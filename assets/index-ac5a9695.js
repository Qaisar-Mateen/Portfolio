function ise(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var M1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function E0(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function rse(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}),i}var MX={exports:{}},IC={},EX={exports:{}},Ti={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ew=Symbol.for("react.element"),nse=Symbol.for("react.portal"),sse=Symbol.for("react.fragment"),ase=Symbol.for("react.strict_mode"),ose=Symbol.for("react.profiler"),lse=Symbol.for("react.provider"),cse=Symbol.for("react.context"),use=Symbol.for("react.forward_ref"),hse=Symbol.for("react.suspense"),dse=Symbol.for("react.memo"),pse=Symbol.for("react.lazy"),P4=Symbol.iterator;function fse(e){return e===null||typeof e!="object"?null:(e=P4&&e[P4]||e["@@iterator"],typeof e=="function"?e:null)}var CX={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},TX=Object.assign,PX={};function C0(e,t,i){this.props=e,this.context=t,this.refs=PX,this.updater=i||CX}C0.prototype.isReactComponent={};C0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};C0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function DX(){}DX.prototype=C0.prototype;function WB(e,t,i){this.props=e,this.context=t,this.refs=PX,this.updater=i||CX}var XB=WB.prototype=new DX;XB.constructor=WB;TX(XB,C0.prototype);XB.isPureReactComponent=!0;var D4=Array.isArray,RX=Object.prototype.hasOwnProperty,YB={current:null},IX={key:!0,ref:!0,__self:!0,__source:!0};function LX(e,t,i){var r,n={},s=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)RX.call(t,r)&&!IX.hasOwnProperty(r)&&(n[r]=t[r]);var o=arguments.length-2;if(o===1)n.children=i;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)n[r]===void 0&&(n[r]=o[r]);return{$$typeof:Ew,type:e,key:s,ref:a,props:n,_owner:YB.current}}function mse(e,t){return{$$typeof:Ew,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function qB(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ew}function gse(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var R4=/\/+/g;function Z2(e,t){return typeof e=="object"&&e!==null&&e.key!=null?gse(""+e.key):t.toString(36)}function ZA(e,t,i,r,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Ew:case nse:a=!0}}if(a)return a=e,n=n(a),e=r===""?"."+Z2(a,0):r,D4(n)?(i="",e!=null&&(i=e.replace(R4,"$&/")+"/"),ZA(n,t,i,"",function(c){return c})):n!=null&&(qB(n)&&(n=mse(n,i+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(R4,"$&/")+"/")+e)),t.push(n)),1;if(a=0,r=r===""?".":r+":",D4(e))for(var o=0;o<e.length;o++){s=e[o];var l=r+Z2(s,o);a+=ZA(s,t,i,l,n)}else if(l=fse(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=r+Z2(s,o++),a+=ZA(s,t,i,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function p_(e,t,i){if(e==null)return e;var r=[],n=0;return ZA(e,r,"","",function(s){return t.call(i,s,n++)}),r}function vse(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ca={current:null},$A={transition:null},yse={ReactCurrentDispatcher:ca,ReactCurrentBatchConfig:$A,ReactCurrentOwner:YB};function OX(){throw Error("act(...) is not supported in production builds of React.")}Ti.Children={map:p_,forEach:function(e,t,i){p_(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return p_(e,function(){t++}),t},toArray:function(e){return p_(e,function(t){return t})||[]},only:function(e){if(!qB(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ti.Component=C0;Ti.Fragment=sse;Ti.Profiler=ose;Ti.PureComponent=WB;Ti.StrictMode=ase;Ti.Suspense=hse;Ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yse;Ti.act=OX;Ti.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=TX({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=YB.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)RX.call(t,l)&&!IX.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:Ew,type:e.type,key:n,ref:s,props:r,_owner:a}};Ti.createContext=function(e){return e={$$typeof:cse,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:lse,_context:e},e.Consumer=e};Ti.createElement=LX;Ti.createFactory=function(e){var t=LX.bind(null,e);return t.type=e,t};Ti.createRef=function(){return{current:null}};Ti.forwardRef=function(e){return{$$typeof:use,render:e}};Ti.isValidElement=qB;Ti.lazy=function(e){return{$$typeof:pse,_payload:{_status:-1,_result:e},_init:vse}};Ti.memo=function(e,t){return{$$typeof:dse,type:e,compare:t===void 0?null:t}};Ti.startTransition=function(e){var t=$A.transition;$A.transition={};try{e()}finally{$A.transition=t}};Ti.unstable_act=OX;Ti.useCallback=function(e,t){return ca.current.useCallback(e,t)};Ti.useContext=function(e){return ca.current.useContext(e)};Ti.useDebugValue=function(){};Ti.useDeferredValue=function(e){return ca.current.useDeferredValue(e)};Ti.useEffect=function(e,t){return ca.current.useEffect(e,t)};Ti.useId=function(){return ca.current.useId()};Ti.useImperativeHandle=function(e,t,i){return ca.current.useImperativeHandle(e,t,i)};Ti.useInsertionEffect=function(e,t){return ca.current.useInsertionEffect(e,t)};Ti.useLayoutEffect=function(e,t){return ca.current.useLayoutEffect(e,t)};Ti.useMemo=function(e,t){return ca.current.useMemo(e,t)};Ti.useReducer=function(e,t,i){return ca.current.useReducer(e,t,i)};Ti.useRef=function(e){return ca.current.useRef(e)};Ti.useState=function(e){return ca.current.useState(e)};Ti.useSyncExternalStore=function(e,t,i){return ca.current.useSyncExternalStore(e,t,i)};Ti.useTransition=function(){return ca.current.useTransition()};Ti.version="18.3.1";EX.exports=Ti;var fe=EX.exports;const Ku=E0(fe),xse=ise({__proto__:null,default:Ku},[fe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wse=fe,bse=Symbol.for("react.element"),_se=Symbol.for("react.fragment"),Sse=Object.prototype.hasOwnProperty,Ase=wse.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Mse={key:!0,ref:!0,__self:!0,__source:!0};function BX(e,t,i){var r,n={},s=null,a=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)Sse.call(t,r)&&!Mse.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:bse,type:e,key:s,ref:a,props:n,_owner:Ase.current}}IC.Fragment=_se;IC.jsx=BX;IC.jsxs=BX;MX.exports=IC;var He=MX.exports,FX={exports:{}},ro={},NX={exports:{}},UX={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(U,j){var k=U.length;U.push(j);e:for(;0<k;){var q=k-1>>>1,W=U[q];if(0<n(W,j))U[q]=j,U[k]=W,k=q;else break e}}function i(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var j=U[0],k=U.pop();if(k!==j){U[0]=k;e:for(var q=0,W=U.length,te=W>>>1;q<te;){var G=2*(q+1)-1,le=U[G],Z=G+1,he=U[Z];if(0>n(le,k))Z<W&&0>n(he,le)?(U[q]=he,U[Z]=k,q=Z):(U[q]=le,U[G]=k,q=G);else if(Z<W&&0>n(he,k))U[q]=he,U[Z]=k,q=Z;else break e}}return j}function n(U,j){var k=U.sortIndex-j.sortIndex;return k!==0?k:U.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(U){for(var j=i(c);j!==null;){if(j.callback===null)r(c);else if(j.startTime<=U)r(c),j.sortIndex=j.expirationTime,t(l,j);else break;j=i(c)}}function _(U){if(g=!1,y(U),!f)if(i(l)!==null)f=!0,K(A);else{var j=i(c);j!==null&&Y(_,j.startTime-U)}}function A(U,j){f=!1,g&&(g=!1,v(M),M=-1),p=!0;var k=d;try{for(y(j),h=i(l);h!==null&&(!(h.expirationTime>j)||U&&!R());){var q=h.callback;if(typeof q=="function"){h.callback=null,d=h.priorityLevel;var W=q(h.expirationTime<=j);j=e.unstable_now(),typeof W=="function"?h.callback=W:h===i(l)&&r(l),y(j)}else r(l);h=i(l)}if(h!==null)var te=!0;else{var G=i(c);G!==null&&Y(_,G.startTime-j),te=!1}return te}finally{h=null,d=k,p=!1}}var S=!1,C=null,M=-1,E=5,P=-1;function R(){return!(e.unstable_now()-P<E)}function O(){if(C!==null){var U=e.unstable_now();P=U;var j=!0;try{j=C(!0,U)}finally{j?L():(S=!1,C=null)}}else S=!1}var L;if(typeof x=="function")L=function(){x(O)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,z=I.port2;I.port1.onmessage=O,L=function(){z.postMessage(null)}}else L=function(){m(O,0)};function K(U){C=U,S||(S=!0,L())}function Y(U,j){M=m(function(){U(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(U){U.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,K(A))},e.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<U?Math.floor(1e3/U):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(U){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var k=d;d=j;try{return U()}finally{d=k}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(U,j){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var k=d;d=U;try{return j()}finally{d=k}},e.unstable_scheduleCallback=function(U,j,k){var q=e.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?q+k:q):k=q,U){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=k+W,U={id:u++,callback:j,priorityLevel:U,startTime:k,expirationTime:W,sortIndex:-1},k>q?(U.sortIndex=k,t(c,U),i(l)===null&&U===i(c)&&(g?(v(M),M=-1):g=!0,Y(_,k-q))):(U.sortIndex=W,t(l,U),f||p||(f=!0,K(A))),U},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(U){var j=d;return function(){var k=d;d=j;try{return U.apply(this,arguments)}finally{d=k}}}})(UX);NX.exports=UX;var Ese=NX.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cse=fe,eo=Ese;function ft(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kX=new Set,Sx={};function cm(e,t){Qv(e,t),Qv(e+"Capture",t)}function Qv(e,t){for(Sx[e]=t,e=0;e<t.length;e++)kX.add(t[e])}var Zu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),z3=Object.prototype.hasOwnProperty,Tse=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I4={},L4={};function Pse(e){return z3.call(L4,e)?!0:z3.call(I4,e)?!1:Tse.test(e)?L4[e]=!0:(I4[e]=!0,!1)}function Dse(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Rse(e,t,i,r){if(t===null||typeof t>"u"||Dse(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ua(e,t,i,r,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var xs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){xs[e]=new ua(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];xs[t]=new ua(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){xs[e]=new ua(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){xs[e]=new ua(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){xs[e]=new ua(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){xs[e]=new ua(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){xs[e]=new ua(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){xs[e]=new ua(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){xs[e]=new ua(e,5,!1,e.toLowerCase(),null,!1,!1)});var QB=/[\-:]([a-z])/g;function JB(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(QB,JB);xs[t]=new ua(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(QB,JB);xs[t]=new ua(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(QB,JB);xs[t]=new ua(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){xs[e]=new ua(e,1,!1,e.toLowerCase(),null,!1,!1)});xs.xlinkHref=new ua("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){xs[e]=new ua(e,1,!1,e.toLowerCase(),null,!0,!0)});function KB(e,t,i,r){var n=xs.hasOwnProperty(t)?xs[t]:null;(n!==null?n.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Rse(t,i,n,r)&&(i=null),r||n===null?Pse(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=i===null?n.type===3?!1:"":i:(t=n.attributeName,r=n.attributeNamespace,i===null?e.removeAttribute(t):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var uh=Cse.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,f_=Symbol.for("react.element"),Jg=Symbol.for("react.portal"),Kg=Symbol.for("react.fragment"),ZB=Symbol.for("react.strict_mode"),V3=Symbol.for("react.profiler"),zX=Symbol.for("react.provider"),VX=Symbol.for("react.context"),$B=Symbol.for("react.forward_ref"),G3=Symbol.for("react.suspense"),H3=Symbol.for("react.suspense_list"),eF=Symbol.for("react.memo"),Jh=Symbol.for("react.lazy"),GX=Symbol.for("react.offscreen"),O4=Symbol.iterator;function Sy(e){return e===null||typeof e!="object"?null:(e=O4&&e[O4]||e["@@iterator"],typeof e=="function"?e:null)}var Fr=Object.assign,$2;function E1(e){if($2===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);$2=t&&t[1]||""}return`
`+$2+e}var eP=!1;function tP(e,t){if(!e||eP)return"";eP=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{eP=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?E1(e):""}function Ise(e){switch(e.tag){case 5:return E1(e.type);case 16:return E1("Lazy");case 13:return E1("Suspense");case 19:return E1("SuspenseList");case 0:case 2:case 15:return e=tP(e.type,!1),e;case 11:return e=tP(e.type.render,!1),e;case 1:return e=tP(e.type,!0),e;default:return""}}function j3(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Kg:return"Fragment";case Jg:return"Portal";case V3:return"Profiler";case ZB:return"StrictMode";case G3:return"Suspense";case H3:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case VX:return(e.displayName||"Context")+".Consumer";case zX:return(e._context.displayName||"Context")+".Provider";case $B:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case eF:return t=e.displayName||null,t!==null?t:j3(e.type)||"Memo";case Jh:t=e._payload,e=e._init;try{return j3(e(t))}catch{}}return null}function Lse(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j3(t);case 8:return t===ZB?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function zd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function HX(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ose(e){var t=HX(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function m_(e){e._valueTracker||(e._valueTracker=Ose(e))}function jX(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=HX(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function kM(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function W3(e,t){var i=t.checked;return Fr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function B4(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=zd(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function WX(e,t){t=t.checked,t!=null&&KB(e,"checked",t,!1)}function X3(e,t){WX(e,t);var i=zd(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Y3(e,t.type,i):t.hasOwnProperty("defaultValue")&&Y3(e,t.type,zd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function F4(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function Y3(e,t,i){(t!=="number"||kM(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var C1=Array.isArray;function Av(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+zd(i),t=null,n=0;n<e.length;n++){if(e[n].value===i){e[n].selected=!0,r&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function q3(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ft(91));return Fr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function N4(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(ft(92));if(C1(i)){if(1<i.length)throw Error(ft(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:zd(i)}}function XX(e,t){var i=zd(t.value),r=zd(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function U4(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function YX(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Q3(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?YX(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var g_,qX=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,n){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(g_=g_||document.createElement("div"),g_.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=g_.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ax(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var H1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bse=["Webkit","ms","Moz","O"];Object.keys(H1).forEach(function(e){Bse.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),H1[t]=H1[e]})});function QX(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||H1.hasOwnProperty(e)&&H1[e]?(""+t).trim():t+"px"}function JX(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=QX(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}var Fse=Fr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function J3(e,t){if(t){if(Fse[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ft(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ft(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ft(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ft(62))}}function K3(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Z3=null;function tF(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var $3=null,Mv=null,Ev=null;function k4(e){if(e=Pw(e)){if(typeof $3!="function")throw Error(ft(280));var t=e.stateNode;t&&(t=NC(t),$3(e.stateNode,e.type,t))}}function KX(e){Mv?Ev?Ev.push(e):Ev=[e]:Mv=e}function ZX(){if(Mv){var e=Mv,t=Ev;if(Ev=Mv=null,k4(e),t)for(e=0;e<t.length;e++)k4(t[e])}}function $X(e,t){return e(t)}function eY(){}var iP=!1;function tY(e,t,i){if(iP)return e(t,i);iP=!0;try{return $X(e,t,i)}finally{iP=!1,(Mv!==null||Ev!==null)&&(eY(),ZX())}}function Mx(e,t){var i=e.stateNode;if(i===null)return null;var r=NC(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(ft(231,t,typeof i));return i}var eI=!1;if(Zu)try{var Ay={};Object.defineProperty(Ay,"passive",{get:function(){eI=!0}}),window.addEventListener("test",Ay,Ay),window.removeEventListener("test",Ay,Ay)}catch{eI=!1}function Nse(e,t,i,r,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(u){this.onError(u)}}var j1=!1,zM=null,VM=!1,tI=null,Use={onError:function(e){j1=!0,zM=e}};function kse(e,t,i,r,n,s,a,o,l){j1=!1,zM=null,Nse.apply(Use,arguments)}function zse(e,t,i,r,n,s,a,o,l){if(kse.apply(this,arguments),j1){if(j1){var c=zM;j1=!1,zM=null}else throw Error(ft(198));VM||(VM=!0,tI=c)}}function um(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function iY(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function z4(e){if(um(e)!==e)throw Error(ft(188))}function Vse(e){var t=e.alternate;if(!t){if(t=um(e),t===null)throw Error(ft(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return z4(n),e;if(s===r)return z4(n),t;s=s.sibling}throw Error(ft(188))}if(i.return!==r.return)i=n,r=s;else{for(var a=!1,o=n.child;o;){if(o===i){a=!0,i=n,r=s;break}if(o===r){a=!0,r=n,i=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===i){a=!0,i=s,r=n;break}if(o===r){a=!0,r=s,i=n;break}o=o.sibling}if(!a)throw Error(ft(189))}}if(i.alternate!==r)throw Error(ft(190))}if(i.tag!==3)throw Error(ft(188));return i.stateNode.current===i?e:t}function rY(e){return e=Vse(e),e!==null?nY(e):null}function nY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=nY(e);if(t!==null)return t;e=e.sibling}return null}var sY=eo.unstable_scheduleCallback,V4=eo.unstable_cancelCallback,Gse=eo.unstable_shouldYield,Hse=eo.unstable_requestPaint,en=eo.unstable_now,jse=eo.unstable_getCurrentPriorityLevel,iF=eo.unstable_ImmediatePriority,aY=eo.unstable_UserBlockingPriority,GM=eo.unstable_NormalPriority,Wse=eo.unstable_LowPriority,oY=eo.unstable_IdlePriority,LC=null,Ec=null;function Xse(e){if(Ec&&typeof Ec.onCommitFiberRoot=="function")try{Ec.onCommitFiberRoot(LC,e,void 0,(e.current.flags&128)===128)}catch{}}var Ml=Math.clz32?Math.clz32:Qse,Yse=Math.log,qse=Math.LN2;function Qse(e){return e>>>=0,e===0?32:31-(Yse(e)/qse|0)|0}var v_=64,y_=4194304;function T1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function HM(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,n=e.suspendedLanes,s=e.pingedLanes,a=i&268435455;if(a!==0){var o=a&~n;o!==0?r=T1(o):(s&=a,s!==0&&(r=T1(s)))}else a=i&~n,a!==0?r=T1(a):s!==0&&(r=T1(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&n)&&(n=r&-r,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-Ml(t),n=1<<i,r|=e[i],t&=~n;return r}function Jse(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kse(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-Ml(s),o=1<<a,l=n[a];l===-1?(!(o&i)||o&r)&&(n[a]=Jse(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function iI(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function lY(){var e=v_;return v_<<=1,!(v_&4194240)&&(v_=64),e}function rP(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Cw(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ml(t),e[t]=i}function Zse(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-Ml(i),s=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~s}}function rF(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-Ml(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var tr=0;function cY(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var uY,nF,hY,dY,pY,rI=!1,x_=[],wd=null,bd=null,_d=null,Ex=new Map,Cx=new Map,td=[],$se="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function G4(e,t){switch(e){case"focusin":case"focusout":wd=null;break;case"dragenter":case"dragleave":bd=null;break;case"mouseover":case"mouseout":_d=null;break;case"pointerover":case"pointerout":Ex.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Cx.delete(t.pointerId)}}function My(e,t,i,r,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},t!==null&&(t=Pw(t),t!==null&&nF(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function eae(e,t,i,r,n){switch(t){case"focusin":return wd=My(wd,e,t,i,r,n),!0;case"dragenter":return bd=My(bd,e,t,i,r,n),!0;case"mouseover":return _d=My(_d,e,t,i,r,n),!0;case"pointerover":var s=n.pointerId;return Ex.set(s,My(Ex.get(s)||null,e,t,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,Cx.set(s,My(Cx.get(s)||null,e,t,i,r,n)),!0}return!1}function fY(e){var t=lf(e.target);if(t!==null){var i=um(t);if(i!==null){if(t=i.tag,t===13){if(t=iY(i),t!==null){e.blockedOn=t,pY(e.priority,function(){hY(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function eM(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=nI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);Z3=r,i.target.dispatchEvent(r),Z3=null}else return t=Pw(i),t!==null&&nF(t),e.blockedOn=i,!1;t.shift()}return!0}function H4(e,t,i){eM(e)&&i.delete(t)}function tae(){rI=!1,wd!==null&&eM(wd)&&(wd=null),bd!==null&&eM(bd)&&(bd=null),_d!==null&&eM(_d)&&(_d=null),Ex.forEach(H4),Cx.forEach(H4)}function Ey(e,t){e.blockedOn===t&&(e.blockedOn=null,rI||(rI=!0,eo.unstable_scheduleCallback(eo.unstable_NormalPriority,tae)))}function Tx(e){function t(n){return Ey(n,e)}if(0<x_.length){Ey(x_[0],e);for(var i=1;i<x_.length;i++){var r=x_[i];r.blockedOn===e&&(r.blockedOn=null)}}for(wd!==null&&Ey(wd,e),bd!==null&&Ey(bd,e),_d!==null&&Ey(_d,e),Ex.forEach(t),Cx.forEach(t),i=0;i<td.length;i++)r=td[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<td.length&&(i=td[0],i.blockedOn===null);)fY(i),i.blockedOn===null&&td.shift()}var Cv=uh.ReactCurrentBatchConfig,jM=!0;function iae(e,t,i,r){var n=tr,s=Cv.transition;Cv.transition=null;try{tr=1,sF(e,t,i,r)}finally{tr=n,Cv.transition=s}}function rae(e,t,i,r){var n=tr,s=Cv.transition;Cv.transition=null;try{tr=4,sF(e,t,i,r)}finally{tr=n,Cv.transition=s}}function sF(e,t,i,r){if(jM){var n=nI(e,t,i,r);if(n===null)pP(e,t,r,WM,i),G4(e,r);else if(eae(n,e,t,i,r))r.stopPropagation();else if(G4(e,r),t&4&&-1<$se.indexOf(e)){for(;n!==null;){var s=Pw(n);if(s!==null&&uY(s),s=nI(e,t,i,r),s===null&&pP(e,t,r,WM,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else pP(e,t,r,null,i)}}var WM=null;function nI(e,t,i,r){if(WM=null,e=tF(r),e=lf(e),e!==null)if(t=um(e),t===null)e=null;else if(i=t.tag,i===13){if(e=iY(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return WM=e,null}function mY(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jse()){case iF:return 1;case aY:return 4;case GM:case Wse:return 16;case oY:return 536870912;default:return 16}default:return 16}}var cd=null,aF=null,tM=null;function gY(){if(tM)return tM;var e,t=aF,i=t.length,r,n="value"in cd?cd.value:cd.textContent,s=n.length;for(e=0;e<i&&t[e]===n[e];e++);var a=i-e;for(r=1;r<=a&&t[i-r]===n[s-r];r++);return tM=n.slice(e,1<r?1-r:void 0)}function iM(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function w_(){return!0}function j4(){return!1}function no(e){function t(i,r,n,s,a){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?w_:j4,this.isPropagationStopped=j4,this}return Fr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=w_)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=w_)},persist:function(){},isPersistent:w_}),t}var T0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oF=no(T0),Tw=Fr({},T0,{view:0,detail:0}),nae=no(Tw),nP,sP,Cy,OC=Fr({},Tw,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lF,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Cy&&(Cy&&e.type==="mousemove"?(nP=e.screenX-Cy.screenX,sP=e.screenY-Cy.screenY):sP=nP=0,Cy=e),nP)},movementY:function(e){return"movementY"in e?e.movementY:sP}}),W4=no(OC),sae=Fr({},OC,{dataTransfer:0}),aae=no(sae),oae=Fr({},Tw,{relatedTarget:0}),aP=no(oae),lae=Fr({},T0,{animationName:0,elapsedTime:0,pseudoElement:0}),cae=no(lae),uae=Fr({},T0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),hae=no(uae),dae=Fr({},T0,{data:0}),X4=no(dae),pae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fae={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gae(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=mae[e])?!!t[e]:!1}function lF(){return gae}var vae=Fr({},Tw,{key:function(e){if(e.key){var t=pae[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=iM(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?fae[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lF,charCode:function(e){return e.type==="keypress"?iM(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?iM(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),yae=no(vae),xae=Fr({},OC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Y4=no(xae),wae=Fr({},Tw,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lF}),bae=no(wae),_ae=Fr({},T0,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sae=no(_ae),Aae=Fr({},OC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Mae=no(Aae),Eae=[9,13,27,32],cF=Zu&&"CompositionEvent"in window,W1=null;Zu&&"documentMode"in document&&(W1=document.documentMode);var Cae=Zu&&"TextEvent"in window&&!W1,vY=Zu&&(!cF||W1&&8<W1&&11>=W1),q4=String.fromCharCode(32),Q4=!1;function yY(e,t){switch(e){case"keyup":return Eae.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xY(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Zg=!1;function Tae(e,t){switch(e){case"compositionend":return xY(t);case"keypress":return t.which!==32?null:(Q4=!0,q4);case"textInput":return e=t.data,e===q4&&Q4?null:e;default:return null}}function Pae(e,t){if(Zg)return e==="compositionend"||!cF&&yY(e,t)?(e=gY(),tM=aF=cd=null,Zg=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return vY&&t.locale!=="ko"?null:t.data;default:return null}}var Dae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Dae[e.type]:t==="textarea"}function wY(e,t,i,r){KX(r),t=XM(t,"onChange"),0<t.length&&(i=new oF("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var X1=null,Px=null;function Rae(e){RY(e,0)}function BC(e){var t=tv(e);if(jX(t))return e}function Iae(e,t){if(e==="change")return t}var bY=!1;if(Zu){var oP;if(Zu){var lP="oninput"in document;if(!lP){var K4=document.createElement("div");K4.setAttribute("oninput","return;"),lP=typeof K4.oninput=="function"}oP=lP}else oP=!1;bY=oP&&(!document.documentMode||9<document.documentMode)}function Z4(){X1&&(X1.detachEvent("onpropertychange",_Y),Px=X1=null)}function _Y(e){if(e.propertyName==="value"&&BC(Px)){var t=[];wY(t,Px,e,tF(e)),tY(Rae,t)}}function Lae(e,t,i){e==="focusin"?(Z4(),X1=t,Px=i,X1.attachEvent("onpropertychange",_Y)):e==="focusout"&&Z4()}function Oae(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return BC(Px)}function Bae(e,t){if(e==="click")return BC(t)}function Fae(e,t){if(e==="input"||e==="change")return BC(t)}function Nae(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Il=typeof Object.is=="function"?Object.is:Nae;function Dx(e,t){if(Il(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!z3.call(t,n)||!Il(e[n],t[n]))return!1}return!0}function $4(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function eV(e,t){var i=$4(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=$4(i)}}function SY(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?SY(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function AY(){for(var e=window,t=kM();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=kM(e.document)}return t}function uF(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Uae(e){var t=AY(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&SY(i.ownerDocument.documentElement,i)){if(r!==null&&uF(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!e.extend&&s>r&&(n=r,r=s,s=n),n=eV(i,s);var a=eV(i,r);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var kae=Zu&&"documentMode"in document&&11>=document.documentMode,$g=null,sI=null,Y1=null,aI=!1;function tV(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;aI||$g==null||$g!==kM(r)||(r=$g,"selectionStart"in r&&uF(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Y1&&Dx(Y1,r)||(Y1=r,r=XM(sI,"onSelect"),0<r.length&&(t=new oF("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=$g)))}function b_(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var ev={animationend:b_("Animation","AnimationEnd"),animationiteration:b_("Animation","AnimationIteration"),animationstart:b_("Animation","AnimationStart"),transitionend:b_("Transition","TransitionEnd")},cP={},MY={};Zu&&(MY=document.createElement("div").style,"AnimationEvent"in window||(delete ev.animationend.animation,delete ev.animationiteration.animation,delete ev.animationstart.animation),"TransitionEvent"in window||delete ev.transitionend.transition);function FC(e){if(cP[e])return cP[e];if(!ev[e])return e;var t=ev[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in MY)return cP[e]=t[i];return e}var EY=FC("animationend"),CY=FC("animationiteration"),TY=FC("animationstart"),PY=FC("transitionend"),DY=new Map,iV="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $d(e,t){DY.set(e,t),cm(t,[e])}for(var uP=0;uP<iV.length;uP++){var hP=iV[uP],zae=hP.toLowerCase(),Vae=hP[0].toUpperCase()+hP.slice(1);$d(zae,"on"+Vae)}$d(EY,"onAnimationEnd");$d(CY,"onAnimationIteration");$d(TY,"onAnimationStart");$d("dblclick","onDoubleClick");$d("focusin","onFocus");$d("focusout","onBlur");$d(PY,"onTransitionEnd");Qv("onMouseEnter",["mouseout","mouseover"]);Qv("onMouseLeave",["mouseout","mouseover"]);Qv("onPointerEnter",["pointerout","pointerover"]);Qv("onPointerLeave",["pointerout","pointerover"]);cm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cm("onBeforeInput",["compositionend","keypress","textInput","paste"]);cm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var P1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gae=new Set("cancel close invalid load scroll toggle".split(" ").concat(P1));function rV(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,zse(r,t,void 0,e),e.currentTarget=null}function RY(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;rV(n,o,c),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;rV(n,o,c),s=l}}}if(VM)throw e=tI,VM=!1,tI=null,e}function vr(e,t){var i=t[hI];i===void 0&&(i=t[hI]=new Set);var r=e+"__bubble";i.has(r)||(IY(t,e,2,!1),i.add(r))}function dP(e,t,i){var r=0;t&&(r|=4),IY(i,e,r,t)}var __="_reactListening"+Math.random().toString(36).slice(2);function Rx(e){if(!e[__]){e[__]=!0,kX.forEach(function(i){i!=="selectionchange"&&(Gae.has(i)||dP(i,!1,e),dP(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[__]||(t[__]=!0,dP("selectionchange",!1,t))}}function IY(e,t,i,r){switch(mY(t)){case 1:var n=iae;break;case 4:n=rae;break;default:n=sF}i=n.bind(null,t,i,e),n=void 0,!eI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),r?n!==void 0?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):n!==void 0?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function pP(e,t,i,r,n){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=lf(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}tY(function(){var c=s,u=tF(i),h=[];e:{var d=DY.get(e);if(d!==void 0){var p=oF,f=e;switch(e){case"keypress":if(iM(i)===0)break e;case"keydown":case"keyup":p=yae;break;case"focusin":f="focus",p=aP;break;case"focusout":f="blur",p=aP;break;case"beforeblur":case"afterblur":p=aP;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=W4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=aae;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=bae;break;case EY:case CY:case TY:p=cae;break;case PY:p=Sae;break;case"scroll":p=nae;break;case"wheel":p=Mae;break;case"copy":case"cut":case"paste":p=hae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Y4}var g=(t&4)!==0,m=!g&&e==="scroll",v=g?d!==null?d+"Capture":null:d;g=[];for(var x=c,y;x!==null;){y=x;var _=y.stateNode;if(y.tag===5&&_!==null&&(y=_,v!==null&&(_=Mx(x,v),_!=null&&g.push(Ix(x,_,y)))),m)break;x=x.return}0<g.length&&(d=new p(d,f,null,i,u),h.push({event:d,listeners:g}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&i!==Z3&&(f=i.relatedTarget||i.fromElement)&&(lf(f)||f[$u]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=i.relatedTarget||i.toElement,p=c,f=f?lf(f):null,f!==null&&(m=um(f),f!==m||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(g=W4,_="onMouseLeave",v="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(g=Y4,_="onPointerLeave",v="onPointerEnter",x="pointer"),m=p==null?d:tv(p),y=f==null?d:tv(f),d=new g(_,x+"leave",p,i,u),d.target=m,d.relatedTarget=y,_=null,lf(u)===c&&(g=new g(v,x+"enter",f,i,u),g.target=y,g.relatedTarget=m,_=g),m=_,p&&f)t:{for(g=p,v=f,x=0,y=g;y;y=Nm(y))x++;for(y=0,_=v;_;_=Nm(_))y++;for(;0<x-y;)g=Nm(g),x--;for(;0<y-x;)v=Nm(v),y--;for(;x--;){if(g===v||v!==null&&g===v.alternate)break t;g=Nm(g),v=Nm(v)}g=null}else g=null;p!==null&&nV(h,d,p,g,!1),f!==null&&m!==null&&nV(h,m,f,g,!0)}}e:{if(d=c?tv(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var A=Iae;else if(J4(d))if(bY)A=Fae;else{A=Oae;var S=Lae}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(A=Bae);if(A&&(A=A(e,c))){wY(h,A,i,u);break e}S&&S(e,d,c),e==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&Y3(d,"number",d.value)}switch(S=c?tv(c):window,e){case"focusin":(J4(S)||S.contentEditable==="true")&&($g=S,sI=c,Y1=null);break;case"focusout":Y1=sI=$g=null;break;case"mousedown":aI=!0;break;case"contextmenu":case"mouseup":case"dragend":aI=!1,tV(h,i,u);break;case"selectionchange":if(kae)break;case"keydown":case"keyup":tV(h,i,u)}var C;if(cF)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Zg?yY(e,i)&&(M="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(M="onCompositionStart");M&&(vY&&i.locale!=="ko"&&(Zg||M!=="onCompositionStart"?M==="onCompositionEnd"&&Zg&&(C=gY()):(cd=u,aF="value"in cd?cd.value:cd.textContent,Zg=!0)),S=XM(c,M),0<S.length&&(M=new X4(M,e,null,i,u),h.push({event:M,listeners:S}),C?M.data=C:(C=xY(i),C!==null&&(M.data=C)))),(C=Cae?Tae(e,i):Pae(e,i))&&(c=XM(c,"onBeforeInput"),0<c.length&&(u=new X4("onBeforeInput","beforeinput",null,i,u),h.push({event:u,listeners:c}),u.data=C))}RY(h,t)})}function Ix(e,t,i){return{instance:e,listener:t,currentTarget:i}}function XM(e,t){for(var i=t+"Capture",r=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=Mx(e,i),s!=null&&r.unshift(Ix(e,s,n)),s=Mx(e,t),s!=null&&r.push(Ix(e,s,n))),e=e.return}return r}function Nm(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function nV(e,t,i,r,n){for(var s=t._reactName,a=[];i!==null&&i!==r;){var o=i,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,n?(l=Mx(i,s),l!=null&&a.unshift(Ix(i,l,o))):n||(l=Mx(i,s),l!=null&&a.push(Ix(i,l,o)))),i=i.return}a.length!==0&&e.push({event:t,listeners:a})}var Hae=/\r\n?/g,jae=/\u0000|\uFFFD/g;function sV(e){return(typeof e=="string"?e:""+e).replace(Hae,`
`).replace(jae,"")}function S_(e,t,i){if(t=sV(t),sV(e)!==t&&i)throw Error(ft(425))}function YM(){}var oI=null,lI=null;function cI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var uI=typeof setTimeout=="function"?setTimeout:void 0,Wae=typeof clearTimeout=="function"?clearTimeout:void 0,aV=typeof Promise=="function"?Promise:void 0,Xae=typeof queueMicrotask=="function"?queueMicrotask:typeof aV<"u"?function(e){return aV.resolve(null).then(e).catch(Yae)}:uI;function Yae(e){setTimeout(function(){throw e})}function fP(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){e.removeChild(n),Tx(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);Tx(t)}function Sd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function oV(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var P0=Math.random().toString(36).slice(2),yc="__reactFiber$"+P0,Lx="__reactProps$"+P0,$u="__reactContainer$"+P0,hI="__reactEvents$"+P0,qae="__reactListeners$"+P0,Qae="__reactHandles$"+P0;function lf(e){var t=e[yc];if(t)return t;for(var i=e.parentNode;i;){if(t=i[$u]||i[yc]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=oV(e);e!==null;){if(i=e[yc])return i;e=oV(e)}return t}e=i,i=e.parentNode}return null}function Pw(e){return e=e[yc]||e[$u],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function tv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ft(33))}function NC(e){return e[Lx]||null}var dI=[],iv=-1;function ep(e){return{current:e}}function wr(e){0>iv||(e.current=dI[iv],dI[iv]=null,iv--)}function fr(e,t){iv++,dI[iv]=e.current,e.current=t}var Vd={},Ns=ep(Vd),Pa=ep(!1),Gf=Vd;function Jv(e,t){var i=e.type.contextTypes;if(!i)return Vd;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Da(e){return e=e.childContextTypes,e!=null}function qM(){wr(Pa),wr(Ns)}function lV(e,t,i){if(Ns.current!==Vd)throw Error(ft(168));fr(Ns,t),fr(Pa,i)}function LY(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in t))throw Error(ft(108,Lse(e)||"Unknown",n));return Fr({},i,r)}function QM(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vd,Gf=Ns.current,fr(Ns,e),fr(Pa,Pa.current),!0}function cV(e,t,i){var r=e.stateNode;if(!r)throw Error(ft(169));i?(e=LY(e,t,Gf),r.__reactInternalMemoizedMergedChildContext=e,wr(Pa),wr(Ns),fr(Ns,e)):wr(Pa),fr(Pa,i)}var Au=null,UC=!1,mP=!1;function OY(e){Au===null?Au=[e]:Au.push(e)}function Jae(e){UC=!0,OY(e)}function tp(){if(!mP&&Au!==null){mP=!0;var e=0,t=tr;try{var i=Au;for(tr=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}Au=null,UC=!1}catch(n){throw Au!==null&&(Au=Au.slice(e+1)),sY(iF,tp),n}finally{tr=t,mP=!1}}return null}var rv=[],nv=0,JM=null,KM=0,Ro=[],Io=0,Hf=null,Lu=1,Ou="";function Gp(e,t){rv[nv++]=KM,rv[nv++]=JM,JM=e,KM=t}function BY(e,t,i){Ro[Io++]=Lu,Ro[Io++]=Ou,Ro[Io++]=Hf,Hf=e;var r=Lu;e=Ou;var n=32-Ml(r)-1;r&=~(1<<n),i+=1;var s=32-Ml(t)+n;if(30<s){var a=n-n%5;s=(r&(1<<a)-1).toString(32),r>>=a,n-=a,Lu=1<<32-Ml(t)+n|i<<n|r,Ou=s+e}else Lu=1<<s|i<<n|r,Ou=e}function hF(e){e.return!==null&&(Gp(e,1),BY(e,1,0))}function dF(e){for(;e===JM;)JM=rv[--nv],rv[nv]=null,KM=rv[--nv],rv[nv]=null;for(;e===Hf;)Hf=Ro[--Io],Ro[Io]=null,Ou=Ro[--Io],Ro[Io]=null,Lu=Ro[--Io],Ro[Io]=null}var Za=null,qa=null,Ar=!1,yl=null;function FY(e,t){var i=Fo(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function uV(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Za=e,qa=Sd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Za=e,qa=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Hf!==null?{id:Lu,overflow:Ou}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Fo(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,Za=e,qa=null,!0):!1;default:return!1}}function pI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function fI(e){if(Ar){var t=qa;if(t){var i=t;if(!uV(e,t)){if(pI(e))throw Error(ft(418));t=Sd(i.nextSibling);var r=Za;t&&uV(e,t)?FY(r,i):(e.flags=e.flags&-4097|2,Ar=!1,Za=e)}}else{if(pI(e))throw Error(ft(418));e.flags=e.flags&-4097|2,Ar=!1,Za=e}}}function hV(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Za=e}function A_(e){if(e!==Za)return!1;if(!Ar)return hV(e),Ar=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!cI(e.type,e.memoizedProps)),t&&(t=qa)){if(pI(e))throw NY(),Error(ft(418));for(;t;)FY(e,t),t=Sd(t.nextSibling)}if(hV(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ft(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){qa=Sd(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}qa=null}}else qa=Za?Sd(e.stateNode.nextSibling):null;return!0}function NY(){for(var e=qa;e;)e=Sd(e.nextSibling)}function Kv(){qa=Za=null,Ar=!1}function pF(e){yl===null?yl=[e]:yl.push(e)}var Kae=uh.ReactCurrentBatchConfig;function Ty(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ft(309));var r=i.stateNode}if(!r)throw Error(ft(147,e));var n=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(ft(284));if(!i._owner)throw Error(ft(290,e))}return e}function M_(e,t){throw e=Object.prototype.toString.call(t),Error(ft(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function dV(e){var t=e._init;return t(e._payload)}function UY(e){function t(v,x){if(e){var y=v.deletions;y===null?(v.deletions=[x],v.flags|=16):y.push(x)}}function i(v,x){if(!e)return null;for(;x!==null;)t(v,x),x=x.sibling;return null}function r(v,x){for(v=new Map;x!==null;)x.key!==null?v.set(x.key,x):v.set(x.index,x),x=x.sibling;return v}function n(v,x){return v=Cd(v,x),v.index=0,v.sibling=null,v}function s(v,x,y){return v.index=y,e?(y=v.alternate,y!==null?(y=y.index,y<x?(v.flags|=2,x):y):(v.flags|=2,x)):(v.flags|=1048576,x)}function a(v){return e&&v.alternate===null&&(v.flags|=2),v}function o(v,x,y,_){return x===null||x.tag!==6?(x=_P(y,v.mode,_),x.return=v,x):(x=n(x,y),x.return=v,x)}function l(v,x,y,_){var A=y.type;return A===Kg?u(v,x,y.props.children,_,y.key):x!==null&&(x.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Jh&&dV(A)===x.type)?(_=n(x,y.props),_.ref=Ty(v,x,y),_.return=v,_):(_=cM(y.type,y.key,y.props,null,v.mode,_),_.ref=Ty(v,x,y),_.return=v,_)}function c(v,x,y,_){return x===null||x.tag!==4||x.stateNode.containerInfo!==y.containerInfo||x.stateNode.implementation!==y.implementation?(x=SP(y,v.mode,_),x.return=v,x):(x=n(x,y.children||[]),x.return=v,x)}function u(v,x,y,_,A){return x===null||x.tag!==7?(x=Pf(y,v.mode,_,A),x.return=v,x):(x=n(x,y),x.return=v,x)}function h(v,x,y){if(typeof x=="string"&&x!==""||typeof x=="number")return x=_P(""+x,v.mode,y),x.return=v,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case f_:return y=cM(x.type,x.key,x.props,null,v.mode,y),y.ref=Ty(v,null,x),y.return=v,y;case Jg:return x=SP(x,v.mode,y),x.return=v,x;case Jh:var _=x._init;return h(v,_(x._payload),y)}if(C1(x)||Sy(x))return x=Pf(x,v.mode,y,null),x.return=v,x;M_(v,x)}return null}function d(v,x,y,_){var A=x!==null?x.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return A!==null?null:o(v,x,""+y,_);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case f_:return y.key===A?l(v,x,y,_):null;case Jg:return y.key===A?c(v,x,y,_):null;case Jh:return A=y._init,d(v,x,A(y._payload),_)}if(C1(y)||Sy(y))return A!==null?null:u(v,x,y,_,null);M_(v,y)}return null}function p(v,x,y,_,A){if(typeof _=="string"&&_!==""||typeof _=="number")return v=v.get(y)||null,o(x,v,""+_,A);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case f_:return v=v.get(_.key===null?y:_.key)||null,l(x,v,_,A);case Jg:return v=v.get(_.key===null?y:_.key)||null,c(x,v,_,A);case Jh:var S=_._init;return p(v,x,y,S(_._payload),A)}if(C1(_)||Sy(_))return v=v.get(y)||null,u(x,v,_,A,null);M_(x,_)}return null}function f(v,x,y,_){for(var A=null,S=null,C=x,M=x=0,E=null;C!==null&&M<y.length;M++){C.index>M?(E=C,C=null):E=C.sibling;var P=d(v,C,y[M],_);if(P===null){C===null&&(C=E);break}e&&C&&P.alternate===null&&t(v,C),x=s(P,x,M),S===null?A=P:S.sibling=P,S=P,C=E}if(M===y.length)return i(v,C),Ar&&Gp(v,M),A;if(C===null){for(;M<y.length;M++)C=h(v,y[M],_),C!==null&&(x=s(C,x,M),S===null?A=C:S.sibling=C,S=C);return Ar&&Gp(v,M),A}for(C=r(v,C);M<y.length;M++)E=p(C,v,M,y[M],_),E!==null&&(e&&E.alternate!==null&&C.delete(E.key===null?M:E.key),x=s(E,x,M),S===null?A=E:S.sibling=E,S=E);return e&&C.forEach(function(R){return t(v,R)}),Ar&&Gp(v,M),A}function g(v,x,y,_){var A=Sy(y);if(typeof A!="function")throw Error(ft(150));if(y=A.call(y),y==null)throw Error(ft(151));for(var S=A=null,C=x,M=x=0,E=null,P=y.next();C!==null&&!P.done;M++,P=y.next()){C.index>M?(E=C,C=null):E=C.sibling;var R=d(v,C,P.value,_);if(R===null){C===null&&(C=E);break}e&&C&&R.alternate===null&&t(v,C),x=s(R,x,M),S===null?A=R:S.sibling=R,S=R,C=E}if(P.done)return i(v,C),Ar&&Gp(v,M),A;if(C===null){for(;!P.done;M++,P=y.next())P=h(v,P.value,_),P!==null&&(x=s(P,x,M),S===null?A=P:S.sibling=P,S=P);return Ar&&Gp(v,M),A}for(C=r(v,C);!P.done;M++,P=y.next())P=p(C,v,M,P.value,_),P!==null&&(e&&P.alternate!==null&&C.delete(P.key===null?M:P.key),x=s(P,x,M),S===null?A=P:S.sibling=P,S=P);return e&&C.forEach(function(O){return t(v,O)}),Ar&&Gp(v,M),A}function m(v,x,y,_){if(typeof y=="object"&&y!==null&&y.type===Kg&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case f_:e:{for(var A=y.key,S=x;S!==null;){if(S.key===A){if(A=y.type,A===Kg){if(S.tag===7){i(v,S.sibling),x=n(S,y.props.children),x.return=v,v=x;break e}}else if(S.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Jh&&dV(A)===S.type){i(v,S.sibling),x=n(S,y.props),x.ref=Ty(v,S,y),x.return=v,v=x;break e}i(v,S);break}else t(v,S);S=S.sibling}y.type===Kg?(x=Pf(y.props.children,v.mode,_,y.key),x.return=v,v=x):(_=cM(y.type,y.key,y.props,null,v.mode,_),_.ref=Ty(v,x,y),_.return=v,v=_)}return a(v);case Jg:e:{for(S=y.key;x!==null;){if(x.key===S)if(x.tag===4&&x.stateNode.containerInfo===y.containerInfo&&x.stateNode.implementation===y.implementation){i(v,x.sibling),x=n(x,y.children||[]),x.return=v,v=x;break e}else{i(v,x);break}else t(v,x);x=x.sibling}x=SP(y,v.mode,_),x.return=v,v=x}return a(v);case Jh:return S=y._init,m(v,x,S(y._payload),_)}if(C1(y))return f(v,x,y,_);if(Sy(y))return g(v,x,y,_);M_(v,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,x!==null&&x.tag===6?(i(v,x.sibling),x=n(x,y),x.return=v,v=x):(i(v,x),x=_P(y,v.mode,_),x.return=v,v=x),a(v)):i(v,x)}return m}var Zv=UY(!0),kY=UY(!1),ZM=ep(null),$M=null,sv=null,fF=null;function mF(){fF=sv=$M=null}function gF(e){var t=ZM.current;wr(ZM),e._currentValue=t}function mI(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Tv(e,t){$M=e,fF=sv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ea=!0),e.firstContext=null)}function Go(e){var t=e._currentValue;if(fF!==e)if(e={context:e,memoizedValue:t,next:null},sv===null){if($M===null)throw Error(ft(308));sv=e,$M.dependencies={lanes:0,firstContext:e}}else sv=sv.next=e;return t}var cf=null;function vF(e){cf===null?cf=[e]:cf.push(e)}function zY(e,t,i,r){var n=t.interleaved;return n===null?(i.next=i,vF(t)):(i.next=n.next,n.next=i),t.interleaved=i,eh(e,r)}function eh(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Kh=!1;function yF(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VY(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ju(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ad(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,ki&2){var n=r.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),r.pending=t,eh(e,i)}return n=r.interleaved,n===null?(t.next=t,vF(r)):(t.next=n.next,n.next=t),r.interleaved=t,eh(e,i)}function rM(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,rF(e,i)}}function pV(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=a:s=s.next=a,i=i.next}while(i!==null);s===null?n=s=t:s=s.next=t}else n=s=t;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function eE(e,t,i,r){var n=e.updateQueue;Kh=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;a=0,u=c=l=null,o=s;do{var d=o.lane,p=o.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,g=o;switch(d=t,p=i,g.tag){case 1:if(f=g.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=g.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=Fr({},h,d);break e;case 2:Kh=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,d=n.effects,d===null?n.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,a|=d;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;d=o,o=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(1);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Wf|=a,e.lanes=a,e.memoizedState=h}}function fV(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(ft(191,n));n.call(r)}}}var Dw={},Cc=ep(Dw),Ox=ep(Dw),Bx=ep(Dw);function uf(e){if(e===Dw)throw Error(ft(174));return e}function xF(e,t){switch(fr(Bx,t),fr(Ox,e),fr(Cc,Dw),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Q3(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Q3(t,e)}wr(Cc),fr(Cc,t)}function $v(){wr(Cc),wr(Ox),wr(Bx)}function GY(e){uf(Bx.current);var t=uf(Cc.current),i=Q3(t,e.type);t!==i&&(fr(Ox,e),fr(Cc,i))}function wF(e){Ox.current===e&&(wr(Cc),wr(Ox))}var Pr=ep(0);function tE(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var gP=[];function bF(){for(var e=0;e<gP.length;e++)gP[e]._workInProgressVersionPrimary=null;gP.length=0}var nM=uh.ReactCurrentDispatcher,vP=uh.ReactCurrentBatchConfig,jf=0,Or=null,Cn=null,Yn=null,iE=!1,q1=!1,Fx=0,Zae=0;function Ms(){throw Error(ft(321))}function _F(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Il(e[i],t[i]))return!1;return!0}function SF(e,t,i,r,n,s){if(jf=s,Or=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,nM.current=e===null||e.memoizedState===null?ioe:roe,e=i(r,n),q1){s=0;do{if(q1=!1,Fx=0,25<=s)throw Error(ft(301));s+=1,Yn=Cn=null,t.updateQueue=null,nM.current=noe,e=i(r,n)}while(q1)}if(nM.current=rE,t=Cn!==null&&Cn.next!==null,jf=0,Yn=Cn=Or=null,iE=!1,t)throw Error(ft(300));return e}function AF(){var e=Fx!==0;return Fx=0,e}function dc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yn===null?Or.memoizedState=Yn=e:Yn=Yn.next=e,Yn}function Ho(){if(Cn===null){var e=Or.alternate;e=e!==null?e.memoizedState:null}else e=Cn.next;var t=Yn===null?Or.memoizedState:Yn.next;if(t!==null)Yn=t,Cn=e;else{if(e===null)throw Error(ft(310));Cn=e,e={memoizedState:Cn.memoizedState,baseState:Cn.baseState,baseQueue:Cn.baseQueue,queue:Cn.queue,next:null},Yn===null?Or.memoizedState=Yn=e:Yn=Yn.next=e}return Yn}function Nx(e,t){return typeof t=="function"?t(e):t}function yP(e){var t=Ho(),i=t.queue;if(i===null)throw Error(ft(311));i.lastRenderedReducer=e;var r=Cn,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((jf&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=r):l=l.next=h,Or.lanes|=u,Wf|=u}c=c.next}while(c!==null&&c!==s);l===null?a=r:l.next=o,Il(r,t.memoizedState)||(Ea=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){n=e;do s=n.lane,Or.lanes|=s,Wf|=s,n=n.next;while(n!==e)}else n===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function xP(e){var t=Ho(),i=t.queue;if(i===null)throw Error(ft(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,s=t.memoizedState;if(n!==null){i.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);Il(s,t.memoizedState)||(Ea=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function HY(){}function jY(e,t){var i=Or,r=Ho(),n=t(),s=!Il(r.memoizedState,n);if(s&&(r.memoizedState=n,Ea=!0),r=r.queue,MF(YY.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||Yn!==null&&Yn.memoizedState.tag&1){if(i.flags|=2048,Ux(9,XY.bind(null,i,r,n,t),void 0,null),es===null)throw Error(ft(349));jf&30||WY(i,t,n)}return n}function WY(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Or.updateQueue,t===null?(t={lastEffect:null,stores:null},Or.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function XY(e,t,i,r){t.value=i,t.getSnapshot=r,qY(t)&&QY(e)}function YY(e,t,i){return i(function(){qY(t)&&QY(e)})}function qY(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Il(e,i)}catch{return!0}}function QY(e){var t=eh(e,1);t!==null&&El(t,e,1,-1)}function mV(e){var t=dc();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Nx,lastRenderedState:e},t.queue=e,e=e.dispatch=toe.bind(null,Or,e),[t.memoizedState,e]}function Ux(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=Or.updateQueue,t===null?(t={lastEffect:null,stores:null},Or.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function JY(){return Ho().memoizedState}function sM(e,t,i,r){var n=dc();Or.flags|=e,n.memoizedState=Ux(1|t,i,void 0,r===void 0?null:r)}function kC(e,t,i,r){var n=Ho();r=r===void 0?null:r;var s=void 0;if(Cn!==null){var a=Cn.memoizedState;if(s=a.destroy,r!==null&&_F(r,a.deps)){n.memoizedState=Ux(t,i,s,r);return}}Or.flags|=e,n.memoizedState=Ux(1|t,i,s,r)}function gV(e,t){return sM(8390656,8,e,t)}function MF(e,t){return kC(2048,8,e,t)}function KY(e,t){return kC(4,2,e,t)}function ZY(e,t){return kC(4,4,e,t)}function $Y(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function eq(e,t,i){return i=i!=null?i.concat([e]):null,kC(4,4,$Y.bind(null,t,e),i)}function EF(){}function tq(e,t){var i=Ho();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&_F(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function iq(e,t){var i=Ho();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&_F(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function rq(e,t,i){return jf&21?(Il(i,t)||(i=lY(),Or.lanes|=i,Wf|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ea=!0),e.memoizedState=i)}function $ae(e,t){var i=tr;tr=i!==0&&4>i?i:4,e(!0);var r=vP.transition;vP.transition={};try{e(!1),t()}finally{tr=i,vP.transition=r}}function nq(){return Ho().memoizedState}function eoe(e,t,i){var r=Ed(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},sq(e))aq(t,i);else if(i=zY(e,t,i,r),i!==null){var n=na();El(i,e,r,n),oq(i,t,r)}}function toe(e,t,i){var r=Ed(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(sq(e))aq(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,i);if(n.hasEagerState=!0,n.eagerState=o,Il(o,a)){var l=t.interleaved;l===null?(n.next=n,vF(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}i=zY(e,t,n,r),i!==null&&(n=na(),El(i,e,r,n),oq(i,t,r))}}function sq(e){var t=e.alternate;return e===Or||t!==null&&t===Or}function aq(e,t){q1=iE=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function oq(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,rF(e,i)}}var rE={readContext:Go,useCallback:Ms,useContext:Ms,useEffect:Ms,useImperativeHandle:Ms,useInsertionEffect:Ms,useLayoutEffect:Ms,useMemo:Ms,useReducer:Ms,useRef:Ms,useState:Ms,useDebugValue:Ms,useDeferredValue:Ms,useTransition:Ms,useMutableSource:Ms,useSyncExternalStore:Ms,useId:Ms,unstable_isNewReconciler:!1},ioe={readContext:Go,useCallback:function(e,t){return dc().memoizedState=[e,t===void 0?null:t],e},useContext:Go,useEffect:gV,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,sM(4194308,4,$Y.bind(null,t,e),i)},useLayoutEffect:function(e,t){return sM(4194308,4,e,t)},useInsertionEffect:function(e,t){return sM(4,2,e,t)},useMemo:function(e,t){var i=dc();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=dc();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=eoe.bind(null,Or,e),[r.memoizedState,e]},useRef:function(e){var t=dc();return e={current:e},t.memoizedState=e},useState:mV,useDebugValue:EF,useDeferredValue:function(e){return dc().memoizedState=e},useTransition:function(){var e=mV(!1),t=e[0];return e=$ae.bind(null,e[1]),dc().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=Or,n=dc();if(Ar){if(i===void 0)throw Error(ft(407));i=i()}else{if(i=t(),es===null)throw Error(ft(349));jf&30||WY(r,t,i)}n.memoizedState=i;var s={value:i,getSnapshot:t};return n.queue=s,gV(YY.bind(null,r,s,e),[e]),r.flags|=2048,Ux(9,XY.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=dc(),t=es.identifierPrefix;if(Ar){var i=Ou,r=Lu;i=(r&~(1<<32-Ml(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=Fx++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=Zae++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},roe={readContext:Go,useCallback:tq,useContext:Go,useEffect:MF,useImperativeHandle:eq,useInsertionEffect:KY,useLayoutEffect:ZY,useMemo:iq,useReducer:yP,useRef:JY,useState:function(){return yP(Nx)},useDebugValue:EF,useDeferredValue:function(e){var t=Ho();return rq(t,Cn.memoizedState,e)},useTransition:function(){var e=yP(Nx)[0],t=Ho().memoizedState;return[e,t]},useMutableSource:HY,useSyncExternalStore:jY,useId:nq,unstable_isNewReconciler:!1},noe={readContext:Go,useCallback:tq,useContext:Go,useEffect:MF,useImperativeHandle:eq,useInsertionEffect:KY,useLayoutEffect:ZY,useMemo:iq,useReducer:xP,useRef:JY,useState:function(){return xP(Nx)},useDebugValue:EF,useDeferredValue:function(e){var t=Ho();return Cn===null?t.memoizedState=e:rq(t,Cn.memoizedState,e)},useTransition:function(){var e=xP(Nx)[0],t=Ho().memoizedState;return[e,t]},useMutableSource:HY,useSyncExternalStore:jY,useId:nq,unstable_isNewReconciler:!1};function ml(e,t){if(e&&e.defaultProps){t=Fr({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function gI(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:Fr({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var zC={isMounted:function(e){return(e=e._reactInternals)?um(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=na(),n=Ed(e),s=ju(r,n);s.payload=t,i!=null&&(s.callback=i),t=Ad(e,s,n),t!==null&&(El(t,e,n,r),rM(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=na(),n=Ed(e),s=ju(r,n);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=Ad(e,s,n),t!==null&&(El(t,e,n,r),rM(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=na(),r=Ed(e),n=ju(i,r);n.tag=2,t!=null&&(n.callback=t),t=Ad(e,n,r),t!==null&&(El(t,e,r,i),rM(t,e,r))}};function vV(e,t,i,r,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,a):t.prototype&&t.prototype.isPureReactComponent?!Dx(i,r)||!Dx(n,s):!0}function lq(e,t,i){var r=!1,n=Vd,s=t.contextType;return typeof s=="object"&&s!==null?s=Go(s):(n=Da(t)?Gf:Ns.current,r=t.contextTypes,s=(r=r!=null)?Jv(e,n):Vd),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=zC,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function yV(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&zC.enqueueReplaceState(t,t.state,null)}function vI(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs={},yF(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=Go(s):(s=Da(t)?Gf:Ns.current,n.context=Jv(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(gI(e,t,s,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&zC.enqueueReplaceState(n,n.state,null),eE(e,i,n,r),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function e0(e,t){try{var i="",r=t;do i+=Ise(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function wP(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function yI(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var soe=typeof WeakMap=="function"?WeakMap:Map;function cq(e,t,i){i=ju(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){sE||(sE=!0,TI=r),yI(e,t)},i}function uq(e,t,i){i=ju(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){yI(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){yI(e,t),typeof r!="function"&&(Md===null?Md=new Set([this]):Md.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),i}function xV(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new soe;var n=new Set;r.set(t,n)}else n=r.get(t),n===void 0&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=xoe.bind(null,e,t,i),t.then(e,e))}function wV(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function bV(e,t,i,r,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=ju(-1,1),t.tag=2,Ad(i,t,1))),i.lanes|=1),e)}var aoe=uh.ReactCurrentOwner,Ea=!1;function Zs(e,t,i,r){t.child=e===null?kY(t,null,i,r):Zv(t,e.child,i,r)}function _V(e,t,i,r,n){i=i.render;var s=t.ref;return Tv(t,n),r=SF(e,t,i,r,s,n),i=AF(),e!==null&&!Ea?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,th(e,t,n)):(Ar&&i&&hF(t),t.flags|=1,Zs(e,t,r,n),t.child)}function SV(e,t,i,r,n){if(e===null){var s=i.type;return typeof s=="function"&&!OF(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,hq(e,t,s,r,n)):(e=cM(i.type,null,r,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var a=s.memoizedProps;if(i=i.compare,i=i!==null?i:Dx,i(a,r)&&e.ref===t.ref)return th(e,t,n)}return t.flags|=1,e=Cd(s,r),e.ref=t.ref,e.return=t,t.child=e}function hq(e,t,i,r,n){if(e!==null){var s=e.memoizedProps;if(Dx(s,r)&&e.ref===t.ref)if(Ea=!1,t.pendingProps=r=s,(e.lanes&n)!==0)e.flags&131072&&(Ea=!0);else return t.lanes=e.lanes,th(e,t,n)}return xI(e,t,i,r,n)}function dq(e,t,i){var r=t.pendingProps,n=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},fr(ov,Wa),Wa|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,fr(ov,Wa),Wa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,fr(ov,Wa),Wa|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,fr(ov,Wa),Wa|=r;return Zs(e,t,n,i),t.child}function pq(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function xI(e,t,i,r,n){var s=Da(i)?Gf:Ns.current;return s=Jv(t,s),Tv(t,n),i=SF(e,t,i,r,s,n),r=AF(),e!==null&&!Ea?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,th(e,t,n)):(Ar&&r&&hF(t),t.flags|=1,Zs(e,t,i,n),t.child)}function AV(e,t,i,r,n){if(Da(i)){var s=!0;QM(t)}else s=!1;if(Tv(t,n),t.stateNode===null)aM(e,t),lq(t,i,r),vI(t,i,r,n),r=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;typeof c=="object"&&c!==null?c=Go(c):(c=Da(i)?Gf:Ns.current,c=Jv(t,c));var u=i.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&yV(t,a,r,c),Kh=!1;var d=t.memoizedState;a.state=d,eE(t,r,a,n),l=t.memoizedState,o!==r||d!==l||Pa.current||Kh?(typeof u=="function"&&(gI(t,i,u,r),l=t.memoizedState),(o=Kh||vV(t,i,o,r,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,VY(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:ml(t.type,o),a.props=c,h=t.pendingProps,d=a.context,l=i.contextType,typeof l=="object"&&l!==null?l=Go(l):(l=Da(i)?Gf:Ns.current,l=Jv(t,l));var p=i.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&yV(t,a,r,l),Kh=!1,d=t.memoizedState,a.state=d,eE(t,r,a,n);var f=t.memoizedState;o!==h||d!==f||Pa.current||Kh?(typeof p=="function"&&(gI(t,i,p,r),f=t.memoizedState),(c=Kh||vV(t,i,c,r,d,f,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,f,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,f,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return wI(e,t,i,r,s,n)}function wI(e,t,i,r,n,s){pq(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return n&&cV(t,i,!1),th(e,t,s);r=t.stateNode,aoe.current=t;var o=a&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=Zv(t,e.child,null,s),t.child=Zv(t,null,o,s)):Zs(e,t,o,s),t.memoizedState=r.state,n&&cV(t,i,!0),t.child}function fq(e){var t=e.stateNode;t.pendingContext?lV(e,t.pendingContext,t.pendingContext!==t.context):t.context&&lV(e,t.context,!1),xF(e,t.containerInfo)}function MV(e,t,i,r,n){return Kv(),pF(n),t.flags|=256,Zs(e,t,i,r),t.child}var bI={dehydrated:null,treeContext:null,retryLane:0};function _I(e){return{baseLanes:e,cachePool:null,transitions:null}}function mq(e,t,i){var r=t.pendingProps,n=Pr.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),fr(Pr,n&1),e===null)return fI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,s?(r=t.mode,s=t.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=HC(a,r,0,null),e=Pf(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=_I(i),t.memoizedState=bI,e):CF(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return ooe(e,t,a,r,o,n,i);if(s){s=r.fallback,a=t.mode,n=e.child,o=n.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&t.child!==n?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=Cd(n,l),r.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=Cd(o,s):(s=Pf(s,a,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,a=e.child.memoizedState,a=a===null?_I(i):{baseLanes:a.baseLanes|i,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~i,t.memoizedState=bI,r}return s=e.child,e=s.sibling,r=Cd(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function CF(e,t){return t=HC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function E_(e,t,i,r){return r!==null&&pF(r),Zv(t,e.child,null,i),e=CF(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function ooe(e,t,i,r,n,s,a){if(i)return t.flags&256?(t.flags&=-257,r=wP(Error(ft(422))),E_(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,n=t.mode,r=HC({mode:"visible",children:r.children},n,0,null),s=Pf(s,n,a,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Zv(t,e.child,null,a),t.child.memoizedState=_I(a),t.memoizedState=bI,s);if(!(t.mode&1))return E_(e,t,a,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(ft(419)),r=wP(s,r,void 0),E_(e,t,a,r)}if(o=(a&e.childLanes)!==0,Ea||o){if(r=es,r!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,eh(e,n),El(r,e,n,-1))}return LF(),r=wP(Error(ft(421))),E_(e,t,a,r)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=woe.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,qa=Sd(n.nextSibling),Za=t,Ar=!0,yl=null,e!==null&&(Ro[Io++]=Lu,Ro[Io++]=Ou,Ro[Io++]=Hf,Lu=e.id,Ou=e.overflow,Hf=t),t=CF(t,r.children),t.flags|=4096,t)}function EV(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),mI(e.return,t,i)}function bP(e,t,i,r,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function gq(e,t,i){var r=t.pendingProps,n=r.revealOrder,s=r.tail;if(Zs(e,t,r.children,i),r=Pr.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&EV(e,i,t);else if(e.tag===19)EV(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(fr(Pr,r),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;i!==null;)e=i.alternate,e!==null&&tE(e)===null&&(n=i),i=i.sibling;i=n,i===null?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),bP(t,!1,n,i,s);break;case"backwards":for(i=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&tE(e)===null){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}bP(t,!0,i,null,s);break;case"together":bP(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function aM(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function th(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Wf|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ft(153));if(t.child!==null){for(e=t.child,i=Cd(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Cd(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function loe(e,t,i){switch(t.tag){case 3:fq(t),Kv();break;case 5:GY(t);break;case 1:Da(t.type)&&QM(t);break;case 4:xF(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;fr(ZM,r._currentValue),r._currentValue=n;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(fr(Pr,Pr.current&1),t.flags|=128,null):i&t.child.childLanes?mq(e,t,i):(fr(Pr,Pr.current&1),e=th(e,t,i),e!==null?e.sibling:null);fr(Pr,Pr.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return gq(e,t,i);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),fr(Pr,Pr.current),r)break;return null;case 22:case 23:return t.lanes=0,dq(e,t,i)}return th(e,t,i)}var vq,SI,yq,xq;vq=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};SI=function(){};yq=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,uf(Cc.current);var s=null;switch(i){case"input":n=W3(e,n),r=W3(e,r),s=[];break;case"select":n=Fr({},n,{value:void 0}),r=Fr({},r,{value:void 0}),s=[];break;case"textarea":n=q3(e,n),r=q3(e,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=YM)}J3(i,r);var a;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Sx.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(i||(i={}),i[a]=l[a])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Sx.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&vr("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};xq=function(e,t,i,r){i!==r&&(t.flags|=4)};function Py(e,t){if(!Ar)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Es(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function coe(e,t,i){var r=t.pendingProps;switch(dF(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Es(t),null;case 1:return Da(t.type)&&qM(),Es(t),null;case 3:return r=t.stateNode,$v(),wr(Pa),wr(Ns),bF(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(A_(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,yl!==null&&(RI(yl),yl=null))),SI(e,t),Es(t),null;case 5:wF(t);var n=uf(Bx.current);if(i=t.type,e!==null&&t.stateNode!=null)yq(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(ft(166));return Es(t),null}if(e=uf(Cc.current),A_(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[yc]=t,r[Lx]=s,e=(t.mode&1)!==0,i){case"dialog":vr("cancel",r),vr("close",r);break;case"iframe":case"object":case"embed":vr("load",r);break;case"video":case"audio":for(n=0;n<P1.length;n++)vr(P1[n],r);break;case"source":vr("error",r);break;case"img":case"image":case"link":vr("error",r),vr("load",r);break;case"details":vr("toggle",r);break;case"input":B4(r,s),vr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},vr("invalid",r);break;case"textarea":N4(r,s),vr("invalid",r)}J3(i,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&S_(r.textContent,o,e),n=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&S_(r.textContent,o,e),n=["children",""+o]):Sx.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&vr("scroll",r)}switch(i){case"input":m_(r),F4(r,s,!0);break;case"textarea":m_(r),U4(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=YM)}r=n,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=YX(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(i,{is:r.is}):(e=a.createElement(i),i==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,i),e[yc]=t,e[Lx]=r,vq(e,t,!1,!1),t.stateNode=e;e:{switch(a=K3(i,r),i){case"dialog":vr("cancel",e),vr("close",e),n=r;break;case"iframe":case"object":case"embed":vr("load",e),n=r;break;case"video":case"audio":for(n=0;n<P1.length;n++)vr(P1[n],e);n=r;break;case"source":vr("error",e),n=r;break;case"img":case"image":case"link":vr("error",e),vr("load",e),n=r;break;case"details":vr("toggle",e),n=r;break;case"input":B4(e,r),n=W3(e,r),vr("invalid",e);break;case"option":n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=Fr({},r,{value:void 0}),vr("invalid",e);break;case"textarea":N4(e,r),n=q3(e,r),vr("invalid",e);break;default:n=r}J3(i,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?JX(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&qX(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&Ax(e,l):typeof l=="number"&&Ax(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Sx.hasOwnProperty(s)?l!=null&&s==="onScroll"&&vr("scroll",e):l!=null&&KB(e,s,l,a))}switch(i){case"input":m_(e),F4(e,r,!1);break;case"textarea":m_(e),U4(e);break;case"option":r.value!=null&&e.setAttribute("value",""+zd(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?Av(e,!!r.multiple,s,!1):r.defaultValue!=null&&Av(e,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=YM)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Es(t),null;case 6:if(e&&t.stateNode!=null)xq(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(ft(166));if(i=uf(Bx.current),uf(Cc.current),A_(t)){if(r=t.stateNode,i=t.memoizedProps,r[yc]=t,(s=r.nodeValue!==i)&&(e=Za,e!==null))switch(e.tag){case 3:S_(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&S_(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[yc]=t,t.stateNode=r}return Es(t),null;case 13:if(wr(Pr),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ar&&qa!==null&&t.mode&1&&!(t.flags&128))NY(),Kv(),t.flags|=98560,s=!1;else if(s=A_(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(ft(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ft(317));s[yc]=t}else Kv(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Es(t),s=!1}else yl!==null&&(RI(yl),yl=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Pr.current&1?In===0&&(In=3):LF())),t.updateQueue!==null&&(t.flags|=4),Es(t),null);case 4:return $v(),SI(e,t),e===null&&Rx(t.stateNode.containerInfo),Es(t),null;case 10:return gF(t.type._context),Es(t),null;case 17:return Da(t.type)&&qM(),Es(t),null;case 19:if(wr(Pr),s=t.memoizedState,s===null)return Es(t),null;if(r=(t.flags&128)!==0,a=s.rendering,a===null)if(r)Py(s,!1);else{if(In!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=tE(e),a!==null){for(t.flags|=128,Py(s,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return fr(Pr,Pr.current&1|2),t.child}e=e.sibling}s.tail!==null&&en()>t0&&(t.flags|=128,r=!0,Py(s,!1),t.lanes=4194304)}else{if(!r)if(e=tE(a),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Py(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Ar)return Es(t),null}else 2*en()-s.renderingStartTime>t0&&i!==1073741824&&(t.flags|=128,r=!0,Py(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(i=s.last,i!==null?i.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=en(),t.sibling=null,i=Pr.current,fr(Pr,r?i&1|2:i&1),t):(Es(t),null);case 22:case 23:return IF(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Wa&1073741824&&(Es(t),t.subtreeFlags&6&&(t.flags|=8192)):Es(t),null;case 24:return null;case 25:return null}throw Error(ft(156,t.tag))}function uoe(e,t){switch(dF(t),t.tag){case 1:return Da(t.type)&&qM(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return $v(),wr(Pa),wr(Ns),bF(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return wF(t),null;case 13:if(wr(Pr),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ft(340));Kv()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return wr(Pr),null;case 4:return $v(),null;case 10:return gF(t.type._context),null;case 22:case 23:return IF(),null;case 24:return null;default:return null}}var C_=!1,Is=!1,hoe=typeof WeakSet=="function"?WeakSet:Set,It=null;function av(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){Vr(e,t,r)}else i.current=null}function AI(e,t,i){try{i()}catch(r){Vr(e,t,r)}}var CV=!1;function doe(e,t){if(oI=jM,e=AY(),uF(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var p;h!==i||n!==0&&h.nodeType!==3||(o=a+n),h!==s||r!==0&&h.nodeType!==3||(l=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===e)break t;if(d===i&&++c===n&&(o=a),d===s&&++u===r&&(l=a),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}i=o===-1||l===-1?null:{start:o,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(lI={focusedElem:e,selectionRange:i},jM=!1,It=t;It!==null;)if(t=It,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,It=e;else for(;It!==null;){t=It;try{var f=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var g=f.memoizedProps,m=f.memoizedState,v=t.stateNode,x=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:ml(t.type,g),m);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ft(163))}}catch(_){Vr(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,It=e;break}It=t.return}return f=CV,CV=!1,f}function Q1(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&AI(t,i,s)}n=n.next}while(n!==r)}}function VC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function MI(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function wq(e){var t=e.alternate;t!==null&&(e.alternate=null,wq(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[yc],delete t[Lx],delete t[hI],delete t[qae],delete t[Qae])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function bq(e){return e.tag===5||e.tag===3||e.tag===4}function TV(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||bq(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function EI(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=YM));else if(r!==4&&(e=e.child,e!==null))for(EI(e,t,i),e=e.sibling;e!==null;)EI(e,t,i),e=e.sibling}function CI(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(CI(e,t,i),e=e.sibling;e!==null;)CI(e,t,i),e=e.sibling}var ls=null,vl=!1;function Mh(e,t,i){for(i=i.child;i!==null;)_q(e,t,i),i=i.sibling}function _q(e,t,i){if(Ec&&typeof Ec.onCommitFiberUnmount=="function")try{Ec.onCommitFiberUnmount(LC,i)}catch{}switch(i.tag){case 5:Is||av(i,t);case 6:var r=ls,n=vl;ls=null,Mh(e,t,i),ls=r,vl=n,ls!==null&&(vl?(e=ls,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):ls.removeChild(i.stateNode));break;case 18:ls!==null&&(vl?(e=ls,i=i.stateNode,e.nodeType===8?fP(e.parentNode,i):e.nodeType===1&&fP(e,i),Tx(e)):fP(ls,i.stateNode));break;case 4:r=ls,n=vl,ls=i.stateNode.containerInfo,vl=!0,Mh(e,t,i),ls=r,vl=n;break;case 0:case 11:case 14:case 15:if(!Is&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&AI(i,t,a),n=n.next}while(n!==r)}Mh(e,t,i);break;case 1:if(!Is&&(av(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){Vr(i,t,o)}Mh(e,t,i);break;case 21:Mh(e,t,i);break;case 22:i.mode&1?(Is=(r=Is)||i.memoizedState!==null,Mh(e,t,i),Is=r):Mh(e,t,i);break;default:Mh(e,t,i)}}function PV(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new hoe),t.forEach(function(r){var n=boe.bind(null,e,r);i.has(r)||(i.add(r),r.then(n,n))})}}function el(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:ls=o.stateNode,vl=!1;break e;case 3:ls=o.stateNode.containerInfo,vl=!0;break e;case 4:ls=o.stateNode.containerInfo,vl=!0;break e}o=o.return}if(ls===null)throw Error(ft(160));_q(s,a,n),ls=null,vl=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){Vr(n,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Sq(t,e),t=t.sibling}function Sq(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(el(t,e),Zl(e),r&4){try{Q1(3,e,e.return),VC(3,e)}catch(g){Vr(e,e.return,g)}try{Q1(5,e,e.return)}catch(g){Vr(e,e.return,g)}}break;case 1:el(t,e),Zl(e),r&512&&i!==null&&av(i,i.return);break;case 5:if(el(t,e),Zl(e),r&512&&i!==null&&av(i,i.return),e.flags&32){var n=e.stateNode;try{Ax(n,"")}catch(g){Vr(e,e.return,g)}}if(r&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=i!==null?i.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&WX(n,s),K3(o,a);var c=K3(o,s);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?JX(n,h):u==="dangerouslySetInnerHTML"?qX(n,h):u==="children"?Ax(n,h):KB(n,u,h,c)}switch(o){case"input":X3(n,s);break;case"textarea":XX(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Av(n,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?Av(n,!!s.multiple,s.defaultValue,!0):Av(n,!!s.multiple,s.multiple?[]:"",!1))}n[Lx]=s}catch(g){Vr(e,e.return,g)}}break;case 6:if(el(t,e),Zl(e),r&4){if(e.stateNode===null)throw Error(ft(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(g){Vr(e,e.return,g)}}break;case 3:if(el(t,e),Zl(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{Tx(t.containerInfo)}catch(g){Vr(e,e.return,g)}break;case 4:el(t,e),Zl(e);break;case 13:el(t,e),Zl(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(DF=en())),r&4&&PV(e);break;case 22:if(u=i!==null&&i.memoizedState!==null,e.mode&1?(Is=(c=Is)||u,el(t,e),Is=c):el(t,e),Zl(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(It=e,u=e.child;u!==null;){for(h=It=u;It!==null;){switch(d=It,p=d.child,d.tag){case 0:case 11:case 14:case 15:Q1(4,d,d.return);break;case 1:av(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,i=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Vr(r,i,g)}}break;case 5:av(d,d.return);break;case 22:if(d.memoizedState!==null){RV(h);continue}}p!==null?(p.return=d,It=p):RV(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=QX("display",a))}catch(g){Vr(e,e.return,g)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(g){Vr(e,e.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:el(t,e),Zl(e),r&4&&PV(e);break;case 21:break;default:el(t,e),Zl(e)}}function Zl(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(bq(i)){var r=i;break e}i=i.return}throw Error(ft(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(Ax(n,""),r.flags&=-33);var s=TV(e);CI(e,s,n);break;case 3:case 4:var a=r.stateNode.containerInfo,o=TV(e);EI(e,o,a);break;default:throw Error(ft(161))}}catch(l){Vr(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function poe(e,t,i){It=e,Aq(e)}function Aq(e,t,i){for(var r=(e.mode&1)!==0;It!==null;){var n=It,s=n.child;if(n.tag===22&&r){var a=n.memoizedState!==null||C_;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||Is;o=C_;var c=Is;if(C_=a,(Is=l)&&!c)for(It=n;It!==null;)a=It,l=a.child,a.tag===22&&a.memoizedState!==null?IV(n):l!==null?(l.return=a,It=l):IV(n);for(;s!==null;)It=s,Aq(s),s=s.sibling;It=n,C_=o,Is=c}DV(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,It=s):DV(e)}}function DV(e){for(;It!==null;){var t=It;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Is||VC(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Is)if(i===null)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:ml(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&fV(t,s,r);break;case 3:var a=t.updateQueue;if(a!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}fV(t,a,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Tx(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ft(163))}Is||t.flags&512&&MI(t)}catch(d){Vr(t,t.return,d)}}if(t===e){It=null;break}if(i=t.sibling,i!==null){i.return=t.return,It=i;break}It=t.return}}function RV(e){for(;It!==null;){var t=It;if(t===e){It=null;break}var i=t.sibling;if(i!==null){i.return=t.return,It=i;break}It=t.return}}function IV(e){for(;It!==null;){var t=It;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{VC(4,t)}catch(l){Vr(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var n=t.return;try{r.componentDidMount()}catch(l){Vr(t,n,l)}}var s=t.return;try{MI(t)}catch(l){Vr(t,s,l)}break;case 5:var a=t.return;try{MI(t)}catch(l){Vr(t,a,l)}}}catch(l){Vr(t,t.return,l)}if(t===e){It=null;break}var o=t.sibling;if(o!==null){o.return=t.return,It=o;break}It=t.return}}var foe=Math.ceil,nE=uh.ReactCurrentDispatcher,TF=uh.ReactCurrentOwner,Uo=uh.ReactCurrentBatchConfig,ki=0,es=null,fn=null,vs=0,Wa=0,ov=ep(0),In=0,kx=null,Wf=0,GC=0,PF=0,J1=null,xa=null,DF=0,t0=1/0,wu=null,sE=!1,TI=null,Md=null,T_=!1,ud=null,aE=0,K1=0,PI=null,oM=-1,lM=0;function na(){return ki&6?en():oM!==-1?oM:oM=en()}function Ed(e){return e.mode&1?ki&2&&vs!==0?vs&-vs:Kae.transition!==null?(lM===0&&(lM=lY()),lM):(e=tr,e!==0||(e=window.event,e=e===void 0?16:mY(e.type)),e):1}function El(e,t,i,r){if(50<K1)throw K1=0,PI=null,Error(ft(185));Cw(e,i,r),(!(ki&2)||e!==es)&&(e===es&&(!(ki&2)&&(GC|=i),In===4&&id(e,vs)),Ra(e,r),i===1&&ki===0&&!(t.mode&1)&&(t0=en()+500,UC&&tp()))}function Ra(e,t){var i=e.callbackNode;Kse(e,t);var r=HM(e,e===es?vs:0);if(r===0)i!==null&&V4(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&V4(i),t===1)e.tag===0?Jae(LV.bind(null,e)):OY(LV.bind(null,e)),Xae(function(){!(ki&6)&&tp()}),i=null;else{switch(cY(r)){case 1:i=iF;break;case 4:i=aY;break;case 16:i=GM;break;case 536870912:i=oY;break;default:i=GM}i=Iq(i,Mq.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function Mq(e,t){if(oM=-1,lM=0,ki&6)throw Error(ft(327));var i=e.callbackNode;if(Pv()&&e.callbackNode!==i)return null;var r=HM(e,e===es?vs:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=oE(e,r);else{t=r;var n=ki;ki|=2;var s=Cq();(es!==e||vs!==t)&&(wu=null,t0=en()+500,Tf(e,t));do try{voe();break}catch(o){Eq(e,o)}while(1);mF(),nE.current=s,ki=n,fn!==null?t=0:(es=null,vs=0,t=In)}if(t!==0){if(t===2&&(n=iI(e),n!==0&&(r=n,t=DI(e,n))),t===1)throw i=kx,Tf(e,0),id(e,r),Ra(e,en()),i;if(t===6)id(e,r);else{if(n=e.current.alternate,!(r&30)&&!moe(n)&&(t=oE(e,r),t===2&&(s=iI(e),s!==0&&(r=s,t=DI(e,s))),t===1))throw i=kx,Tf(e,0),id(e,r),Ra(e,en()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(ft(345));case 2:Hp(e,xa,wu);break;case 3:if(id(e,r),(r&130023424)===r&&(t=DF+500-en(),10<t)){if(HM(e,0)!==0)break;if(n=e.suspendedLanes,(n&r)!==r){na(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=uI(Hp.bind(null,e,xa,wu),t);break}Hp(e,xa,wu);break;case 4:if(id(e,r),(r&4194240)===r)break;for(t=e.eventTimes,n=-1;0<r;){var a=31-Ml(r);s=1<<a,a=t[a],a>n&&(n=a),r&=~s}if(r=n,r=en()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*foe(r/1960))-r,10<r){e.timeoutHandle=uI(Hp.bind(null,e,xa,wu),r);break}Hp(e,xa,wu);break;case 5:Hp(e,xa,wu);break;default:throw Error(ft(329))}}}return Ra(e,en()),e.callbackNode===i?Mq.bind(null,e):null}function DI(e,t){var i=J1;return e.current.memoizedState.isDehydrated&&(Tf(e,t).flags|=256),e=oE(e,t),e!==2&&(t=xa,xa=i,t!==null&&RI(t)),e}function RI(e){xa===null?xa=e:xa.push.apply(xa,e)}function moe(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!Il(s(),n))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function id(e,t){for(t&=~PF,t&=~GC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Ml(t),r=1<<i;e[i]=-1,t&=~r}}function LV(e){if(ki&6)throw Error(ft(327));Pv();var t=HM(e,0);if(!(t&1))return Ra(e,en()),null;var i=oE(e,t);if(e.tag!==0&&i===2){var r=iI(e);r!==0&&(t=r,i=DI(e,r))}if(i===1)throw i=kx,Tf(e,0),id(e,t),Ra(e,en()),i;if(i===6)throw Error(ft(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Hp(e,xa,wu),Ra(e,en()),null}function RF(e,t){var i=ki;ki|=1;try{return e(t)}finally{ki=i,ki===0&&(t0=en()+500,UC&&tp())}}function Xf(e){ud!==null&&ud.tag===0&&!(ki&6)&&Pv();var t=ki;ki|=1;var i=Uo.transition,r=tr;try{if(Uo.transition=null,tr=1,e)return e()}finally{tr=r,Uo.transition=i,ki=t,!(ki&6)&&tp()}}function IF(){Wa=ov.current,wr(ov)}function Tf(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,Wae(i)),fn!==null)for(i=fn.return;i!==null;){var r=i;switch(dF(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&qM();break;case 3:$v(),wr(Pa),wr(Ns),bF();break;case 5:wF(r);break;case 4:$v();break;case 13:wr(Pr);break;case 19:wr(Pr);break;case 10:gF(r.type._context);break;case 22:case 23:IF()}i=i.return}if(es=e,fn=e=Cd(e.current,null),vs=Wa=t,In=0,kx=null,PF=GC=Wf=0,xa=J1=null,cf!==null){for(t=0;t<cf.length;t++)if(i=cf[t],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var a=s.next;s.next=n,r.next=a}i.pending=r}cf=null}return e}function Eq(e,t){do{var i=fn;try{if(mF(),nM.current=rE,iE){for(var r=Or.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}iE=!1}if(jf=0,Yn=Cn=Or=null,q1=!1,Fx=0,TF.current=null,i===null||i.return===null){In=1,kx=t,fn=null;break}e:{var s=e,a=i.return,o=i,l=t;if(t=vs,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=wV(a);if(p!==null){p.flags&=-257,bV(p,a,o,s,t),p.mode&1&&xV(s,c,t),t=p,l=c;var f=t.updateQueue;if(f===null){var g=new Set;g.add(l),t.updateQueue=g}else f.add(l);break e}else{if(!(t&1)){xV(s,c,t),LF();break e}l=Error(ft(426))}}else if(Ar&&o.mode&1){var m=wV(a);if(m!==null){!(m.flags&65536)&&(m.flags|=256),bV(m,a,o,s,t),pF(e0(l,o));break e}}s=l=e0(l,o),In!==4&&(In=2),J1===null?J1=[s]:J1.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var v=cq(s,l,t);pV(s,v);break e;case 1:o=l;var x=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Md===null||!Md.has(y)))){s.flags|=65536,t&=-t,s.lanes|=t;var _=uq(s,o,t);pV(s,_);break e}}s=s.return}while(s!==null)}Pq(i)}catch(A){t=A,fn===i&&i!==null&&(fn=i=i.return);continue}break}while(1)}function Cq(){var e=nE.current;return nE.current=rE,e===null?rE:e}function LF(){(In===0||In===3||In===2)&&(In=4),es===null||!(Wf&268435455)&&!(GC&268435455)||id(es,vs)}function oE(e,t){var i=ki;ki|=2;var r=Cq();(es!==e||vs!==t)&&(wu=null,Tf(e,t));do try{goe();break}catch(n){Eq(e,n)}while(1);if(mF(),ki=i,nE.current=r,fn!==null)throw Error(ft(261));return es=null,vs=0,In}function goe(){for(;fn!==null;)Tq(fn)}function voe(){for(;fn!==null&&!Gse();)Tq(fn)}function Tq(e){var t=Rq(e.alternate,e,Wa);e.memoizedProps=e.pendingProps,t===null?Pq(e):fn=t,TF.current=null}function Pq(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=uoe(i,t),i!==null){i.flags&=32767,fn=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{In=6,fn=null;return}}else if(i=coe(i,t,Wa),i!==null){fn=i;return}if(t=t.sibling,t!==null){fn=t;return}fn=t=e}while(t!==null);In===0&&(In=5)}function Hp(e,t,i){var r=tr,n=Uo.transition;try{Uo.transition=null,tr=1,yoe(e,t,i,r)}finally{Uo.transition=n,tr=r}return null}function yoe(e,t,i,r){do Pv();while(ud!==null);if(ki&6)throw Error(ft(327));i=e.finishedWork;var n=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(ft(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(Zse(e,s),e===es&&(fn=es=null,vs=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||T_||(T_=!0,Iq(GM,function(){return Pv(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=Uo.transition,Uo.transition=null;var a=tr;tr=1;var o=ki;ki|=4,TF.current=null,doe(e,i),Sq(i,e),Uae(lI),jM=!!oI,lI=oI=null,e.current=i,poe(i),Hse(),ki=o,tr=a,Uo.transition=s}else e.current=i;if(T_&&(T_=!1,ud=e,aE=n),s=e.pendingLanes,s===0&&(Md=null),Xse(i.stateNode),Ra(e,en()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(sE)throw sE=!1,e=TI,TI=null,e;return aE&1&&e.tag!==0&&Pv(),s=e.pendingLanes,s&1?e===PI?K1++:(K1=0,PI=e):K1=0,tp(),null}function Pv(){if(ud!==null){var e=cY(aE),t=Uo.transition,i=tr;try{if(Uo.transition=null,tr=16>e?16:e,ud===null)var r=!1;else{if(e=ud,ud=null,aE=0,ki&6)throw Error(ft(331));var n=ki;for(ki|=4,It=e.current;It!==null;){var s=It,a=s.child;if(It.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(It=c;It!==null;){var u=It;switch(u.tag){case 0:case 11:case 15:Q1(8,u,s)}var h=u.child;if(h!==null)h.return=u,It=h;else for(;It!==null;){u=It;var d=u.sibling,p=u.return;if(wq(u),u===c){It=null;break}if(d!==null){d.return=p,It=d;break}It=p}}}var f=s.alternate;if(f!==null){var g=f.child;if(g!==null){f.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(g!==null)}}It=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,It=a;else e:for(;It!==null;){if(s=It,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Q1(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,It=v;break e}It=s.return}}var x=e.current;for(It=x;It!==null;){a=It;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,It=y;else e:for(a=x;It!==null;){if(o=It,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:VC(9,o)}}catch(A){Vr(o,o.return,A)}if(o===a){It=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,It=_;break e}It=o.return}}if(ki=n,tp(),Ec&&typeof Ec.onPostCommitFiberRoot=="function")try{Ec.onPostCommitFiberRoot(LC,e)}catch{}r=!0}return r}finally{tr=i,Uo.transition=t}}return!1}function OV(e,t,i){t=e0(i,t),t=cq(e,t,1),e=Ad(e,t,1),t=na(),e!==null&&(Cw(e,1,t),Ra(e,t))}function Vr(e,t,i){if(e.tag===3)OV(e,e,i);else for(;t!==null;){if(t.tag===3){OV(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Md===null||!Md.has(r))){e=e0(i,e),e=uq(t,e,1),t=Ad(t,e,1),e=na(),t!==null&&(Cw(t,1,e),Ra(t,e));break}}t=t.return}}function xoe(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=na(),e.pingedLanes|=e.suspendedLanes&i,es===e&&(vs&i)===i&&(In===4||In===3&&(vs&130023424)===vs&&500>en()-DF?Tf(e,0):PF|=i),Ra(e,t)}function Dq(e,t){t===0&&(e.mode&1?(t=y_,y_<<=1,!(y_&130023424)&&(y_=4194304)):t=1);var i=na();e=eh(e,t),e!==null&&(Cw(e,t,i),Ra(e,i))}function woe(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),Dq(e,i)}function boe(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(ft(314))}r!==null&&r.delete(t),Dq(e,i)}var Rq;Rq=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Pa.current)Ea=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Ea=!1,loe(e,t,i);Ea=!!(e.flags&131072)}else Ea=!1,Ar&&t.flags&1048576&&BY(t,KM,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;aM(e,t),e=t.pendingProps;var n=Jv(t,Ns.current);Tv(t,i),n=SF(null,t,r,e,n,i);var s=AF();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Da(r)?(s=!0,QM(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,yF(t),n.updater=zC,t.stateNode=n,n._reactInternals=t,vI(t,r,e,i),t=wI(null,t,r,!0,s,i)):(t.tag=0,Ar&&s&&hF(t),Zs(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(aM(e,t),e=t.pendingProps,n=r._init,r=n(r._payload),t.type=r,n=t.tag=Soe(r),e=ml(r,e),n){case 0:t=xI(null,t,r,e,i);break e;case 1:t=AV(null,t,r,e,i);break e;case 11:t=_V(null,t,r,e,i);break e;case 14:t=SV(null,t,r,ml(r.type,e),i);break e}throw Error(ft(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:ml(r,n),xI(e,t,r,n,i);case 1:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:ml(r,n),AV(e,t,r,n,i);case 3:e:{if(fq(t),e===null)throw Error(ft(387));r=t.pendingProps,s=t.memoizedState,n=s.element,VY(e,t),eE(t,r,null,i);var a=t.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=e0(Error(ft(423)),t),t=MV(e,t,r,i,n);break e}else if(r!==n){n=e0(Error(ft(424)),t),t=MV(e,t,r,i,n);break e}else for(qa=Sd(t.stateNode.containerInfo.firstChild),Za=t,Ar=!0,yl=null,i=kY(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Kv(),r===n){t=th(e,t,i);break e}Zs(e,t,r,i)}t=t.child}return t;case 5:return GY(t),e===null&&fI(t),r=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,cI(r,n)?a=null:s!==null&&cI(r,s)&&(t.flags|=32),pq(e,t),Zs(e,t,a,i),t.child;case 6:return e===null&&fI(t),null;case 13:return mq(e,t,i);case 4:return xF(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Zv(t,null,r,i):Zs(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:ml(r,n),_V(e,t,r,n,i);case 7:return Zs(e,t,t.pendingProps,i),t.child;case 8:return Zs(e,t,t.pendingProps.children,i),t.child;case 12:return Zs(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,fr(ZM,r._currentValue),r._currentValue=a,s!==null)if(Il(s.value,a)){if(s.children===n.children&&!Pa.current){t=th(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ju(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),mI(s.return,i,t),o.lanes|=i;break}l=l.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ft(341));a.lanes|=i,o=a.alternate,o!==null&&(o.lanes|=i),mI(a,i,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Zs(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,Tv(t,i),n=Go(n),r=r(n),t.flags|=1,Zs(e,t,r,i),t.child;case 14:return r=t.type,n=ml(r,t.pendingProps),n=ml(r.type,n),SV(e,t,r,n,i);case 15:return hq(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:ml(r,n),aM(e,t),t.tag=1,Da(r)?(e=!0,QM(t)):e=!1,Tv(t,i),lq(t,r,n),vI(t,r,n,i),wI(null,t,r,!0,e,i);case 19:return gq(e,t,i);case 22:return dq(e,t,i)}throw Error(ft(156,t.tag))};function Iq(e,t){return sY(e,t)}function _oe(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fo(e,t,i,r){return new _oe(e,t,i,r)}function OF(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Soe(e){if(typeof e=="function")return OF(e)?1:0;if(e!=null){if(e=e.$$typeof,e===$B)return 11;if(e===eF)return 14}return 2}function Cd(e,t){var i=e.alternate;return i===null?(i=Fo(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function cM(e,t,i,r,n,s){var a=2;if(r=e,typeof e=="function")OF(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Kg:return Pf(i.children,n,s,t);case ZB:a=8,n|=8;break;case V3:return e=Fo(12,i,t,n|2),e.elementType=V3,e.lanes=s,e;case G3:return e=Fo(13,i,t,n),e.elementType=G3,e.lanes=s,e;case H3:return e=Fo(19,i,t,n),e.elementType=H3,e.lanes=s,e;case GX:return HC(i,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case zX:a=10;break e;case VX:a=9;break e;case $B:a=11;break e;case eF:a=14;break e;case Jh:a=16,r=null;break e}throw Error(ft(130,e==null?e:typeof e,""))}return t=Fo(a,i,t,n),t.elementType=e,t.type=r,t.lanes=s,t}function Pf(e,t,i,r){return e=Fo(7,e,r,t),e.lanes=i,e}function HC(e,t,i,r){return e=Fo(22,e,r,t),e.elementType=GX,e.lanes=i,e.stateNode={isHidden:!1},e}function _P(e,t,i){return e=Fo(6,e,null,t),e.lanes=i,e}function SP(e,t,i){return t=Fo(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Aoe(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rP(0),this.expirationTimes=rP(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rP(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function BF(e,t,i,r,n,s,a,o,l){return e=new Aoe(e,t,i,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Fo(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},yF(s),e}function Moe(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Jg,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function Lq(e){if(!e)return Vd;e=e._reactInternals;e:{if(um(e)!==e||e.tag!==1)throw Error(ft(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Da(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ft(171))}if(e.tag===1){var i=e.type;if(Da(i))return LY(e,i,t)}return t}function Oq(e,t,i,r,n,s,a,o,l){return e=BF(i,r,!0,e,n,s,a,o,l),e.context=Lq(null),i=e.current,r=na(),n=Ed(i),s=ju(r,n),s.callback=t??null,Ad(i,s,n),e.current.lanes=n,Cw(e,n,r),Ra(e,r),e}function jC(e,t,i,r){var n=t.current,s=na(),a=Ed(n);return i=Lq(i),t.context===null?t.context=i:t.pendingContext=i,t=ju(s,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Ad(n,t,a),e!==null&&(El(e,n,a,s),rM(e,n,a)),a}function lE(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function BV(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function FF(e,t){BV(e,t),(e=e.alternate)&&BV(e,t)}function Eoe(){return null}var Bq=typeof reportError=="function"?reportError:function(e){console.error(e)};function NF(e){this._internalRoot=e}WC.prototype.render=NF.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ft(409));jC(e,t,null,null)};WC.prototype.unmount=NF.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Xf(function(){jC(null,e,null,null)}),t[$u]=null}};function WC(e){this._internalRoot=e}WC.prototype.unstable_scheduleHydration=function(e){if(e){var t=dY();e={blockedOn:null,target:e,priority:t};for(var i=0;i<td.length&&t!==0&&t<td[i].priority;i++);td.splice(i,0,e),i===0&&fY(e)}};function UF(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function XC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function FV(){}function Coe(e,t,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=lE(a);s.call(c)}}var a=Oq(t,r,e,0,null,!1,!1,"",FV);return e._reactRootContainer=a,e[$u]=a.current,Rx(e.nodeType===8?e.parentNode:e),Xf(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof r=="function"){var o=r;r=function(){var c=lE(l);o.call(c)}}var l=BF(e,0,!1,null,null,!1,!1,"",FV);return e._reactRootContainer=l,e[$u]=l.current,Rx(e.nodeType===8?e.parentNode:e),Xf(function(){jC(t,l,i,r)}),l}function YC(e,t,i,r,n){var s=i._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=lE(a);o.call(l)}}jC(t,a,e,n)}else a=Coe(i,t,e,n,r);return lE(a)}uY=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=T1(t.pendingLanes);i!==0&&(rF(t,i|1),Ra(t,en()),!(ki&6)&&(t0=en()+500,tp()))}break;case 13:Xf(function(){var r=eh(e,1);if(r!==null){var n=na();El(r,e,1,n)}}),FF(e,1)}};nF=function(e){if(e.tag===13){var t=eh(e,134217728);if(t!==null){var i=na();El(t,e,134217728,i)}FF(e,134217728)}};hY=function(e){if(e.tag===13){var t=Ed(e),i=eh(e,t);if(i!==null){var r=na();El(i,e,t,r)}FF(e,t)}};dY=function(){return tr};pY=function(e,t){var i=tr;try{return tr=e,t()}finally{tr=i}};$3=function(e,t,i){switch(t){case"input":if(X3(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=NC(r);if(!n)throw Error(ft(90));jX(r),X3(r,n)}}}break;case"textarea":XX(e,i);break;case"select":t=i.value,t!=null&&Av(e,!!i.multiple,t,!1)}};$X=RF;eY=Xf;var Toe={usingClientEntryPoint:!1,Events:[Pw,tv,NC,KX,ZX,RF]},Dy={findFiberByHostInstance:lf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Poe={bundleType:Dy.bundleType,version:Dy.version,rendererPackageName:Dy.rendererPackageName,rendererConfig:Dy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:uh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=rY(e),e===null?null:e.stateNode},findFiberByHostInstance:Dy.findFiberByHostInstance||Eoe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var P_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!P_.isDisabled&&P_.supportsFiber)try{LC=P_.inject(Poe),Ec=P_}catch{}}ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Toe;ro.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!UF(t))throw Error(ft(200));return Moe(e,t,null,i)};ro.createRoot=function(e,t){if(!UF(e))throw Error(ft(299));var i=!1,r="",n=Bq;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=BF(e,1,!1,null,null,i,!1,r,n),e[$u]=t.current,Rx(e.nodeType===8?e.parentNode:e),new NF(t)};ro.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ft(188)):(e=Object.keys(e).join(","),Error(ft(268,e)));return e=rY(t),e=e===null?null:e.stateNode,e};ro.flushSync=function(e){return Xf(e)};ro.hydrate=function(e,t,i){if(!XC(t))throw Error(ft(200));return YC(null,e,t,!0,i)};ro.hydrateRoot=function(e,t,i){if(!UF(e))throw Error(ft(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",a=Bq;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(a=i.onRecoverableError)),t=Oq(t,null,e,1,i??null,n,!1,s,a),e[$u]=t.current,Rx(e),r)for(e=0;e<r.length;e++)i=r[e],n=i._getVersion,n=n(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new WC(t)};ro.render=function(e,t,i){if(!XC(t))throw Error(ft(200));return YC(null,e,t,!1,i)};ro.unmountComponentAtNode=function(e){if(!XC(e))throw Error(ft(40));return e._reactRootContainer?(Xf(function(){YC(null,null,e,!1,function(){e._reactRootContainer=null,e[$u]=null})}),!0):!1};ro.unstable_batchedUpdates=RF;ro.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!XC(i))throw Error(ft(200));if(e==null||e._reactInternals===void 0)throw Error(ft(38));return YC(e,t,i,!1,r)};ro.version="18.3.1-next-f1338f8080-20240426";function Fq(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Fq)}catch(e){console.error(e)}}Fq(),FX.exports=ro;var Nq=FX.exports;const Doe=E0(Nq);/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zx(){return zx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},zx.apply(this,arguments)}var hf;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(hf||(hf={}));const NV="popstate";function Roe(e){e===void 0&&(e={});function t(r,n){let{pathname:s,search:a,hash:o}=r.location;return II("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:cE(n)}return Loe(t,i,null,e)}function Cl(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Ioe(){return Math.random().toString(36).substr(2,8)}function UV(e,t){return{usr:e.state,key:e.key,idx:t}}function II(e,t,i,r){return i===void 0&&(i=null),zx({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?qC(t):t,{state:i,key:t&&t.key||r||Ioe()})}function cE(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function qC(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function Loe(e,t,i,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o=hf.Pop,l=null,c=u();c==null&&(c=0,a.replaceState(zx({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function h(){o=hf.Pop;let m=u(),v=m==null?null:m-c;c=m,l&&l({action:o,location:g.location,delta:v})}function d(m,v){o=hf.Push;let x=II(g.location,m,v);i&&i(x,m),c=u()+1;let y=UV(x,c),_=g.createHref(x);try{a.pushState(y,"",_)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;n.location.assign(_)}s&&l&&l({action:o,location:g.location,delta:1})}function p(m,v){o=hf.Replace;let x=II(g.location,m,v);i&&i(x,m),c=u();let y=UV(x,c),_=g.createHref(x);a.replaceState(y,"",_),s&&l&&l({action:o,location:g.location,delta:0})}function f(m){let v=n.location.origin!=="null"?n.location.origin:n.location.href,x=typeof m=="string"?m:cE(m);return x=x.replace(/ $/,"%20"),Cl(v,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,v)}let g={get action(){return o},get location(){return e(n,a)},listen(m){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(NV,h),l=m,()=>{n.removeEventListener(NV,h),l=null}},createHref(m){return t(n,m)},createURL:f,encodeLocation(m){let v=f(m);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:d,replace:p,go(m){return a.go(m)}};return g}var kV;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(kV||(kV={}));function Uq(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}function Ooe(e,t){t===void 0&&(t="/");let{pathname:i,search:r="",hash:n=""}=typeof e=="string"?qC(e):e;return{pathname:i?i.startsWith("/")?i:Boe(i,t):t,search:Noe(r),hash:Uoe(n)}}function Boe(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function AP(e,t,i,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Foe(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function kq(e,t){let i=Foe(e);return t?i.map((r,n)=>n===i.length-1?r.pathname:r.pathnameBase):i.map(r=>r.pathnameBase)}function zq(e,t,i,r){r===void 0&&(r=!1);let n;typeof e=="string"?n=qC(e):(n=zx({},e),Cl(!n.pathname||!n.pathname.includes("?"),AP("?","pathname","search",n)),Cl(!n.pathname||!n.pathname.includes("#"),AP("#","pathname","hash",n)),Cl(!n.search||!n.search.includes("#"),AP("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(a==null)o=i;else{let h=t.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;n.pathname=d.join("/")}o=h>=0?t[h]:"/"}let l=Ooe(n,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Vq=e=>e.join("/").replace(/\/\/+/g,"/"),Noe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Uoe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,Gq=["post","put","patch","delete"];new Set(Gq);const koe=["get",...Gq];new Set(koe);/**
 * React Router v6.28.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uE(){return uE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},uE.apply(this,arguments)}const Hq=fe.createContext(null),D0=fe.createContext(null),kF=fe.createContext(null),QC=fe.createContext({outlet:null,matches:[],isDataRoute:!1});function zoe(e,t){let{relative:i}=t===void 0?{}:t;JC()||Cl(!1);let{basename:r,navigator:n}=fe.useContext(D0),{hash:s,pathname:a,search:o}=Wq(e,{relative:i}),l=a;return r!=="/"&&(l=a==="/"?r:Vq([r,a])),n.createHref({pathname:l,search:o,hash:s})}function JC(){return fe.useContext(kF)!=null}function zF(){return JC()||Cl(!1),fe.useContext(kF).location}function jq(e){fe.useContext(D0).static||fe.useLayoutEffect(e)}function Voe(){let{isDataRoute:e}=fe.useContext(QC);return e?Xoe():Goe()}function Goe(){JC()||Cl(!1);let e=fe.useContext(Hq),{basename:t,future:i,navigator:r}=fe.useContext(D0),{matches:n}=fe.useContext(QC),{pathname:s}=zF(),a=JSON.stringify(kq(n,i.v7_relativeSplatPath)),o=fe.useRef(!1);return jq(()=>{o.current=!0}),fe.useCallback(function(c,u){if(u===void 0&&(u={}),!o.current)return;if(typeof c=="number"){r.go(c);return}let h=zq(c,JSON.parse(a),s,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:Vq([t,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[t,r,a,s,e])}function Wq(e,t){let{relative:i}=t===void 0?{}:t,{future:r}=fe.useContext(D0),{matches:n}=fe.useContext(QC),{pathname:s}=zF(),a=JSON.stringify(kq(n,r.v7_relativeSplatPath));return fe.useMemo(()=>zq(e,JSON.parse(a),s,i==="path"),[e,a,s,i])}var Xq=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Xq||{}),Yq=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Yq||{});function Hoe(e){let t=fe.useContext(Hq);return t||Cl(!1),t}function joe(e){let t=fe.useContext(QC);return t||Cl(!1),t}function Woe(e){let t=joe(),i=t.matches[t.matches.length-1];return i.route.id||Cl(!1),i.route.id}function Xoe(){let{router:e}=Hoe(Xq.UseNavigateStable),t=Woe(Yq.UseNavigateStable),i=fe.useRef(!1);return jq(()=>{i.current=!0}),fe.useCallback(function(n,s){s===void 0&&(s={}),i.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,uE({fromRouteId:t},s)))},[e,t])}const zV={};function Yoe(e,t){zV[t]||(zV[t]=!0,console.warn(t))}const Um=(e,t,i)=>Yoe(e," React Router Future Flag Warning: "+t+". "+("You can use the `"+e+"` future flag to opt-in early. ")+("For more information, see "+i+"."));function qoe(e,t){(e==null?void 0:e.v7_startTransition)===void 0&&Um("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||!t.v7_relativeSplatPath)&&Um("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath"),t&&(t.v7_fetcherPersist===void 0&&Um("v7_fetcherPersist","The persistence behavior of fetchers is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist"),t.v7_normalizeFormMethod===void 0&&Um("v7_normalizeFormMethod","Casing of `formMethod` fields is being normalized to uppercase in v7","https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod"),t.v7_partialHydration===void 0&&Um("v7_partialHydration","`RouterProvider` hydration behavior is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_partialhydration"),t.v7_skipActionErrorRevalidation===void 0&&Um("v7_skipActionErrorRevalidation","The revalidation behavior after 4xx/5xx `action` responses is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation"))}function Qoe(e){let{basename:t="/",children:i=null,location:r,navigationType:n=hf.Pop,navigator:s,static:a=!1,future:o}=e;JC()&&Cl(!1);let l=t.replace(/^\/*/,"/"),c=fe.useMemo(()=>({basename:l,navigator:s,static:a,future:uE({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof r=="string"&&(r=qC(r));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:f="default"}=r,g=fe.useMemo(()=>{let m=Uq(u,l);return m==null?null:{location:{pathname:m,search:h,hash:d,state:p,key:f},navigationType:n}},[l,u,h,d,p,f,n]);return g==null?null:fe.createElement(D0.Provider,{value:c},fe.createElement(kF.Provider,{children:i,value:g}))}new Promise(()=>{});/**
 * React Router DOM v6.28.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function LI(){return LI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},LI.apply(this,arguments)}function Joe(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function Koe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Zoe(e,t){return e.button===0&&(!t||t==="_self")&&!Koe(e)}const $oe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ele="6";try{window.__reactRouterVersion=ele}catch{}const tle="startTransition",VV=xse[tle];function ile(e){let{basename:t,children:i,future:r,window:n}=e,s=fe.useRef();s.current==null&&(s.current=Roe({window:n,v5Compat:!0}));let a=s.current,[o,l]=fe.useState({action:a.action,location:a.location}),{v7_startTransition:c}=r||{},u=fe.useCallback(h=>{c&&VV?VV(()=>l(h)):l(h)},[l,c]);return fe.useLayoutEffect(()=>a.listen(u),[a,u]),fe.useEffect(()=>qoe(r),[r]),fe.createElement(Qoe,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:a,future:r})}const rle=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",nle=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sle=fe.forwardRef(function(t,i){let{onClick:r,relative:n,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h}=t,d=Joe(t,$oe),{basename:p}=fe.useContext(D0),f,g=!1;if(typeof c=="string"&&nle.test(c)&&(f=c,rle))try{let y=new URL(window.location.href),_=c.startsWith("//")?new URL(y.protocol+c):new URL(c),A=Uq(_.pathname,p);_.origin===y.origin&&A!=null?c=A+_.search+_.hash:g=!0}catch{}let m=zoe(c,{relative:n}),v=ale(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:n,viewTransition:h});function x(y){r&&r(y),y.defaultPrevented||v(y)}return fe.createElement("a",LI({},d,{href:f||m,onClick:g||s?r:x,ref:i,target:l}))});var GV;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(GV||(GV={}));var HV;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(HV||(HV={}));function ale(e,t){let{target:i,replace:r,state:n,preventScrollReset:s,relative:a,viewTransition:o}=t===void 0?{}:t,l=Voe(),c=zF(),u=Wq(e,{relative:a});return fe.useCallback(h=>{if(Zoe(h,i)){h.preventDefault();let d=r!==void 0?r:cE(c)===cE(u);l(e,{replace:d,state:n,preventScrollReset:s,relative:a,viewTransition:o})}},[c,l,u,r,n,i,e,s,a,o])}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const R0="153",jp={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Wp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},qq=0,OI=1,Qq=2,ole=3,Jq=0,KC=1,Z1=2,gl=3,Bc=0,sa=1,Bo=2,lle=2,Wu=0,Df=1,BI=2,FI=3,NI=4,Kq=5,$p=100,Zq=101,$q=102,UI=103,kI=104,eQ=200,tQ=201,iQ=202,rQ=203,VF=204,GF=205,nQ=206,sQ=207,aQ=208,oQ=209,lQ=210,cQ=0,uQ=1,hQ=2,hE=3,dQ=4,pQ=5,fQ=6,mQ=7,Rw=0,gQ=1,vQ=2,Tl=0,yQ=1,xQ=2,wQ=3,HF=4,bQ=5,ZC=300,Gd=301,Hd=302,Vx=303,Gx=304,I0=306,jd=1e3,ds=1001,i0=1002,Gr=1003,Hx=1004,cle=1004,Dv=1005,ule=1005,Dr=1006,$C=1007,hle=1007,Fc=1008,dle=1008,Tc=1009,_Q=1010,SQ=1011,eT=1012,jF=1013,Bu=1014,_c=1015,r0=1016,WF=1017,XF=1018,Td=1020,AQ=1021,Sa=1023,MQ=1024,EQ=1025,Pd=1026,Yf=1027,CQ=1028,YF=1029,TQ=1030,qF=1031,QF=1033,uM=33776,hM=33777,dM=33778,pM=33779,zI=35840,VI=35841,GI=35842,HI=35843,PQ=36196,jI=37492,WI=37496,XI=37808,YI=37809,qI=37810,QI=37811,JI=37812,KI=37813,ZI=37814,$I=37815,eL=37816,tL=37817,iL=37818,rL=37819,nL=37820,sL=37821,fM=36492,DQ=36283,aL=36284,oL=36285,lL=36286,RQ=2200,IQ=2201,LQ=2202,n0=2300,qf=2301,mM=2302,df=2400,pf=2401,jx=2402,tT=2500,JF=2501,OQ=0,KF=1,dE=2,ZF=3e3,Dd=3001,BQ=3200,FQ=3201,ip=0,NQ=1,Rd="",hi="srgb",jo="srgb-linear",$F="display-p3",ple=0,gM=7680,fle=7681,mle=7682,gle=7683,vle=34055,yle=34056,xle=5386,wle=512,ble=513,_le=514,Sle=515,Ale=516,Mle=517,Ele=518,UQ=519,kQ=512,zQ=513,VQ=514,GQ=515,HQ=516,jQ=517,WQ=518,XQ=519,Wx=35044,Rf=35048,Cle=35040,Tle=35045,Ple=35049,Dle=35041,Rle=35046,Ile=35050,Lle=35042,Ole="100",cL="300 es",pE=1035,Sc=2e3,Xx=2001;let hh=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}};const Cs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let jV=1234567;const If=Math.PI/180,s0=180/Math.PI;function $a(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Cs[e&255]+Cs[e>>8&255]+Cs[e>>16&255]+Cs[e>>24&255]+"-"+Cs[t&255]+Cs[t>>8&255]+"-"+Cs[t>>16&15|64]+Cs[t>>24&255]+"-"+Cs[i&63|128]+Cs[i>>8&255]+"-"+Cs[i>>16&255]+Cs[i>>24&255]+Cs[r&255]+Cs[r>>8&255]+Cs[r>>16&255]+Cs[r>>24&255]).toLowerCase()}function Hr(e,t,i){return Math.max(t,Math.min(i,e))}function eN(e,t){return(e%t+t)%t}function Ble(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function Fle(e,t,i){return e!==t?(i-e)/(t-e):0}function $1(e,t,i){return(1-i)*e+i*t}function Nle(e,t,i,r){return $1(e,t,1-Math.exp(-i*r))}function Ule(e,t=1){return t-Math.abs(eN(e,t*2)-t)}function kle(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function zle(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function Vle(e,t){return e+Math.floor(Math.random()*(t-e+1))}function Gle(e,t){return e+Math.random()*(t-e)}function Hle(e){return e*(.5-Math.random())}function jle(e){e!==void 0&&(jV=e);let t=jV+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Wle(e){return e*If}function Xle(e){return e*s0}function uL(e){return(e&e-1)===0&&e!==0}function YQ(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function fE(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Yle(e,t,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Qa(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function bi(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const tN={DEG2RAD:If,RAD2DEG:s0,generateUUID:$a,clamp:Hr,euclideanModulo:eN,mapLinear:Ble,inverseLerp:Fle,lerp:$1,damp:Nle,pingpong:Ule,smoothstep:kle,smootherstep:zle,randInt:Vle,randFloat:Gle,randFloatSpread:Hle,seededRandom:jle,degToRad:Wle,radToDeg:Xle,isPowerOfTwo:uL,ceilPowerOfTwo:YQ,floorPowerOfTwo:fE,setQuaternionFromProperEuler:Yle,normalize:bi,denormalize:Qa};class it{constructor(t=0,i=0){it.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Hr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wi{constructor(t,i,r,n,s,a,o,l,c){wi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c)}set(t,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],p=r[5],f=r[8],g=n[0],m=n[3],v=n[6],x=n[1],y=n[4],_=n[7],A=n[2],S=n[5],C=n[8];return s[0]=a*g+o*x+l*A,s[3]=a*m+o*y+l*S,s[6]=a*v+o*_+l*C,s[1]=c*g+u*x+h*A,s[4]=c*m+u*y+h*S,s[7]=c*v+u*_+h*C,s[2]=d*g+p*x+f*A,s[5]=d*m+p*y+f*S,s[8]=d*v+p*_+f*C,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,d=o*l-u*s,p=c*s-a*l,f=i*h+r*d+n*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/f;return t[0]=h*g,t[1]=(n*c-u*r)*g,t[2]=(o*r-n*a)*g,t[3]=d*g,t[4]=(u*i-n*l)*g,t[5]=(n*s-o*i)*g,t[6]=p*g,t[7]=(r*l-c*i)*g,t[8]=(a*i-r*s)*g,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+t,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(MP.makeScale(t,i)),this}rotate(t){return this.premultiply(MP.makeRotation(-t)),this}translate(t,i){return this.premultiply(MP.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const MP=new wi;function qQ(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const qle={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function lv(e,t){return new qle[e](t)}function Yx(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const WV={};function ex(e){e in WV||(WV[e]=!0,console.warn(e))}function Rv(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function EP(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const Qle=new wi().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Jle=new wi().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Kle(e){return e.convertSRGBToLinear().applyMatrix3(Jle)}function Zle(e){return e.applyMatrix3(Qle).convertLinearToSRGB()}const $le={[jo]:e=>e,[hi]:e=>e.convertSRGBToLinear(),[$F]:Kle},ece={[jo]:e=>e,[hi]:e=>e.convertLinearToSRGB(),[$F]:Zle},So={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return jo},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.enabled===!1||t===i||!t||!i)return e;const r=$le[t],n=ece[i];if(r===void 0||n===void 0)throw new Error(`Unsupported color space conversion, "${t}" to "${i}".`);return n(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let km;class iN{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{km===void 0&&(km=Yx("canvas")),km.width=t.width,km.height=t.height;const r=km.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),i=km}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=Yx("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Rv(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(t.data){const i=t.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Rv(i[r]/255)*255):i[r]=Rv(i[r]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let tce=0;class ff{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tce++}),this.uuid=$a(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(CP(n[a].image)):s.push(CP(n[a]))}else s=CP(n);r.url=s}return i||(t.images[this.uuid]=r),r}}function CP(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?iN.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ice=0;class mr extends hh{constructor(t=mr.DEFAULT_IMAGE,i=mr.DEFAULT_MAPPING,r=ds,n=ds,s=Dr,a=Fc,o=Sa,l=Tc,c=mr.DEFAULT_ANISOTROPY,u=Rd){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ice++}),this.uuid=$a(),this.name="",this.source=new ff(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new it(0,0),this.repeat=new it(1,1),this.center=new it(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(ex("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===Dd?hi:Rd),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ZC)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case jd:t.x=t.x-Math.floor(t.x);break;case ds:t.x=t.x<0?0:1;break;case i0:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case jd:t.y=t.y-Math.floor(t.y);break;case ds:t.y=t.y<0?0:1;break;case i0:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ex("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===hi?Dd:ZF}set encoding(t){ex("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Dd?hi:Rd}}mr.DEFAULT_IMAGE=null;mr.DEFAULT_MAPPING=ZC;mr.DEFAULT_ANISOTROPY=1;class Zi{constructor(t=0,i=0,r=0,n=1){Zi.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s;const l=t.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],f=l[9],g=l[2],m=l[6],v=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-g)<.01&&Math.abs(f-m)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+g)<.1&&Math.abs(f+m)<.1&&Math.abs(c+p+v-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const y=(c+1)/2,_=(p+1)/2,A=(v+1)/2,S=(u+d)/4,C=(h+g)/4,M=(f+m)/4;return y>_&&y>A?y<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(y),n=S/r,s=C/r):_>A?_<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(_),r=S/n,s=M/n):A<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(A),r=C/s,n=M/s),this.set(r,n,s,i),this}let x=Math.sqrt((m-f)*(m-f)+(h-g)*(h-g)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(m-f)/x,this.y=(h-g)/x,this.z=(d-u)/x,this.w=Math.acos((c+p+v-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ll extends hh{constructor(t=1,i=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new Zi(0,0,t,i),this.scissorTest=!1,this.viewport=new Zi(0,0,t,i);const n={width:t,height:i,depth:1};r.encoding!==void 0&&(ex("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===Dd?hi:Rd),this.texture=new mr(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Dr,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(t,i,r=1){(this.width!==t||this.height!==i||this.depth!==r)&&(this.width=t,this.height=i,this.depth=r,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new ff(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class iT extends mr{constructor(t=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Gr,this.minFilter=Gr,this.wrapR=ds,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class rce extends Ll{constructor(t=1,i=1,r=1){super(t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new iT(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class rN extends mr{constructor(t=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Gr,this.minFilter=Gr,this.wrapR=ds,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class nce extends Ll{constructor(t=1,i=1,r=1){super(t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new rN(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class sce extends Ll{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let a=0;a<r;a++)this.texture[a]=s.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(t,i,r=1){if(this.width!==t||this.height!==i||this.depth!==r){this.width=t,this.height=i,this.depth=r;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=t,this.texture[n].image.height=i,this.texture[n].image.depth=r;this.dispose()}return this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let i=0,r=t.texture.length;i<r;i++)this.texture[i]=t.texture[i].clone(),this.texture[i].isRenderTargetTexture=!0;return this}}class ts{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],p=s[a+1],f=s[a+2],g=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=p,t[i+2]=f,t[i+3]=g;return}if(h!==g||l!==d||c!==p||u!==f){let m=1-o;const v=l*d+c*p+u*f+h*g,x=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){const A=Math.sqrt(y),S=Math.atan2(A,v*x);m=Math.sin(m*S)/A,o=Math.sin(o*S)/A}const _=o*x;if(l=l*m+d*_,c=c*m+p*_,u=u*m+f*_,h=h*m+g*_,m===1-o){const A=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=A,c*=A,u*=A,h*=A}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return t[i]=o*f+u*h+l*p-c*d,t[i+1]=l*f+u*d+c*h-o*p,t[i+2]=c*f+u*p+o*d-l*h,t[i+3]=u*f-o*h-l*d-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){const r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),p=l(n/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"YXZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"ZXY":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"ZYX":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"YZX":this._x=d*u*h+c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h-d*p*f;break;case"XZY":this._x=d*u*h-c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-n)*p}else if(r>o&&r>h){const p=2*Math.sqrt(1+r-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+c)/p}else if(o>h){const p=2*Math.sqrt(1+o-r-h);this._w=(s-c)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-r-o);this._w=(a-n)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Hr(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-i;return this._w=p*a+i*this._w,this._x=p*r+i*this._x,this._y=p*n+i*this._y,this._z=p*s+i*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){const t=Math.random(),i=Math.sqrt(1-t),r=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(s),r*Math.cos(s),i*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ne{constructor(t=0,i=0,r=0){ne.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(XV.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(XV.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){const i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=l*i+a*n-o*r,u=l*r+o*i-s*n,h=l*n+s*r-a*i,d=-s*i-a*r-o*n;return this.x=c*l+d*-s+u*-o-h*-a,this.y=u*l+d*-a+h*-s-c*-o,this.z=h*l+d*-o+c*-a-u*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return TP.copy(this).projectOnVector(t),this.sub(TP)}reflect(t){return this.sub(TP.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Hr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const TP=new ne,XV=new ts;class Ul{constructor(t=new ne(1/0,1/0,1/0),i=new ne(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i+=3)this.expandByPoint(eu.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,r=t.count;i<r;i++)this.expandByPoint(eu.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=eu.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){if(t.updateWorldMatrix(!1,!1),t.boundingBox!==void 0)t.boundingBox===null&&t.computeBoundingBox(),zm.copy(t.boundingBox),zm.applyMatrix4(t.matrixWorld),this.union(zm);else{const n=t.geometry;if(n!==void 0)if(i&&n.attributes!==void 0&&n.attributes.position!==void 0){const s=n.attributes.position;for(let a=0,o=s.count;a<o;a++)eu.fromBufferAttribute(s,a).applyMatrix4(t.matrixWorld),this.expandByPoint(eu)}else n.boundingBox===null&&n.computeBoundingBox(),zm.copy(n.boundingBox),zm.applyMatrix4(t.matrixWorld),this.union(zm)}const r=t.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,eu),eu.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ry),D_.subVectors(this.max,Ry),Vm.subVectors(t.a,Ry),Gm.subVectors(t.b,Ry),Hm.subVectors(t.c,Ry),Eh.subVectors(Gm,Vm),Ch.subVectors(Hm,Gm),bp.subVectors(Vm,Hm);let i=[0,-Eh.z,Eh.y,0,-Ch.z,Ch.y,0,-bp.z,bp.y,Eh.z,0,-Eh.x,Ch.z,0,-Ch.x,bp.z,0,-bp.x,-Eh.y,Eh.x,0,-Ch.y,Ch.x,0,-bp.y,bp.x,0];return!PP(i,Vm,Gm,Hm,D_)||(i=[1,0,0,0,1,0,0,0,1],!PP(i,Vm,Gm,Hm,D_))?!1:(R_.crossVectors(Eh,Ch),i=[R_.x,R_.y,R_.z],PP(i,Vm,Gm,Hm,D_))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,eu).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(eu).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:($c[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),$c[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),$c[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),$c[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),$c[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),$c[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),$c[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),$c[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints($c),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const $c=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne],eu=new ne,zm=new Ul,Vm=new ne,Gm=new ne,Hm=new ne,Eh=new ne,Ch=new ne,bp=new ne,Ry=new ne,D_=new ne,R_=new ne,_p=new ne;function PP(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){_p.fromArray(e,s);const o=n.x*Math.abs(_p.x)+n.y*Math.abs(_p.y)+n.z*Math.abs(_p.z),l=t.dot(_p),c=i.dot(_p),u=r.dot(_p);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const ace=new Ul,Iy=new ne,DP=new ne;class Yo{constructor(t=new ne,i=-1){this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):ace.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Iy.subVectors(t,this.center);const i=Iy.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(Iy,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(DP.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Iy.copy(t.center).add(DP)),this.expandByPoint(Iy.copy(t.center).sub(DP))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const tu=new ne,RP=new ne,I_=new ne,Th=new ne,IP=new ne,L_=new ne,LP=new ne;class hm{constructor(t=new ne,i=new ne(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,tu)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=tu.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(tu.copy(this.origin).addScaledVector(this.direction,i),tu.distanceToSquared(t))}distanceSqToSegment(t,i,r,n){RP.copy(t).add(i).multiplyScalar(.5),I_.copy(i).sub(t).normalize(),Th.copy(this.origin).sub(RP);const s=t.distanceTo(i)*.5,a=-this.direction.dot(I_),o=Th.dot(this.direction),l=-Th.dot(I_),c=Th.lengthSq(),u=Math.abs(1-a*a);let h,d,p,f;if(u>0)if(h=a*l-o,d=a*o-l,f=s*u,h>=0)if(d>=-f)if(d<=f){const g=1/u;h*=g,d*=g,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d<=-f?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=f?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(RP).addScaledVector(I_,d),p}intersectSphere(t,i){tu.subVectors(t.center,this.origin);const r=tu.dot(this.direction),n=tu.dot(tu)-r*r,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(t.min.x-d.x)*c,n=(t.max.x-d.x)*c):(r=(t.max.x-d.x)*c,n=(t.min.x-d.x)*c),u>=0?(s=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(s=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(t){return this.intersectBox(t,tu)!==null}intersectTriangle(t,i,r,n,s){IP.subVectors(i,t),L_.subVectors(r,t),LP.crossVectors(IP,L_);let a=this.direction.dot(LP),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Th.subVectors(this.origin,t);const l=o*this.direction.dot(L_.crossVectors(Th,L_));if(l<0)return null;const c=o*this.direction.dot(IP.cross(Th));if(c<0||l+c>a)return null;const u=-o*Th.dot(LP);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ri{constructor(t,i,r,n,s,a,o,l,c,u,h,d,p,f,g,m){ri.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,g,m)}set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,g,m){const v=this.elements;return v[0]=t,v[4]=i,v[8]=r,v[12]=n,v[1]=s,v[5]=a,v[9]=o,v[13]=l,v[2]=c,v[6]=u,v[10]=h,v[14]=d,v[3]=p,v[7]=f,v[11]=g,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ri().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,n=1/jm.setFromMatrixColumn(t,0).length(),s=1/jm.setFromMatrixColumn(t,1).length(),a=1/jm.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*u,p=a*h,f=o*u,g=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+f*c,i[5]=d-g*c,i[9]=-o*l,i[2]=g-d*c,i[6]=f+p*c,i[10]=a*l}else if(t.order==="YXZ"){const d=l*u,p=l*h,f=c*u,g=c*h;i[0]=d+g*o,i[4]=f*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-f,i[6]=g+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*u,p=l*h,f=c*u,g=c*h;i[0]=d-g*o,i[4]=-a*h,i[8]=f+p*o,i[1]=p+f*o,i[5]=a*u,i[9]=g-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*u,p=a*h,f=o*u,g=o*h;i[0]=l*u,i[4]=f*c-p,i[8]=d*c+g,i[1]=l*h,i[5]=g*c+d,i[9]=p*c-f,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,p=a*c,f=o*l,g=o*c;i[0]=l*u,i[4]=g-d*h,i[8]=f*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+f,i[10]=d-g*h}else if(t.order==="XZY"){const d=a*l,p=a*c,f=o*l,g=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+g,i[5]=a*u,i[9]=p*h-f,i[2]=f*h-p,i[6]=o*u,i[10]=g*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(oce,t,lce)}lookAt(t,i,r){const n=this.elements;return Va.subVectors(t,i),Va.lengthSq()===0&&(Va.z=1),Va.normalize(),Ph.crossVectors(r,Va),Ph.lengthSq()===0&&(Math.abs(r.z)===1?Va.x+=1e-4:Va.z+=1e-4,Va.normalize(),Ph.crossVectors(r,Va)),Ph.normalize(),O_.crossVectors(Va,Ph),n[0]=Ph.x,n[4]=O_.x,n[8]=Va.x,n[1]=Ph.y,n[5]=O_.y,n[9]=Va.y,n[2]=Ph.z,n[6]=O_.z,n[10]=Va.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],f=r[2],g=r[6],m=r[10],v=r[14],x=r[3],y=r[7],_=r[11],A=r[15],S=n[0],C=n[4],M=n[8],E=n[12],P=n[1],R=n[5],O=n[9],L=n[13],I=n[2],z=n[6],K=n[10],Y=n[14],U=n[3],j=n[7],k=n[11],q=n[15];return s[0]=a*S+o*P+l*I+c*U,s[4]=a*C+o*R+l*z+c*j,s[8]=a*M+o*O+l*K+c*k,s[12]=a*E+o*L+l*Y+c*q,s[1]=u*S+h*P+d*I+p*U,s[5]=u*C+h*R+d*z+p*j,s[9]=u*M+h*O+d*K+p*k,s[13]=u*E+h*L+d*Y+p*q,s[2]=f*S+g*P+m*I+v*U,s[6]=f*C+g*R+m*z+v*j,s[10]=f*M+g*O+m*K+v*k,s[14]=f*E+g*L+m*Y+v*q,s[3]=x*S+y*P+_*I+A*U,s[7]=x*C+y*R+_*z+A*j,s[11]=x*M+y*O+_*K+A*k,s[15]=x*E+y*L+_*Y+A*q,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],f=t[3],g=t[7],m=t[11],v=t[15];return f*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*p-r*l*p)+g*(+i*l*p-i*c*d+s*a*d-n*a*p+n*c*u-s*l*u)+m*(+i*c*h-i*o*p-s*a*h+r*a*p+s*o*u-r*c*u)+v*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],x=h*m*c-g*d*c+g*l*p-o*m*p-h*l*v+o*d*v,y=f*d*c-u*m*c-f*l*p+a*m*p+u*l*v-a*d*v,_=u*g*c-f*h*c+f*o*p-a*g*p-u*o*v+a*h*v,A=f*h*l-u*g*l-f*o*d+a*g*d+u*o*m-a*h*m,S=i*x+r*y+n*_+s*A;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/S;return t[0]=x*C,t[1]=(g*d*s-h*m*s-g*n*p+r*m*p+h*n*v-r*d*v)*C,t[2]=(o*m*s-g*l*s+g*n*c-r*m*c-o*n*v+r*l*v)*C,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*p-r*l*p)*C,t[4]=y*C,t[5]=(u*m*s-f*d*s+f*n*p-i*m*p-u*n*v+i*d*v)*C,t[6]=(f*l*s-a*m*s-f*n*c+i*m*c+a*n*v-i*l*v)*C,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*p+i*l*p)*C,t[8]=_*C,t[9]=(f*h*s-u*g*s-f*r*p+i*g*p+u*r*v-i*h*v)*C,t[10]=(a*g*s-f*o*s+f*r*c-i*g*c-a*r*v+i*o*v)*C,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*p-i*o*p)*C,t[12]=A*C,t[13]=(u*g*n-f*h*n+f*r*d-i*g*d-u*r*m+i*h*m)*C,t[14]=(f*o*n-a*g*n-f*r*l+i*g*l+a*r*m-i*o*m)*C,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*C,this}scale(t){const i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,f=s*h,g=a*u,m=a*h,v=o*h,x=l*c,y=l*u,_=l*h,A=r.x,S=r.y,C=r.z;return n[0]=(1-(g+v))*A,n[1]=(p+_)*A,n[2]=(f-y)*A,n[3]=0,n[4]=(p-_)*S,n[5]=(1-(d+v))*S,n[6]=(m+x)*S,n[7]=0,n[8]=(f+y)*C,n[9]=(m-x)*C,n[10]=(1-(d+g))*C,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){const n=this.elements;let s=jm.set(n[0],n[1],n[2]).length();const a=jm.set(n[4],n[5],n[6]).length(),o=jm.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],tl.copy(this);const c=1/s,u=1/a,h=1/o;return tl.elements[0]*=c,tl.elements[1]*=c,tl.elements[2]*=c,tl.elements[4]*=u,tl.elements[5]*=u,tl.elements[6]*=u,tl.elements[8]*=h,tl.elements[9]*=h,tl.elements[10]*=h,i.setFromRotationMatrix(tl),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a,o=Sc){const l=this.elements,c=2*s/(i-t),u=2*s/(r-n),h=(i+t)/(i-t),d=(r+n)/(r-n);let p,f;if(o===Sc)p=-(a+s)/(a-s),f=-2*a*s/(a-s);else if(o===Xx)p=-a/(a-s),f=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,r,n,s,a,o=Sc){const l=this.elements,c=1/(i-t),u=1/(r-n),h=1/(a-s),d=(i+t)*c,p=(r+n)*u;let f,g;if(o===Sc)f=(a+s)*h,g=-2*h;else if(o===Xx)f=s*h,g=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=g,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const jm=new ne,tl=new ri,oce=new ne(0,0,0),lce=new ne(1,1,1),Ph=new ne,O_=new ne,Va=new ne,YV=new ri,qV=new ts;class dm{constructor(t=0,i=0,r=0,n=dm.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,n=this._order){return this._x=t,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],p=n[10];switch(i){case"XYZ":this._y=Math.asin(Hr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Hr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Hr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Hr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Hr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Hr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return YV.makeRotationFromQuaternion(t),this.setFromRotationMatrix(YV,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return qV.setFromEuler(this),this.setFromQuaternion(qV,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}dm.DEFAULT_ORDER="XYZ";class Lf{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let cce=0;const QV=new ne,Wm=new ts,iu=new ri,B_=new ne,Ly=new ne,uce=new ne,hce=new ts,JV=new ne(1,0,0),KV=new ne(0,1,0),ZV=new ne(0,0,1),dce={type:"added"},$V={type:"removed"};class Oi extends hh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:cce++}),this.uuid=$a(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oi.DEFAULT_UP.clone();const t=new ne,i=new dm,r=new ts,n=new ne(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ri},normalMatrix:{value:new wi}}),this.matrix=new ri,this.matrixWorld=new ri,this.matrixAutoUpdate=Oi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Lf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Wm.setFromAxisAngle(t,i),this.quaternion.multiply(Wm),this}rotateOnWorldAxis(t,i){return Wm.setFromAxisAngle(t,i),this.quaternion.premultiply(Wm),this}rotateX(t){return this.rotateOnAxis(JV,t)}rotateY(t){return this.rotateOnAxis(KV,t)}rotateZ(t){return this.rotateOnAxis(ZV,t)}translateOnAxis(t,i){return QV.copy(t).applyQuaternion(this.quaternion),this.position.add(QV.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(JV,t)}translateY(t){return this.translateOnAxis(KV,t)}translateZ(t){return this.translateOnAxis(ZV,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(iu.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?B_.copy(t):B_.set(t,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),Ly.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?iu.lookAt(Ly,B_,this.up):iu.lookAt(B_,Ly,this.up),this.quaternion.setFromRotationMatrix(iu),n&&(iu.extractRotation(n.matrixWorld),Wm.setFromRotationMatrix(iu),this.quaternion.premultiply(Wm.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(dce)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent($V)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent($V)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),iu.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),iu.multiply(t.parent.matrixWorld)),t.applyMatrix4(iu),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ly,t,uce),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ly,hce,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++){const s=i[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),c=a(t.textures),u=a(t.images),h=a(t.shapes),d=a(t.skeletons),p=a(t.animations),f=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations,this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){const n=t.children[r];this.add(n.clone())}return this}}Oi.DEFAULT_UP=new ne(0,1,0);Oi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const il=new ne,ru=new ne,OP=new ne,nu=new ne,Xm=new ne,Ym=new ne,e5=new ne,BP=new ne,FP=new ne,NP=new ne;let F_=!1;class wa{constructor(t=new ne,i=new ne,r=new ne){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),il.subVectors(t,i),n.cross(il);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){il.subVectors(n,i),ru.subVectors(r,i),OP.subVectors(t,i);const a=il.dot(il),o=il.dot(ru),l=il.dot(OP),c=ru.dot(ru),u=ru.dot(OP),h=a*c-o*o;if(h===0)return s.set(-2,-1,-1);const d=1/h,p=(c*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,nu),nu.x>=0&&nu.y>=0&&nu.x+nu.y<=1}static getUV(t,i,r,n,s,a,o,l){return F_===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),F_=!0),this.getInterpolation(t,i,r,n,s,a,o,l)}static getInterpolation(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,nu),l.setScalar(0),l.addScaledVector(s,nu.x),l.addScaledVector(a,nu.y),l.addScaledVector(o,nu.z),l}static isFrontFacing(t,i,r,n){return il.subVectors(r,i),ru.subVectors(t,i),il.cross(ru).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return il.subVectors(this.c,this.b),ru.subVectors(this.a,this.b),il.cross(ru).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return wa.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return wa.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,r,n,s){return F_===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),F_=!0),wa.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}getInterpolation(t,i,r,n,s){return wa.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return wa.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return wa.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const r=this.a,n=this.b,s=this.c;let a,o;Xm.subVectors(n,r),Ym.subVectors(s,r),BP.subVectors(t,r);const l=Xm.dot(BP),c=Ym.dot(BP);if(l<=0&&c<=0)return i.copy(r);FP.subVectors(t,n);const u=Xm.dot(FP),h=Ym.dot(FP);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(Xm,a);NP.subVectors(t,s);const p=Xm.dot(NP),f=Ym.dot(NP);if(f>=0&&p<=f)return i.copy(s);const g=p*c-l*f;if(g<=0&&c>=0&&f<=0)return o=c/(c-f),i.copy(r).addScaledVector(Ym,o);const m=u*f-p*h;if(m<=0&&h-u>=0&&p-f>=0)return e5.subVectors(s,n),o=(h-u)/(h-u+(p-f)),i.copy(n).addScaledVector(e5,o);const v=1/(m+g+d);return a=g*v,o=d*v,i.copy(r).addScaledVector(Xm,a).addScaledVector(Ym,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let pce=0;class yn extends hh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:pce++}),this.uuid=$a(),this.name="",this.type="Material",this.blending=Df,this.side=Bc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=VF,this.blendDst=GF,this.blendEquation=$p,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=hE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=UQ,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=gM,this.stencilZFail=gM,this.stencilZPass=gM,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const r=t[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Df&&(r.blending=this.blending),this.side!==Bc&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(r.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(t.textures),a=n(t.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}const QQ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rl={h:0,s:0,l:0},N_={h:0,s:0,l:0};function UP(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class bt{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,r)}set(t,i,r){if(i===void 0&&r===void 0){const n=t;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(t,i,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=hi){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,So.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=So.workingColorSpace){return this.r=t,this.g=i,this.b=r,So.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=So.workingColorSpace){if(t=eN(t,1),i=Hr(i,0,1),r=Hr(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=UP(a,s,t+1/3),this.g=UP(a,s,t),this.b=UP(a,s,t-1/3)}return So.toWorkingColorSpace(this,n),this}setStyle(t,i=hi){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=hi){const r=QQ[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Rv(t.r),this.g=Rv(t.g),this.b=Rv(t.b),this}copyLinearToSRGB(t){return this.r=EP(t.r),this.g=EP(t.g),this.b=EP(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=hi){return So.fromWorkingColorSpace(Ts.copy(this),t),Math.round(Hr(Ts.r*255,0,255))*65536+Math.round(Hr(Ts.g*255,0,255))*256+Math.round(Hr(Ts.b*255,0,255))}getHexString(t=hi){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=So.workingColorSpace){So.fromWorkingColorSpace(Ts.copy(this),i);const r=Ts.r,n=Ts.g,s=Ts.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=So.workingColorSpace){return So.fromWorkingColorSpace(Ts.copy(this),i),t.r=Ts.r,t.g=Ts.g,t.b=Ts.b,t}getStyle(t=hi){So.fromWorkingColorSpace(Ts.copy(this),t);const i=Ts.r,r=Ts.g,n=Ts.b;return t!==hi?`color(${t} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(t,i,r){return this.getHSL(rl),rl.h+=t,rl.s+=i,rl.l+=r,this.setHSL(rl.h,rl.s,rl.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(rl),t.getHSL(N_);const r=$1(rl.h,N_.h,i),n=$1(rl.s,N_.s,i),s=$1(rl.l,N_.l,i);return this.setHSL(r,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,r=this.g,n=this.b,s=t.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ts=new bt;bt.NAMES=QQ;class Ja extends yn{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Rw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Du=fce();function fce(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function va(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Hr(e,-65504,65504),Du.floatView[0]=e;const t=Du.uint32View[0],i=t>>23&511;return Du.baseTable[i]+((t&8388607)>>Du.shiftTable[i])}function D1(e){const t=e>>10;return Du.uint32View[0]=Du.mantissaTable[Du.offsetTable[t]+(e&1023)]+Du.exponentTable[t],Du.floatView[0]}const mce={toHalfFloat:va,fromHalfFloat:D1},cn=new ne,U_=new it;class Ui{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=Wx,this.updateRange={offset:0,count:-1},this.gpuType=_c,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)U_.fromBufferAttribute(this,i),U_.applyMatrix3(t),this.setXY(i,U_.x,U_.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)cn.fromBufferAttribute(this,i),cn.applyMatrix3(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)cn.fromBufferAttribute(this,i),cn.applyMatrix4(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)cn.fromBufferAttribute(this,i),cn.applyNormalMatrix(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)cn.fromBufferAttribute(this,i),cn.transformDirection(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this}set(t,i=0){return this.array.set(t,i),this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Qa(i,this.array)),i}setX(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Qa(i,this.array)),i}setY(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Qa(i,this.array)),i}setZ(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Qa(i,this.array)),i}setW(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array),s=bi(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Wx&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class gce extends Ui{constructor(t,i,r){super(new Int8Array(t),i,r)}}class vce extends Ui{constructor(t,i,r){super(new Uint8Array(t),i,r)}}class yce extends Ui{constructor(t,i,r){super(new Uint8ClampedArray(t),i,r)}}class xce extends Ui{constructor(t,i,r){super(new Int16Array(t),i,r)}}class nN extends Ui{constructor(t,i,r){super(new Uint16Array(t),i,r)}}class wce extends Ui{constructor(t,i,r){super(new Int32Array(t),i,r)}}class sN extends Ui{constructor(t,i,r){super(new Uint32Array(t),i,r)}}class bce extends Ui{constructor(t,i,r){super(new Uint16Array(t),i,r),this.isFloat16BufferAttribute=!0}getX(t){let i=D1(this.array[t*this.itemSize]);return this.normalized&&(i=Qa(i,this.array)),i}setX(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize]=va(i),this}getY(t){let i=D1(this.array[t*this.itemSize+1]);return this.normalized&&(i=Qa(i,this.array)),i}setY(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+1]=va(i),this}getZ(t){let i=D1(this.array[t*this.itemSize+2]);return this.normalized&&(i=Qa(i,this.array)),i}setZ(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+2]=va(i),this}getW(t){let i=D1(this.array[t*this.itemSize+3]);return this.normalized&&(i=Qa(i,this.array)),i}setW(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+3]=va(i),this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array)),this.array[t+0]=va(i),this.array[t+1]=va(r),this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array)),this.array[t+0]=va(i),this.array[t+1]=va(r),this.array[t+2]=va(n),this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array),s=bi(s,this.array)),this.array[t+0]=va(i),this.array[t+1]=va(r),this.array[t+2]=va(n),this.array[t+3]=va(s),this}}class Ft extends Ui{constructor(t,i,r){super(new Float32Array(t),i,r)}}class _ce extends Ui{constructor(t,i,r){super(new Float64Array(t),i,r)}}let Sce=0;const fo=new ri,kP=new Oi,qm=new ne,Ga=new Ul,Oy=new Ul,Gn=new ne;class pi extends hh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Sce++}),this.uuid=$a(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(qQ(t)?sN:nN)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new wi().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return fo.makeRotationFromQuaternion(t),this.applyMatrix4(fo),this}rotateX(t){return fo.makeRotationX(t),this.applyMatrix4(fo),this}rotateY(t){return fo.makeRotationY(t),this.applyMatrix4(fo),this}rotateZ(t){return fo.makeRotationZ(t),this.applyMatrix4(fo),this}translate(t,i,r){return fo.makeTranslation(t,i,r),this.applyMatrix4(fo),this}scale(t,i,r){return fo.makeScale(t,i,r),this.applyMatrix4(fo),this}lookAt(t){return kP.lookAt(t),kP.updateMatrix(),this.applyMatrix4(kP.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(qm).negate(),this.translate(qm.x,qm.y,qm.z),this}setFromPoints(t){const i=[];for(let r=0,n=t.length;r<n;r++){const s=t[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ft(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ul);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new ne(-1/0,-1/0,-1/0),new ne(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];Ga.setFromBufferAttribute(s),this.morphTargetsRelative?(Gn.addVectors(this.boundingBox.min,Ga.min),this.boundingBox.expandByPoint(Gn),Gn.addVectors(this.boundingBox.max,Ga.max),this.boundingBox.expandByPoint(Gn)):(this.boundingBox.expandByPoint(Ga.min),this.boundingBox.expandByPoint(Ga.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Yo);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new ne,1/0);return}if(t){const r=this.boundingSphere.center;if(Ga.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];Oy.setFromBufferAttribute(o),this.morphTargetsRelative?(Gn.addVectors(Ga.min,Oy.min),Ga.expandByPoint(Gn),Gn.addVectors(Ga.max,Oy.max),Ga.expandByPoint(Gn)):(Ga.expandByPoint(Oy.min),Ga.expandByPoint(Oy.max))}Ga.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)Gn.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared(Gn));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Gn.fromBufferAttribute(o,c),l&&(qm.fromBufferAttribute(t,c),Gn.add(qm)),n=Math.max(n,r.distanceToSquared(Gn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.array,n=i.position.array,s=i.normal.array,a=i.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ui(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let P=0;P<o;P++)c[P]=new ne,u[P]=new ne;const h=new ne,d=new ne,p=new ne,f=new it,g=new it,m=new it,v=new ne,x=new ne;function y(P,R,O){h.fromArray(n,P*3),d.fromArray(n,R*3),p.fromArray(n,O*3),f.fromArray(a,P*2),g.fromArray(a,R*2),m.fromArray(a,O*2),d.sub(h),p.sub(h),g.sub(f),m.sub(f);const L=1/(g.x*m.y-m.x*g.y);isFinite(L)&&(v.copy(d).multiplyScalar(m.y).addScaledVector(p,-g.y).multiplyScalar(L),x.copy(p).multiplyScalar(g.x).addScaledVector(d,-m.x).multiplyScalar(L),c[P].add(v),c[R].add(v),c[O].add(v),u[P].add(x),u[R].add(x),u[O].add(x))}let _=this.groups;_.length===0&&(_=[{start:0,count:r.length}]);for(let P=0,R=_.length;P<R;++P){const O=_[P],L=O.start,I=O.count;for(let z=L,K=L+I;z<K;z+=3)y(r[z+0],r[z+1],r[z+2])}const A=new ne,S=new ne,C=new ne,M=new ne;function E(P){C.fromArray(s,P*3),M.copy(C);const R=c[P];A.copy(R),A.sub(C.multiplyScalar(C.dot(R))).normalize(),S.crossVectors(M,R);const L=S.dot(u[P])<0?-1:1;l[P*4]=A.x,l[P*4+1]=A.y,l[P*4+2]=A.z,l[P*4+3]=L}for(let P=0,R=_.length;P<R;++P){const O=_[P],L=O.start,I=O.count;for(let z=L,K=L+I;z<K;z+=3)E(r[z+0]),E(r[z+1]),E(r[z+2])}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Ui(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const n=new ne,s=new ne,a=new ne,o=new ne,l=new ne,c=new ne,u=new ne,h=new ne;if(t)for(let d=0,p=t.count;d<p;d+=3){const f=t.getX(d+0),g=t.getX(d+1),m=t.getX(d+2);n.fromBufferAttribute(i,f),s.fromBufferAttribute(i,g),a.fromBufferAttribute(i,m),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,m),o.add(u),l.add(u),c.add(u),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=i.count;d<p;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)Gn.fromBufferAttribute(t,i),Gn.normalize(),t.setXYZ(i,Gn.x,Gn.y,Gn.z)}toNonIndexed(){function t(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let p=0,f=0;for(let g=0,m=l.length;g<m;g++){o.isInterleavedBufferAttribute?p=l[g]*o.data.stride+o.offset:p=l[g]*u;for(let v=0;v<u;v++)d[f++]=c[p++]}return new Ui(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new pi,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=t(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=t(d,r);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];t.data.attributes[l]=c.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(i));const n=t.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=t.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const t5=new ri,Sp=new hm,k_=new Yo,i5=new ne,Qm=new ne,Jm=new ne,Km=new ne,zP=new ne,z_=new ne,V_=new it,G_=new it,H_=new it,r5=new ne,n5=new ne,s5=new ne,j_=new ne,W_=new ne;class Ln extends Oi{constructor(t=new pi,i=new Ja){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){z_.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(zP.fromBufferAttribute(h,t),a?z_.addScaledVector(zP,u):z_.addScaledVector(zP.sub(i),u))}i.add(z_)}return i}raycast(t,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),k_.copy(r.boundingSphere),k_.applyMatrix4(s),Sp.copy(t.ray).recast(t.near),!(k_.containsPoint(Sp.origin)===!1&&(Sp.intersectSphere(k_,i5)===null||Sp.origin.distanceToSquared(i5)>(t.far-t.near)**2))&&(t5.copy(s).invert(),Sp.copy(t.ray).applyMatrix4(t5),!(r.boundingBox!==null&&Sp.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(t,i,Sp)))}_computeIntersections(t,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(o!==null)if(Array.isArray(a))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=a[m.materialIndex],x=Math.max(m.start,p.start),y=Math.min(o.count,Math.min(m.start+m.count,p.start+p.count));for(let _=x,A=y;_<A;_+=3){const S=o.getX(_),C=o.getX(_+1),M=o.getX(_+2);n=X_(this,v,t,r,c,u,h,S,C,M),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const f=Math.max(0,p.start),g=Math.min(o.count,p.start+p.count);for(let m=f,v=g;m<v;m+=3){const x=o.getX(m),y=o.getX(m+1),_=o.getX(m+2);n=X_(this,a,t,r,c,u,h,x,y,_),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=a[m.materialIndex],x=Math.max(m.start,p.start),y=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));for(let _=x,A=y;_<A;_+=3){const S=_,C=_+1,M=_+2;n=X_(this,v,t,r,c,u,h,S,C,M),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const f=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);for(let m=f,v=g;m<v;m+=3){const x=m,y=m+1,_=m+2;n=X_(this,a,t,r,c,u,h,x,y,_),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}}}function Ace(e,t,i,r,n,s,a,o){let l;if(t.side===sa?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Bc,o),l===null)return null;W_.copy(o),W_.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(W_);return c<i.near||c>i.far?null:{distance:c,point:W_.clone(),object:e}}function X_(e,t,i,r,n,s,a,o,l,c){e.getVertexPosition(o,Qm),e.getVertexPosition(l,Jm),e.getVertexPosition(c,Km);const u=Ace(e,t,i,r,Qm,Jm,Km,j_);if(u){n&&(V_.fromBufferAttribute(n,o),G_.fromBufferAttribute(n,l),H_.fromBufferAttribute(n,c),u.uv=wa.getInterpolation(j_,Qm,Jm,Km,V_,G_,H_,new it)),s&&(V_.fromBufferAttribute(s,o),G_.fromBufferAttribute(s,l),H_.fromBufferAttribute(s,c),u.uv1=wa.getInterpolation(j_,Qm,Jm,Km,V_,G_,H_,new it),u.uv2=u.uv1),a&&(r5.fromBufferAttribute(a,o),n5.fromBufferAttribute(a,l),s5.fromBufferAttribute(a,c),u.normal=wa.getInterpolation(j_,Qm,Jm,Km,r5,n5,s5,new ne),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a:o,b:l,c,normal:new ne,materialIndex:0};wa.getNormal(Qm,Jm,Km,h.normal),u.face=h}return u}class rp extends pi{constructor(t=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,p=0;f("z","y","x",-1,-1,r,i,t,a,s,0),f("z","y","x",1,-1,r,i,-t,a,s,1),f("x","z","y",1,1,t,r,i,n,a,2),f("x","z","y",1,-1,t,r,-i,n,a,3),f("x","y","z",1,-1,t,i,r,n,s,4),f("x","y","z",-1,-1,t,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new Ft(c,3)),this.setAttribute("normal",new Ft(u,3)),this.setAttribute("uv",new Ft(h,2));function f(g,m,v,x,y,_,A,S,C,M,E){const P=_/C,R=A/M,O=_/2,L=A/2,I=S/2,z=C+1,K=M+1;let Y=0,U=0;const j=new ne;for(let k=0;k<K;k++){const q=k*R-L;for(let W=0;W<z;W++){const te=W*P-O;j[g]=te*x,j[m]=q*y,j[v]=I,c.push(j.x,j.y,j.z),j[g]=0,j[m]=0,j[v]=S>0?1:-1,u.push(j.x,j.y,j.z),h.push(W/C),h.push(1-k/M),Y+=1}}for(let k=0;k<M;k++)for(let q=0;q<C;q++){const W=d+q+z*k,te=d+q+z*(k+1),G=d+(q+1)+z*(k+1),le=d+(q+1)+z*k;l.push(W,te,le),l.push(te,G,le),U+=6}o.addGroup(p,U,E),p+=U,d+=Y}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new rp(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function a0(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][r]=null):t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Qs(e){const t={};for(let i=0;i<e.length;i++){const r=a0(e[i]);for(const n in r)t[n]=r[n]}return t}function Mce(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function JQ(e){return e.getRenderTarget()===null?e.outputColorSpace:jo}const KQ={clone:a0,merge:Qs};var Ece=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Cce=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Nc extends yn{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ece,this.fragmentShader=Cce,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=a0(t.uniforms),this.uniformsGroups=Mce(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class Iw extends Oi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ri,this.projectionMatrix=new ri,this.projectionMatrixInverse=new ri,this.coordinateSystem=Sc}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Mr extends Iw{constructor(t=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=s0*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(If*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return s0*2*Math.atan(Math.tan(If*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,i,r,n,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(If*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const Zm=-90,$m=1;class aN extends Oi{constructor(t,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null;const n=new Mr(Zm,$m,t,i);n.layers=this.layers,this.add(n);const s=new Mr(Zm,$m,t,i);s.layers=this.layers,this.add(s);const a=new Mr(Zm,$m,t,i);a.layers=this.layers,this.add(a);const o=new Mr(Zm,$m,t,i);o.layers=this.layers,this.add(o);const l=new Mr(Zm,$m,t,i);l.layers=this.layers,this.add(l);const c=new Mr(Zm,$m,t,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(t===Sc)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===Xx)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of i)this.add(c),c.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,s,a,o,l,c]=this.children,u=t.getRenderTarget(),h=t.toneMapping,d=t.xr.enabled;t.toneMapping=Tl,t.xr.enabled=!1;const p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0),t.render(i,n),t.setRenderTarget(r,1),t.render(i,s),t.setRenderTarget(r,2),t.render(i,a),t.setRenderTarget(r,3),t.render(i,o),t.setRenderTarget(r,4),t.render(i,l),r.texture.generateMipmaps=p,t.setRenderTarget(r,5),t.render(i,c),t.setRenderTarget(u),t.toneMapping=h,t.xr.enabled=d,r.texture.needsPMREMUpdate=!0}}class Lw extends mr{constructor(t,i,r,n,s,a,o,l,c,u){t=t!==void 0?t:[],i=i!==void 0?i:Gd,super(t,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class oN extends Ll{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},n=[r,r,r,r,r,r];i.encoding!==void 0&&(ex("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===Dd?hi:Rd),this.texture=new Lw(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Dr}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new rp(5,5,5),s=new Nc({name:"CubemapFromEquirect",uniforms:a0(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:sa,blending:Wu});s.uniforms.tEquirect.value=i;const a=new Ln(n,s),o=i.minFilter;return i.minFilter===Fc&&(i.minFilter=Dr),new aN(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i,r,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,r,n);t.setRenderTarget(s)}}const VP=new ne,Tce=new ne,Pce=new wi;class Mu{constructor(t=new ne(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,n){return this.normal.set(t,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const n=VP.subVectors(r,i).cross(Tce.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const r=t.delta(VP),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||Pce.getNormalMatrix(t),n=this.coplanarPoint(VP).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ap=new Yo,Y_=new ne;class rT{constructor(t=new Mu,i=new Mu,r=new Mu,n=new Mu,s=new Mu,a=new Mu){this.planes=[t,i,r,n,s,a]}set(t,i,r,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,i=Sc){const r=this.planes,n=t.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],p=n[8],f=n[9],g=n[10],m=n[11],v=n[12],x=n[13],y=n[14],_=n[15];if(r[0].setComponents(l-s,d-c,m-p,_-v).normalize(),r[1].setComponents(l+s,d+c,m+p,_+v).normalize(),r[2].setComponents(l+a,d+u,m+f,_+x).normalize(),r[3].setComponents(l-a,d-u,m-f,_-x).normalize(),r[4].setComponents(l-o,d-h,m-g,_-y).normalize(),i===Sc)r[5].setComponents(l+o,d+h,m+g,_+y).normalize();else if(i===Xx)r[5].setComponents(o,h,g,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Ap.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Ap.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Ap)}intersectsSprite(t){return Ap.center.set(0,0,0),Ap.radius=.7071067811865476,Ap.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ap)}intersectsSphere(t){const i=this.planes,r=t.center,n=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(Y_.x=n.normal.x>0?t.max.x:t.min.x,Y_.y=n.normal.y>0?t.max.y:t.min.y,Y_.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Y_)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ZQ(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Dce(e,t){const i=t.isWebGL2,r=new WeakMap;function n(c,u){const h=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,d),c.onUploadCallback();let f;if(h instanceof Float32Array)f=e.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)f=e.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=e.UNSIGNED_SHORT;else if(h instanceof Int16Array)f=e.SHORT;else if(h instanceof Uint32Array)f=e.UNSIGNED_INT;else if(h instanceof Int32Array)f=e.INT;else if(h instanceof Int8Array)f=e.BYTE;else if(h instanceof Uint8Array)f=e.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)f=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:f,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){const d=u.array,p=u.updateRange;e.bindBuffer(h,c),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}class L0 extends pi{constructor(t=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};const s=t/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=t/o,d=i/l,p=[],f=[],g=[],m=[];for(let v=0;v<u;v++){const x=v*d-a;for(let y=0;y<c;y++){const _=y*h-s;f.push(_,-x,0),g.push(0,0,1),m.push(y/o),m.push(1-v/l)}}for(let v=0;v<l;v++)for(let x=0;x<o;x++){const y=x+c*v,_=x+c*(v+1),A=x+1+c*(v+1),S=x+1+c*v;p.push(y,_,S),p.push(_,A,S)}this.setIndex(p),this.setAttribute("position",new Ft(f,3)),this.setAttribute("normal",new Ft(g,3)),this.setAttribute("uv",new Ft(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new L0(t.width,t.height,t.widthSegments,t.heightSegments)}}var Rce=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Ice=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Lce=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Oce=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Bce=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Fce=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Nce="vec3 transformed = vec3( position );",Uce=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,kce=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,zce=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Vce=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Gce=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Hce=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,jce=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Wce=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Xce=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Yce=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,qce=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Qce=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Jce=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Kce=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Zce=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,$ce=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,eue=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,tue=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,iue=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,rue="gl_FragColor = linearToOutputTexel( gl_FragColor );",nue=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,sue=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,aue=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,oue=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,lue=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,cue=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,uue=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,hue=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,due=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,pue=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,fue=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,mue=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,gue=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,vue=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,yue=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,xue=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,wue=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,bue=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,_ue=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Sue=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Aue=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Mue=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,Eue=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Cue=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Tue=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Pue=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Due=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Rue=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Iue=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Lue=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Oue=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,Bue=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Fue=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Nue=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Uue=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,kue=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,zue=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Vue=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Gue=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Hue=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,jue=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,Wue=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Xue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Yue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,que=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Que=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Jue=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Kue=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Zue=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,$ue=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ehe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,the=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,ihe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,rhe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,nhe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,she=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,ahe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ohe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,lhe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,che=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,uhe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,hhe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,dhe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,phe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,fhe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,mhe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ghe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,vhe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,yhe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,xhe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,whe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,bhe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_he=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,She=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Ahe=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Mhe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Ehe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Che=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,The=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Phe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Dhe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Rhe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Ihe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Lhe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Ohe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Bhe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Fhe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Nhe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Uhe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,khe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,zhe=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Vhe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ghe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Hhe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jhe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Whe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Xhe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Yhe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,qhe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Qhe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Jhe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Khe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zhe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$he=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ede=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,tde=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ide=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rde=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,nde=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sde=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,xi={alphamap_fragment:Rce,alphamap_pars_fragment:Ice,alphatest_fragment:Lce,alphatest_pars_fragment:Oce,aomap_fragment:Bce,aomap_pars_fragment:Fce,begin_vertex:Nce,beginnormal_vertex:Uce,bsdfs:kce,iridescence_fragment:zce,bumpmap_pars_fragment:Vce,clipping_planes_fragment:Gce,clipping_planes_pars_fragment:Hce,clipping_planes_pars_vertex:jce,clipping_planes_vertex:Wce,color_fragment:Xce,color_pars_fragment:Yce,color_pars_vertex:qce,color_vertex:Qce,common:Jce,cube_uv_reflection_fragment:Kce,defaultnormal_vertex:Zce,displacementmap_pars_vertex:$ce,displacementmap_vertex:eue,emissivemap_fragment:tue,emissivemap_pars_fragment:iue,encodings_fragment:rue,encodings_pars_fragment:nue,envmap_fragment:sue,envmap_common_pars_fragment:aue,envmap_pars_fragment:oue,envmap_pars_vertex:lue,envmap_physical_pars_fragment:wue,envmap_vertex:cue,fog_vertex:uue,fog_pars_vertex:hue,fog_fragment:due,fog_pars_fragment:pue,gradientmap_pars_fragment:fue,lightmap_fragment:mue,lightmap_pars_fragment:gue,lights_lambert_fragment:vue,lights_lambert_pars_fragment:yue,lights_pars_begin:xue,lights_toon_fragment:bue,lights_toon_pars_fragment:_ue,lights_phong_fragment:Sue,lights_phong_pars_fragment:Aue,lights_physical_fragment:Mue,lights_physical_pars_fragment:Eue,lights_fragment_begin:Cue,lights_fragment_maps:Tue,lights_fragment_end:Pue,logdepthbuf_fragment:Due,logdepthbuf_pars_fragment:Rue,logdepthbuf_pars_vertex:Iue,logdepthbuf_vertex:Lue,map_fragment:Oue,map_pars_fragment:Bue,map_particle_fragment:Fue,map_particle_pars_fragment:Nue,metalnessmap_fragment:Uue,metalnessmap_pars_fragment:kue,morphcolor_vertex:zue,morphnormal_vertex:Vue,morphtarget_pars_vertex:Gue,morphtarget_vertex:Hue,normal_fragment_begin:jue,normal_fragment_maps:Wue,normal_pars_fragment:Xue,normal_pars_vertex:Yue,normal_vertex:que,normalmap_pars_fragment:Que,clearcoat_normal_fragment_begin:Jue,clearcoat_normal_fragment_maps:Kue,clearcoat_pars_fragment:Zue,iridescence_pars_fragment:$ue,output_fragment:ehe,packing:the,premultiplied_alpha_fragment:ihe,project_vertex:rhe,dithering_fragment:nhe,dithering_pars_fragment:she,roughnessmap_fragment:ahe,roughnessmap_pars_fragment:ohe,shadowmap_pars_fragment:lhe,shadowmap_pars_vertex:che,shadowmap_vertex:uhe,shadowmask_pars_fragment:hhe,skinbase_vertex:dhe,skinning_pars_vertex:phe,skinning_vertex:fhe,skinnormal_vertex:mhe,specularmap_fragment:ghe,specularmap_pars_fragment:vhe,tonemapping_fragment:yhe,tonemapping_pars_fragment:xhe,transmission_fragment:whe,transmission_pars_fragment:bhe,uv_pars_fragment:_he,uv_pars_vertex:She,uv_vertex:Ahe,worldpos_vertex:Mhe,background_vert:Ehe,background_frag:Che,backgroundCube_vert:The,backgroundCube_frag:Phe,cube_vert:Dhe,cube_frag:Rhe,depth_vert:Ihe,depth_frag:Lhe,distanceRGBA_vert:Ohe,distanceRGBA_frag:Bhe,equirect_vert:Fhe,equirect_frag:Nhe,linedashed_vert:Uhe,linedashed_frag:khe,meshbasic_vert:zhe,meshbasic_frag:Vhe,meshlambert_vert:Ghe,meshlambert_frag:Hhe,meshmatcap_vert:jhe,meshmatcap_frag:Whe,meshnormal_vert:Xhe,meshnormal_frag:Yhe,meshphong_vert:qhe,meshphong_frag:Qhe,meshphysical_vert:Jhe,meshphysical_frag:Khe,meshtoon_vert:Zhe,meshtoon_frag:$he,points_vert:ede,points_frag:tde,shadow_vert:ide,shadow_frag:rde,sprite_vert:nde,sprite_frag:sde},wt={common:{diffuse:{value:new bt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new wi},alphaMap:{value:null},alphaMapTransform:{value:new wi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new wi}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new wi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new wi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new wi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new wi},normalScale:{value:new it(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new wi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new wi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new wi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new wi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new wi},alphaTest:{value:0},uvTransform:{value:new wi}},sprite:{diffuse:{value:new bt(16777215)},opacity:{value:1},center:{value:new it(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new wi},alphaMap:{value:null},alphaMapTransform:{value:new wi},alphaTest:{value:0}}},xl={basic:{uniforms:Qs([wt.common,wt.specularmap,wt.envmap,wt.aomap,wt.lightmap,wt.fog]),vertexShader:xi.meshbasic_vert,fragmentShader:xi.meshbasic_frag},lambert:{uniforms:Qs([wt.common,wt.specularmap,wt.envmap,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.fog,wt.lights,{emissive:{value:new bt(0)}}]),vertexShader:xi.meshlambert_vert,fragmentShader:xi.meshlambert_frag},phong:{uniforms:Qs([wt.common,wt.specularmap,wt.envmap,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.fog,wt.lights,{emissive:{value:new bt(0)},specular:{value:new bt(1118481)},shininess:{value:30}}]),vertexShader:xi.meshphong_vert,fragmentShader:xi.meshphong_frag},standard:{uniforms:Qs([wt.common,wt.envmap,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.roughnessmap,wt.metalnessmap,wt.fog,wt.lights,{emissive:{value:new bt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xi.meshphysical_vert,fragmentShader:xi.meshphysical_frag},toon:{uniforms:Qs([wt.common,wt.aomap,wt.lightmap,wt.emissivemap,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.gradientmap,wt.fog,wt.lights,{emissive:{value:new bt(0)}}]),vertexShader:xi.meshtoon_vert,fragmentShader:xi.meshtoon_frag},matcap:{uniforms:Qs([wt.common,wt.bumpmap,wt.normalmap,wt.displacementmap,wt.fog,{matcap:{value:null}}]),vertexShader:xi.meshmatcap_vert,fragmentShader:xi.meshmatcap_frag},points:{uniforms:Qs([wt.points,wt.fog]),vertexShader:xi.points_vert,fragmentShader:xi.points_frag},dashed:{uniforms:Qs([wt.common,wt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xi.linedashed_vert,fragmentShader:xi.linedashed_frag},depth:{uniforms:Qs([wt.common,wt.displacementmap]),vertexShader:xi.depth_vert,fragmentShader:xi.depth_frag},normal:{uniforms:Qs([wt.common,wt.bumpmap,wt.normalmap,wt.displacementmap,{opacity:{value:1}}]),vertexShader:xi.meshnormal_vert,fragmentShader:xi.meshnormal_frag},sprite:{uniforms:Qs([wt.sprite,wt.fog]),vertexShader:xi.sprite_vert,fragmentShader:xi.sprite_frag},background:{uniforms:{uvTransform:{value:new wi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:xi.background_vert,fragmentShader:xi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:xi.backgroundCube_vert,fragmentShader:xi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xi.cube_vert,fragmentShader:xi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xi.equirect_vert,fragmentShader:xi.equirect_frag},distanceRGBA:{uniforms:Qs([wt.common,wt.displacementmap,{referencePosition:{value:new ne},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xi.distanceRGBA_vert,fragmentShader:xi.distanceRGBA_frag},shadow:{uniforms:Qs([wt.lights,wt.fog,{color:{value:new bt(0)},opacity:{value:1}}]),vertexShader:xi.shadow_vert,fragmentShader:xi.shadow_frag}};xl.physical={uniforms:Qs([xl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new wi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new wi},clearcoatNormalScale:{value:new it(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new wi},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new wi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new wi},sheen:{value:0},sheenColor:{value:new bt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new wi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new wi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new wi},transmissionSamplerSize:{value:new it},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new wi},attenuationDistance:{value:0},attenuationColor:{value:new bt(0)},specularColor:{value:new bt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new wi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new wi},anisotropyVector:{value:new it},anisotropyMap:{value:null},anisotropyMapTransform:{value:new wi}}]),vertexShader:xi.meshphysical_vert,fragmentShader:xi.meshphysical_frag};const q_={r:0,b:0,g:0};function ade(e,t,i,r,n,s,a){const o=new bt(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(m,v){let x=!1,y=v.isScene===!0?v.background:null;switch(y&&y.isTexture&&(y=(v.backgroundBlurriness>0?i:t).get(y)),y===null?g(o,l):y&&y.isColor&&(g(y,1),x=!0),e.xr.getEnvironmentBlendMode()){case"opaque":x=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,a),x=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,a),x=!0;break}(e.autoClear||x)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===I0)?(u===void 0&&(u=new Ln(new rp(1,1,1),new Nc({name:"BackgroundCubeMaterial",uniforms:a0(xl.backgroundCube.uniforms),vertexShader:xl.backgroundCube.vertexShader,fragmentShader:xl.backgroundCube.fragmentShader,side:sa,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,C,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=y,u.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,u.material.toneMapped=y.colorSpace!==hi,(h!==y||d!==y.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):y&&y.isTexture&&(c===void 0&&(c=new Ln(new L0(2,2),new Nc({name:"BackgroundMaterial",uniforms:a0(xl.background.uniforms),vertexShader:xl.background.vertexShader,fragmentShader:xl.background.fragmentShader,side:Bc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=y,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=y.colorSpace!==hi,y.matrixAutoUpdate===!0&&y.updateMatrix(),c.material.uniforms.uvTransform.value.copy(y.matrix),(h!==y||d!==y.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function g(m,v){m.getRGB(q_,JQ(e)),r.buffers.color.setClear(q_.r,q_.g,q_.b,v,a)}return{getClearColor:function(){return o},setClearColor:function(m,v=1){o.set(m),l=v,g(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,g(o,l)},render:f}}function ode(e,t,i,r){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=m(null);let c=l,u=!1;function h(I,z,K,Y,U){let j=!1;if(a){const k=g(Y,K,z);c!==k&&(c=k,p(c.object)),j=v(I,Y,K,U),j&&x(I,Y,K,U)}else{const k=z.wireframe===!0;(c.geometry!==Y.id||c.program!==K.id||c.wireframe!==k)&&(c.geometry=Y.id,c.program=K.id,c.wireframe=k,j=!0)}U!==null&&i.update(U,e.ELEMENT_ARRAY_BUFFER),(j||u)&&(u=!1,M(I,z,K,Y),U!==null&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(U).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(I){return r.isWebGL2?e.bindVertexArray(I):s.bindVertexArrayOES(I)}function f(I){return r.isWebGL2?e.deleteVertexArray(I):s.deleteVertexArrayOES(I)}function g(I,z,K){const Y=K.wireframe===!0;let U=o[I.id];U===void 0&&(U={},o[I.id]=U);let j=U[z.id];j===void 0&&(j={},U[z.id]=j);let k=j[Y];return k===void 0&&(k=m(d()),j[Y]=k),k}function m(I){const z=[],K=[],Y=[];for(let U=0;U<n;U++)z[U]=0,K[U]=0,Y[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:K,attributeDivisors:Y,object:I,attributes:{},index:null}}function v(I,z,K,Y){const U=c.attributes,j=z.attributes;let k=0;const q=K.getAttributes();for(const W in q)if(q[W].location>=0){const G=U[W];let le=j[W];if(le===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(le=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(le=I.instanceColor)),G===void 0||G.attribute!==le||le&&G.data!==le.data)return!0;k++}return c.attributesNum!==k||c.index!==Y}function x(I,z,K,Y){const U={},j=z.attributes;let k=0;const q=K.getAttributes();for(const W in q)if(q[W].location>=0){let G=j[W];G===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(G=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(G=I.instanceColor));const le={};le.attribute=G,G&&G.data&&(le.data=G.data),U[W]=le,k++}c.attributes=U,c.attributesNum=k,c.index=Y}function y(){const I=c.newAttributes;for(let z=0,K=I.length;z<K;z++)I[z]=0}function _(I){A(I,0)}function A(I,z){const K=c.newAttributes,Y=c.enabledAttributes,U=c.attributeDivisors;K[I]=1,Y[I]===0&&(e.enableVertexAttribArray(I),Y[I]=1),U[I]!==z&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,z),U[I]=z)}function S(){const I=c.newAttributes,z=c.enabledAttributes;for(let K=0,Y=z.length;K<Y;K++)z[K]!==I[K]&&(e.disableVertexAttribArray(K),z[K]=0)}function C(I,z,K,Y,U,j,k){k===!0?e.vertexAttribIPointer(I,z,K,U,j):e.vertexAttribPointer(I,z,K,Y,U,j)}function M(I,z,K,Y){if(r.isWebGL2===!1&&(I.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;y();const U=Y.attributes,j=K.getAttributes(),k=z.defaultAttributeValues;for(const q in j){const W=j[q];if(W.location>=0){let te=U[q];if(te===void 0&&(q==="instanceMatrix"&&I.instanceMatrix&&(te=I.instanceMatrix),q==="instanceColor"&&I.instanceColor&&(te=I.instanceColor)),te!==void 0){const G=te.normalized,le=te.itemSize,Z=i.get(te);if(Z===void 0)continue;const he=Z.buffer,ye=Z.type,de=Z.bytesPerElement,xe=r.isWebGL2===!0&&(ye===e.INT||ye===e.UNSIGNED_INT||te.gpuType===jF);if(te.isInterleavedBufferAttribute){const me=te.data,ee=me.stride,we=te.offset;if(me.isInstancedInterleavedBuffer){for(let Ae=0;Ae<W.locationSize;Ae++)A(W.location+Ae,me.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=me.meshPerAttribute*me.count)}else for(let Ae=0;Ae<W.locationSize;Ae++)_(W.location+Ae);e.bindBuffer(e.ARRAY_BUFFER,he);for(let Ae=0;Ae<W.locationSize;Ae++)C(W.location+Ae,le/W.locationSize,ye,G,ee*de,(we+le/W.locationSize*Ae)*de,xe)}else{if(te.isInstancedBufferAttribute){for(let me=0;me<W.locationSize;me++)A(W.location+me,te.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let me=0;me<W.locationSize;me++)_(W.location+me);e.bindBuffer(e.ARRAY_BUFFER,he);for(let me=0;me<W.locationSize;me++)C(W.location+me,le/W.locationSize,ye,G,le*de,le/W.locationSize*me*de,xe)}}else if(k!==void 0){const G=k[q];if(G!==void 0)switch(G.length){case 2:e.vertexAttrib2fv(W.location,G);break;case 3:e.vertexAttrib3fv(W.location,G);break;case 4:e.vertexAttrib4fv(W.location,G);break;default:e.vertexAttrib1fv(W.location,G)}}}}S()}function E(){O();for(const I in o){const z=o[I];for(const K in z){const Y=z[K];for(const U in Y)f(Y[U].object),delete Y[U];delete z[K]}delete o[I]}}function P(I){if(o[I.id]===void 0)return;const z=o[I.id];for(const K in z){const Y=z[K];for(const U in Y)f(Y[U].object),delete Y[U];delete z[K]}delete o[I.id]}function R(I){for(const z in o){const K=o[z];if(K[I.id]===void 0)continue;const Y=K[I.id];for(const U in Y)f(Y[U].object),delete Y[U];delete K[I.id]}}function O(){L(),u=!0,c!==l&&(c=l,p(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:O,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:P,releaseStatesOfProgram:R,initAttributes:y,enableAttribute:_,disableUnusedAttributes:S}}function lde(e,t,i,r){const n=r.isWebGL2;let s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function cde(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){const C=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(C){if(C==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&e.constructor.name==="WebGL2RenderingContext";let o=i.precision!==void 0?i.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),g=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),v=e.getParameter(e.MAX_VARYING_VECTORS),x=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,_=a||t.has("OES_texture_float"),A=y&&_,S=a?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:g,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:x,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:A,maxSamples:S}}function ude(e){const t=this;let i=null,r=0,n=!1,s=!1;const a=new Mu,o=new wi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){const f=h.clippingPlanes,g=h.clipIntersection,m=h.clipShadows,v=e.get(h);if(!n||f===null||f.length===0||s&&!m)s?u(null):c();else{const x=s?0:r,y=x*4;let _=v.clippingState||null;l.value=_,_=u(f,d,y,p);for(let A=0;A!==y;++A)_[A]=i[A];v.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){const g=h!==null?h.length:0;let m=null;if(g!==0){if(m=l.value,f!==!0||m===null){const v=p+g*4,x=d.matrixWorldInverse;o.getNormalMatrix(x),(m===null||m.length<v)&&(m=new Float32Array(v));for(let y=0,_=p;y!==g;++y,_+=4)a.copy(h[y]).applyMatrix4(x,o),a.normal.toArray(m,_),m[_+3]=a.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,m}}function hde(e){let t=new WeakMap;function i(a,o){return o===Vx?a.mapping=Gd:o===Gx&&(a.mapping=Hd),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===Vx||o===Gx)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new oN(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}class Pl extends Iw{constructor(t=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-t,a=r+t,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const cv=4,a5=[.125,.215,.35,.446,.526,.582],ef=20,GP=new Pl,o5=new bt;let HP=null;const Xp=(1+Math.sqrt(5))/2,eg=1/Xp,l5=[new ne(1,1,1),new ne(-1,1,1),new ne(1,1,-1),new ne(-1,1,-1),new ne(0,Xp,eg),new ne(0,Xp,-eg),new ne(eg,0,Xp),new ne(-eg,0,Xp),new ne(Xp,eg,0),new ne(-Xp,eg,0)];class hL{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,r=.1,n=100){HP=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,r,n,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=h5(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=u5(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(HP),t.scissorTest=!1,Q_(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===Gd||t.mapping===Hd?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),HP=this._renderer.getRenderTarget();const r=i||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:Dr,minFilter:Dr,generateMipmaps:!1,type:r0,format:Sa,colorSpace:jo,depthBuffer:!1},n=c5(t,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=c5(t,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=dde(s)),this._blurMaterial=pde(s,t,i)}return n}_compileMaterial(t){const i=new Ln(this._lodPlanes[0],t);this._renderer.compile(i,GP)}_sceneToCubeUV(t,i,r,n){const o=new Mr(90,1,i,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(o5),u.toneMapping=Tl,u.autoClear=!1;const p=new Ja({name:"PMREM.Background",side:sa,depthWrite:!1,depthTest:!1}),f=new Ln(new rp,p);let g=!1;const m=t.background;m?m.isColor&&(p.color.copy(m),t.background=null,g=!0):(p.color.copy(o5),g=!0);for(let v=0;v<6;v++){const x=v%3;x===0?(o.up.set(0,l[v],0),o.lookAt(c[v],0,0)):x===1?(o.up.set(0,0,l[v]),o.lookAt(0,c[v],0)):(o.up.set(0,l[v],0),o.lookAt(0,0,c[v]));const y=this._cubeSize;Q_(n,x*y,v>2?y:0,y,y),u.setRenderTarget(n),g&&u.render(f,o),u.render(t,o)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=d,u.autoClear=h,t.background=m}_textureToCubeUV(t,i){const r=this._renderer,n=t.mapping===Gd||t.mapping===Hd;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=h5()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=u5());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new Ln(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;Q_(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,GP)}_applyPMREM(t){const i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=l5[(n-1)%l5.length];this._blur(t,n-1,n,s,a)}i.autoClear=r}_blur(t,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,r,n,"latitudinal",s),this._halfBlur(a,t,r,r,n,"longitudinal",s)}_halfBlur(t,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Ln(this._lodPlanes[n],c),d=c.uniforms,p=this._sizeLods[r]-1,f=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*ef-1),g=s/f,m=isFinite(s)?1+Math.floor(u*g):ef;m>ef&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${ef}`);const v=[];let x=0;for(let C=0;C<ef;++C){const M=C/g,E=Math.exp(-M*M/2);v.push(E),C===0?x+=E:C<m&&(x+=2*E)}for(let C=0;C<v.length;C++)v[C]=v[C]/x;d.envMap.value=t.texture,d.samples.value=m,d.weights.value=v,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:y}=this;d.dTheta.value=f,d.mipInt.value=y-r;const _=this._sizeLods[n],A=3*_*(n>y-cv?n-y+cv:0),S=4*(this._cubeSize-_);Q_(i,A,S,3*_,2*_),l.setRenderTarget(i),l.render(h,GP)}}function dde(e){const t=[],i=[],r=[];let n=e;const s=e-cv+1+a5.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>e-cv?l=a5[a-e+cv-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,g=3,m=2,v=1,x=new Float32Array(g*f*p),y=new Float32Array(m*f*p),_=new Float32Array(v*f*p);for(let S=0;S<p;S++){const C=S%3*2/3-1,M=S>2?0:-1,E=[C,M,0,C+2/3,M,0,C+2/3,M+1,0,C,M,0,C+2/3,M+1,0,C,M+1,0];x.set(E,g*f*S),y.set(d,m*f*S);const P=[S,S,S,S,S,S];_.set(P,v*f*S)}const A=new pi;A.setAttribute("position",new Ui(x,g)),A.setAttribute("uv",new Ui(y,m)),A.setAttribute("faceIndex",new Ui(_,v)),t.push(A),n>cv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function c5(e,t,i){const r=new Ll(e,t,i);return r.texture.mapping=I0,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Q_(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function pde(e,t,i){const r=new Float32Array(ef),n=new ne(0,1,0);return new Nc({name:"SphericalGaussianBlur",defines:{n:ef,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:lN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Wu,depthTest:!1,depthWrite:!1})}function u5(){return new Nc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:lN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Wu,depthTest:!1,depthWrite:!1})}function h5(){return new Nc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:lN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Wu,depthTest:!1,depthWrite:!1})}function lN(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function fde(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===Vx||l===Gx,u=l===Gd||l===Hd;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new hL(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{const h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new hL(e));const d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function mde(e){const t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){const n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function gde(e,t,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const f in d.attributes)t.remove(d.attributes[f]);for(const f in d.morphAttributes){const g=d.morphAttributes[f];for(let m=0,v=g.length;m<v;m++)t.remove(g[m])}d.removeEventListener("dispose",a),delete n[d.id];const p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)t.update(d[f],e.ARRAY_BUFFER);const p=h.morphAttributes;for(const f in p){const g=p[f];for(let m=0,v=g.length;m<v;m++)t.update(g[m],e.ARRAY_BUFFER)}}function c(h){const d=[],p=h.index,f=h.attributes.position;let g=0;if(p!==null){const x=p.array;g=p.version;for(let y=0,_=x.length;y<_;y+=3){const A=x[y+0],S=x[y+1],C=x[y+2];d.push(A,S,S,C,C,A)}}else{const x=f.array;g=f.version;for(let y=0,_=x.length/3-1;y<_;y+=3){const A=y+0,S=y+1,C=y+2;d.push(A,S,S,C,C,A)}}const m=new(qQ(d)?sN:nN)(d,1);m.version=g;const v=s.get(h);v&&t.remove(v),s.set(h,m)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function vde(e,t,i,r){const n=r.isWebGL2;let s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,f){if(f===0)return;let g,m;if(n)g=e,m="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[m](s,p,o,d*l,f),i.update(p,s,f)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function yde(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case e.TRIANGLES:i.triangles+=o*(s/3);break;case e.LINES:i.lines+=o*(s/2);break;case e.LINE_STRIP:i.lines+=o*(s-1);break;case e.LINE_LOOP:i.lines+=o*s;break;case e.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function xde(e,t){return e[0]-t[0]}function wde(e,t){return Math.abs(t[1])-Math.abs(e[1])}function bde(e,t,i){const r={},n=new Float32Array(8),s=new WeakMap,a=new Zi,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(t.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=p!==void 0?p.length:0;let g=s.get(u);if(g===void 0||g.count!==f){let I=function(){O.dispose(),s.delete(u),u.removeEventListener("dispose",I)};g!==void 0&&g.texture.dispose();const x=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,_=u.morphAttributes.color!==void 0,A=u.morphAttributes.position||[],S=u.morphAttributes.normal||[],C=u.morphAttributes.color||[];let M=0;x===!0&&(M=1),y===!0&&(M=2),_===!0&&(M=3);let E=u.attributes.position.count*M,P=1;E>t.maxTextureSize&&(P=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);const R=new Float32Array(E*P*4*f),O=new iT(R,E,P,f);O.type=_c,O.needsUpdate=!0;const L=M*4;for(let z=0;z<f;z++){const K=A[z],Y=S[z],U=C[z],j=E*P*4*z;for(let k=0;k<K.count;k++){const q=k*L;x===!0&&(a.fromBufferAttribute(K,k),R[j+q+0]=a.x,R[j+q+1]=a.y,R[j+q+2]=a.z,R[j+q+3]=0),y===!0&&(a.fromBufferAttribute(Y,k),R[j+q+4]=a.x,R[j+q+5]=a.y,R[j+q+6]=a.z,R[j+q+7]=0),_===!0&&(a.fromBufferAttribute(U,k),R[j+q+8]=a.x,R[j+q+9]=a.y,R[j+q+10]=a.z,R[j+q+11]=U.itemSize===4?a.w:1)}}g={count:f,texture:O,size:new it(E,P)},s.set(u,g),u.addEventListener("dispose",I)}let m=0;for(let x=0;x<d.length;x++)m+=d[x];const v=u.morphTargetsRelative?1:1-m;h.getUniforms().setValue(e,"morphTargetBaseInfluence",v),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{const p=d===void 0?0:d.length;let f=r[u.id];if(f===void 0||f.length!==p){f=[];for(let y=0;y<p;y++)f[y]=[y,0];r[u.id]=f}for(let y=0;y<p;y++){const _=f[y];_[0]=y,_[1]=d[y]}f.sort(wde);for(let y=0;y<8;y++)y<p&&f[y][1]?(o[y][0]=f[y][0],o[y][1]=f[y][1]):(o[y][0]=Number.MAX_SAFE_INTEGER,o[y][1]=0);o.sort(xde);const g=u.morphAttributes.position,m=u.morphAttributes.normal;let v=0;for(let y=0;y<8;y++){const _=o[y],A=_[0],S=_[1];A!==Number.MAX_SAFE_INTEGER&&S?(g&&u.getAttribute("morphTarget"+y)!==g[A]&&u.setAttribute("morphTarget"+y,g[A]),m&&u.getAttribute("morphNormal"+y)!==m[A]&&u.setAttribute("morphNormal"+y,m[A]),n[y]=S,v+=S):(g&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),m&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),n[y]=0)}const x=u.morphTargetsRelative?1:1-v;h.getUniforms().setValue(e,"morphTargetBaseInfluence",x),h.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function _de(e,t,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=t.get(l,u);return n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,e.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,e.ARRAY_BUFFER)),h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}const $Q=new mr,eJ=new iT,tJ=new rN,iJ=new Lw,d5=[],p5=[],f5=new Float32Array(16),m5=new Float32Array(9),g5=new Float32Array(4);function O0(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let s=d5[n];if(s===void 0&&(s=new Float32Array(n),d5[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function On(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Bn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function nT(e,t){let i=p5[t];i===void 0&&(i=new Int32Array(t),p5[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function Sde(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Ade(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(On(i,t))return;e.uniform2fv(this.addr,t),Bn(i,t)}}function Mde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(On(i,t))return;e.uniform3fv(this.addr,t),Bn(i,t)}}function Ede(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(On(i,t))return;e.uniform4fv(this.addr,t),Bn(i,t)}}function Cde(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(On(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Bn(i,t)}else{if(On(i,r))return;g5.set(r),e.uniformMatrix2fv(this.addr,!1,g5),Bn(i,r)}}function Tde(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(On(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Bn(i,t)}else{if(On(i,r))return;m5.set(r),e.uniformMatrix3fv(this.addr,!1,m5),Bn(i,r)}}function Pde(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(On(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Bn(i,t)}else{if(On(i,r))return;f5.set(r),e.uniformMatrix4fv(this.addr,!1,f5),Bn(i,r)}}function Dde(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Rde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(On(i,t))return;e.uniform2iv(this.addr,t),Bn(i,t)}}function Ide(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(On(i,t))return;e.uniform3iv(this.addr,t),Bn(i,t)}}function Lde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(On(i,t))return;e.uniform4iv(this.addr,t),Bn(i,t)}}function Ode(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Bde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(On(i,t))return;e.uniform2uiv(this.addr,t),Bn(i,t)}}function Fde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(On(i,t))return;e.uniform3uiv(this.addr,t),Bn(i,t)}}function Nde(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(On(i,t))return;e.uniform4uiv(this.addr,t),Bn(i,t)}}function Ude(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||$Q,n)}function kde(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||tJ,n)}function zde(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||iJ,n)}function Vde(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||eJ,n)}function Gde(e){switch(e){case 5126:return Sde;case 35664:return Ade;case 35665:return Mde;case 35666:return Ede;case 35674:return Cde;case 35675:return Tde;case 35676:return Pde;case 5124:case 35670:return Dde;case 35667:case 35671:return Rde;case 35668:case 35672:return Ide;case 35669:case 35673:return Lde;case 5125:return Ode;case 36294:return Bde;case 36295:return Fde;case 36296:return Nde;case 35678:case 36198:case 36298:case 36306:case 35682:return Ude;case 35679:case 36299:case 36307:return kde;case 35680:case 36300:case 36308:case 36293:return zde;case 36289:case 36303:case 36311:case 36292:return Vde}}function Hde(e,t){e.uniform1fv(this.addr,t)}function jde(e,t){const i=O0(t,this.size,2);e.uniform2fv(this.addr,i)}function Wde(e,t){const i=O0(t,this.size,3);e.uniform3fv(this.addr,i)}function Xde(e,t){const i=O0(t,this.size,4);e.uniform4fv(this.addr,i)}function Yde(e,t){const i=O0(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function qde(e,t){const i=O0(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Qde(e,t){const i=O0(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Jde(e,t){e.uniform1iv(this.addr,t)}function Kde(e,t){e.uniform2iv(this.addr,t)}function Zde(e,t){e.uniform3iv(this.addr,t)}function $de(e,t){e.uniform4iv(this.addr,t)}function epe(e,t){e.uniform1uiv(this.addr,t)}function tpe(e,t){e.uniform2uiv(this.addr,t)}function ipe(e,t){e.uniform3uiv(this.addr,t)}function rpe(e,t){e.uniform4uiv(this.addr,t)}function npe(e,t,i){const r=this.cache,n=t.length,s=nT(i,n);On(r,s)||(e.uniform1iv(this.addr,s),Bn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||$Q,s[a])}function spe(e,t,i){const r=this.cache,n=t.length,s=nT(i,n);On(r,s)||(e.uniform1iv(this.addr,s),Bn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||tJ,s[a])}function ape(e,t,i){const r=this.cache,n=t.length,s=nT(i,n);On(r,s)||(e.uniform1iv(this.addr,s),Bn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||iJ,s[a])}function ope(e,t,i){const r=this.cache,n=t.length,s=nT(i,n);On(r,s)||(e.uniform1iv(this.addr,s),Bn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||eJ,s[a])}function lpe(e){switch(e){case 5126:return Hde;case 35664:return jde;case 35665:return Wde;case 35666:return Xde;case 35674:return Yde;case 35675:return qde;case 35676:return Qde;case 5124:case 35670:return Jde;case 35667:case 35671:return Kde;case 35668:case 35672:return Zde;case 35669:case 35673:return $de;case 5125:return epe;case 36294:return tpe;case 36295:return ipe;case 36296:return rpe;case 35678:case 36198:case 36298:case 36306:case 35682:return npe;case 35679:case 36299:case 36307:return spe;case 35680:case 36300:case 36308:case 36293:return ape;case 36289:case 36303:case 36311:case 36292:return ope}}class cpe{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.setValue=Gde(i.type)}}class upe{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.size=i.size,this.setValue=lpe(i.type)}}class hpe{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,i[o.id],r)}}}const jP=/(\w+)(\])?(\[|\.)?/g;function v5(e,t){e.seq.push(t),e.map[t.id]=t}function dpe(e,t,i){const r=e.name,n=r.length;for(jP.lastIndex=0;;){const s=jP.exec(r),a=jP.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){v5(i,c===void 0?new cpe(o,e,t):new upe(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new hpe(o),v5(i,h)),i=h}}}class vM{constructor(t,i){this.seq=[],this.map={};const r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=t.getActiveUniform(i,n),a=t.getUniformLocation(i,s.name);dpe(s,a,this)}}setValue(t,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(t,r,n)}setOptional(t,i,r){const n=i[r];n!==void 0&&this.setValue(t,r,n)}static upload(t,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,i){const r=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in i&&r.push(a)}return r}}function y5(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}let ppe=0;function fpe(e,t){const i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function mpe(e){switch(e){case jo:return["Linear","( value )"];case hi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}function x5(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+fpe(e.getShaderSource(t),a)}else return n}function gpe(e,t){const i=mpe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function vpe(e,t){let i;switch(t){case yQ:i="Linear";break;case xQ:i="Reinhard";break;case wQ:i="OptimizedCineon";break;case HF:i="ACESFilmic";break;case bQ:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ype(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(R1).join(`
`)}function xpe(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function wpe(e,t){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n),a=s.name;let o=1;s.type===e.FLOAT_MAT2&&(o=2),s.type===e.FLOAT_MAT3&&(o=3),s.type===e.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function R1(e){return e!==""}function w5(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function b5(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const bpe=/^[ \t]*#include +<([\w\d./]+)>/gm;function dL(e){return e.replace(bpe,_pe)}function _pe(e,t){const i=xi[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return dL(i)}const Spe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _5(e){return e.replace(Spe,Ape)}function Ape(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function S5(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Mpe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===KC?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Z1?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===gl&&(t="SHADOWMAP_TYPE_VSM"),t}function Epe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Gd:case Hd:t="ENVMAP_TYPE_CUBE";break;case I0:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Cpe(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Hd:t="ENVMAP_MODE_REFRACTION";break}return t}function Tpe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Rw:t="ENVMAP_BLENDING_MULTIPLY";break;case gQ:t="ENVMAP_BLENDING_MIX";break;case vQ:t="ENVMAP_BLENDING_ADD";break}return t}function Ppe(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function Dpe(e,t,i,r){const n=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=Mpe(i),c=Epe(i),u=Cpe(i),h=Tpe(i),d=Ppe(i),p=i.isWebGL2?"":ype(i),f=xpe(s),g=n.createProgram();let m,v,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(R1).join(`
`),m.length>0&&(m+=`
`),v=[p,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(R1).join(`
`),v.length>0&&(v+=`
`)):(m=[S5(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(R1).join(`
`),v=[p,S5(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Tl?"#define TONE_MAPPING":"",i.toneMapping!==Tl?xi.tonemapping_pars_fragment:"",i.toneMapping!==Tl?vpe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",xi.encodings_pars_fragment,gpe("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(R1).join(`
`)),a=dL(a),a=w5(a,i),a=b5(a,i),o=dL(o),o=w5(o,i),o=b5(o,i),a=_5(a),o=_5(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",i.glslVersion===cL?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===cL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const y=x+m+a,_=x+v+o,A=y5(n,n.VERTEX_SHADER,y),S=y5(n,n.FRAGMENT_SHADER,_);if(n.attachShader(g,A),n.attachShader(g,S),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),e.debug.checkShaderErrors){const E=n.getProgramInfoLog(g).trim(),P=n.getShaderInfoLog(A).trim(),R=n.getShaderInfoLog(S).trim();let O=!0,L=!0;if(n.getProgramParameter(g,n.LINK_STATUS)===!1)if(O=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(n,g,A,S);else{const I=x5(n,A,"vertex"),z=x5(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,n.VALIDATE_STATUS)+`

Program Info Log: `+E+`
`+I+`
`+z)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(P===""||R==="")&&(L=!1);L&&(this.diagnostics={runnable:O,programLog:E,vertexShader:{log:P,prefix:m},fragmentShader:{log:R,prefix:v}})}n.deleteShader(A),n.deleteShader(S);let C;this.getUniforms=function(){return C===void 0&&(C=new vM(n,g)),C};let M;return this.getAttributes=function(){return M===void 0&&(M=wpe(n,g)),M},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=ppe++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=A,this.fragmentShader=S,this}let Rpe=0;class Ipe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,r=t.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let r=i.get(t);return r===void 0&&(r=new Set,i.set(t,r)),r}_getShaderStage(t){const i=this.shaderCache;let r=i.get(t);return r===void 0&&(r=new Lpe(t),i.set(t,r)),r}}class Lpe{constructor(t){this.id=Rpe++,this.code=t,this.usedTimes=0}}function Ope(e,t,i,r,n,s,a){const o=new Lf,l=new Ipe,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures;let p=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(E){return E===0?"uv":`uv${E}`}function m(E,P,R,O,L){const I=O.fog,z=L.geometry,K=E.isMeshStandardMaterial?O.environment:null,Y=(E.isMeshStandardMaterial?i:t).get(E.envMap||K),U=Y&&Y.mapping===I0?Y.image.height:null,j=f[E.type];E.precision!==null&&(p=n.getMaxPrecision(E.precision),p!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",p,"instead."));const k=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,q=k!==void 0?k.length:0;let W=0;z.morphAttributes.position!==void 0&&(W=1),z.morphAttributes.normal!==void 0&&(W=2),z.morphAttributes.color!==void 0&&(W=3);let te,G,le,Z;if(j){const ti=xl[j];te=ti.vertexShader,G=ti.fragmentShader}else te=E.vertexShader,G=E.fragmentShader,l.update(E),le=l.getVertexShaderID(E),Z=l.getFragmentShaderID(E);const he=e.getRenderTarget(),ye=L.isInstancedMesh===!0,de=!!E.map,xe=!!E.matcap,me=!!Y,ee=!!E.aoMap,we=!!E.lightMap,Ae=!!E.bumpMap,Te=!!E.normalMap,Re=!!E.displacementMap,Xe=!!E.emissiveMap,Oe=!!E.metalnessMap,Be=!!E.roughnessMap,at=E.anisotropy>0,ht=E.clearcoat>0,se=E.iridescence>0,N=E.sheen>0,H=E.transmission>0,ve=at&&!!E.anisotropyMap,X=ht&&!!E.clearcoatMap,Ce=ht&&!!E.clearcoatNormalMap,Ve=ht&&!!E.clearcoatRoughnessMap,Ye=se&&!!E.iridescenceMap,_e=se&&!!E.iridescenceThicknessMap,Pe=N&&!!E.sheenColorMap,Qe=N&&!!E.sheenRoughnessMap,st=!!E.specularMap,ct=!!E.specularColorMap,tt=!!E.specularIntensityMap,oe=H&&!!E.transmissionMap,je=H&&!!E.thicknessMap,dt=!!E.gradientMap,J=!!E.alphaMap,be=E.alphaTest>0,ue=!!E.extensions,Ne=!!z.attributes.uv1,et=!!z.attributes.uv2,_t=!!z.attributes.uv3;return{isWebGL2:u,shaderID:j,shaderType:E.type,shaderName:E.name,vertexShader:te,fragmentShader:G,defines:E.defines,customVertexShaderID:le,customFragmentShaderID:Z,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:p,instancing:ye,instancingColor:ye&&L.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:he===null?e.outputColorSpace:he.isXRRenderTarget===!0?he.texture.colorSpace:jo,map:de,matcap:xe,envMap:me,envMapMode:me&&Y.mapping,envMapCubeUVHeight:U,aoMap:ee,lightMap:we,bumpMap:Ae,normalMap:Te,displacementMap:d&&Re,emissiveMap:Xe,normalMapObjectSpace:Te&&E.normalMapType===NQ,normalMapTangentSpace:Te&&E.normalMapType===ip,metalnessMap:Oe,roughnessMap:Be,anisotropy:at,anisotropyMap:ve,clearcoat:ht,clearcoatMap:X,clearcoatNormalMap:Ce,clearcoatRoughnessMap:Ve,iridescence:se,iridescenceMap:Ye,iridescenceThicknessMap:_e,sheen:N,sheenColorMap:Pe,sheenRoughnessMap:Qe,specularMap:st,specularColorMap:ct,specularIntensityMap:tt,transmission:H,transmissionMap:oe,thicknessMap:je,gradientMap:dt,opaque:E.transparent===!1&&E.blending===Df,alphaMap:J,alphaTest:be,combine:E.combine,mapUv:de&&g(E.map.channel),aoMapUv:ee&&g(E.aoMap.channel),lightMapUv:we&&g(E.lightMap.channel),bumpMapUv:Ae&&g(E.bumpMap.channel),normalMapUv:Te&&g(E.normalMap.channel),displacementMapUv:Re&&g(E.displacementMap.channel),emissiveMapUv:Xe&&g(E.emissiveMap.channel),metalnessMapUv:Oe&&g(E.metalnessMap.channel),roughnessMapUv:Be&&g(E.roughnessMap.channel),anisotropyMapUv:ve&&g(E.anisotropyMap.channel),clearcoatMapUv:X&&g(E.clearcoatMap.channel),clearcoatNormalMapUv:Ce&&g(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ve&&g(E.clearcoatRoughnessMap.channel),iridescenceMapUv:Ye&&g(E.iridescenceMap.channel),iridescenceThicknessMapUv:_e&&g(E.iridescenceThicknessMap.channel),sheenColorMapUv:Pe&&g(E.sheenColorMap.channel),sheenRoughnessMapUv:Qe&&g(E.sheenRoughnessMap.channel),specularMapUv:st&&g(E.specularMap.channel),specularColorMapUv:ct&&g(E.specularColorMap.channel),specularIntensityMapUv:tt&&g(E.specularIntensityMap.channel),transmissionMapUv:oe&&g(E.transmissionMap.channel),thicknessMapUv:je&&g(E.thicknessMap.channel),alphaMapUv:J&&g(E.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(Te||at),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,vertexUv1s:Ne,vertexUv2s:et,vertexUv3s:_t,pointsUvs:L.isPoints===!0&&!!z.attributes.uv&&(de||J),fog:!!I,useFog:E.fog===!0,fogExp2:I&&I.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:q,morphTextureStride:W,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:e.shadowMap.enabled&&R.length>0,shadowMapType:e.shadowMap.type,toneMapping:E.toneMapped?e.toneMapping:Tl,useLegacyLights:e.useLegacyLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Bo,flipSided:E.side===sa,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:ue&&E.extensions.derivatives===!0,extensionFragDepth:ue&&E.extensions.fragDepth===!0,extensionDrawBuffers:ue&&E.extensions.drawBuffers===!0,extensionShaderTextureLOD:ue&&E.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}}function v(E){const P=[];if(E.shaderID?P.push(E.shaderID):(P.push(E.customVertexShaderID),P.push(E.customFragmentShaderID)),E.defines!==void 0)for(const R in E.defines)P.push(R),P.push(E.defines[R]);return E.isRawShaderMaterial===!1&&(x(P,E),y(P,E),P.push(e.outputColorSpace)),P.push(E.customProgramCacheKey),P.join()}function x(E,P){E.push(P.precision),E.push(P.outputColorSpace),E.push(P.envMapMode),E.push(P.envMapCubeUVHeight),E.push(P.mapUv),E.push(P.alphaMapUv),E.push(P.lightMapUv),E.push(P.aoMapUv),E.push(P.bumpMapUv),E.push(P.normalMapUv),E.push(P.displacementMapUv),E.push(P.emissiveMapUv),E.push(P.metalnessMapUv),E.push(P.roughnessMapUv),E.push(P.anisotropyMapUv),E.push(P.clearcoatMapUv),E.push(P.clearcoatNormalMapUv),E.push(P.clearcoatRoughnessMapUv),E.push(P.iridescenceMapUv),E.push(P.iridescenceThicknessMapUv),E.push(P.sheenColorMapUv),E.push(P.sheenRoughnessMapUv),E.push(P.specularMapUv),E.push(P.specularColorMapUv),E.push(P.specularIntensityMapUv),E.push(P.transmissionMapUv),E.push(P.thicknessMapUv),E.push(P.combine),E.push(P.fogExp2),E.push(P.sizeAttenuation),E.push(P.morphTargetsCount),E.push(P.morphAttributeCount),E.push(P.numDirLights),E.push(P.numPointLights),E.push(P.numSpotLights),E.push(P.numSpotLightMaps),E.push(P.numHemiLights),E.push(P.numRectAreaLights),E.push(P.numDirLightShadows),E.push(P.numPointLightShadows),E.push(P.numSpotLightShadows),E.push(P.numSpotLightShadowsWithMaps),E.push(P.shadowMapType),E.push(P.toneMapping),E.push(P.numClippingPlanes),E.push(P.numClipIntersection),E.push(P.depthPacking)}function y(E,P){o.disableAll(),P.isWebGL2&&o.enable(0),P.supportsVertexTextures&&o.enable(1),P.instancing&&o.enable(2),P.instancingColor&&o.enable(3),P.matcap&&o.enable(4),P.envMap&&o.enable(5),P.normalMapObjectSpace&&o.enable(6),P.normalMapTangentSpace&&o.enable(7),P.clearcoat&&o.enable(8),P.iridescence&&o.enable(9),P.alphaTest&&o.enable(10),P.vertexColors&&o.enable(11),P.vertexAlphas&&o.enable(12),P.vertexUv1s&&o.enable(13),P.vertexUv2s&&o.enable(14),P.vertexUv3s&&o.enable(15),P.vertexTangents&&o.enable(16),P.anisotropy&&o.enable(17),E.push(o.mask),o.disableAll(),P.fog&&o.enable(0),P.useFog&&o.enable(1),P.flatShading&&o.enable(2),P.logarithmicDepthBuffer&&o.enable(3),P.skinning&&o.enable(4),P.morphTargets&&o.enable(5),P.morphNormals&&o.enable(6),P.morphColors&&o.enable(7),P.premultipliedAlpha&&o.enable(8),P.shadowMapEnabled&&o.enable(9),P.useLegacyLights&&o.enable(10),P.doubleSided&&o.enable(11),P.flipSided&&o.enable(12),P.useDepthPacking&&o.enable(13),P.dithering&&o.enable(14),P.transmission&&o.enable(15),P.sheen&&o.enable(16),P.opaque&&o.enable(17),P.pointsUvs&&o.enable(18),E.push(o.mask)}function _(E){const P=f[E.type];let R;if(P){const O=xl[P];R=KQ.clone(O.uniforms)}else R=E.uniforms;return R}function A(E,P){let R;for(let O=0,L=c.length;O<L;O++){const I=c[O];if(I.cacheKey===P){R=I,++R.usedTimes;break}}return R===void 0&&(R=new Dpe(e,P,E,s),c.push(R)),R}function S(E){if(--E.usedTimes===0){const P=c.indexOf(E);c[P]=c[c.length-1],c.pop(),E.destroy()}}function C(E){l.remove(E)}function M(){l.dispose()}return{getParameters:m,getProgramCacheKey:v,getUniforms:_,acquireProgram:A,releaseProgram:S,releaseShaderCache:C,programs:c,dispose:M}}function Bpe(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function Fpe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function A5(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function M5(){const e=[];let t=0;const i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,f,g,m){let v=e[t];return v===void 0?(v={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:g,group:m},e[t]=v):(v.id=h.id,v.object=h,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=h.renderOrder,v.z=g,v.group=m),t++,v}function o(h,d,p,f,g,m){const v=a(h,d,p,f,g,m);p.transmission>0?r.push(v):p.transparent===!0?n.push(v):i.push(v)}function l(h,d,p,f,g,m){const v=a(h,d,p,f,g,m);p.transmission>0?r.unshift(v):p.transparent===!0?n.unshift(v):i.unshift(v)}function c(h,d){i.length>1&&i.sort(h||Fpe),r.length>1&&r.sort(d||A5),n.length>1&&n.sort(d||A5)}function u(){for(let h=t,d=e.length;h<d;h++){const p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function Npe(){let e=new WeakMap;function t(r,n){const s=e.get(r);let a;return s===void 0?(a=new M5,e.set(r,[a])):n>=s.length?(a=new M5,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function Upe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new ne,color:new bt};break;case"SpotLight":i={position:new ne,direction:new ne,color:new bt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ne,color:new bt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ne,skyColor:new bt,groundColor:new bt};break;case"RectAreaLight":i={color:new bt,position:new ne,halfWidth:new ne,halfHeight:new ne};break}return e[t.id]=i,i}}}function kpe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new it};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new it};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new it,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let zpe=0;function Vpe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Gpe(e,t){const i=new Upe,r=kpe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new ne);const s=new ne,a=new ri,o=new ri;function l(u,h){let d=0,p=0,f=0;for(let R=0;R<9;R++)n.probe[R].set(0,0,0);let g=0,m=0,v=0,x=0,y=0,_=0,A=0,S=0,C=0,M=0;u.sort(Vpe);const E=h===!0?Math.PI:1;for(let R=0,O=u.length;R<O;R++){const L=u[R],I=L.color,z=L.intensity,K=L.distance,Y=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)d+=I.r*z*E,p+=I.g*z*E,f+=I.b*z*E;else if(L.isLightProbe)for(let U=0;U<9;U++)n.probe[U].addScaledVector(L.sh.coefficients[U],z);else if(L.isDirectionalLight){const U=i.get(L);if(U.color.copy(L.color).multiplyScalar(L.intensity*E),L.castShadow){const j=L.shadow,k=r.get(L);k.shadowBias=j.bias,k.shadowNormalBias=j.normalBias,k.shadowRadius=j.radius,k.shadowMapSize=j.mapSize,n.directionalShadow[g]=k,n.directionalShadowMap[g]=Y,n.directionalShadowMatrix[g]=L.shadow.matrix,_++}n.directional[g]=U,g++}else if(L.isSpotLight){const U=i.get(L);U.position.setFromMatrixPosition(L.matrixWorld),U.color.copy(I).multiplyScalar(z*E),U.distance=K,U.coneCos=Math.cos(L.angle),U.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),U.decay=L.decay,n.spot[v]=U;const j=L.shadow;if(L.map&&(n.spotLightMap[C]=L.map,C++,j.updateMatrices(L),L.castShadow&&M++),n.spotLightMatrix[v]=j.matrix,L.castShadow){const k=r.get(L);k.shadowBias=j.bias,k.shadowNormalBias=j.normalBias,k.shadowRadius=j.radius,k.shadowMapSize=j.mapSize,n.spotShadow[v]=k,n.spotShadowMap[v]=Y,S++}v++}else if(L.isRectAreaLight){const U=i.get(L);U.color.copy(I).multiplyScalar(z),U.halfWidth.set(L.width*.5,0,0),U.halfHeight.set(0,L.height*.5,0),n.rectArea[x]=U,x++}else if(L.isPointLight){const U=i.get(L);if(U.color.copy(L.color).multiplyScalar(L.intensity*E),U.distance=L.distance,U.decay=L.decay,L.castShadow){const j=L.shadow,k=r.get(L);k.shadowBias=j.bias,k.shadowNormalBias=j.normalBias,k.shadowRadius=j.radius,k.shadowMapSize=j.mapSize,k.shadowCameraNear=j.camera.near,k.shadowCameraFar=j.camera.far,n.pointShadow[m]=k,n.pointShadowMap[m]=Y,n.pointShadowMatrix[m]=L.shadow.matrix,A++}n.point[m]=U,m++}else if(L.isHemisphereLight){const U=i.get(L);U.skyColor.copy(L.color).multiplyScalar(z*E),U.groundColor.copy(L.groundColor).multiplyScalar(z*E),n.hemi[y]=U,y++}}x>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=wt.LTC_FLOAT_1,n.rectAreaLTC2=wt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=wt.LTC_HALF_1,n.rectAreaLTC2=wt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=f;const P=n.hash;(P.directionalLength!==g||P.pointLength!==m||P.spotLength!==v||P.rectAreaLength!==x||P.hemiLength!==y||P.numDirectionalShadows!==_||P.numPointShadows!==A||P.numSpotShadows!==S||P.numSpotMaps!==C)&&(n.directional.length=g,n.spot.length=v,n.rectArea.length=x,n.point.length=m,n.hemi.length=y,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=A,n.pointShadowMap.length=A,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=A,n.spotLightMatrix.length=S+C-M,n.spotLightMap.length=C,n.numSpotLightShadowsWithMaps=M,P.directionalLength=g,P.pointLength=m,P.spotLength=v,P.rectAreaLength=x,P.hemiLength=y,P.numDirectionalShadows=_,P.numPointShadows=A,P.numSpotShadows=S,P.numSpotMaps=C,n.version=zpe++)}function c(u,h){let d=0,p=0,f=0,g=0,m=0;const v=h.matrixWorldInverse;for(let x=0,y=u.length;x<y;x++){const _=u[x];if(_.isDirectionalLight){const A=n.directional[d];A.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),d++}else if(_.isSpotLight){const A=n.spot[f];A.position.setFromMatrixPosition(_.matrixWorld),A.position.applyMatrix4(v),A.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),f++}else if(_.isRectAreaLight){const A=n.rectArea[g];A.position.setFromMatrixPosition(_.matrixWorld),A.position.applyMatrix4(v),o.identity(),a.copy(_.matrixWorld),a.premultiply(v),o.extractRotation(a),A.halfWidth.set(_.width*.5,0,0),A.halfHeight.set(0,_.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),g++}else if(_.isPointLight){const A=n.point[p];A.position.setFromMatrixPosition(_.matrixWorld),A.position.applyMatrix4(v),p++}else if(_.isHemisphereLight){const A=n.hemi[m];A.direction.setFromMatrixPosition(_.matrixWorld),A.direction.transformDirection(v),m++}}}return{setup:l,setupView:c,state:n}}function E5(e,t){const i=new Gpe(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(h){r.push(h)}function o(h){n.push(h)}function l(h){i.setup(r,h)}function c(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function Hpe(e,t){let i=new WeakMap;function r(s,a=0){const o=i.get(s);let l;return o===void 0?(l=new E5(e,t),i.set(s,[l])):a>=o.length?(l=new E5(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}class cN extends yn{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BQ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class uN extends yn{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const jpe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Wpe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Xpe(e,t,i){let r=new rT;const n=new it,s=new it,a=new Zi,o=new cN({depthPacking:FQ}),l=new uN,c={},u=i.maxTextureSize,h={[Bc]:sa,[sa]:Bc,[Bo]:Bo},d=new Nc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new it},radius:{value:4}},vertexShader:jpe,fragmentShader:Wpe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new pi;f.setAttribute("position",new Ui(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Ln(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=KC;let v=this.type;this.render=function(A,S,C){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||A.length===0)return;const M=e.getRenderTarget(),E=e.getActiveCubeFace(),P=e.getActiveMipmapLevel(),R=e.state;R.setBlending(Wu),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);const O=v!==gl&&this.type===gl,L=v===gl&&this.type!==gl;for(let I=0,z=A.length;I<z;I++){const K=A[I],Y=K.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",K,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;n.copy(Y.mapSize);const U=Y.getFrameExtents();if(n.multiply(U),s.copy(Y.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/U.x),n.x=s.x*U.x,Y.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/U.y),n.y=s.y*U.y,Y.mapSize.y=s.y)),Y.map===null||O===!0||L===!0){const k=this.type!==gl?{minFilter:Gr,magFilter:Gr}:{};Y.map!==null&&Y.map.dispose(),Y.map=new Ll(n.x,n.y,k),Y.map.texture.name=K.name+".shadowMap",Y.camera.updateProjectionMatrix()}e.setRenderTarget(Y.map),e.clear();const j=Y.getViewportCount();for(let k=0;k<j;k++){const q=Y.getViewport(k);a.set(s.x*q.x,s.y*q.y,s.x*q.z,s.y*q.w),R.viewport(a),Y.updateMatrices(K,k),r=Y.getFrustum(),_(S,C,Y.camera,K,this.type)}Y.isPointLightShadow!==!0&&this.type===gl&&x(Y,C),Y.needsUpdate=!1}v=this.type,m.needsUpdate=!1,e.setRenderTarget(M,E,P)};function x(A,S){const C=t.update(g);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,p.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Ll(n.x,n.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,e.setRenderTarget(A.mapPass),e.clear(),e.renderBufferDirect(S,null,C,d,g,null),p.uniforms.shadow_pass.value=A.mapPass.texture,p.uniforms.resolution.value=A.mapSize,p.uniforms.radius.value=A.radius,e.setRenderTarget(A.map),e.clear(),e.renderBufferDirect(S,null,C,p,g,null)}function y(A,S,C,M){let E=null;const P=C.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(P!==void 0)E=P;else if(E=C.isPointLight===!0?l:o,e.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const R=E.uuid,O=S.uuid;let L=c[R];L===void 0&&(L={},c[R]=L);let I=L[O];I===void 0&&(I=E.clone(),L[O]=I),E=I}if(E.visible=S.visible,E.wireframe=S.wireframe,M===gl?E.side=S.shadowSide!==null?S.shadowSide:S.side:E.side=S.shadowSide!==null?S.shadowSide:h[S.side],E.alphaMap=S.alphaMap,E.alphaTest=S.alphaTest,E.map=S.map,E.clipShadows=S.clipShadows,E.clippingPlanes=S.clippingPlanes,E.clipIntersection=S.clipIntersection,E.displacementMap=S.displacementMap,E.displacementScale=S.displacementScale,E.displacementBias=S.displacementBias,E.wireframeLinewidth=S.wireframeLinewidth,E.linewidth=S.linewidth,C.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const R=e.properties.get(E);R.light=C}return E}function _(A,S,C,M,E){if(A.visible===!1)return;if(A.layers.test(S.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&E===gl)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,A.matrixWorld);const O=t.update(A),L=A.material;if(Array.isArray(L)){const I=O.groups;for(let z=0,K=I.length;z<K;z++){const Y=I[z],U=L[Y.materialIndex];if(U&&U.visible){const j=y(A,U,M,E);e.renderBufferDirect(C,null,O,j,A,Y)}}}else if(L.visible){const I=y(A,L,M,E);e.renderBufferDirect(C,null,O,I,A,null)}}const R=A.children;for(let O=0,L=R.length;O<L;O++)_(R[O],S,C,M,E)}}function Ype(e,t,i){const r=i.isWebGL2;function n(){let J=!1;const be=new Zi;let ue=null;const Ne=new Zi(0,0,0,0);return{setMask:function(et){ue!==et&&!J&&(e.colorMask(et,et,et,et),ue=et)},setLocked:function(et){J=et},setClear:function(et,_t,zt,ti,ar){ar===!0&&(et*=ti,_t*=ti,zt*=ti),be.set(et,_t,zt,ti),Ne.equals(be)===!1&&(e.clearColor(et,_t,zt,ti),Ne.copy(be))},reset:function(){J=!1,ue=null,Ne.set(-1,0,0,0)}}}function s(){let J=!1,be=null,ue=null,Ne=null;return{setTest:function(et){et?he(e.DEPTH_TEST):ye(e.DEPTH_TEST)},setMask:function(et){be!==et&&!J&&(e.depthMask(et),be=et)},setFunc:function(et){if(ue!==et){switch(et){case cQ:e.depthFunc(e.NEVER);break;case uQ:e.depthFunc(e.ALWAYS);break;case hQ:e.depthFunc(e.LESS);break;case hE:e.depthFunc(e.LEQUAL);break;case dQ:e.depthFunc(e.EQUAL);break;case pQ:e.depthFunc(e.GEQUAL);break;case fQ:e.depthFunc(e.GREATER);break;case mQ:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}ue=et}},setLocked:function(et){J=et},setClear:function(et){Ne!==et&&(e.clearDepth(et),Ne=et)},reset:function(){J=!1,be=null,ue=null,Ne=null}}}function a(){let J=!1,be=null,ue=null,Ne=null,et=null,_t=null,zt=null,ti=null,ar=null;return{setTest:function(Ut){J||(Ut?he(e.STENCIL_TEST):ye(e.STENCIL_TEST))},setMask:function(Ut){be!==Ut&&!J&&(e.stencilMask(Ut),be=Ut)},setFunc:function(Ut,Wi,Ai){(ue!==Ut||Ne!==Wi||et!==Ai)&&(e.stencilFunc(Ut,Wi,Ai),ue=Ut,Ne=Wi,et=Ai)},setOp:function(Ut,Wi,Ai){(_t!==Ut||zt!==Wi||ti!==Ai)&&(e.stencilOp(Ut,Wi,Ai),_t=Ut,zt=Wi,ti=Ai)},setLocked:function(Ut){J=Ut},setClear:function(Ut){ar!==Ut&&(e.clearStencil(Ut),ar=Ut)},reset:function(){J=!1,be=null,ue=null,Ne=null,et=null,_t=null,zt=null,ti=null,ar=null}}}const o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap;let d={},p={},f=new WeakMap,g=[],m=null,v=!1,x=null,y=null,_=null,A=null,S=null,C=null,M=null,E=!1,P=null,R=null,O=null,L=null,I=null;const z=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let K=!1,Y=0;const U=e.getParameter(e.VERSION);U.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(U)[1]),K=Y>=1):U.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),K=Y>=2);let j=null,k={};const q=e.getParameter(e.SCISSOR_BOX),W=e.getParameter(e.VIEWPORT),te=new Zi().fromArray(q),G=new Zi().fromArray(W);function le(J,be,ue,Ne){const et=new Uint8Array(4),_t=e.createTexture();e.bindTexture(J,_t),e.texParameteri(J,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(J,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let zt=0;zt<ue;zt++)r&&(J===e.TEXTURE_3D||J===e.TEXTURE_2D_ARRAY)?e.texImage3D(be,0,e.RGBA,1,1,Ne,0,e.RGBA,e.UNSIGNED_BYTE,et):e.texImage2D(be+zt,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,et);return _t}const Z={};Z[e.TEXTURE_2D]=le(e.TEXTURE_2D,e.TEXTURE_2D,1),Z[e.TEXTURE_CUBE_MAP]=le(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(Z[e.TEXTURE_2D_ARRAY]=le(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),Z[e.TEXTURE_3D]=le(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),he(e.DEPTH_TEST),l.setFunc(hE),Re(!1),Xe(OI),he(e.CULL_FACE),Ae(Wu);function he(J){d[J]!==!0&&(e.enable(J),d[J]=!0)}function ye(J){d[J]!==!1&&(e.disable(J),d[J]=!1)}function de(J,be){return p[J]!==be?(e.bindFramebuffer(J,be),p[J]=be,r&&(J===e.DRAW_FRAMEBUFFER&&(p[e.FRAMEBUFFER]=be),J===e.FRAMEBUFFER&&(p[e.DRAW_FRAMEBUFFER]=be)),!0):!1}function xe(J,be){let ue=g,Ne=!1;if(J)if(ue=f.get(be),ue===void 0&&(ue=[],f.set(be,ue)),J.isWebGLMultipleRenderTargets){const et=J.texture;if(ue.length!==et.length||ue[0]!==e.COLOR_ATTACHMENT0){for(let _t=0,zt=et.length;_t<zt;_t++)ue[_t]=e.COLOR_ATTACHMENT0+_t;ue.length=et.length,Ne=!0}}else ue[0]!==e.COLOR_ATTACHMENT0&&(ue[0]=e.COLOR_ATTACHMENT0,Ne=!0);else ue[0]!==e.BACK&&(ue[0]=e.BACK,Ne=!0);Ne&&(i.isWebGL2?e.drawBuffers(ue):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(ue))}function me(J){return m!==J?(e.useProgram(J),m=J,!0):!1}const ee={[$p]:e.FUNC_ADD,[Zq]:e.FUNC_SUBTRACT,[$q]:e.FUNC_REVERSE_SUBTRACT};if(r)ee[UI]=e.MIN,ee[kI]=e.MAX;else{const J=t.get("EXT_blend_minmax");J!==null&&(ee[UI]=J.MIN_EXT,ee[kI]=J.MAX_EXT)}const we={[eQ]:e.ZERO,[tQ]:e.ONE,[iQ]:e.SRC_COLOR,[VF]:e.SRC_ALPHA,[lQ]:e.SRC_ALPHA_SATURATE,[aQ]:e.DST_COLOR,[nQ]:e.DST_ALPHA,[rQ]:e.ONE_MINUS_SRC_COLOR,[GF]:e.ONE_MINUS_SRC_ALPHA,[oQ]:e.ONE_MINUS_DST_COLOR,[sQ]:e.ONE_MINUS_DST_ALPHA};function Ae(J,be,ue,Ne,et,_t,zt,ti){if(J===Wu){v===!0&&(ye(e.BLEND),v=!1);return}if(v===!1&&(he(e.BLEND),v=!0),J!==Kq){if(J!==x||ti!==E){if((y!==$p||S!==$p)&&(e.blendEquation(e.FUNC_ADD),y=$p,S=$p),ti)switch(J){case Df:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case BI:e.blendFunc(e.ONE,e.ONE);break;case FI:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case NI:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case Df:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case BI:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case FI:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case NI:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}_=null,A=null,C=null,M=null,x=J,E=ti}return}et=et||be,_t=_t||ue,zt=zt||Ne,(be!==y||et!==S)&&(e.blendEquationSeparate(ee[be],ee[et]),y=be,S=et),(ue!==_||Ne!==A||_t!==C||zt!==M)&&(e.blendFuncSeparate(we[ue],we[Ne],we[_t],we[zt]),_=ue,A=Ne,C=_t,M=zt),x=J,E=!1}function Te(J,be){J.side===Bo?ye(e.CULL_FACE):he(e.CULL_FACE);let ue=J.side===sa;be&&(ue=!ue),Re(ue),J.blending===Df&&J.transparent===!1?Ae(Wu):Ae(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.premultipliedAlpha),l.setFunc(J.depthFunc),l.setTest(J.depthTest),l.setMask(J.depthWrite),o.setMask(J.colorWrite);const Ne=J.stencilWrite;c.setTest(Ne),Ne&&(c.setMask(J.stencilWriteMask),c.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),c.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),Be(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?he(e.SAMPLE_ALPHA_TO_COVERAGE):ye(e.SAMPLE_ALPHA_TO_COVERAGE)}function Re(J){P!==J&&(J?e.frontFace(e.CW):e.frontFace(e.CCW),P=J)}function Xe(J){J!==qq?(he(e.CULL_FACE),J!==R&&(J===OI?e.cullFace(e.BACK):J===Qq?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):ye(e.CULL_FACE),R=J}function Oe(J){J!==O&&(K&&e.lineWidth(J),O=J)}function Be(J,be,ue){J?(he(e.POLYGON_OFFSET_FILL),(L!==be||I!==ue)&&(e.polygonOffset(be,ue),L=be,I=ue)):ye(e.POLYGON_OFFSET_FILL)}function at(J){J?he(e.SCISSOR_TEST):ye(e.SCISSOR_TEST)}function ht(J){J===void 0&&(J=e.TEXTURE0+z-1),j!==J&&(e.activeTexture(J),j=J)}function se(J,be,ue){ue===void 0&&(j===null?ue=e.TEXTURE0+z-1:ue=j);let Ne=k[ue];Ne===void 0&&(Ne={type:void 0,texture:void 0},k[ue]=Ne),(Ne.type!==J||Ne.texture!==be)&&(j!==ue&&(e.activeTexture(ue),j=ue),e.bindTexture(J,be||Z[J]),Ne.type=J,Ne.texture=be)}function N(){const J=k[j];J!==void 0&&J.type!==void 0&&(e.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function H(){try{e.compressedTexImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ve(){try{e.compressedTexImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function X(){try{e.texSubImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ce(){try{e.texSubImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ve(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ye(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function _e(){try{e.texStorage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Pe(){try{e.texStorage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Qe(){try{e.texImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function st(){try{e.texImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ct(J){te.equals(J)===!1&&(e.scissor(J.x,J.y,J.z,J.w),te.copy(J))}function tt(J){G.equals(J)===!1&&(e.viewport(J.x,J.y,J.z,J.w),G.copy(J))}function oe(J,be){let ue=h.get(be);ue===void 0&&(ue=new WeakMap,h.set(be,ue));let Ne=ue.get(J);Ne===void 0&&(Ne=e.getUniformBlockIndex(be,J.name),ue.set(J,Ne))}function je(J,be){const Ne=h.get(be).get(J);u.get(be)!==Ne&&(e.uniformBlockBinding(be,Ne,J.__bindingPointIndex),u.set(be,Ne))}function dt(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),r===!0&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},j=null,k={},p={},f=new WeakMap,g=[],m=null,v=!1,x=null,y=null,_=null,A=null,S=null,C=null,M=null,E=!1,P=null,R=null,O=null,L=null,I=null,te.set(0,0,e.canvas.width,e.canvas.height),G.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:he,disable:ye,bindFramebuffer:de,drawBuffers:xe,useProgram:me,setBlending:Ae,setMaterial:Te,setFlipSided:Re,setCullFace:Xe,setLineWidth:Oe,setPolygonOffset:Be,setScissorTest:at,activeTexture:ht,bindTexture:se,unbindTexture:N,compressedTexImage2D:H,compressedTexImage3D:ve,texImage2D:Qe,texImage3D:st,updateUBOMapping:oe,uniformBlockBinding:je,texStorage2D:_e,texStorage3D:Pe,texSubImage2D:X,texSubImage3D:Ce,compressedTexSubImage2D:Ve,compressedTexSubImage3D:Ye,scissor:ct,viewport:tt,reset:dt}}function qpe(e,t,i,r,n,s,a){const o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let g;const m=new WeakMap;let v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(N,H){return v?new OffscreenCanvas(N,H):Yx("canvas")}function y(N,H,ve,X){let Ce=1;if((N.width>X||N.height>X)&&(Ce=X/Math.max(N.width,N.height)),Ce<1||H===!0)if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap){const Ve=H?fE:Math.floor,Ye=Ve(Ce*N.width),_e=Ve(Ce*N.height);g===void 0&&(g=x(Ye,_e));const Pe=ve?x(Ye,_e):g;return Pe.width=Ye,Pe.height=_e,Pe.getContext("2d").drawImage(N,0,0,Ye,_e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+N.width+"x"+N.height+") to ("+Ye+"x"+_e+")."),Pe}else return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+N.width+"x"+N.height+")."),N;return N}function _(N){return uL(N.width)&&uL(N.height)}function A(N){return o?!1:N.wrapS!==ds||N.wrapT!==ds||N.minFilter!==Gr&&N.minFilter!==Dr}function S(N,H){return N.generateMipmaps&&H&&N.minFilter!==Gr&&N.minFilter!==Dr}function C(N){e.generateMipmap(N)}function M(N,H,ve,X,Ce=!1){if(o===!1)return H;if(N!==null){if(e[N]!==void 0)return e[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let Ve=H;return H===e.RED&&(ve===e.FLOAT&&(Ve=e.R32F),ve===e.HALF_FLOAT&&(Ve=e.R16F),ve===e.UNSIGNED_BYTE&&(Ve=e.R8)),H===e.RG&&(ve===e.FLOAT&&(Ve=e.RG32F),ve===e.HALF_FLOAT&&(Ve=e.RG16F),ve===e.UNSIGNED_BYTE&&(Ve=e.RG8)),H===e.RGBA&&(ve===e.FLOAT&&(Ve=e.RGBA32F),ve===e.HALF_FLOAT&&(Ve=e.RGBA16F),ve===e.UNSIGNED_BYTE&&(Ve=X===hi&&Ce===!1?e.SRGB8_ALPHA8:e.RGBA8),ve===e.UNSIGNED_SHORT_4_4_4_4&&(Ve=e.RGBA4),ve===e.UNSIGNED_SHORT_5_5_5_1&&(Ve=e.RGB5_A1)),(Ve===e.R16F||Ve===e.R32F||Ve===e.RG16F||Ve===e.RG32F||Ve===e.RGBA16F||Ve===e.RGBA32F)&&t.get("EXT_color_buffer_float"),Ve}function E(N,H,ve){return S(N,ve)===!0||N.isFramebufferTexture&&N.minFilter!==Gr&&N.minFilter!==Dr?Math.log2(Math.max(H.width,H.height))+1:N.mipmaps!==void 0&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?H.mipmaps.length:1}function P(N){return N===Gr||N===Hx||N===Dv?e.NEAREST:e.LINEAR}function R(N){const H=N.target;H.removeEventListener("dispose",R),L(H),H.isVideoTexture&&f.delete(H)}function O(N){const H=N.target;H.removeEventListener("dispose",O),z(H)}function L(N){const H=r.get(N);if(H.__webglInit===void 0)return;const ve=N.source,X=m.get(ve);if(X){const Ce=X[H.__cacheKey];Ce.usedTimes--,Ce.usedTimes===0&&I(N),Object.keys(X).length===0&&m.delete(ve)}r.remove(N)}function I(N){const H=r.get(N);e.deleteTexture(H.__webglTexture);const ve=N.source,X=m.get(ve);delete X[H.__cacheKey],a.memory.textures--}function z(N){const H=N.texture,ve=r.get(N),X=r.get(H);if(X.__webglTexture!==void 0&&(e.deleteTexture(X.__webglTexture),a.memory.textures--),N.depthTexture&&N.depthTexture.dispose(),N.isWebGLCubeRenderTarget)for(let Ce=0;Ce<6;Ce++)e.deleteFramebuffer(ve.__webglFramebuffer[Ce]),ve.__webglDepthbuffer&&e.deleteRenderbuffer(ve.__webglDepthbuffer[Ce]);else{if(e.deleteFramebuffer(ve.__webglFramebuffer),ve.__webglDepthbuffer&&e.deleteRenderbuffer(ve.__webglDepthbuffer),ve.__webglMultisampledFramebuffer&&e.deleteFramebuffer(ve.__webglMultisampledFramebuffer),ve.__webglColorRenderbuffer)for(let Ce=0;Ce<ve.__webglColorRenderbuffer.length;Ce++)ve.__webglColorRenderbuffer[Ce]&&e.deleteRenderbuffer(ve.__webglColorRenderbuffer[Ce]);ve.__webglDepthRenderbuffer&&e.deleteRenderbuffer(ve.__webglDepthRenderbuffer)}if(N.isWebGLMultipleRenderTargets)for(let Ce=0,Ve=H.length;Ce<Ve;Ce++){const Ye=r.get(H[Ce]);Ye.__webglTexture&&(e.deleteTexture(Ye.__webglTexture),a.memory.textures--),r.remove(H[Ce])}r.remove(H),r.remove(N)}let K=0;function Y(){K=0}function U(){const N=K;return N>=l&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+l),K+=1,N}function j(N){const H=[];return H.push(N.wrapS),H.push(N.wrapT),H.push(N.wrapR||0),H.push(N.magFilter),H.push(N.minFilter),H.push(N.anisotropy),H.push(N.internalFormat),H.push(N.format),H.push(N.type),H.push(N.generateMipmaps),H.push(N.premultiplyAlpha),H.push(N.flipY),H.push(N.unpackAlignment),H.push(N.colorSpace),H.join()}function k(N,H){const ve=r.get(N);if(N.isVideoTexture&&ht(N),N.isRenderTargetTexture===!1&&N.version>0&&ve.__version!==N.version){const X=N.image;if(X===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(X.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{de(ve,N,H);return}}i.bindTexture(e.TEXTURE_2D,ve.__webglTexture,e.TEXTURE0+H)}function q(N,H){const ve=r.get(N);if(N.version>0&&ve.__version!==N.version){de(ve,N,H);return}i.bindTexture(e.TEXTURE_2D_ARRAY,ve.__webglTexture,e.TEXTURE0+H)}function W(N,H){const ve=r.get(N);if(N.version>0&&ve.__version!==N.version){de(ve,N,H);return}i.bindTexture(e.TEXTURE_3D,ve.__webglTexture,e.TEXTURE0+H)}function te(N,H){const ve=r.get(N);if(N.version>0&&ve.__version!==N.version){xe(ve,N,H);return}i.bindTexture(e.TEXTURE_CUBE_MAP,ve.__webglTexture,e.TEXTURE0+H)}const G={[jd]:e.REPEAT,[ds]:e.CLAMP_TO_EDGE,[i0]:e.MIRRORED_REPEAT},le={[Gr]:e.NEAREST,[Hx]:e.NEAREST_MIPMAP_NEAREST,[Dv]:e.NEAREST_MIPMAP_LINEAR,[Dr]:e.LINEAR,[$C]:e.LINEAR_MIPMAP_NEAREST,[Fc]:e.LINEAR_MIPMAP_LINEAR},Z={[kQ]:e.NEVER,[XQ]:e.ALWAYS,[zQ]:e.LESS,[GQ]:e.LEQUAL,[VQ]:e.EQUAL,[WQ]:e.GEQUAL,[HQ]:e.GREATER,[jQ]:e.NOTEQUAL};function he(N,H,ve){if(ve?(e.texParameteri(N,e.TEXTURE_WRAP_S,G[H.wrapS]),e.texParameteri(N,e.TEXTURE_WRAP_T,G[H.wrapT]),(N===e.TEXTURE_3D||N===e.TEXTURE_2D_ARRAY)&&e.texParameteri(N,e.TEXTURE_WRAP_R,G[H.wrapR]),e.texParameteri(N,e.TEXTURE_MAG_FILTER,le[H.magFilter]),e.texParameteri(N,e.TEXTURE_MIN_FILTER,le[H.minFilter])):(e.texParameteri(N,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(N,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(N===e.TEXTURE_3D||N===e.TEXTURE_2D_ARRAY)&&e.texParameteri(N,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),(H.wrapS!==ds||H.wrapT!==ds)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(N,e.TEXTURE_MAG_FILTER,P(H.magFilter)),e.texParameteri(N,e.TEXTURE_MIN_FILTER,P(H.minFilter)),H.minFilter!==Gr&&H.minFilter!==Dr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),H.compareFunction&&(e.texParameteri(N,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(N,e.TEXTURE_COMPARE_FUNC,Z[H.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){const X=t.get("EXT_texture_filter_anisotropic");if(H.magFilter===Gr||H.minFilter!==Dv&&H.minFilter!==Fc||H.type===_c&&t.has("OES_texture_float_linear")===!1||o===!1&&H.type===r0&&t.has("OES_texture_half_float_linear")===!1)return;(H.anisotropy>1||r.get(H).__currentAnisotropy)&&(e.texParameterf(N,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(H.anisotropy,n.getMaxAnisotropy())),r.get(H).__currentAnisotropy=H.anisotropy)}}function ye(N,H){let ve=!1;N.__webglInit===void 0&&(N.__webglInit=!0,H.addEventListener("dispose",R));const X=H.source;let Ce=m.get(X);Ce===void 0&&(Ce={},m.set(X,Ce));const Ve=j(H);if(Ve!==N.__cacheKey){Ce[Ve]===void 0&&(Ce[Ve]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,ve=!0),Ce[Ve].usedTimes++;const Ye=Ce[N.__cacheKey];Ye!==void 0&&(Ce[N.__cacheKey].usedTimes--,Ye.usedTimes===0&&I(H)),N.__cacheKey=Ve,N.__webglTexture=Ce[Ve].texture}return ve}function de(N,H,ve){let X=e.TEXTURE_2D;(H.isDataArrayTexture||H.isCompressedArrayTexture)&&(X=e.TEXTURE_2D_ARRAY),H.isData3DTexture&&(X=e.TEXTURE_3D);const Ce=ye(N,H),Ve=H.source;i.bindTexture(X,N.__webglTexture,e.TEXTURE0+ve);const Ye=r.get(Ve);if(Ve.version!==Ye.__version||Ce===!0){i.activeTexture(e.TEXTURE0+ve),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,H.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,H.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const _e=A(H)&&_(H.image)===!1;let Pe=y(H.image,_e,!1,u);Pe=se(H,Pe);const Qe=_(Pe)||o,st=s.convert(H.format,H.colorSpace);let ct=s.convert(H.type),tt=M(H.internalFormat,st,ct,H.colorSpace);he(X,H,Qe);let oe;const je=H.mipmaps,dt=o&&H.isVideoTexture!==!0,J=Ye.__version===void 0||Ce===!0,be=E(H,Pe,Qe);if(H.isDepthTexture)tt=e.DEPTH_COMPONENT,o?H.type===_c?tt=e.DEPTH_COMPONENT32F:H.type===Bu?tt=e.DEPTH_COMPONENT24:H.type===Td?tt=e.DEPTH24_STENCIL8:tt=e.DEPTH_COMPONENT16:H.type===_c&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),H.format===Pd&&tt===e.DEPTH_COMPONENT&&H.type!==eT&&H.type!==Bu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),H.type=Bu,ct=s.convert(H.type)),H.format===Yf&&tt===e.DEPTH_COMPONENT&&(tt=e.DEPTH_STENCIL,H.type!==Td&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),H.type=Td,ct=s.convert(H.type))),J&&(dt?i.texStorage2D(e.TEXTURE_2D,1,tt,Pe.width,Pe.height):i.texImage2D(e.TEXTURE_2D,0,tt,Pe.width,Pe.height,0,st,ct,null));else if(H.isDataTexture)if(je.length>0&&Qe){dt&&J&&i.texStorage2D(e.TEXTURE_2D,be,tt,je[0].width,je[0].height);for(let ue=0,Ne=je.length;ue<Ne;ue++)oe=je[ue],dt?i.texSubImage2D(e.TEXTURE_2D,ue,0,0,oe.width,oe.height,st,ct,oe.data):i.texImage2D(e.TEXTURE_2D,ue,tt,oe.width,oe.height,0,st,ct,oe.data);H.generateMipmaps=!1}else dt?(J&&i.texStorage2D(e.TEXTURE_2D,be,tt,Pe.width,Pe.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,Pe.width,Pe.height,st,ct,Pe.data)):i.texImage2D(e.TEXTURE_2D,0,tt,Pe.width,Pe.height,0,st,ct,Pe.data);else if(H.isCompressedTexture)if(H.isCompressedArrayTexture){dt&&J&&i.texStorage3D(e.TEXTURE_2D_ARRAY,be,tt,je[0].width,je[0].height,Pe.depth);for(let ue=0,Ne=je.length;ue<Ne;ue++)oe=je[ue],H.format!==Sa?st!==null?dt?i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,ue,0,0,0,oe.width,oe.height,Pe.depth,st,oe.data,0,0):i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,ue,tt,oe.width,oe.height,Pe.depth,0,oe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):dt?i.texSubImage3D(e.TEXTURE_2D_ARRAY,ue,0,0,0,oe.width,oe.height,Pe.depth,st,ct,oe.data):i.texImage3D(e.TEXTURE_2D_ARRAY,ue,tt,oe.width,oe.height,Pe.depth,0,st,ct,oe.data)}else{dt&&J&&i.texStorage2D(e.TEXTURE_2D,be,tt,je[0].width,je[0].height);for(let ue=0,Ne=je.length;ue<Ne;ue++)oe=je[ue],H.format!==Sa?st!==null?dt?i.compressedTexSubImage2D(e.TEXTURE_2D,ue,0,0,oe.width,oe.height,st,oe.data):i.compressedTexImage2D(e.TEXTURE_2D,ue,tt,oe.width,oe.height,0,oe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):dt?i.texSubImage2D(e.TEXTURE_2D,ue,0,0,oe.width,oe.height,st,ct,oe.data):i.texImage2D(e.TEXTURE_2D,ue,tt,oe.width,oe.height,0,st,ct,oe.data)}else if(H.isDataArrayTexture)dt?(J&&i.texStorage3D(e.TEXTURE_2D_ARRAY,be,tt,Pe.width,Pe.height,Pe.depth),i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,Pe.width,Pe.height,Pe.depth,st,ct,Pe.data)):i.texImage3D(e.TEXTURE_2D_ARRAY,0,tt,Pe.width,Pe.height,Pe.depth,0,st,ct,Pe.data);else if(H.isData3DTexture)dt?(J&&i.texStorage3D(e.TEXTURE_3D,be,tt,Pe.width,Pe.height,Pe.depth),i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,Pe.width,Pe.height,Pe.depth,st,ct,Pe.data)):i.texImage3D(e.TEXTURE_3D,0,tt,Pe.width,Pe.height,Pe.depth,0,st,ct,Pe.data);else if(H.isFramebufferTexture){if(J)if(dt)i.texStorage2D(e.TEXTURE_2D,be,tt,Pe.width,Pe.height);else{let ue=Pe.width,Ne=Pe.height;for(let et=0;et<be;et++)i.texImage2D(e.TEXTURE_2D,et,tt,ue,Ne,0,st,ct,null),ue>>=1,Ne>>=1}}else if(je.length>0&&Qe){dt&&J&&i.texStorage2D(e.TEXTURE_2D,be,tt,je[0].width,je[0].height);for(let ue=0,Ne=je.length;ue<Ne;ue++)oe=je[ue],dt?i.texSubImage2D(e.TEXTURE_2D,ue,0,0,st,ct,oe):i.texImage2D(e.TEXTURE_2D,ue,tt,st,ct,oe);H.generateMipmaps=!1}else dt?(J&&i.texStorage2D(e.TEXTURE_2D,be,tt,Pe.width,Pe.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,st,ct,Pe)):i.texImage2D(e.TEXTURE_2D,0,tt,st,ct,Pe);S(H,Qe)&&C(X),Ye.__version=Ve.version,H.onUpdate&&H.onUpdate(H)}N.__version=H.version}function xe(N,H,ve){if(H.image.length!==6)return;const X=ye(N,H),Ce=H.source;i.bindTexture(e.TEXTURE_CUBE_MAP,N.__webglTexture,e.TEXTURE0+ve);const Ve=r.get(Ce);if(Ce.version!==Ve.__version||X===!0){i.activeTexture(e.TEXTURE0+ve),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,H.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,H.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const Ye=H.isCompressedTexture||H.image[0].isCompressedTexture,_e=H.image[0]&&H.image[0].isDataTexture,Pe=[];for(let ue=0;ue<6;ue++)!Ye&&!_e?Pe[ue]=y(H.image[ue],!1,!0,c):Pe[ue]=_e?H.image[ue].image:H.image[ue],Pe[ue]=se(H,Pe[ue]);const Qe=Pe[0],st=_(Qe)||o,ct=s.convert(H.format,H.colorSpace),tt=s.convert(H.type),oe=M(H.internalFormat,ct,tt,H.colorSpace),je=o&&H.isVideoTexture!==!0,dt=Ve.__version===void 0||X===!0;let J=E(H,Qe,st);he(e.TEXTURE_CUBE_MAP,H,st);let be;if(Ye){je&&dt&&i.texStorage2D(e.TEXTURE_CUBE_MAP,J,oe,Qe.width,Qe.height);for(let ue=0;ue<6;ue++){be=Pe[ue].mipmaps;for(let Ne=0;Ne<be.length;Ne++){const et=be[Ne];H.format!==Sa?ct!==null?je?i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne,0,0,et.width,et.height,ct,et.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne,oe,et.width,et.height,0,et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):je?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne,0,0,et.width,et.height,ct,tt,et.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne,oe,et.width,et.height,0,ct,tt,et.data)}}}else{be=H.mipmaps,je&&dt&&(be.length>0&&J++,i.texStorage2D(e.TEXTURE_CUBE_MAP,J,oe,Pe[0].width,Pe[0].height));for(let ue=0;ue<6;ue++)if(_e){je?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,0,0,Pe[ue].width,Pe[ue].height,ct,tt,Pe[ue].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,oe,Pe[ue].width,Pe[ue].height,0,ct,tt,Pe[ue].data);for(let Ne=0;Ne<be.length;Ne++){const _t=be[Ne].image[ue].image;je?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne+1,0,0,_t.width,_t.height,ct,tt,_t.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne+1,oe,_t.width,_t.height,0,ct,tt,_t.data)}}else{je?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,0,0,ct,tt,Pe[ue]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,oe,ct,tt,Pe[ue]);for(let Ne=0;Ne<be.length;Ne++){const et=be[Ne];je?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne+1,0,0,ct,tt,et.image[ue]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ue,Ne+1,oe,ct,tt,et.image[ue])}}}S(H,st)&&C(e.TEXTURE_CUBE_MAP),Ve.__version=Ce.version,H.onUpdate&&H.onUpdate(H)}N.__version=H.version}function me(N,H,ve,X,Ce){const Ve=s.convert(ve.format,ve.colorSpace),Ye=s.convert(ve.type),_e=M(ve.internalFormat,Ve,Ye,ve.colorSpace);r.get(H).__hasExternalTextures||(Ce===e.TEXTURE_3D||Ce===e.TEXTURE_2D_ARRAY?i.texImage3D(Ce,0,_e,H.width,H.height,H.depth,0,Ve,Ye,null):i.texImage2D(Ce,0,_e,H.width,H.height,0,Ve,Ye,null)),i.bindFramebuffer(e.FRAMEBUFFER,N),at(H)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,X,Ce,r.get(ve).__webglTexture,0,Be(H)):(Ce===e.TEXTURE_2D||Ce>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&Ce<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,X,Ce,r.get(ve).__webglTexture,0),i.bindFramebuffer(e.FRAMEBUFFER,null)}function ee(N,H,ve){if(e.bindRenderbuffer(e.RENDERBUFFER,N),H.depthBuffer&&!H.stencilBuffer){let X=e.DEPTH_COMPONENT16;if(ve||at(H)){const Ce=H.depthTexture;Ce&&Ce.isDepthTexture&&(Ce.type===_c?X=e.DEPTH_COMPONENT32F:Ce.type===Bu&&(X=e.DEPTH_COMPONENT24));const Ve=Be(H);at(H)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Ve,X,H.width,H.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,Ve,X,H.width,H.height)}else e.renderbufferStorage(e.RENDERBUFFER,X,H.width,H.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,N)}else if(H.depthBuffer&&H.stencilBuffer){const X=Be(H);ve&&at(H)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,X,e.DEPTH24_STENCIL8,H.width,H.height):at(H)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,X,e.DEPTH24_STENCIL8,H.width,H.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,H.width,H.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,N)}else{const X=H.isWebGLMultipleRenderTargets===!0?H.texture:[H.texture];for(let Ce=0;Ce<X.length;Ce++){const Ve=X[Ce],Ye=s.convert(Ve.format,Ve.colorSpace),_e=s.convert(Ve.type),Pe=M(Ve.internalFormat,Ye,_e,Ve.colorSpace),Qe=Be(H);ve&&at(H)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,Qe,Pe,H.width,H.height):at(H)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,Qe,Pe,H.width,H.height):e.renderbufferStorage(e.RENDERBUFFER,Pe,H.width,H.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function we(N,H){if(H&&H.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,N),!(H.depthTexture&&H.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(H.depthTexture).__webglTexture||H.depthTexture.image.width!==H.width||H.depthTexture.image.height!==H.height)&&(H.depthTexture.image.width=H.width,H.depthTexture.image.height=H.height,H.depthTexture.needsUpdate=!0),k(H.depthTexture,0);const X=r.get(H.depthTexture).__webglTexture,Ce=Be(H);if(H.depthTexture.format===Pd)at(H)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,X,0,Ce):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,X,0);else if(H.depthTexture.format===Yf)at(H)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,X,0,Ce):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,X,0);else throw new Error("Unknown depthTexture format")}function Ae(N){const H=r.get(N),ve=N.isWebGLCubeRenderTarget===!0;if(N.depthTexture&&!H.__autoAllocateDepthBuffer){if(ve)throw new Error("target.depthTexture not supported in Cube render targets");we(H.__webglFramebuffer,N)}else if(ve){H.__webglDepthbuffer=[];for(let X=0;X<6;X++)i.bindFramebuffer(e.FRAMEBUFFER,H.__webglFramebuffer[X]),H.__webglDepthbuffer[X]=e.createRenderbuffer(),ee(H.__webglDepthbuffer[X],N,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,H.__webglFramebuffer),H.__webglDepthbuffer=e.createRenderbuffer(),ee(H.__webglDepthbuffer,N,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function Te(N,H,ve){const X=r.get(N);H!==void 0&&me(X.__webglFramebuffer,N,N.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),ve!==void 0&&Ae(N)}function Re(N){const H=N.texture,ve=r.get(N),X=r.get(H);N.addEventListener("dispose",O),N.isWebGLMultipleRenderTargets!==!0&&(X.__webglTexture===void 0&&(X.__webglTexture=e.createTexture()),X.__version=H.version,a.memory.textures++);const Ce=N.isWebGLCubeRenderTarget===!0,Ve=N.isWebGLMultipleRenderTargets===!0,Ye=_(N)||o;if(Ce){ve.__webglFramebuffer=[];for(let _e=0;_e<6;_e++)ve.__webglFramebuffer[_e]=e.createFramebuffer()}else{if(ve.__webglFramebuffer=e.createFramebuffer(),Ve)if(n.drawBuffers){const _e=N.texture;for(let Pe=0,Qe=_e.length;Pe<Qe;Pe++){const st=r.get(_e[Pe]);st.__webglTexture===void 0&&(st.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&N.samples>0&&at(N)===!1){const _e=Ve?H:[H];ve.__webglMultisampledFramebuffer=e.createFramebuffer(),ve.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,ve.__webglMultisampledFramebuffer);for(let Pe=0;Pe<_e.length;Pe++){const Qe=_e[Pe];ve.__webglColorRenderbuffer[Pe]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,ve.__webglColorRenderbuffer[Pe]);const st=s.convert(Qe.format,Qe.colorSpace),ct=s.convert(Qe.type),tt=M(Qe.internalFormat,st,ct,Qe.colorSpace,N.isXRRenderTarget===!0),oe=Be(N);e.renderbufferStorageMultisample(e.RENDERBUFFER,oe,tt,N.width,N.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Pe,e.RENDERBUFFER,ve.__webglColorRenderbuffer[Pe])}e.bindRenderbuffer(e.RENDERBUFFER,null),N.depthBuffer&&(ve.__webglDepthRenderbuffer=e.createRenderbuffer(),ee(ve.__webglDepthRenderbuffer,N,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(Ce){i.bindTexture(e.TEXTURE_CUBE_MAP,X.__webglTexture),he(e.TEXTURE_CUBE_MAP,H,Ye);for(let _e=0;_e<6;_e++)me(ve.__webglFramebuffer[_e],N,H,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+_e);S(H,Ye)&&C(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(Ve){const _e=N.texture;for(let Pe=0,Qe=_e.length;Pe<Qe;Pe++){const st=_e[Pe],ct=r.get(st);i.bindTexture(e.TEXTURE_2D,ct.__webglTexture),he(e.TEXTURE_2D,st,Ye),me(ve.__webglFramebuffer,N,st,e.COLOR_ATTACHMENT0+Pe,e.TEXTURE_2D),S(st,Ye)&&C(e.TEXTURE_2D)}i.unbindTexture()}else{let _e=e.TEXTURE_2D;(N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(o?_e=N.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(_e,X.__webglTexture),he(_e,H,Ye),me(ve.__webglFramebuffer,N,H,e.COLOR_ATTACHMENT0,_e),S(H,Ye)&&C(_e),i.unbindTexture()}N.depthBuffer&&Ae(N)}function Xe(N){const H=_(N)||o,ve=N.isWebGLMultipleRenderTargets===!0?N.texture:[N.texture];for(let X=0,Ce=ve.length;X<Ce;X++){const Ve=ve[X];if(S(Ve,H)){const Ye=N.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,_e=r.get(Ve).__webglTexture;i.bindTexture(Ye,_e),C(Ye),i.unbindTexture()}}}function Oe(N){if(o&&N.samples>0&&at(N)===!1){const H=N.isWebGLMultipleRenderTargets?N.texture:[N.texture],ve=N.width,X=N.height;let Ce=e.COLOR_BUFFER_BIT;const Ve=[],Ye=N.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,_e=r.get(N),Pe=N.isWebGLMultipleRenderTargets===!0;if(Pe)for(let Qe=0;Qe<H.length;Qe++)i.bindFramebuffer(e.FRAMEBUFFER,_e.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Qe,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,_e.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+Qe,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,_e.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,_e.__webglFramebuffer);for(let Qe=0;Qe<H.length;Qe++){Ve.push(e.COLOR_ATTACHMENT0+Qe),N.depthBuffer&&Ve.push(Ye);const st=_e.__ignoreDepthValues!==void 0?_e.__ignoreDepthValues:!1;if(st===!1&&(N.depthBuffer&&(Ce|=e.DEPTH_BUFFER_BIT),N.stencilBuffer&&(Ce|=e.STENCIL_BUFFER_BIT)),Pe&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,_e.__webglColorRenderbuffer[Qe]),st===!0&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[Ye]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[Ye])),Pe){const ct=r.get(H[Qe]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,ct,0)}e.blitFramebuffer(0,0,ve,X,0,0,ve,X,Ce,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,Ve)}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),Pe)for(let Qe=0;Qe<H.length;Qe++){i.bindFramebuffer(e.FRAMEBUFFER,_e.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+Qe,e.RENDERBUFFER,_e.__webglColorRenderbuffer[Qe]);const st=r.get(H[Qe]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,_e.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+Qe,e.TEXTURE_2D,st,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,_e.__webglMultisampledFramebuffer)}}function Be(N){return Math.min(h,N.samples)}function at(N){const H=r.get(N);return o&&N.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&H.__useRenderToTexture!==!1}function ht(N){const H=a.render.frame;f.get(N)!==H&&(f.set(N,H),N.update())}function se(N,H){const ve=N.colorSpace,X=N.format,Ce=N.type;return N.isCompressedTexture===!0||N.format===pE||ve!==jo&&ve!==Rd&&(ve===hi?o===!1?t.has("EXT_sRGB")===!0&&X===Sa?(N.format=pE,N.minFilter=Dr,N.generateMipmaps=!1):H=iN.sRGBToLinear(H):(X!==Sa||Ce!==Tc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ve)),H}this.allocateTextureUnit=U,this.resetTextureUnits=Y,this.setTexture2D=k,this.setTexture2DArray=q,this.setTexture3D=W,this.setTextureCube=te,this.rebindTextures=Te,this.setupRenderTarget=Re,this.updateRenderTargetMipmap=Xe,this.updateMultisampleRenderTarget=Oe,this.setupDepthRenderbuffer=Ae,this.setupFrameBufferTexture=me,this.useMultisampledRTT=at}function rJ(e,t,i){const r=i.isWebGL2;function n(s,a=Rd){let o;if(s===Tc)return e.UNSIGNED_BYTE;if(s===WF)return e.UNSIGNED_SHORT_4_4_4_4;if(s===XF)return e.UNSIGNED_SHORT_5_5_5_1;if(s===_Q)return e.BYTE;if(s===SQ)return e.SHORT;if(s===eT)return e.UNSIGNED_SHORT;if(s===jF)return e.INT;if(s===Bu)return e.UNSIGNED_INT;if(s===_c)return e.FLOAT;if(s===r0)return r?e.HALF_FLOAT:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===AQ)return e.ALPHA;if(s===Sa)return e.RGBA;if(s===MQ)return e.LUMINANCE;if(s===EQ)return e.LUMINANCE_ALPHA;if(s===Pd)return e.DEPTH_COMPONENT;if(s===Yf)return e.DEPTH_STENCIL;if(s===pE)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===CQ)return e.RED;if(s===YF)return e.RED_INTEGER;if(s===TQ)return e.RG;if(s===qF)return e.RG_INTEGER;if(s===QF)return e.RGBA_INTEGER;if(s===uM||s===hM||s===dM||s===pM)if(a===hi)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===uM)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===hM)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===dM)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===pM)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===uM)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===hM)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===dM)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===pM)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===zI||s===VI||s===GI||s===HI)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===zI)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===VI)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===GI)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===HI)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===PQ)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===jI||s===WI)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===jI)return a===hi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===WI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===XI||s===YI||s===qI||s===QI||s===JI||s===KI||s===ZI||s===$I||s===eL||s===tL||s===iL||s===rL||s===nL||s===sL)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===XI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===YI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===qI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===QI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===JI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===KI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===ZI)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===$I)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===eL)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===tL)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===iL)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===rL)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===nL)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===sL)return a===hi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===fM)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===fM)return a===hi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===DQ||s===aL||s===oL||s===lL)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===fM)return o.COMPRESSED_RED_RGTC1_EXT;if(s===aL)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===oL)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===lL)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Td?r?e.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}class nJ extends Mr{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Fu extends Oi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Qpe={type:"move"};class WP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Fu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Fu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ne,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ne),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Fu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ne,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ne),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const r of t.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(c&&t.hand){a=!0;for(const g of t.hand.values()){const m=i.getJointPose(g,r),v=this._getHandJoint(c,g);m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=m.radius),v.visible=m!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(t.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Qpe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const r=new Fu;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[i.jointName]=r,t.add(r)}return t.joints[i.jointName]}}class sJ extends mr{constructor(t,i,r,n,s,a,o,l,c,u){if(u=u!==void 0?u:Pd,u!==Pd&&u!==Yf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===Pd&&(r=Bu),r===void 0&&u===Yf&&(r=Td),super(null,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=o!==void 0?o:Gr,this.minFilter=l!==void 0?l:Gr,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class Jpe extends hh{constructor(t,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,f=null;const g=i.getContextAttributes();let m=null,v=null;const x=[],y=[];let _=null;const A=new Mr;A.layers.enable(1),A.viewport=new Zi;const S=new Mr;S.layers.enable(2),S.viewport=new Zi;const C=[A,S],M=new nJ;M.layers.enable(1),M.layers.enable(2);let E=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(W){_=W},this.getController=function(W){let te=x[W];return te===void 0&&(te=new WP,x[W]=te),te.getTargetRaySpace()},this.getControllerGrip=function(W){let te=x[W];return te===void 0&&(te=new WP,x[W]=te),te.getGripSpace()},this.getHand=function(W){let te=x[W];return te===void 0&&(te=new WP,x[W]=te),te.getHandSpace()};function R(W){const te=y.indexOf(W.inputSource);if(te===-1)return;const G=x[te];G!==void 0&&(G.update(W.inputSource,W.frame,c||a),G.dispatchEvent({type:W.type,data:W.inputSource}))}function O(){n.removeEventListener("select",R),n.removeEventListener("selectstart",R),n.removeEventListener("selectend",R),n.removeEventListener("squeeze",R),n.removeEventListener("squeezestart",R),n.removeEventListener("squeezeend",R),n.removeEventListener("end",O),n.removeEventListener("inputsourceschange",L);for(let W=0;W<x.length;W++){const te=y[W];te!==null&&(y[W]=null,x[W].disconnect(te))}E=null,P=null,t.setRenderTarget(m),p=null,d=null,h=null,n=null,v=null,q.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){s=W,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){o=W,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(W){c=W},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(W){if(n=W,n!==null){if(m=t.getRenderTarget(),n.addEventListener("select",R),n.addEventListener("selectstart",R),n.addEventListener("selectend",R),n.addEventListener("squeeze",R),n.addEventListener("squeezestart",R),n.addEventListener("squeezeend",R),n.addEventListener("end",O),n.addEventListener("inputsourceschange",L),g.xrCompatible!==!0&&await i.makeXRCompatible(),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const te={antialias:n.renderState.layers===void 0?g.antialias:!0,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(n,i,te),n.updateRenderState({baseLayer:p}),v=new Ll(p.framebufferWidth,p.framebufferHeight,{format:Sa,type:Tc,colorSpace:t.outputColorSpace,stencilBuffer:g.stencil})}else{let te=null,G=null,le=null;g.depth&&(le=g.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,te=g.stencil?Yf:Pd,G=g.stencil?Td:Bu);const Z={colorFormat:i.RGBA8,depthFormat:le,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(Z),n.updateRenderState({layers:[d]}),v=new Ll(d.textureWidth,d.textureHeight,{format:Sa,type:Tc,depthTexture:new sJ(d.textureWidth,d.textureHeight,G,void 0,void 0,void 0,void 0,void 0,void 0,te),stencilBuffer:g.stencil,colorSpace:t.outputColorSpace,samples:g.antialias?4:0});const he=t.properties.get(v);he.__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),q.setContext(n),q.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function L(W){for(let te=0;te<W.removed.length;te++){const G=W.removed[te],le=y.indexOf(G);le>=0&&(y[le]=null,x[le].disconnect(G))}for(let te=0;te<W.added.length;te++){const G=W.added[te];let le=y.indexOf(G);if(le===-1){for(let he=0;he<x.length;he++)if(he>=y.length){y.push(G),le=he;break}else if(y[he]===null){y[he]=G,le=he;break}if(le===-1)break}const Z=x[le];Z&&Z.connect(G)}}const I=new ne,z=new ne;function K(W,te,G){I.setFromMatrixPosition(te.matrixWorld),z.setFromMatrixPosition(G.matrixWorld);const le=I.distanceTo(z),Z=te.projectionMatrix.elements,he=G.projectionMatrix.elements,ye=Z[14]/(Z[10]-1),de=Z[14]/(Z[10]+1),xe=(Z[9]+1)/Z[5],me=(Z[9]-1)/Z[5],ee=(Z[8]-1)/Z[0],we=(he[8]+1)/he[0],Ae=ye*ee,Te=ye*we,Re=le/(-ee+we),Xe=Re*-ee;te.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(Xe),W.translateZ(Re),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert();const Oe=ye+Re,Be=de+Re,at=Ae-Xe,ht=Te+(le-Xe),se=xe*de/Be*Oe,N=me*de/Be*Oe;W.projectionMatrix.makePerspective(at,ht,se,N,Oe,Be),W.projectionMatrixInverse.copy(W.projectionMatrix).invert()}function Y(W,te){te===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(te.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCameraXR=function(W){if(n===null)return W;_&&(W=_),M.near=S.near=A.near=W.near,M.far=S.far=A.far=W.far,(E!==M.near||P!==M.far)&&(n.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,P=M.far);const te=W.parent,G=M.cameras;Y(M,te);for(let le=0;le<G.length;le++)Y(G[le],te);return G.length===2?K(M,A,S):M.projectionMatrix.copy(A.projectionMatrix),_&&U(M,te),M};function U(W,te){const G=_;te===null?G.matrix.copy(W.matrixWorld):(G.matrix.copy(te.matrixWorld),G.matrix.invert(),G.matrix.multiply(W.matrixWorld)),G.matrix.decompose(G.position,G.quaternion,G.scale),G.updateMatrixWorld(!0);const le=G.children;for(let Z=0,he=le.length;Z<he;Z++)le[Z].updateMatrixWorld(!0);G.projectionMatrix.copy(W.projectionMatrix),G.projectionMatrixInverse.copy(W.projectionMatrixInverse),G.isPerspectiveCamera&&(G.fov=s0*2*Math.atan(1/G.projectionMatrix.elements[5]),G.zoom=1)}this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(W){l=W,d!==null&&(d.fixedFoveation=W),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=W)};let j=null;function k(W,te){if(u=te.getViewerPose(c||a),f=te,u!==null){const G=u.views;p!==null&&(t.setRenderTargetFramebuffer(v,p.framebuffer),t.setRenderTarget(v));let le=!1;G.length!==M.cameras.length&&(M.cameras.length=0,le=!0);for(let Z=0;Z<G.length;Z++){const he=G[Z];let ye=null;if(p!==null)ye=p.getViewport(he);else{const xe=h.getViewSubImage(d,he);ye=xe.viewport,Z===0&&(t.setRenderTargetTextures(v,xe.colorTexture,d.ignoreDepthValues?void 0:xe.depthStencilTexture),t.setRenderTarget(v))}let de=C[Z];de===void 0&&(de=new Mr,de.layers.enable(Z),de.viewport=new Zi,C[Z]=de),de.matrix.fromArray(he.transform.matrix),de.matrix.decompose(de.position,de.quaternion,de.scale),de.projectionMatrix.fromArray(he.projectionMatrix),de.projectionMatrixInverse.copy(de.projectionMatrix).invert(),de.viewport.set(ye.x,ye.y,ye.width,ye.height),Z===0&&(M.matrix.copy(de.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),le===!0&&M.cameras.push(de)}}for(let G=0;G<x.length;G++){const le=y[G],Z=x[G];le!==null&&Z!==void 0&&Z.update(le,te,c||a)}j&&j(W,te),te.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:te}),f=null}const q=new ZQ;q.setAnimationLoop(k),this.setAnimationLoop=function(W){j=W},this.dispose=function(){}}}function Kpe(e,t){function i(m,v){m.matrixAutoUpdate===!0&&m.updateMatrix(),v.value.copy(m.matrix)}function r(m,v){v.color.getRGB(m.fogColor.value,JQ(e)),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}function n(m,v,x,y,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(m,v):v.isMeshToonMaterial?(s(m,v),h(m,v)):v.isMeshPhongMaterial?(s(m,v),u(m,v)):v.isMeshStandardMaterial?(s(m,v),d(m,v),v.isMeshPhysicalMaterial&&p(m,v,_)):v.isMeshMatcapMaterial?(s(m,v),f(m,v)):v.isMeshDepthMaterial?s(m,v):v.isMeshDistanceMaterial?(s(m,v),g(m,v)):v.isMeshNormalMaterial?s(m,v):v.isLineBasicMaterial?(a(m,v),v.isLineDashedMaterial&&o(m,v)):v.isPointsMaterial?l(m,v,x,y):v.isSpriteMaterial?c(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map,i(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,i(v.alphaMap,m.alphaMapTransform)),v.bumpMap&&(m.bumpMap.value=v.bumpMap,i(v.bumpMap,m.bumpMapTransform),m.bumpScale.value=v.bumpScale,v.side===sa&&(m.bumpScale.value*=-1)),v.normalMap&&(m.normalMap.value=v.normalMap,i(v.normalMap,m.normalMapTransform),m.normalScale.value.copy(v.normalScale),v.side===sa&&m.normalScale.value.negate()),v.displacementMap&&(m.displacementMap.value=v.displacementMap,i(v.displacementMap,m.displacementMapTransform),m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap,i(v.emissiveMap,m.emissiveMapTransform)),v.specularMap&&(m.specularMap.value=v.specularMap,i(v.specularMap,m.specularMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const x=t.get(v).envMap;if(x&&(m.envMap.value=x,m.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap){m.lightMap.value=v.lightMap;const y=e.useLegacyLights===!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*y,i(v.lightMap,m.lightMapTransform)}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity,i(v.aoMap,m.aoMapTransform))}function a(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,v.map&&(m.map.value=v.map,i(v.map,m.mapTransform))}function o(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}function l(m,v,x,y){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*x,m.scale.value=y*.5,v.map&&(m.map.value=v.map,i(v.map,m.uvTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,i(v.alphaMap,m.alphaMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest)}function c(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map,i(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,i(v.alphaMap,m.alphaMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest)}function u(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}function h(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}function d(m,v){m.metalness.value=v.metalness,v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap,i(v.metalnessMap,m.metalnessMapTransform)),m.roughness.value=v.roughness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap,i(v.roughnessMap,m.roughnessMapTransform)),t.get(v).envMap&&(m.envMapIntensity.value=v.envMapIntensity)}function p(m,v,x){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap,i(v.sheenColorMap,m.sheenColorMapTransform)),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap,i(v.sheenRoughnessMap,m.sheenRoughnessMapTransform))),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap,i(v.clearcoatMap,m.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,i(v.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(m.clearcoatNormalMap.value=v.clearcoatNormalMap,i(v.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===sa&&m.clearcoatNormalScale.value.negate())),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap,i(v.iridescenceMap,m.iridescenceMapTransform)),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap,i(v.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=x.texture,m.transmissionSamplerSize.value.set(x.width,x.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap,i(v.transmissionMap,m.transmissionMapTransform)),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap,i(v.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(m.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(m.anisotropyMap.value=v.anisotropyMap,i(v.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap,i(v.specularColorMap,m.specularColorMapTransform)),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap,i(v.specularIntensityMap,m.specularIntensityMapTransform))}function f(m,v){v.matcap&&(m.matcap.value=v.matcap)}function g(m,v){const x=t.get(v).light;m.referencePosition.value.setFromMatrixPosition(x.matrixWorld),m.nearDistance.value=x.shadow.camera.near,m.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function Zpe(e,t,i,r){let n={},s={},a=[];const o=i.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(x,y){const _=y.program;r.uniformBlockBinding(x,_)}function c(x,y){let _=n[x.id];_===void 0&&(f(x),_=u(x),n[x.id]=_,x.addEventListener("dispose",m));const A=y.program;r.updateUBOMapping(x,A);const S=t.render.frame;s[x.id]!==S&&(d(x),s[x.id]=S)}function u(x){const y=h();x.__bindingPointIndex=y;const _=e.createBuffer(),A=x.__size,S=x.usage;return e.bindBuffer(e.UNIFORM_BUFFER,_),e.bufferData(e.UNIFORM_BUFFER,A,S),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,y,_),_}function h(){for(let x=0;x<o;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){const y=n[x.id],_=x.uniforms,A=x.__cache;e.bindBuffer(e.UNIFORM_BUFFER,y);for(let S=0,C=_.length;S<C;S++){const M=_[S];if(p(M,S,A)===!0){const E=M.__offset,P=Array.isArray(M.value)?M.value:[M.value];let R=0;for(let O=0;O<P.length;O++){const L=P[O],I=g(L);typeof L=="number"?(M.__data[0]=L,e.bufferSubData(e.UNIFORM_BUFFER,E+R,M.__data)):L.isMatrix3?(M.__data[0]=L.elements[0],M.__data[1]=L.elements[1],M.__data[2]=L.elements[2],M.__data[3]=L.elements[0],M.__data[4]=L.elements[3],M.__data[5]=L.elements[4],M.__data[6]=L.elements[5],M.__data[7]=L.elements[0],M.__data[8]=L.elements[6],M.__data[9]=L.elements[7],M.__data[10]=L.elements[8],M.__data[11]=L.elements[0]):(L.toArray(M.__data,R),R+=I.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,E,M.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function p(x,y,_){const A=x.value;if(_[y]===void 0){if(typeof A=="number")_[y]=A;else{const S=Array.isArray(A)?A:[A],C=[];for(let M=0;M<S.length;M++)C.push(S[M].clone());_[y]=C}return!0}else if(typeof A=="number"){if(_[y]!==A)return _[y]=A,!0}else{const S=Array.isArray(_[y])?_[y]:[_[y]],C=Array.isArray(A)?A:[A];for(let M=0;M<S.length;M++){const E=S[M];if(E.equals(C[M])===!1)return E.copy(C[M]),!0}}return!1}function f(x){const y=x.uniforms;let _=0;const A=16;let S=0;for(let C=0,M=y.length;C<M;C++){const E=y[C],P={boundary:0,storage:0},R=Array.isArray(E.value)?E.value:[E.value];for(let O=0,L=R.length;O<L;O++){const I=R[O],z=g(I);P.boundary+=z.boundary,P.storage+=z.storage}if(E.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=_,C>0){S=_%A;const O=A-S;S!==0&&O-P.boundary<0&&(_+=A-S,E.__offset=_)}_+=P.storage}return S=_%A,S>0&&(_+=A-S),x.__size=_,x.__cache={},this}function g(x){const y={boundary:0,storage:0};return typeof x=="number"?(y.boundary=4,y.storage=4):x.isVector2?(y.boundary=8,y.storage=8):x.isVector3||x.isColor?(y.boundary=16,y.storage=12):x.isVector4?(y.boundary=16,y.storage=16):x.isMatrix3?(y.boundary=48,y.storage=48):x.isMatrix4?(y.boundary=64,y.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),y}function m(x){const y=x.target;y.removeEventListener("dispose",m);const _=a.indexOf(y.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[y.id]),delete n[y.id],delete s[y.id]}function v(){for(const x in n)e.deleteBuffer(n[x]);a=[],n={},s={}}return{bind:l,update:c,dispose:v}}function $pe(){const e=Yx("canvas");return e.style.display="block",e}class hN{constructor(t={}){const{canvas:i=$pe(),context:r=null,depth:n=!0,stencil:s=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=t;this.isWebGLRenderer=!0;let d;r!==null?d=r.getContextAttributes().alpha:d=a;const p=new Uint32Array(4),f=new Int32Array(4);let g=null,m=null;const v=[],x=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=hi,this.useLegacyLights=!0,this.toneMapping=Tl,this.toneMappingExposure=1;const y=this;let _=!1,A=0,S=0,C=null,M=-1,E=null;const P=new Zi,R=new Zi;let O=null;const L=new bt(0);let I=0,z=i.width,K=i.height,Y=1,U=null,j=null;const k=new Zi(0,0,z,K),q=new Zi(0,0,z,K);let W=!1;const te=new rT;let G=!1,le=!1,Z=null;const he=new ri,ye=new it,de=new ne,xe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function me(){return C===null?Y:1}let ee=r;function we(re,Me){for(let Ie=0;Ie<re.length;Ie++){const Ee=re[Ie],ke=i.getContext(Ee,Me);if(ke!==null)return ke}return null}try{const re={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${R0}`),i.addEventListener("webglcontextlost",be,!1),i.addEventListener("webglcontextrestored",ue,!1),i.addEventListener("webglcontextcreationerror",Ne,!1),ee===null){const Me=["webgl2","webgl","experimental-webgl"];if(y.isWebGL1Renderer===!0&&Me.shift(),ee=we(Me,re),ee===null)throw we(Me)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ee instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),ee.getShaderPrecisionFormat===void 0&&(ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(re){throw console.error("THREE.WebGLRenderer: "+re.message),re}let Ae,Te,Re,Xe,Oe,Be,at,ht,se,N,H,ve,X,Ce,Ve,Ye,_e,Pe,Qe,st,ct,tt,oe,je;function dt(){Ae=new mde(ee),Te=new cde(ee,Ae,t),Ae.init(Te),tt=new rJ(ee,Ae,Te),Re=new Ype(ee,Ae,Te),Xe=new yde(ee),Oe=new Bpe,Be=new qpe(ee,Ae,Re,Oe,Te,tt,Xe),at=new hde(y),ht=new fde(y),se=new Dce(ee,Te),oe=new ode(ee,Ae,se,Te),N=new gde(ee,se,Xe,oe),H=new _de(ee,N,se,Xe),Qe=new bde(ee,Te,Be),Ye=new ude(Oe),ve=new Ope(y,at,ht,Ae,Te,oe,Ye),X=new Kpe(y,Oe),Ce=new Npe,Ve=new Hpe(Ae,Te),Pe=new ade(y,at,ht,Re,H,d,l),_e=new Xpe(y,H,Te),je=new Zpe(ee,Xe,Te,Re),st=new lde(ee,Ae,Xe,Te),ct=new vde(ee,Ae,Xe,Te),Xe.programs=ve.programs,y.capabilities=Te,y.extensions=Ae,y.properties=Oe,y.renderLists=Ce,y.shadowMap=_e,y.state=Re,y.info=Xe}dt();const J=new Jpe(y,ee);this.xr=J,this.getContext=function(){return ee},this.getContextAttributes=function(){return ee.getContextAttributes()},this.forceContextLoss=function(){const re=Ae.get("WEBGL_lose_context");re&&re.loseContext()},this.forceContextRestore=function(){const re=Ae.get("WEBGL_lose_context");re&&re.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(re){re!==void 0&&(Y=re,this.setSize(z,K,!1))},this.getSize=function(re){return re.set(z,K)},this.setSize=function(re,Me,Ie=!0){if(J.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}z=re,K=Me,i.width=Math.floor(re*Y),i.height=Math.floor(Me*Y),Ie===!0&&(i.style.width=re+"px",i.style.height=Me+"px"),this.setViewport(0,0,re,Me)},this.getDrawingBufferSize=function(re){return re.set(z*Y,K*Y).floor()},this.setDrawingBufferSize=function(re,Me,Ie){z=re,K=Me,Y=Ie,i.width=Math.floor(re*Ie),i.height=Math.floor(Me*Ie),this.setViewport(0,0,re,Me)},this.getCurrentViewport=function(re){return re.copy(P)},this.getViewport=function(re){return re.copy(k)},this.setViewport=function(re,Me,Ie,Ee){re.isVector4?k.set(re.x,re.y,re.z,re.w):k.set(re,Me,Ie,Ee),Re.viewport(P.copy(k).multiplyScalar(Y).floor())},this.getScissor=function(re){return re.copy(q)},this.setScissor=function(re,Me,Ie,Ee){re.isVector4?q.set(re.x,re.y,re.z,re.w):q.set(re,Me,Ie,Ee),Re.scissor(R.copy(q).multiplyScalar(Y).floor())},this.getScissorTest=function(){return W},this.setScissorTest=function(re){Re.setScissorTest(W=re)},this.setOpaqueSort=function(re){U=re},this.setTransparentSort=function(re){j=re},this.getClearColor=function(re){return re.copy(Pe.getClearColor())},this.setClearColor=function(){Pe.setClearColor.apply(Pe,arguments)},this.getClearAlpha=function(){return Pe.getClearAlpha()},this.setClearAlpha=function(){Pe.setClearAlpha.apply(Pe,arguments)},this.clear=function(re=!0,Me=!0,Ie=!0){let Ee=0;if(re){let ke=!1;if(C!==null){const ut=C.texture.format;ke=ut===QF||ut===qF||ut===YF}if(ke){const ut=C.texture.type,pt=ut===Tc||ut===Bu||ut===eT||ut===Td||ut===WF||ut===XF,Dt=Pe.getClearColor(),Nt=Pe.getClearAlpha(),ni=Dt.r,Tt=Dt.g,gt=Dt.b,gi=Oe.get(C).__webglFramebuffer;pt?(p[0]=ni,p[1]=Tt,p[2]=gt,p[3]=Nt,ee.clearBufferuiv(ee.COLOR,gi,p)):(f[0]=ni,f[1]=Tt,f[2]=gt,f[3]=Nt,ee.clearBufferiv(ee.COLOR,gi,f))}else Ee|=ee.COLOR_BUFFER_BIT}Me&&(Ee|=ee.DEPTH_BUFFER_BIT),Ie&&(Ee|=ee.STENCIL_BUFFER_BIT),ee.clear(Ee)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",be,!1),i.removeEventListener("webglcontextrestored",ue,!1),i.removeEventListener("webglcontextcreationerror",Ne,!1),Ce.dispose(),Ve.dispose(),Oe.dispose(),at.dispose(),ht.dispose(),H.dispose(),oe.dispose(),je.dispose(),ve.dispose(),J.dispose(),J.removeEventListener("sessionstart",Ut),J.removeEventListener("sessionend",Wi),Z&&(Z.dispose(),Z=null),Ai.stop()};function be(re){re.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function ue(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const re=Xe.autoReset,Me=_e.enabled,Ie=_e.autoUpdate,Ee=_e.needsUpdate,ke=_e.type;dt(),Xe.autoReset=re,_e.enabled=Me,_e.autoUpdate=Ie,_e.needsUpdate=Ee,_e.type=ke}function Ne(re){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",re.statusMessage)}function et(re){const Me=re.target;Me.removeEventListener("dispose",et),_t(Me)}function _t(re){zt(re),Oe.remove(re)}function zt(re){const Me=Oe.get(re).programs;Me!==void 0&&(Me.forEach(function(Ie){ve.releaseProgram(Ie)}),re.isShaderMaterial&&ve.releaseShaderCache(re))}this.renderBufferDirect=function(re,Me,Ie,Ee,ke,ut){Me===null&&(Me=xe);const pt=ke.isMesh&&ke.matrixWorld.determinant()<0,Dt=Fe(re,Me,Ie,Ee,ke);Re.setMaterial(Ee,pt);let Nt=Ie.index,ni=1;Ee.wireframe===!0&&(Nt=N.getWireframeAttribute(Ie),ni=2);const Tt=Ie.drawRange,gt=Ie.attributes.position;let gi=Tt.start*ni,Rt=(Tt.start+Tt.count)*ni;ut!==null&&(gi=Math.max(gi,ut.start*ni),Rt=Math.min(Rt,(ut.start+ut.count)*ni)),Nt!==null?(gi=Math.max(gi,0),Rt=Math.min(Rt,Nt.count)):gt!=null&&(gi=Math.max(gi,0),Rt=Math.min(Rt,gt.count));const Cr=Rt-gi;if(Cr<0||Cr===1/0)return;oe.setup(ke,Ee,Dt,Ie,Nt);let qr,Pi=st;if(Nt!==null&&(qr=se.get(Nt),Pi=ct,Pi.setIndex(qr)),ke.isMesh)Ee.wireframe===!0?(Re.setLineWidth(Ee.wireframeLinewidth*me()),Pi.setMode(ee.LINES)):Pi.setMode(ee.TRIANGLES);else if(ke.isLine){let Xt=Ee.linewidth;Xt===void 0&&(Xt=1),Re.setLineWidth(Xt*me()),ke.isLineSegments?Pi.setMode(ee.LINES):ke.isLineLoop?Pi.setMode(ee.LINE_LOOP):Pi.setMode(ee.LINE_STRIP)}else ke.isPoints?Pi.setMode(ee.POINTS):ke.isSprite&&Pi.setMode(ee.TRIANGLES);if(ke.isInstancedMesh)Pi.renderInstances(gi,Cr,ke.count);else if(Ie.isInstancedBufferGeometry){const Xt=Ie._maxInstanceCount!==void 0?Ie._maxInstanceCount:1/0,Q=Math.min(Ie.instanceCount,Xt);Pi.renderInstances(gi,Cr,Q)}else Pi.render(gi,Cr)},this.compile=function(re,Me){function Ie(Ee,ke,ut){Ee.transparent===!0&&Ee.side===Bo&&Ee.forceSinglePass===!1?(Ee.side=sa,Ee.needsUpdate=!0,Ue(Ee,ke,ut),Ee.side=Bc,Ee.needsUpdate=!0,Ue(Ee,ke,ut),Ee.side=Bo):Ue(Ee,ke,ut)}m=Ve.get(re),m.init(),x.push(m),re.traverseVisible(function(Ee){Ee.isLight&&Ee.layers.test(Me.layers)&&(m.pushLight(Ee),Ee.castShadow&&m.pushShadow(Ee))}),m.setupLights(y.useLegacyLights),re.traverse(function(Ee){const ke=Ee.material;if(ke)if(Array.isArray(ke))for(let ut=0;ut<ke.length;ut++){const pt=ke[ut];Ie(pt,re,Ee)}else Ie(ke,re,Ee)}),x.pop(),m=null};let ti=null;function ar(re){ti&&ti(re)}function Ut(){Ai.stop()}function Wi(){Ai.start()}const Ai=new ZQ;Ai.setAnimationLoop(ar),typeof self<"u"&&Ai.setContext(self),this.setAnimationLoop=function(re){ti=re,J.setAnimationLoop(re),re===null?Ai.stop():Ai.start()},J.addEventListener("sessionstart",Ut),J.addEventListener("sessionend",Wi),this.render=function(re,Me){if(Me!==void 0&&Me.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;re.matrixWorldAutoUpdate===!0&&re.updateMatrixWorld(),Me.parent===null&&Me.matrixWorldAutoUpdate===!0&&Me.updateMatrixWorld(),J.enabled===!0&&J.isPresenting===!0&&(Me=J.updateCameraXR(Me)),re.isScene===!0&&re.onBeforeRender(y,re,Me,C),m=Ve.get(re,x.length),m.init(),x.push(m),he.multiplyMatrices(Me.projectionMatrix,Me.matrixWorldInverse),te.setFromProjectionMatrix(he),le=this.localClippingEnabled,G=Ye.init(this.clippingPlanes,le),g=Ce.get(re,v.length),g.init(),v.push(g),Qo(re,Me,0,y.sortObjects),g.finish(),y.sortObjects===!0&&g.sort(U,j),G===!0&&Ye.beginShadows();const Ie=m.state.shadowsArray;if(_e.render(Ie,re,Me),G===!0&&Ye.endShadows(),this.info.autoReset===!0&&this.info.reset(),this.info.render.frame++,Pe.render(g,re),m.setupLights(y.useLegacyLights),Me.isArrayCamera){const Ee=Me.cameras;for(let ke=0,ut=Ee.length;ke<ut;ke++){const pt=Ee[ke];mh(g,re,pt,pt.viewport)}}else mh(g,re,Me);C!==null&&(Be.updateMultisampleRenderTarget(C),Be.updateRenderTargetMipmap(C)),re.isScene===!0&&re.onAfterRender(y,re,Me),oe.resetDefaultState(),M=-1,E=null,x.pop(),x.length>0?m=x[x.length-1]:m=null,v.pop(),v.length>0?g=v[v.length-1]:g=null};function Qo(re,Me,Ie,Ee){if(re.visible===!1)return;if(re.layers.test(Me.layers)){if(re.isGroup)Ie=re.renderOrder;else if(re.isLOD)re.autoUpdate===!0&&re.update(Me);else if(re.isLight)m.pushLight(re),re.castShadow&&m.pushShadow(re);else if(re.isSprite){if(!re.frustumCulled||te.intersectsSprite(re)){Ee&&de.setFromMatrixPosition(re.matrixWorld).applyMatrix4(he);const pt=H.update(re),Dt=re.material;Dt.visible&&g.push(re,pt,Dt,Ie,de.z,null)}}else if((re.isMesh||re.isLine||re.isPoints)&&(!re.frustumCulled||te.intersectsObject(re))){re.isSkinnedMesh&&re.skeleton.frame!==Xe.render.frame&&(re.skeleton.update(),re.skeleton.frame=Xe.render.frame);const pt=H.update(re),Dt=re.material;if(Ee&&(re.boundingSphere!==void 0?(re.boundingSphere===null&&re.computeBoundingSphere(),de.copy(re.boundingSphere.center)):(pt.boundingSphere===null&&pt.computeBoundingSphere(),de.copy(pt.boundingSphere.center)),de.applyMatrix4(re.matrixWorld).applyMatrix4(he)),Array.isArray(Dt)){const Nt=pt.groups;for(let ni=0,Tt=Nt.length;ni<Tt;ni++){const gt=Nt[ni],gi=Dt[gt.materialIndex];gi&&gi.visible&&g.push(re,pt,gi,Ie,de.z,gt)}}else Dt.visible&&g.push(re,pt,Dt,Ie,de.z,null)}}const ut=re.children;for(let pt=0,Dt=ut.length;pt<Dt;pt++)Qo(ut[pt],Me,Ie,Ee)}function mh(re,Me,Ie,Ee){const ke=re.opaque,ut=re.transmissive,pt=re.transparent;m.setupLightsView(Ie),G===!0&&Ye.setGlobalState(y.clippingPlanes,Ie),ut.length>0&&gh(ke,ut,Me,Ie),Ee&&Re.viewport(P.copy(Ee)),ke.length>0&&da(ke,Me,Ie),ut.length>0&&da(ut,Me,Ie),pt.length>0&&da(pt,Me,Ie),Re.buffers.depth.setTest(!0),Re.buffers.depth.setMask(!0),Re.buffers.color.setMask(!0),Re.setPolygonOffset(!1)}function gh(re,Me,Ie,Ee){const ke=Te.isWebGL2;Z===null&&(Z=new Ll(1,1,{generateMipmaps:!0,type:Ae.has("EXT_color_buffer_half_float")?r0:Tc,minFilter:Fc,samples:ke&&o===!0?4:0})),y.getDrawingBufferSize(ye),ke?Z.setSize(ye.x,ye.y):Z.setSize(fE(ye.x),fE(ye.y));const ut=y.getRenderTarget();y.setRenderTarget(Z),y.getClearColor(L),I=y.getClearAlpha(),I<1&&y.setClearColor(16777215,.5),y.clear();const pt=y.toneMapping;y.toneMapping=Tl,da(re,Ie,Ee),Be.updateMultisampleRenderTarget(Z),Be.updateRenderTargetMipmap(Z);let Dt=!1;for(let Nt=0,ni=Me.length;Nt<ni;Nt++){const Tt=Me[Nt],gt=Tt.object,gi=Tt.geometry,Rt=Tt.material,Cr=Tt.group;if(Rt.side===Bo&&gt.layers.test(Ee.layers)){const qr=Rt.side;Rt.side=sa,Rt.needsUpdate=!0,ae(gt,Ie,Ee,gi,Rt,Cr),Rt.side=qr,Rt.needsUpdate=!0,Dt=!0}}Dt===!0&&(Be.updateMultisampleRenderTarget(Z),Be.updateRenderTargetMipmap(Z)),y.setRenderTarget(ut),y.setClearColor(L,I),y.toneMapping=pt}function da(re,Me,Ie){const Ee=Me.isScene===!0?Me.overrideMaterial:null;for(let ke=0,ut=re.length;ke<ut;ke++){const pt=re[ke],Dt=pt.object,Nt=pt.geometry,ni=Ee===null?pt.material:Ee,Tt=pt.group;Dt.layers.test(Ie.layers)&&ae(Dt,Me,Ie,Nt,ni,Tt)}}function ae(re,Me,Ie,Ee,ke,ut){re.onBeforeRender(y,Me,Ie,Ee,ke,ut),re.modelViewMatrix.multiplyMatrices(Ie.matrixWorldInverse,re.matrixWorld),re.normalMatrix.getNormalMatrix(re.modelViewMatrix),ke.onBeforeRender(y,Me,Ie,Ee,re,ut),ke.transparent===!0&&ke.side===Bo&&ke.forceSinglePass===!1?(ke.side=sa,ke.needsUpdate=!0,y.renderBufferDirect(Ie,Me,Ee,ke,re,ut),ke.side=Bc,ke.needsUpdate=!0,y.renderBufferDirect(Ie,Me,Ee,ke,re,ut),ke.side=Bo):y.renderBufferDirect(Ie,Me,Ee,ke,re,ut),re.onAfterRender(y,Me,Ie,Ee,ke,ut)}function Ue(re,Me,Ie){Me.isScene!==!0&&(Me=xe);const Ee=Oe.get(re),ke=m.state.lights,ut=m.state.shadowsArray,pt=ke.state.version,Dt=ve.getParameters(re,ke.state,ut,Me,Ie),Nt=ve.getProgramCacheKey(Dt);let ni=Ee.programs;Ee.environment=re.isMeshStandardMaterial?Me.environment:null,Ee.fog=Me.fog,Ee.envMap=(re.isMeshStandardMaterial?ht:at).get(re.envMap||Ee.environment),ni===void 0&&(re.addEventListener("dispose",et),ni=new Map,Ee.programs=ni);let Tt=ni.get(Nt);if(Tt!==void 0){if(Ee.currentProgram===Tt&&Ee.lightsStateVersion===pt)return Je(re,Dt),Tt}else Dt.uniforms=ve.getUniforms(re),re.onBuild(Ie,Dt,y),re.onBeforeCompile(Dt,y),Tt=ve.acquireProgram(Dt,Nt),ni.set(Nt,Tt),Ee.uniforms=Dt.uniforms;const gt=Ee.uniforms;(!re.isShaderMaterial&&!re.isRawShaderMaterial||re.clipping===!0)&&(gt.clippingPlanes=Ye.uniform),Je(re,Dt),Ee.needsLights=Pt(re),Ee.lightsStateVersion=pt,Ee.needsLights&&(gt.ambientLightColor.value=ke.state.ambient,gt.lightProbe.value=ke.state.probe,gt.directionalLights.value=ke.state.directional,gt.directionalLightShadows.value=ke.state.directionalShadow,gt.spotLights.value=ke.state.spot,gt.spotLightShadows.value=ke.state.spotShadow,gt.rectAreaLights.value=ke.state.rectArea,gt.ltc_1.value=ke.state.rectAreaLTC1,gt.ltc_2.value=ke.state.rectAreaLTC2,gt.pointLights.value=ke.state.point,gt.pointLightShadows.value=ke.state.pointShadow,gt.hemisphereLights.value=ke.state.hemi,gt.directionalShadowMap.value=ke.state.directionalShadowMap,gt.directionalShadowMatrix.value=ke.state.directionalShadowMatrix,gt.spotShadowMap.value=ke.state.spotShadowMap,gt.spotLightMatrix.value=ke.state.spotLightMatrix,gt.spotLightMap.value=ke.state.spotLightMap,gt.pointShadowMap.value=ke.state.pointShadowMap,gt.pointShadowMatrix.value=ke.state.pointShadowMatrix);const gi=Tt.getUniforms(),Rt=vM.seqWithValue(gi.seq,gt);return Ee.currentProgram=Tt,Ee.uniformsList=Rt,Tt}function Je(re,Me){const Ie=Oe.get(re);Ie.outputColorSpace=Me.outputColorSpace,Ie.instancing=Me.instancing,Ie.skinning=Me.skinning,Ie.morphTargets=Me.morphTargets,Ie.morphNormals=Me.morphNormals,Ie.morphColors=Me.morphColors,Ie.morphTargetsCount=Me.morphTargetsCount,Ie.numClippingPlanes=Me.numClippingPlanes,Ie.numIntersection=Me.numClipIntersection,Ie.vertexAlphas=Me.vertexAlphas,Ie.vertexTangents=Me.vertexTangents,Ie.toneMapping=Me.toneMapping}function Fe(re,Me,Ie,Ee,ke){Me.isScene!==!0&&(Me=xe),Be.resetTextureUnits();const ut=Me.fog,pt=Ee.isMeshStandardMaterial?Me.environment:null,Dt=C===null?y.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:jo,Nt=(Ee.isMeshStandardMaterial?ht:at).get(Ee.envMap||pt),ni=Ee.vertexColors===!0&&!!Ie.attributes.color&&Ie.attributes.color.itemSize===4,Tt=!!Ie.attributes.tangent&&(!!Ee.normalMap||Ee.anisotropy>0),gt=!!Ie.morphAttributes.position,gi=!!Ie.morphAttributes.normal,Rt=!!Ie.morphAttributes.color,Cr=Ee.toneMapped?y.toneMapping:Tl,qr=Ie.morphAttributes.position||Ie.morphAttributes.normal||Ie.morphAttributes.color,Pi=qr!==void 0?qr.length:0,Xt=Oe.get(Ee),Q=m.state.lights;if(G===!0&&(le===!0||re!==E)){const an=re===E&&Ee.id===M;Ye.setState(Ee,re,an)}let $=!1;Ee.version===Xt.__version?(Xt.needsLights&&Xt.lightsStateVersion!==Q.state.version||Xt.outputColorSpace!==Dt||ke.isInstancedMesh&&Xt.instancing===!1||!ke.isInstancedMesh&&Xt.instancing===!0||ke.isSkinnedMesh&&Xt.skinning===!1||!ke.isSkinnedMesh&&Xt.skinning===!0||Xt.envMap!==Nt||Ee.fog===!0&&Xt.fog!==ut||Xt.numClippingPlanes!==void 0&&(Xt.numClippingPlanes!==Ye.numPlanes||Xt.numIntersection!==Ye.numIntersection)||Xt.vertexAlphas!==ni||Xt.vertexTangents!==Tt||Xt.morphTargets!==gt||Xt.morphNormals!==gi||Xt.morphColors!==Rt||Xt.toneMapping!==Cr||Te.isWebGL2===!0&&Xt.morphTargetsCount!==Pi)&&($=!0):($=!0,Xt.__version=Ee.version);let ge=Xt.currentProgram;$===!0&&(ge=Ue(Ee,Me,ke));let ie=!1,Se=!1,lt=!1;const zi=ge.getUniforms(),ur=Xt.uniforms;if(Re.useProgram(ge.program)&&(ie=!0,Se=!0,lt=!0),Ee.id!==M&&(M=Ee.id,Se=!0),ie||E!==re){if(zi.setValue(ee,"projectionMatrix",re.projectionMatrix),Te.logarithmicDepthBuffer&&zi.setValue(ee,"logDepthBufFC",2/(Math.log(re.far+1)/Math.LN2)),E!==re&&(E=re,Se=!0,lt=!0),Ee.isShaderMaterial||Ee.isMeshPhongMaterial||Ee.isMeshToonMaterial||Ee.isMeshStandardMaterial||Ee.envMap){const an=zi.map.cameraPosition;an!==void 0&&an.setValue(ee,de.setFromMatrixPosition(re.matrixWorld))}(Ee.isMeshPhongMaterial||Ee.isMeshToonMaterial||Ee.isMeshLambertMaterial||Ee.isMeshBasicMaterial||Ee.isMeshStandardMaterial||Ee.isShaderMaterial)&&zi.setValue(ee,"isOrthographic",re.isOrthographicCamera===!0),(Ee.isMeshPhongMaterial||Ee.isMeshToonMaterial||Ee.isMeshLambertMaterial||Ee.isMeshBasicMaterial||Ee.isMeshStandardMaterial||Ee.isShaderMaterial||Ee.isShadowMaterial||ke.isSkinnedMesh)&&zi.setValue(ee,"viewMatrix",re.matrixWorldInverse)}if(ke.isSkinnedMesh){zi.setOptional(ee,ke,"bindMatrix"),zi.setOptional(ee,ke,"bindMatrixInverse");const an=ke.skeleton;an&&(Te.floatVertexTextures?(an.boneTexture===null&&an.computeBoneTexture(),zi.setValue(ee,"boneTexture",an.boneTexture,Be),zi.setValue(ee,"boneTextureSize",an.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Fa=Ie.morphAttributes;if((Fa.position!==void 0||Fa.normal!==void 0||Fa.color!==void 0&&Te.isWebGL2===!0)&&Qe.update(ke,Ie,ge),(Se||Xt.receiveShadow!==ke.receiveShadow)&&(Xt.receiveShadow=ke.receiveShadow,zi.setValue(ee,"receiveShadow",ke.receiveShadow)),Ee.isMeshGouraudMaterial&&Ee.envMap!==null&&(ur.envMap.value=Nt,ur.flipEnvMap.value=Nt.isCubeTexture&&Nt.isRenderTargetTexture===!1?-1:1),Se&&(zi.setValue(ee,"toneMappingExposure",y.toneMappingExposure),Xt.needsLights&&Ze(ur,lt),ut&&Ee.fog===!0&&X.refreshFogUniforms(ur,ut),X.refreshMaterialUniforms(ur,Ee,Y,K,Z),vM.upload(ee,Xt.uniformsList,ur,Be)),Ee.isShaderMaterial&&Ee.uniformsNeedUpdate===!0&&(vM.upload(ee,Xt.uniformsList,ur,Be),Ee.uniformsNeedUpdate=!1),Ee.isSpriteMaterial&&zi.setValue(ee,"center",ke.center),zi.setValue(ee,"modelViewMatrix",ke.modelViewMatrix),zi.setValue(ee,"normalMatrix",ke.normalMatrix),zi.setValue(ee,"modelMatrix",ke.matrixWorld),Ee.isShaderMaterial||Ee.isRawShaderMaterial){const an=Ee.uniformsGroups;for(let Jo=0,jl=an.length;Jo<jl;Jo++)if(Te.isWebGL2){const ry=an[Jo];je.update(ry,ge),je.bind(ry,ge)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ge}function Ze(re,Me){re.ambientLightColor.needsUpdate=Me,re.lightProbe.needsUpdate=Me,re.directionalLights.needsUpdate=Me,re.directionalLightShadows.needsUpdate=Me,re.pointLights.needsUpdate=Me,re.pointLightShadows.needsUpdate=Me,re.spotLights.needsUpdate=Me,re.spotLightShadows.needsUpdate=Me,re.rectAreaLights.needsUpdate=Me,re.hemisphereLights.needsUpdate=Me}function Pt(re){return re.isMeshLambertMaterial||re.isMeshToonMaterial||re.isMeshPhongMaterial||re.isMeshStandardMaterial||re.isShadowMaterial||re.isShaderMaterial&&re.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(re,Me,Ie){Oe.get(re.texture).__webglTexture=Me,Oe.get(re.depthTexture).__webglTexture=Ie;const Ee=Oe.get(re);Ee.__hasExternalTextures=!0,Ee.__hasExternalTextures&&(Ee.__autoAllocateDepthBuffer=Ie===void 0,Ee.__autoAllocateDepthBuffer||Ae.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ee.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(re,Me){const Ie=Oe.get(re);Ie.__webglFramebuffer=Me,Ie.__useDefaultFramebuffer=Me===void 0},this.setRenderTarget=function(re,Me=0,Ie=0){C=re,A=Me,S=Ie;let Ee=!0,ke=null,ut=!1,pt=!1;if(re){const Nt=Oe.get(re);Nt.__useDefaultFramebuffer!==void 0?(Re.bindFramebuffer(ee.FRAMEBUFFER,null),Ee=!1):Nt.__webglFramebuffer===void 0?Be.setupRenderTarget(re):Nt.__hasExternalTextures&&Be.rebindTextures(re,Oe.get(re.texture).__webglTexture,Oe.get(re.depthTexture).__webglTexture);const ni=re.texture;(ni.isData3DTexture||ni.isDataArrayTexture||ni.isCompressedArrayTexture)&&(pt=!0);const Tt=Oe.get(re).__webglFramebuffer;re.isWebGLCubeRenderTarget?(ke=Tt[Me],ut=!0):Te.isWebGL2&&re.samples>0&&Be.useMultisampledRTT(re)===!1?ke=Oe.get(re).__webglMultisampledFramebuffer:ke=Tt,P.copy(re.viewport),R.copy(re.scissor),O=re.scissorTest}else P.copy(k).multiplyScalar(Y).floor(),R.copy(q).multiplyScalar(Y).floor(),O=W;if(Re.bindFramebuffer(ee.FRAMEBUFFER,ke)&&Te.drawBuffers&&Ee&&Re.drawBuffers(re,ke),Re.viewport(P),Re.scissor(R),Re.setScissorTest(O),ut){const Nt=Oe.get(re.texture);ee.framebufferTexture2D(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,ee.TEXTURE_CUBE_MAP_POSITIVE_X+Me,Nt.__webglTexture,Ie)}else if(pt){const Nt=Oe.get(re.texture),ni=Me||0;ee.framebufferTextureLayer(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,Nt.__webglTexture,Ie||0,ni)}M=-1},this.readRenderTargetPixels=function(re,Me,Ie,Ee,ke,ut,pt){if(!(re&&re.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Dt=Oe.get(re).__webglFramebuffer;if(re.isWebGLCubeRenderTarget&&pt!==void 0&&(Dt=Dt[pt]),Dt){Re.bindFramebuffer(ee.FRAMEBUFFER,Dt);try{const Nt=re.texture,ni=Nt.format,Tt=Nt.type;if(ni!==Sa&&tt.convert(ni)!==ee.getParameter(ee.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const gt=Tt===r0&&(Ae.has("EXT_color_buffer_half_float")||Te.isWebGL2&&Ae.has("EXT_color_buffer_float"));if(Tt!==Tc&&tt.convert(Tt)!==ee.getParameter(ee.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Tt===_c&&(Te.isWebGL2||Ae.has("OES_texture_float")||Ae.has("WEBGL_color_buffer_float")))&&!gt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Me>=0&&Me<=re.width-Ee&&Ie>=0&&Ie<=re.height-ke&&ee.readPixels(Me,Ie,Ee,ke,tt.convert(ni),tt.convert(Tt),ut)}finally{const Nt=C!==null?Oe.get(C).__webglFramebuffer:null;Re.bindFramebuffer(ee.FRAMEBUFFER,Nt)}}},this.copyFramebufferToTexture=function(re,Me,Ie=0){const Ee=Math.pow(2,-Ie),ke=Math.floor(Me.image.width*Ee),ut=Math.floor(Me.image.height*Ee);Be.setTexture2D(Me,0),ee.copyTexSubImage2D(ee.TEXTURE_2D,Ie,0,0,re.x,re.y,ke,ut),Re.unbindTexture()},this.copyTextureToTexture=function(re,Me,Ie,Ee=0){const ke=Me.image.width,ut=Me.image.height,pt=tt.convert(Ie.format),Dt=tt.convert(Ie.type);Be.setTexture2D(Ie,0),ee.pixelStorei(ee.UNPACK_FLIP_Y_WEBGL,Ie.flipY),ee.pixelStorei(ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ie.premultiplyAlpha),ee.pixelStorei(ee.UNPACK_ALIGNMENT,Ie.unpackAlignment),Me.isDataTexture?ee.texSubImage2D(ee.TEXTURE_2D,Ee,re.x,re.y,ke,ut,pt,Dt,Me.image.data):Me.isCompressedTexture?ee.compressedTexSubImage2D(ee.TEXTURE_2D,Ee,re.x,re.y,Me.mipmaps[0].width,Me.mipmaps[0].height,pt,Me.mipmaps[0].data):ee.texSubImage2D(ee.TEXTURE_2D,Ee,re.x,re.y,pt,Dt,Me.image),Ee===0&&Ie.generateMipmaps&&ee.generateMipmap(ee.TEXTURE_2D),Re.unbindTexture()},this.copyTextureToTexture3D=function(re,Me,Ie,Ee,ke=0){if(y.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const ut=re.max.x-re.min.x+1,pt=re.max.y-re.min.y+1,Dt=re.max.z-re.min.z+1,Nt=tt.convert(Ee.format),ni=tt.convert(Ee.type);let Tt;if(Ee.isData3DTexture)Be.setTexture3D(Ee,0),Tt=ee.TEXTURE_3D;else if(Ee.isDataArrayTexture)Be.setTexture2DArray(Ee,0),Tt=ee.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ee.pixelStorei(ee.UNPACK_FLIP_Y_WEBGL,Ee.flipY),ee.pixelStorei(ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ee.premultiplyAlpha),ee.pixelStorei(ee.UNPACK_ALIGNMENT,Ee.unpackAlignment);const gt=ee.getParameter(ee.UNPACK_ROW_LENGTH),gi=ee.getParameter(ee.UNPACK_IMAGE_HEIGHT),Rt=ee.getParameter(ee.UNPACK_SKIP_PIXELS),Cr=ee.getParameter(ee.UNPACK_SKIP_ROWS),qr=ee.getParameter(ee.UNPACK_SKIP_IMAGES),Pi=Ie.isCompressedTexture?Ie.mipmaps[0]:Ie.image;ee.pixelStorei(ee.UNPACK_ROW_LENGTH,Pi.width),ee.pixelStorei(ee.UNPACK_IMAGE_HEIGHT,Pi.height),ee.pixelStorei(ee.UNPACK_SKIP_PIXELS,re.min.x),ee.pixelStorei(ee.UNPACK_SKIP_ROWS,re.min.y),ee.pixelStorei(ee.UNPACK_SKIP_IMAGES,re.min.z),Ie.isDataTexture||Ie.isData3DTexture?ee.texSubImage3D(Tt,ke,Me.x,Me.y,Me.z,ut,pt,Dt,Nt,ni,Pi.data):Ie.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ee.compressedTexSubImage3D(Tt,ke,Me.x,Me.y,Me.z,ut,pt,Dt,Nt,Pi.data)):ee.texSubImage3D(Tt,ke,Me.x,Me.y,Me.z,ut,pt,Dt,Nt,ni,Pi),ee.pixelStorei(ee.UNPACK_ROW_LENGTH,gt),ee.pixelStorei(ee.UNPACK_IMAGE_HEIGHT,gi),ee.pixelStorei(ee.UNPACK_SKIP_PIXELS,Rt),ee.pixelStorei(ee.UNPACK_SKIP_ROWS,Cr),ee.pixelStorei(ee.UNPACK_SKIP_IMAGES,qr),ke===0&&Ee.generateMipmaps&&ee.generateMipmap(Tt),Re.unbindTexture()},this.initTexture=function(re){re.isCubeTexture?Be.setTextureCube(re,0):re.isData3DTexture?Be.setTexture3D(re,0):re.isDataArrayTexture||re.isCompressedArrayTexture?Be.setTexture2DArray(re,0):Be.setTexture2D(re,0),Re.unbindTexture()},this.resetState=function(){A=0,S=0,C=null,Re.reset(),oe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Sc}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===hi?Dd:ZF}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===Dd?hi:jo}}class aJ extends hN{}aJ.prototype.isWebGL1Renderer=!0;class sT{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new bt(t),this.density=i}clone(){return new sT(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class aT{constructor(t,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new bt(t),this.near=i,this.far=r}clone(){return new aT(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class mE extends Oi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class Ow{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=Wx,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=$a()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,r){t*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=i.array[r+n];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$a()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$a()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const js=new ne;class Wd{constructor(t,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,r=this.data.count;i<r;i++)js.fromBufferAttribute(this,i),js.applyMatrix4(t),this.setXYZ(i,js.x,js.y,js.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)js.fromBufferAttribute(this,i),js.applyNormalMatrix(t),this.setXYZ(i,js.x,js.y,js.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)js.fromBufferAttribute(this,i),js.transformDirection(t),this.setXYZ(i,js.x,js.y,js.z);return this}setX(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=Qa(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=Qa(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=Qa(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=Qa(i,this.array)),i}setXY(t,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this}setXYZ(t,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array),s=bi(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new Ui(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Wd(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class dN extends yn{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new bt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let tg;const By=new ne,ig=new ne,rg=new ne,ng=new it,Fy=new it,oJ=new ri,J_=new ne,Ny=new ne,K_=new ne,C5=new it,XP=new it,T5=new it;class lJ extends Oi{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",tg===void 0){tg=new pi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Ow(i,5);tg.setIndex([0,1,2,0,2,3]),tg.setAttribute("position",new Wd(r,3,0,!1)),tg.setAttribute("uv",new Wd(r,2,3,!1))}this.geometry=tg,this.material=t!==void 0?t:new dN,this.center=new it(.5,.5)}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ig.setFromMatrixScale(this.matrixWorld),oJ.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),rg.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ig.multiplyScalar(-rg.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;Z_(J_.set(-.5,-.5,0),rg,a,ig,n,s),Z_(Ny.set(.5,-.5,0),rg,a,ig,n,s),Z_(K_.set(.5,.5,0),rg,a,ig,n,s),C5.set(0,0),XP.set(1,0),T5.set(1,1);let o=t.ray.intersectTriangle(J_,Ny,K_,!1,By);if(o===null&&(Z_(Ny.set(-.5,.5,0),rg,a,ig,n,s),XP.set(0,1),o=t.ray.intersectTriangle(J_,K_,Ny,!1,By),o===null))return;const l=t.ray.origin.distanceTo(By);l<t.near||l>t.far||i.push({distance:l,point:By.clone(),uv:wa.getInterpolation(By,J_,Ny,K_,C5,XP,T5,new it),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function Z_(e,t,i,r,n,s){ng.subVectors(e,i).addScalar(.5).multiply(r),n!==void 0?(Fy.x=s*ng.x-n*ng.y,Fy.y=n*ng.x+s*ng.y):Fy.copy(ng),e.copy(t),e.x+=Fy.x,e.y+=Fy.y,e.applyMatrix4(oJ)}const $_=new ne,P5=new ne;class cJ extends Oi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),t<s)break}return i[r-1].object}return null}raycast(t,i){if(this.levels.length>0){$_.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo($_);this.getObjectForDistance(n).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){$_.setFromMatrixPosition(t.matrixWorld),P5.setFromMatrixPosition(this.matrixWorld);const r=$_.distanceTo(P5)/t.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const D5=new ne,R5=new Zi,I5=new Zi,efe=new ne,L5=new ri,sg=new ne,YP=new Yo,O5=new ri,qP=new hm;class pN extends Ln{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ri,this.bindMatrixInverse=new ri,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ul),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)sg.fromBufferAttribute(i,r),this.applyBoneTransform(r,sg),this.boundingBox.expandByPoint(sg)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Yo),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)sg.fromBufferAttribute(i,r),this.applyBoneTransform(r,sg),this.boundingSphere.expandByPoint(sg)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),YP.copy(this.boundingSphere),YP.applyMatrix4(n),t.ray.intersectsSphere(YP)!==!1&&(O5.copy(n).invert(),qP.copy(t.ray).applyMatrix4(O5),!(this.boundingBox!==null&&qP.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,i,qP)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Zi,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const r=this.skeleton,n=this.geometry;R5.fromBufferAttribute(n.attributes.skinIndex,t),I5.fromBufferAttribute(n.attributes.skinWeight,t),D5.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=I5.getComponent(s);if(a!==0){const o=R5.getComponent(s);L5.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(efe.copy(D5).applyMatrix4(L5),a)}}return i.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,i){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,i)}}class oT extends Oi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Iv extends mr{constructor(t=null,i=1,r=1,n,s,a,o,l,c=Gr,u=Gr,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const B5=new ri,tfe=new ri;class Bw{constructor(t=[],i=[]){this.uuid=$a(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ri)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const r=new ri;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:tfe;B5.multiplyMatrices(o,i[s]),B5.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new Bw(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=YQ(t),t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const r=new Iv(i,t,t,Sa,_c);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this.boneTextureSize=t,this}getBoneByName(t){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===t)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const s=t.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new oT),this.bones.push(a),this.boneInverses.push(new ri().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.bones.push(a.uuid);const o=r[n];t.boneInverses.push(o.toArray())}return t}}class Qf extends Ui{constructor(t,i,r,n=1){super(t,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const ag=new ri,F5=new ri,eS=[],N5=new Ul,ife=new ri,Uy=new Ln,ky=new Yo;class fN extends Ln{constructor(t,i,r){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new Qf(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,ife)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Ul),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,ag),N5.copy(t.boundingBox).applyMatrix4(ag),this.boundingBox.union(N5)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Yo),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,ag),ky.copy(t.boundingSphere).applyMatrix4(ag),this.boundingSphere.union(ky)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}raycast(t,i){const r=this.matrixWorld,n=this.count;if(Uy.geometry=this.geometry,Uy.material=this.material,Uy.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ky.copy(this.boundingSphere),ky.applyMatrix4(r),t.ray.intersectsSphere(ky)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,ag),F5.multiplyMatrices(r,ag),Uy.matrixWorld=F5,Uy.raycast(t,eS);for(let a=0,o=eS.length;a<o;a++){const l=eS[a];l.instanceId=s,l.object=this,i.push(l)}eS.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new Qf(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ks extends yn{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const U5=new ne,k5=new ne,z5=new ri,QP=new hm,tS=new Yo;class ih extends Oi{constructor(t=new pi,i=new ks){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)U5.fromBufferAttribute(i,n-1),k5.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=U5.distanceTo(k5);t.setAttribute("lineDistance",new Ft(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),tS.copy(r.boundingSphere),tS.applyMatrix4(n),tS.radius+=s,t.ray.intersectsSphere(tS)===!1)return;z5.copy(n).invert(),QP.copy(t.ray).applyMatrix4(z5);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new ne,u=new ne,h=new ne,d=new ne,p=this.isLineSegments?2:1,f=r.index,m=r.attributes.position;if(f!==null){const v=Math.max(0,a.start),x=Math.min(f.count,a.start+a.count);for(let y=v,_=x-1;y<_;y+=p){const A=f.getX(y),S=f.getX(y+1);if(c.fromBufferAttribute(m,A),u.fromBufferAttribute(m,S),QP.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const M=t.ray.origin.distanceTo(d);M<t.near||M>t.far||i.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{const v=Math.max(0,a.start),x=Math.min(m.count,a.start+a.count);for(let y=v,_=x-1;y<_;y+=p){if(c.fromBufferAttribute(m,y),u.fromBufferAttribute(m,y+1),QP.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const S=t.ray.origin.distanceTo(d);S<t.near||S>t.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}const V5=new ne,G5=new ne;class kl extends ih{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)V5.fromBufferAttribute(i,n),G5.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+V5.distanceTo(G5);t.setAttribute("lineDistance",new Ft(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class mN extends ih{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class Fw extends yn{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new bt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const H5=new ri,pL=new hm,iS=new Yo,rS=new ne;let gN=class extends Oi{constructor(t=new pi,i=new Fw){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=t.material,this.geometry=t.geometry,this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),iS.copy(r.boundingSphere),iS.applyMatrix4(n),iS.radius+=s,t.ray.intersectsSphere(iS)===!1)return;H5.copy(n).invert(),pL.copy(t.ray).applyMatrix4(H5);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let f=d,g=p;f<g;f++){const m=c.getX(f);rS.fromBufferAttribute(h,m),j5(rS,m,l,n,t,i,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let f=d,g=p;f<g;f++)rS.fromBufferAttribute(h,f),j5(rS,f,l,n,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function j5(e,t,i,r,n,s,a){const o=pL.distanceSqToPoint(e);if(o<i){const l=new ne;pL.closestPointToPoint(e,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}class rfe extends mr{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Dr,this.magFilter=s!==void 0?s:Dr,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class nfe extends mr{constructor(t,i){super({width:t,height:i}),this.isFramebufferTexture=!0,this.magFilter=Gr,this.minFilter=Gr,this.generateMipmaps=!1,this.needsUpdate=!0}}class vN extends mr{constructor(t,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class sfe extends vN{constructor(t,i,r,n,s,a){super(t,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=ds}}class afe extends mr{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class zl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,i){const r=this.getUtoTmapping(t);return this.getPoint(r,i)}getPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return i}getSpacedPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPointAt(r/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=t*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,p=(a-u)/d;return(n+p)/(s-1)}getTangent(t,i){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new it:new ne);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const r=this.getUtoTmapping(t);return this.getTangent(r,i)}computeFrenetFrames(t,i){const r=new ne,n=[],s=[],a=[],o=new ne,l=new ri;for(let p=0;p<=t;p++){const f=p/t;n[p]=this.getTangentAt(f,new ne)}s[0]=new ne,a[0]=new ne;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let p=1;p<=t;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(n[p-1],n[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(Hr(n[p-1].dot(n[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,f))}a[p].crossVectors(n[p],s[p])}if(i===!0){let p=Math.acos(Hr(s[0].dot(s[t]),-1,1));p/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(p=-p);for(let f=1;f<=t;f++)s[f].applyMatrix4(l.makeRotationAxis(n[f],p*f)),a[f].crossVectors(n[f],s[f])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class lT extends zl{constructor(t=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i){const r=i||new it,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*u-p*h+this.aX,c=d*h+p*u+this.aY}return r.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class uJ extends lT{constructor(t,i,r,n,s,a){super(t,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function yN(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+r*o}}}const nS=new ne,JP=new yN,KP=new yN,ZP=new yN;class hJ extends zl{constructor(t=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=r,this.tension=n}getPoint(t,i=new ne){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(nS.subVectors(n[0],n[1]).add(n[0]),c=nS);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(nS.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=nS),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(c.distanceToSquared(h),p),g=Math.pow(h.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(u),p);g<1e-4&&(g=1),f<1e-4&&(f=g),m<1e-4&&(m=g),JP.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,f,g,m),KP.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,f,g,m),ZP.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,f,g,m)}else this.curveType==="catmullrom"&&(JP.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),KP.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),ZP.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(JP.calc(l),KP.calc(l),ZP.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new ne().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function W5(e,t,i,r,n){const s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function ofe(e,t){const i=1-e;return i*i*t}function lfe(e,t){return 2*(1-e)*e*t}function cfe(e,t){return e*e*t}function tx(e,t,i,r){return ofe(e,t)+lfe(e,i)+cfe(e,r)}function ufe(e,t){const i=1-e;return i*i*i*t}function hfe(e,t){const i=1-e;return 3*i*i*e*t}function dfe(e,t){return 3*(1-e)*e*e*t}function pfe(e,t){return e*e*e*t}function ix(e,t,i,r,n){return ufe(e,t)+hfe(e,i)+dfe(e,r)+pfe(e,n)}class xN extends zl{constructor(t=new it,i=new it,r=new it,n=new it){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new it){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(ix(t,n.x,s.x,a.x,o.x),ix(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class dJ extends zl{constructor(t=new ne,i=new ne,r=new ne,n=new ne){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new ne){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(ix(t,n.x,s.x,a.x,o.x),ix(t,n.y,s.y,a.y,o.y),ix(t,n.z,s.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class cT extends zl{constructor(t=new it,i=new it){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new it){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new it){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class pJ extends zl{constructor(t=new ne,i=new ne){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new ne){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new ne){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class wN extends zl{constructor(t=new it,i=new it,r=new it){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new it){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(tx(t,n.x,s.x,a.x),tx(t,n.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class bN extends zl{constructor(t=new ne,i=new ne,r=new ne){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new ne){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(tx(t,n.x,s.x,a.x),tx(t,n.y,s.y,a.y),tx(t,n.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class _N extends zl{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new it){const r=i,n=this.points,s=(n.length-1)*t,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(W5(o,l.x,c.x,u.x,h.x),W5(o,l.y,c.y,u.y,h.y)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new it().fromArray(n))}return this}}var SN=Object.freeze({__proto__:null,ArcCurve:uJ,CatmullRomCurve3:hJ,CubicBezierCurve:xN,CubicBezierCurve3:dJ,EllipseCurve:lT,LineCurve:cT,LineCurve3:pJ,QuadraticBezierCurve:wN,QuadraticBezierCurve3:bN,SplineCurve:_N});class fJ extends zl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);t.equals(i)||this.curves.push(new cT(i,t))}getPoint(t,i){const r=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(new SN[n.type]().fromJSON(n))}return this}}class qx extends fJ{constructor(t){super(),this.type="Path",this.currentPoint=new it,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,r=t.length;i<r;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const r=new cT(this.currentPoint.clone(),new it(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,r,n){const s=new wN(this.currentPoint.clone(),new it(t,i),new it(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(t,i,r,n,s,a){const o=new xN(this.currentPoint.clone(),new it(t,i),new it(r,n),new it(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),r=new _N(i);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,r,n,s,a),this}absarc(t,i,r,n,s,a){return this.absellipse(t,i,r,r,n,s,a),this}ellipse(t,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,i+u,r,n,s,a,o,l),this}absellipse(t,i,r,n,s,a,o,l){const c=new lT(t,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class B0 extends pi{constructor(t=[new it(0,-.5),new it(.5,0),new it(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=Hr(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new ne,d=new it,p=new ne,f=new ne,g=new ne;let m=0,v=0;for(let x=0;x<=t.length-1;x++)switch(x){case 0:m=t[x+1].x-t[x].x,v=t[x+1].y-t[x].y,p.x=v*1,p.y=-m,p.z=v*0,g.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case t.length-1:l.push(g.x,g.y,g.z);break;default:m=t[x+1].x-t[x].x,v=t[x+1].y-t[x].y,p.x=v*1,p.y=-m,p.z=v*0,f.copy(p),p.x+=g.x,p.y+=g.y,p.z+=g.z,p.normalize(),l.push(p.x,p.y,p.z),g.copy(f)}for(let x=0;x<=i;x++){const y=r+x*u*n,_=Math.sin(y),A=Math.cos(y);for(let S=0;S<=t.length-1;S++){h.x=t[S].x*_,h.y=t[S].y,h.z=t[S].x*A,a.push(h.x,h.y,h.z),d.x=x/i,d.y=S/(t.length-1),o.push(d.x,d.y);const C=l[3*S+0]*_,M=l[3*S+1],E=l[3*S+0]*A;c.push(C,M,E)}}for(let x=0;x<i;x++)for(let y=0;y<t.length-1;y++){const _=y+x*t.length,A=_,S=_+t.length,C=_+t.length+1,M=_+1;s.push(A,S,M),s.push(C,M,S)}this.setIndex(s),this.setAttribute("position",new Ft(a,3)),this.setAttribute("uv",new Ft(o,2)),this.setAttribute("normal",new Ft(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new B0(t.points,t.segments,t.phiStart,t.phiLength)}}class Nw extends B0{constructor(t=1,i=1,r=4,n=8){const s=new qx;s.absarc(0,-i/2,t,Math.PI*1.5,0),s.absarc(0,i/2,t,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:t,height:i,capSegments:r,radialSegments:n}}static fromJSON(t){return new Nw(t.radius,t.length,t.capSegments,t.radialSegments)}}class Uw extends pi{constructor(t=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new ne,u=new it;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const p=r+h/i*n;c.x=t*Math.cos(p),c.y=t*Math.sin(p),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/t+1)/2,u.y=(a[d+1]/t+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Ft(a,3)),this.setAttribute("normal",new Ft(o,3)),this.setAttribute("uv",new Ft(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Uw(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class pm extends pi{constructor(t=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],p=[];let f=0;const g=[],m=r/2;let v=0;x(),a===!1&&(t>0&&y(!0),i>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new Ft(h,3)),this.setAttribute("normal",new Ft(d,3)),this.setAttribute("uv",new Ft(p,2));function x(){const _=new ne,A=new ne;let S=0;const C=(i-t)/r;for(let M=0;M<=s;M++){const E=[],P=M/s,R=P*(i-t)+t;for(let O=0;O<=n;O++){const L=O/n,I=L*l+o,z=Math.sin(I),K=Math.cos(I);A.x=R*z,A.y=-P*r+m,A.z=R*K,h.push(A.x,A.y,A.z),_.set(z,C,K).normalize(),d.push(_.x,_.y,_.z),p.push(L,1-P),E.push(f++)}g.push(E)}for(let M=0;M<n;M++)for(let E=0;E<s;E++){const P=g[E][M],R=g[E+1][M],O=g[E+1][M+1],L=g[E][M+1];u.push(P,R,L),u.push(R,O,L),S+=6}c.addGroup(v,S,0),v+=S}function y(_){const A=f,S=new it,C=new ne;let M=0;const E=_===!0?t:i,P=_===!0?1:-1;for(let O=1;O<=n;O++)h.push(0,m*P,0),d.push(0,P,0),p.push(.5,.5),f++;const R=f;for(let O=0;O<=n;O++){const I=O/n*l+o,z=Math.cos(I),K=Math.sin(I);C.x=E*K,C.y=m*P,C.z=E*z,h.push(C.x,C.y,C.z),d.push(0,P,0),S.x=z*.5+.5,S.y=K*.5*P+.5,p.push(S.x,S.y),f++}for(let O=0;O<n;O++){const L=A+O,I=R+O;_===!0?u.push(I,I+1,L):u.push(I+1,I,L),M+=3}c.addGroup(v,M,_===!0?1:2),v+=M}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pm(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class kw extends pm{constructor(t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new kw(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class dh extends pi{constructor(t=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new Ft(s,3)),this.setAttribute("normal",new Ft(s.slice(),3)),this.setAttribute("uv",new Ft(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(x){const y=new ne,_=new ne,A=new ne;for(let S=0;S<i.length;S+=3)p(i[S+0],y),p(i[S+1],_),p(i[S+2],A),l(y,_,A,x)}function l(x,y,_,A){const S=A+1,C=[];for(let M=0;M<=S;M++){C[M]=[];const E=x.clone().lerp(_,M/S),P=y.clone().lerp(_,M/S),R=S-M;for(let O=0;O<=R;O++)O===0&&M===S?C[M][O]=E:C[M][O]=E.clone().lerp(P,O/R)}for(let M=0;M<S;M++)for(let E=0;E<2*(S-M)-1;E++){const P=Math.floor(E/2);E%2===0?(d(C[M][P+1]),d(C[M+1][P]),d(C[M][P])):(d(C[M][P+1]),d(C[M+1][P+1]),d(C[M+1][P]))}}function c(x){const y=new ne;for(let _=0;_<s.length;_+=3)y.x=s[_+0],y.y=s[_+1],y.z=s[_+2],y.normalize().multiplyScalar(x),s[_+0]=y.x,s[_+1]=y.y,s[_+2]=y.z}function u(){const x=new ne;for(let y=0;y<s.length;y+=3){x.x=s[y+0],x.y=s[y+1],x.z=s[y+2];const _=m(x)/2/Math.PI+.5,A=v(x)/Math.PI+.5;a.push(_,1-A)}f(),h()}function h(){for(let x=0;x<a.length;x+=6){const y=a[x+0],_=a[x+2],A=a[x+4],S=Math.max(y,_,A),C=Math.min(y,_,A);S>.9&&C<.1&&(y<.2&&(a[x+0]+=1),_<.2&&(a[x+2]+=1),A<.2&&(a[x+4]+=1))}}function d(x){s.push(x.x,x.y,x.z)}function p(x,y){const _=x*3;y.x=t[_+0],y.y=t[_+1],y.z=t[_+2]}function f(){const x=new ne,y=new ne,_=new ne,A=new ne,S=new it,C=new it,M=new it;for(let E=0,P=0;E<s.length;E+=9,P+=6){x.set(s[E+0],s[E+1],s[E+2]),y.set(s[E+3],s[E+4],s[E+5]),_.set(s[E+6],s[E+7],s[E+8]),S.set(a[P+0],a[P+1]),C.set(a[P+2],a[P+3]),M.set(a[P+4],a[P+5]),A.copy(x).add(y).add(_).divideScalar(3);const R=m(A);g(S,P+0,x,R),g(C,P+2,y,R),g(M,P+4,_,R)}}function g(x,y,_,A){A<0&&x.x===1&&(a[y]=x.x-1),_.x===0&&_.z===0&&(a[y]=A/2/Math.PI+.5)}function m(x){return Math.atan2(x.z,-x.x)}function v(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new dh(t.vertices,t.indices,t.radius,t.details)}}class zw extends dh{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new zw(t.radius,t.detail)}}const sS=new ne,aS=new ne,$P=new ne,oS=new wa;class mJ extends pi{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const n=Math.pow(10,4),s=Math.cos(If*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},p=[];for(let f=0;f<l;f+=3){a?(c[0]=a.getX(f),c[1]=a.getX(f+1),c[2]=a.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);const{a:g,b:m,c:v}=oS;if(g.fromBufferAttribute(o,c[0]),m.fromBufferAttribute(o,c[1]),v.fromBufferAttribute(o,c[2]),oS.getNormal($P),h[0]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,h[1]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,h[2]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let x=0;x<3;x++){const y=(x+1)%3,_=h[x],A=h[y],S=oS[u[x]],C=oS[u[y]],M=`${_}_${A}`,E=`${A}_${_}`;E in d&&d[E]?($P.dot(d[E].normal)<=s&&(p.push(S.x,S.y,S.z),p.push(C.x,C.y,C.z)),d[E]=null):M in d||(d[M]={index0:c[x],index1:c[y],normal:$P.clone()})}}for(const f in d)if(d[f]){const{index0:g,index1:m}=d[f];sS.fromBufferAttribute(o,g),aS.fromBufferAttribute(o,m),p.push(sS.x,sS.y,sS.z),p.push(aS.x,aS.y,aS.z)}this.setAttribute("position",new Ft(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Of extends qx{constructor(t){super(t),this.uuid=$a(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(new qx().fromJSON(n))}return this}}const ffe={triangulate:function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let s=gJ(e,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=xfe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<n;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return Qx(s,a,i,o,l,p,0),a}};function gJ(e,t,i,r,n){let s,a;if(n===Dfe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=X5(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=X5(s,e[s],e[s+1],a);return a&&uT(a,a.next)&&(Kx(a),a=a.next),a}function Jf(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(uT(i,i.next)||Rr(i.prev,i,i.next)===0)){if(Kx(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Qx(e,t,i,r,n,s,a){if(!e)return;!a&&s&&Afe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?gfe(e,r,n,s):mfe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),Kx(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=vfe(Jf(e),t,i),Qx(e,t,i,r,n,s,2)):a===2&&yfe(e,t,i,r,n,s):Qx(Jf(e),t,i,r,n,s,1);break}}}function mfe(e){const t=e.prev,i=e,r=e.next;if(Rr(t,i,r)>=0)return!1;const n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&uv(n,o,s,l,a,c,f.x,f.y)&&Rr(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function gfe(e,t,i,r){const n=e.prev,s=e,a=e.next;if(Rr(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,g=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,v=fL(p,f,t,i,r),x=fL(g,m,t,i,r);let y=e.prevZ,_=e.nextZ;for(;y&&y.z>=v&&_&&_.z<=x;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==n&&y!==a&&uv(o,u,l,h,c,d,y.x,y.y)&&Rr(y.prev,y,y.next)>=0||(y=y.prevZ,_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&uv(o,u,l,h,c,d,_.x,_.y)&&Rr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==n&&y!==a&&uv(o,u,l,h,c,d,y.x,y.y)&&Rr(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&uv(o,u,l,h,c,d,_.x,_.y)&&Rr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function vfe(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!uT(n,s)&&vJ(n,r,r.next,s)&&Jx(n,s)&&Jx(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Kx(r),Kx(r.next),r=e=s),r=r.next}while(r!==e);return Jf(r)}function yfe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Cfe(a,o)){let l=yJ(a,o);a=Jf(a,a.next),l=Jf(l,l.next),Qx(a,t,i,r,n,s,0),Qx(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function xfe(e,t,i,r){const n=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=gJ(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(Efe(c));for(n.sort(wfe),s=0;s<n.length;s++)i=bfe(n[s],i);return i}function wfe(e,t){return e.x-t.x}function bfe(e,t){const i=_fe(e,t);if(!i)return t;const r=yJ(i,e);return Jf(r,r.next),Jf(i,i.next)}function _fe(e,t){let i=t,r=-1/0,n;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&uv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Jx(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Sfe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function Sfe(e,t){return Rr(e.prev,e,t.prev)<0&&Rr(t.next,e,e.next)<0}function Afe(e,t,i,r){let n=e;do n.z===0&&(n.z=fL(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Mfe(n)}function Mfe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function fL(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Efe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function uv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function Cfe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Tfe(e,t)&&(Jx(e,t)&&Jx(t,e)&&Pfe(e,t)&&(Rr(e.prev,e,t.prev)||Rr(e,t.prev,t))||uT(e,t)&&Rr(e.prev,e,e.next)>0&&Rr(t.prev,t,t.next)>0)}function Rr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function uT(e,t){return e.x===t.x&&e.y===t.y}function vJ(e,t,i,r){const n=cS(Rr(e,t,i)),s=cS(Rr(e,t,r)),a=cS(Rr(i,r,e)),o=cS(Rr(i,r,t));return!!(n!==s&&a!==o||n===0&&lS(e,i,t)||s===0&&lS(e,r,t)||a===0&&lS(i,e,r)||o===0&&lS(i,t,r))}function lS(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function cS(e){return e>0?1:e<0?-1:0}function Tfe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&vJ(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Jx(e,t){return Rr(e.prev,e,e.next)<0?Rr(e,t,e.next)>=0&&Rr(e,e.prev,t)>=0:Rr(e,t,e.prev)<0||Rr(e,e.next,t)<0}function Pfe(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function yJ(e,t){const i=new mL(e.i,e.x,e.y),r=new mL(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function X5(e,t,i,r){const n=new mL(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Kx(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function mL(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dfe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}class Pc{static area(t){const i=t.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=t[n].x*t[s].y-t[s].x*t[n].y;return r*.5}static isClockWise(t){return Pc.area(t)<0}static triangulateShape(t,i){const r=[],n=[],s=[];Y5(t),q5(r,t);let a=t.length;i.forEach(Y5);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,q5(r,i[l]);const o=ffe.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function Y5(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function q5(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class Vw extends pi{constructor(t=new Of([new it(.5,.5),new it(-.5,.5),new it(-.5,-.5),new it(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,n=[],s=[];for(let o=0,l=t.length;o<l;o++){const c=t[o];a(c)}this.setAttribute("position",new Ft(n,3)),this.setAttribute("uv",new Ft(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,p=i.bevelThickness!==void 0?i.bevelThickness:.2,f=i.bevelSize!==void 0?i.bevelSize:p-.1,g=i.bevelOffset!==void 0?i.bevelOffset:0,m=i.bevelSegments!==void 0?i.bevelSegments:3;const v=i.extrudePath,x=i.UVGenerator!==void 0?i.UVGenerator:Rfe;let y,_=!1,A,S,C,M;v&&(y=v.getSpacedPoints(u),_=!0,d=!1,A=v.computeFrenetFrames(u,!1),S=new ne,C=new ne,M=new ne),d||(m=0,p=0,f=0,g=0);const E=o.extractPoints(c);let P=E.shape;const R=E.holes;if(!Pc.isClockWise(P)){P=P.reverse();for(let ee=0,we=R.length;ee<we;ee++){const Ae=R[ee];Pc.isClockWise(Ae)&&(R[ee]=Ae.reverse())}}const L=Pc.triangulateShape(P,R),I=P;for(let ee=0,we=R.length;ee<we;ee++){const Ae=R[ee];P=P.concat(Ae)}function z(ee,we,Ae){return we||console.error("THREE.ExtrudeGeometry: vec does not exist"),ee.clone().addScaledVector(we,Ae)}const K=P.length,Y=L.length;function U(ee,we,Ae){let Te,Re,Xe;const Oe=ee.x-we.x,Be=ee.y-we.y,at=Ae.x-ee.x,ht=Ae.y-ee.y,se=Oe*Oe+Be*Be,N=Oe*ht-Be*at;if(Math.abs(N)>Number.EPSILON){const H=Math.sqrt(se),ve=Math.sqrt(at*at+ht*ht),X=we.x-Be/H,Ce=we.y+Oe/H,Ve=Ae.x-ht/ve,Ye=Ae.y+at/ve,_e=((Ve-X)*ht-(Ye-Ce)*at)/(Oe*ht-Be*at);Te=X+Oe*_e-ee.x,Re=Ce+Be*_e-ee.y;const Pe=Te*Te+Re*Re;if(Pe<=2)return new it(Te,Re);Xe=Math.sqrt(Pe/2)}else{let H=!1;Oe>Number.EPSILON?at>Number.EPSILON&&(H=!0):Oe<-Number.EPSILON?at<-Number.EPSILON&&(H=!0):Math.sign(Be)===Math.sign(ht)&&(H=!0),H?(Te=-Be,Re=Oe,Xe=Math.sqrt(se)):(Te=Oe,Re=Be,Xe=Math.sqrt(se/2))}return new it(Te/Xe,Re/Xe)}const j=[];for(let ee=0,we=I.length,Ae=we-1,Te=ee+1;ee<we;ee++,Ae++,Te++)Ae===we&&(Ae=0),Te===we&&(Te=0),j[ee]=U(I[ee],I[Ae],I[Te]);const k=[];let q,W=j.concat();for(let ee=0,we=R.length;ee<we;ee++){const Ae=R[ee];q=[];for(let Te=0,Re=Ae.length,Xe=Re-1,Oe=Te+1;Te<Re;Te++,Xe++,Oe++)Xe===Re&&(Xe=0),Oe===Re&&(Oe=0),q[Te]=U(Ae[Te],Ae[Xe],Ae[Oe]);k.push(q),W=W.concat(q)}for(let ee=0;ee<m;ee++){const we=ee/m,Ae=p*Math.cos(we*Math.PI/2),Te=f*Math.sin(we*Math.PI/2)+g;for(let Re=0,Xe=I.length;Re<Xe;Re++){const Oe=z(I[Re],j[Re],Te);he(Oe.x,Oe.y,-Ae)}for(let Re=0,Xe=R.length;Re<Xe;Re++){const Oe=R[Re];q=k[Re];for(let Be=0,at=Oe.length;Be<at;Be++){const ht=z(Oe[Be],q[Be],Te);he(ht.x,ht.y,-Ae)}}}const te=f+g;for(let ee=0;ee<K;ee++){const we=d?z(P[ee],W[ee],te):P[ee];_?(C.copy(A.normals[0]).multiplyScalar(we.x),S.copy(A.binormals[0]).multiplyScalar(we.y),M.copy(y[0]).add(C).add(S),he(M.x,M.y,M.z)):he(we.x,we.y,0)}for(let ee=1;ee<=u;ee++)for(let we=0;we<K;we++){const Ae=d?z(P[we],W[we],te):P[we];_?(C.copy(A.normals[ee]).multiplyScalar(Ae.x),S.copy(A.binormals[ee]).multiplyScalar(Ae.y),M.copy(y[ee]).add(C).add(S),he(M.x,M.y,M.z)):he(Ae.x,Ae.y,h/u*ee)}for(let ee=m-1;ee>=0;ee--){const we=ee/m,Ae=p*Math.cos(we*Math.PI/2),Te=f*Math.sin(we*Math.PI/2)+g;for(let Re=0,Xe=I.length;Re<Xe;Re++){const Oe=z(I[Re],j[Re],Te);he(Oe.x,Oe.y,h+Ae)}for(let Re=0,Xe=R.length;Re<Xe;Re++){const Oe=R[Re];q=k[Re];for(let Be=0,at=Oe.length;Be<at;Be++){const ht=z(Oe[Be],q[Be],Te);_?he(ht.x,ht.y+y[u-1].y,y[u-1].x+Ae):he(ht.x,ht.y,h+Ae)}}}G(),le();function G(){const ee=n.length/3;if(d){let we=0,Ae=K*we;for(let Te=0;Te<Y;Te++){const Re=L[Te];ye(Re[2]+Ae,Re[1]+Ae,Re[0]+Ae)}we=u+m*2,Ae=K*we;for(let Te=0;Te<Y;Te++){const Re=L[Te];ye(Re[0]+Ae,Re[1]+Ae,Re[2]+Ae)}}else{for(let we=0;we<Y;we++){const Ae=L[we];ye(Ae[2],Ae[1],Ae[0])}for(let we=0;we<Y;we++){const Ae=L[we];ye(Ae[0]+K*u,Ae[1]+K*u,Ae[2]+K*u)}}r.addGroup(ee,n.length/3-ee,0)}function le(){const ee=n.length/3;let we=0;Z(I,we),we+=I.length;for(let Ae=0,Te=R.length;Ae<Te;Ae++){const Re=R[Ae];Z(Re,we),we+=Re.length}r.addGroup(ee,n.length/3-ee,1)}function Z(ee,we){let Ae=ee.length;for(;--Ae>=0;){const Te=Ae;let Re=Ae-1;Re<0&&(Re=ee.length-1);for(let Xe=0,Oe=u+m*2;Xe<Oe;Xe++){const Be=K*Xe,at=K*(Xe+1),ht=we+Te+Be,se=we+Re+Be,N=we+Re+at,H=we+Te+at;de(ht,se,N,H)}}}function he(ee,we,Ae){l.push(ee),l.push(we),l.push(Ae)}function ye(ee,we,Ae){xe(ee),xe(we),xe(Ae);const Te=n.length/3,Re=x.generateTopUV(r,n,Te-3,Te-2,Te-1);me(Re[0]),me(Re[1]),me(Re[2])}function de(ee,we,Ae,Te){xe(ee),xe(we),xe(Te),xe(we),xe(Ae),xe(Te);const Re=n.length/3,Xe=x.generateSideWallUV(r,n,Re-6,Re-3,Re-2,Re-1);me(Xe[0]),me(Xe[1]),me(Xe[3]),me(Xe[1]),me(Xe[2]),me(Xe[3])}function xe(ee){n.push(l[ee*3+0]),n.push(l[ee*3+1]),n.push(l[ee*3+2])}function me(ee){s.push(ee.x),s.push(ee.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return Ife(i,r,t)}static fromJSON(t,i){const r=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];r.push(o)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new SN[n.type]().fromJSON(n)),new Vw(r,t.options)}}const Rfe={generateTopUV:function(e,t,i,r,n){const s=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],c=t[n*3],u=t[n*3+1];return[new it(s,a),new it(o,l),new it(c,u)]},generateSideWallUV:function(e,t,i,r,n,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],c=t[r*3],u=t[r*3+1],h=t[r*3+2],d=t[n*3],p=t[n*3+1],f=t[n*3+2],g=t[s*3],m=t[s*3+1],v=t[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new it(a,1-l),new it(c,1-h),new it(d,1-f),new it(g,1-v)]:[new it(o,1-l),new it(u,1-h),new it(p,1-f),new it(m,1-v)]}};function Ife(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const s=e[r];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class Gw extends dh{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new Gw(t.radius,t.detail)}}class F0 extends dh{constructor(t=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new F0(t.radius,t.detail)}}class Hw extends pi{constructor(t=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=t;const d=(i-t)/n,p=new ne,f=new it;for(let g=0;g<=n;g++){for(let m=0;m<=r;m++){const v=s+m/r*a;p.x=h*Math.cos(v),p.y=h*Math.sin(v),l.push(p.x,p.y,p.z),c.push(0,0,1),f.x=(p.x/i+1)/2,f.y=(p.y/i+1)/2,u.push(f.x,f.y)}h+=d}for(let g=0;g<n;g++){const m=g*(r+1);for(let v=0;v<r;v++){const x=v+m,y=x,_=x+r+1,A=x+r+2,S=x+1;o.push(y,_,S),o.push(_,A,S)}}this.setIndex(o),this.setAttribute("position",new Ft(l,3)),this.setAttribute("normal",new Ft(c,3)),this.setAttribute("uv",new Ft(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Hw(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class jw extends pi{constructor(t=new Of([new it(0,.5),new it(-.5,-.5),new it(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let u=0;u<t.length;u++)c(t[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new Ft(n,3)),this.setAttribute("normal",new Ft(s,3)),this.setAttribute("uv",new Ft(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let p=d.shape;const f=d.holes;Pc.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,v=f.length;m<v;m++){const x=f[m];Pc.isClockWise(x)===!0&&(f[m]=x.reverse())}const g=Pc.triangulateShape(p,f);for(let m=0,v=f.length;m<v;m++){const x=f[m];p=p.concat(x)}for(let m=0,v=p.length;m<v;m++){const x=p[m];n.push(x.x,x.y,0),s.push(0,0,1),a.push(x.x,x.y)}for(let m=0,v=g.length;m<v;m++){const x=g[m],y=x[0]+h,_=x[1]+h,A=x[2]+h;r.push(y,_,A),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return Lfe(i,t)}static fromJSON(t,i){const r=[];for(let n=0,s=t.shapes.length;n<s;n++){const a=i[t.shapes[n]];r.push(a)}return new jw(r,t.curveSegments)}}function Lfe(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class N0 extends pi{constructor(t=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new ne,d=new ne,p=[],f=[],g=[],m=[];for(let v=0;v<=r;v++){const x=[],y=v/r;let _=0;v===0&&a===0?_=.5/i:v===r&&l===Math.PI&&(_=-.5/i);for(let A=0;A<=i;A++){const S=A/i;h.x=-t*Math.cos(n+S*s)*Math.sin(a+y*o),h.y=t*Math.cos(a+y*o),h.z=t*Math.sin(n+S*s)*Math.sin(a+y*o),f.push(h.x,h.y,h.z),d.copy(h).normalize(),g.push(d.x,d.y,d.z),m.push(S+_,1-y),x.push(c++)}u.push(x)}for(let v=0;v<r;v++)for(let x=0;x<i;x++){const y=u[v][x+1],_=u[v][x],A=u[v+1][x],S=u[v+1][x+1];(v!==0||a>0)&&p.push(y,_,S),(v!==r-1||l<Math.PI)&&p.push(_,A,S)}this.setIndex(p),this.setAttribute("position",new Ft(f,3)),this.setAttribute("normal",new Ft(g,3)),this.setAttribute("uv",new Ft(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new N0(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ww extends dh{constructor(t=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new Ww(t.radius,t.detail)}}class Xw extends pi{constructor(t=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new ne,h=new ne,d=new ne;for(let p=0;p<=r;p++)for(let f=0;f<=n;f++){const g=f/n*s,m=p/r*Math.PI*2;h.x=(t+i*Math.cos(m))*Math.cos(g),h.y=(t+i*Math.cos(m))*Math.sin(g),h.z=i*Math.sin(m),o.push(h.x,h.y,h.z),u.x=t*Math.cos(g),u.y=t*Math.sin(g),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(f/n),c.push(p/r)}for(let p=1;p<=r;p++)for(let f=1;f<=n;f++){const g=(n+1)*p+f-1,m=(n+1)*(p-1)+f-1,v=(n+1)*(p-1)+f,x=(n+1)*p+f;a.push(g,m,x),a.push(m,v,x)}this.setIndex(a),this.setAttribute("position",new Ft(o,3)),this.setAttribute("normal",new Ft(l,3)),this.setAttribute("uv",new Ft(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Xw(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Yw extends pi{constructor(t=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new ne,d=new ne,p=new ne,f=new ne,g=new ne,m=new ne,v=new ne;for(let y=0;y<=r;++y){const _=y/r*s*Math.PI*2;x(_,s,a,t,p),x(_+.01,s,a,t,f),m.subVectors(f,p),v.addVectors(f,p),g.crossVectors(m,v),v.crossVectors(g,m),g.normalize(),v.normalize();for(let A=0;A<=n;++A){const S=A/n*Math.PI*2,C=-i*Math.cos(S),M=i*Math.sin(S);h.x=p.x+(C*v.x+M*g.x),h.y=p.y+(C*v.y+M*g.y),h.z=p.z+(C*v.z+M*g.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(y/r),u.push(A/n)}}for(let y=1;y<=r;y++)for(let _=1;_<=n;_++){const A=(n+1)*(y-1)+(_-1),S=(n+1)*y+(_-1),C=(n+1)*y+_,M=(n+1)*(y-1)+_;o.push(A,S,M),o.push(S,C,M)}this.setIndex(o),this.setAttribute("position",new Ft(l,3)),this.setAttribute("normal",new Ft(c,3)),this.setAttribute("uv",new Ft(u,2));function x(y,_,A,S,C){const M=Math.cos(y),E=Math.sin(y),P=A/_*y,R=Math.cos(P);C.x=S*(2+R)*.5*M,C.y=S*(2+R)*E*.5,C.z=S*Math.sin(P)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Yw(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class qw extends pi{constructor(t=new bN(new ne(-1,-1,0),new ne(-1,1,0),new ne(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new ne,l=new ne,c=new it;let u=new ne;const h=[],d=[],p=[],f=[];g(),this.setIndex(f),this.setAttribute("position",new Ft(h,3)),this.setAttribute("normal",new Ft(d,3)),this.setAttribute("uv",new Ft(p,2));function g(){for(let y=0;y<i;y++)m(y);m(s===!1?i:0),x(),v()}function m(y){u=t.getPointAt(y/i,u);const _=a.normals[y],A=a.binormals[y];for(let S=0;S<=n;S++){const C=S/n*Math.PI*2,M=Math.sin(C),E=-Math.cos(C);l.x=E*_.x+M*A.x,l.y=E*_.y+M*A.y,l.z=E*_.z+M*A.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function v(){for(let y=1;y<=i;y++)for(let _=1;_<=n;_++){const A=(n+1)*(y-1)+(_-1),S=(n+1)*y+(_-1),C=(n+1)*y+_,M=(n+1)*(y-1)+_;f.push(A,S,M),f.push(S,C,M)}}function x(){for(let y=0;y<=i;y++)for(let _=0;_<=n;_++)c.x=y/i,c.y=_/n,p.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new qw(new SN[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class xJ extends pi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],r=new Set,n=new ne,s=new ne;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,p=h.count;for(let f=d,g=d+p;f<g;f+=3)for(let m=0;m<3;m++){const v=o.getX(f+m),x=o.getX(f+(m+1)%3);n.fromBufferAttribute(a,v),s.fromBufferAttribute(a,x),Q5(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),Q5(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ft(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Q5(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var J5=Object.freeze({__proto__:null,BoxGeometry:rp,CapsuleGeometry:Nw,CircleGeometry:Uw,ConeGeometry:kw,CylinderGeometry:pm,DodecahedronGeometry:zw,EdgesGeometry:mJ,ExtrudeGeometry:Vw,IcosahedronGeometry:Gw,LatheGeometry:B0,OctahedronGeometry:F0,PlaneGeometry:L0,PolyhedronGeometry:dh,RingGeometry:Hw,ShapeGeometry:jw,SphereGeometry:N0,TetrahedronGeometry:Ww,TorusGeometry:Xw,TorusKnotGeometry:Yw,TubeGeometry:qw,WireframeGeometry:xJ});class wJ extends yn{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new bt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class bJ extends Nc{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Qw extends yn{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new bt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ip,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class qo extends Qw{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new it(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new bt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new bt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new bt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class _J extends yn{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new bt(16777215),this.specular=new bt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ip,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Rw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class SJ extends yn{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new bt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ip,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class AJ extends yn{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ip,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class MJ extends yn{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ip,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Rw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class EJ extends yn{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new bt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ip,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class CJ extends ks{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Co(e,t,i){return AN(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function mf(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function AN(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function TJ(e){function t(n,s){return e[n]-e[s]}const i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function gL(e,t,i){const r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function MN(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}function Ofe(e,t,i,r,n=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let p=0;p<c.times.length;++p){const f=c.times[p]*n;if(!(f<i||f>=r)){h.push(c.times[p]);for(let g=0;g<u;++g)d.push(c.values[p*u+g])}}h.length!==0&&(c.times=mf(h,c.times.constructor),c.values=mf(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function Bfe(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,s=t/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=e.tracks.find(function(v){return v.name===o.name&&v.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let g;if(s<=o.times[0]){const v=u,x=h-u;g=Co(o.values,v,x)}else if(s>=o.times[f]){const v=f*h+u,x=v+h-u;g=Co(o.values,v,x)}else{const v=o.createInterpolant(),x=u,y=h-u;v.evaluate(s),g=Co(v.resultBuffer,x,y)}l==="quaternion"&&new ts().fromArray(g).normalize().conjugate().toArray(g);const m=c.times.length;for(let v=0;v<m;++v){const x=v*p+d;if(l==="quaternion")ts.multiplyQuaternionsFlat(c.values,x,g,0,c.values,x);else{const y=p-d*2;for(let _=0;_<y;++_)c.values[x+_]-=g[_]}}}return e.blendMode=JF,e}const Ffe={arraySlice:Co,convertArray:mf,isTypedArray:AN,getKeyframeOrder:TJ,sortedArray:gL,flattenJSON:MN,subclip:Ofe,makeClipAdditive:Bfe};class U0{constructor(t,i,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(t<n)){for(let o=r+2;;){if(n===void 0){if(t<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],t<n)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],t>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;t<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class PJ extends U0{constructor(t,i,r,n){super(t,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:df,endingEnd:df}}intervalChanged_(t,i,r){const n=this.parameterPositions;let s=t-2,a=t+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case pf:s=t,o=2*i-r;break;case jx:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=t,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case pf:a=t,l=2*r-i;break;case jx:a=1,l=r+n[1]-n[0];break;default:a=t-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(r-i)/(n-i),g=f*f,m=g*f,v=-d*m+2*d*g-d*f,x=(1+d)*m+(-1.5-2*d)*g+(-.5+d)*f+1,y=(-1-p)*m+(1.5+p)*g+.5*f,_=p*m-p*g;for(let A=0;A!==o;++A)s[A]=v*a[u+A]+x*a[c+A]+y*a[l+A]+_*a[h+A];return s}}class EN extends U0{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class DJ extends U0{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Vl{constructor(t,i,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=mf(i,this.TimeBufferType),this.values=mf(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(t);else{r={name:t.name,times:mf(t.times,Array),values:mf(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(r.interpolation=n)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new DJ(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new EN(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new PJ(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case n0:i=this.InterpolantFactoryMethodDiscrete;break;case qf:i=this.InterpolantFactoryMethodLinear;break;case mM:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return n0;case this.InterpolantFactoryMethodLinear:return qf;case this.InterpolantFactoryMethodSmooth:return mM}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=t}return this}trim(t,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<t;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=Co(r,s,a),this.values=Co(this.values,s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(n!==void 0&&AN(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t}optimize(){const t=Co(this.times),i=Co(this.values),r=this.getValueSize(),n=this.getInterpolation()===mM,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=t[o],u=t[o+1];if(c!==u&&(o!==1||c!==t[0]))if(n)l=!0;else{const h=o*r,d=h-r,p=h+r;for(let f=0;f!==r;++f){const g=i[h+f];if(g!==i[d+f]||g!==i[p+f]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*r,d=a*r;for(let p=0;p!==r;++p)i[d+p]=i[h+p]}++a}}if(s>0){t[a]=t[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==t.length?(this.times=Co(t,0,a),this.values=Co(i,0,a*r)):(this.times=t,this.values=i),this}clone(){const t=Co(this.times,0),i=Co(this.values,0),r=this.constructor,n=new r(this.name,t,i);return n.createInterpolant=this.createInterpolant,n}}Vl.prototype.TimeBufferType=Float32Array;Vl.prototype.ValueBufferType=Float32Array;Vl.prototype.DefaultInterpolation=qf;class fm extends Vl{}fm.prototype.ValueTypeName="bool";fm.prototype.ValueBufferType=Array;fm.prototype.DefaultInterpolation=n0;fm.prototype.InterpolantFactoryMethodLinear=void 0;fm.prototype.InterpolantFactoryMethodSmooth=void 0;class CN extends Vl{}CN.prototype.ValueTypeName="color";class Kf extends Vl{}Kf.prototype.ValueTypeName="number";class RJ extends U0{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=t*o;for(let u=c+o;c!==u;c+=4)ts.slerpFlat(s,0,a,c-o,a,c,l);return s}}class Xd extends Vl{InterpolantFactoryMethodLinear(t){return new RJ(this.times,this.values,this.getValueSize(),t)}}Xd.prototype.ValueTypeName="quaternion";Xd.prototype.DefaultInterpolation=qf;Xd.prototype.InterpolantFactoryMethodSmooth=void 0;class mm extends Vl{}mm.prototype.ValueTypeName="string";mm.prototype.ValueBufferType=Array;mm.prototype.DefaultInterpolation=n0;mm.prototype.InterpolantFactoryMethodLinear=void 0;mm.prototype.InterpolantFactoryMethodSmooth=void 0;class Zf extends Vl{}Zf.prototype.ValueTypeName="vector";class o0{constructor(t,i=-1,r,n=tT){this.name=t,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=$a(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],r=t.tracks,n=1/(t.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(Ufe(r[a]).scale(n));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(Vl.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(t,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=TJ(l);l=gL(l,1,u),c=gL(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Kf(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(t,-1,a)}static findByName(t,i){let r=t;if(!Array.isArray(t)){const n=t;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(t,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const c=t[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,p,f,g){if(p.length!==0){const m=[],v=[];MN(p,m,v,f),m.length!==0&&g.push(new h(d,m,v))}},n=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let g=0;g<d[f].morphTargets.length;g++)p[d[f].morphTargets[g]]=-1;for(const g in p){const m=[],v=[];for(let x=0;x!==d[f].morphTargets.length;++x){const y=d[f];m.push(y.time),v.push(y.morphTarget===g?1:0)}n.push(new Kf(".morphTargetInfluence["+g+"]",m,v))}l=p.length*a}else{const p=".bones["+i[h].name+"]";r(Zf,p+".position",d,"pos",n),r(Xd,p+".quaternion",d,"rot",n),r(Zf,p+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const t=this.tracks;let i=0;for(let r=0,n=t.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Nfe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Kf;case"vector":case"vector2":case"vector3":case"vector4":return Zf;case"color":return CN;case"quaternion":return Xd;case"bool":case"boolean":return fm;case"string":return mm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Ufe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=Nfe(e.type);if(e.times===void 0){const i=[],r=[];MN(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const $f={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class TN{constructor(t,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],f=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return f}return null}}}const hv=new TN;class zs{constructor(t){this.manager=t!==void 0?t:hv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(n,s){r.load(t,n,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const su={};class kfe extends Error{constructor(t,i){super(t),this.response=i}}class aa extends zs{constructor(t){super(t)}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=$f.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(su[t]!==void 0){su[t].push({onLoad:i,onProgress:r,onError:n});return}su[t]=[],su[t].push({onLoad:i,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=su[t],h=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),p=d?parseInt(d):0,f=p!==0;let g=0;const m=new ReadableStream({start(v){x();function x(){h.read().then(({done:y,value:_})=>{if(y)v.close();else{g+=_.byteLength;const A=new ProgressEvent("progress",{lengthComputable:f,loaded:g,total:p});for(let S=0,C=u.length;S<C;S++){const M=u[S];M.onProgress&&M.onProgress(A)}v.enqueue(_),x()}})}}});return new Response(m)}else throw new kfe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(f=>p.decode(f))}}}).then(c=>{$f.add(t,c);const u=su[t];delete su[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=su[t];if(u===void 0)throw this.manager.itemError(t),c;delete su[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class zfe extends zs{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new aa(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=[];for(let r=0;r<t.length;r++){const n=o0.parse(t[r]);i.push(n)}return i}}class Vfe extends zs{constructor(t){super(t)}load(t,i,r,n){const s=this,a=[],o=new vN,l=new aa(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(t[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=Dr),o.image=a,o.format=p.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)u(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let f=0;f<p;f++){a[f]={mipmaps:[]};for(let g=0;g<d.mipmapCount;g++)a[f].mipmaps.push(d.mipmaps[f*d.mipmapCount+g]),a[f].format=d.format,a[f].width=d.width,a[f].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=Dr),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class Zx extends zs{constructor(t){super(t)}load(t,i,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=$f.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=Yx("img");function l(){u(),$f.add(t,this),i&&i(this),s.manager.itemEnd(t)}function c(h){u(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class Gfe extends zs{constructor(t){super(t)}load(t,i,r,n){const s=new Lw;s.colorSpace=hi;const a=new Zx(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(t[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<t.length;++c)l(c);return s}}class Hfe extends zs{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Iv,o=new aa(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){const c=s.parse(l);c&&(c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:ds,a.wrapT=c.wrapT!==void 0?c.wrapT:ds,a.magFilter=c.magFilter!==void 0?c.magFilter:Dr,a.minFilter=c.minFilter!==void 0?c.minFilter:Dr,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?a.colorSpace=c.colorSpace:c.encoding!==void 0&&(a.encoding=c.encoding),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Fc),c.mipmapCount===1&&(a.minFilter=Dr),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c))},r,n),a}}class Jw extends zs{constructor(t){super(t)}load(t,i,r,n){const s=new mr,a=new Zx(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class np extends Oi{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new bt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class IJ extends np{constructor(t,i,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new bt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const eD=new ri,K5=new ne,Z5=new ne;class PN{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new it(512,512),this.map=null,this.mapPass=null,this.matrix=new ri,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rT,this._frameExtents=new it(1,1),this._viewportCount=1,this._viewports=[new Zi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,r=this.matrix;K5.setFromMatrixPosition(t.matrixWorld),i.position.copy(K5),Z5.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(Z5),i.updateMatrixWorld(),eD.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eD),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(eD)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class jfe extends PN{constructor(){super(new Mr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,r=s0*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class DN extends np{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.target=new Oi,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new jfe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const $5=new ri,zy=new ne,tD=new ne;class Wfe extends PN{constructor(){super(new Mr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new it(4,2),this._viewportCount=6,this._viewports=[new Zi(2,1,1,1),new Zi(0,1,1,1),new Zi(3,1,1,1),new Zi(1,1,1,1),new Zi(3,0,1,1),new Zi(1,0,1,1)],this._cubeDirections=[new ne(1,0,0),new ne(-1,0,0),new ne(0,0,1),new ne(0,0,-1),new ne(0,1,0),new ne(0,-1,0)],this._cubeUps=[new ne(0,1,0),new ne(0,1,0),new ne(0,1,0),new ne(0,1,0),new ne(0,0,1),new ne(0,0,-1)]}updateMatrices(t,i=0){const r=this.camera,n=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),zy.setFromMatrixPosition(t.matrixWorld),r.position.copy(zy),tD.copy(r.position),tD.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(tD),r.updateMatrixWorld(),n.makeTranslation(-zy.x,-zy.y,-zy.z),$5.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix($5)}}class RN extends np{constructor(t,i,r=0,n=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new Wfe}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Xfe extends PN{constructor(){super(new Pl(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class IN extends np{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.target=new Oi,this.shadow=new Xfe}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class LJ extends np{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class OJ extends np{constructor(t,i,r=10,n=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class BJ{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ne)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,i+n*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,i+n*3);return t}static getBasisAt(t,i){const r=t.x,n=t.y,s=t.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class hT extends np{constructor(t=new BJ,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class dT extends zs{constructor(t){super(t),this.textures={}}load(t,i,r,n){const s=this,a=new aa(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=dT.createMaterialFromType(t.type);if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=t.sheen),t.sheenColor!==void 0&&(n.sheenColor=new bt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(n.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(t.specular),t.specularIntensity!==void 0&&(n.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(n.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(n.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(n.transmission=t.transmission),t.thickness!==void 0&&(n.thickness=t.thickness),t.attenuationDistance!==void 0&&(n.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(n.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(n.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.shadowSide!==void 0&&(n.shadowSide=t.shadowSide),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==1&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(n.dithering=t.dithering),t.alphaToCoverage!==void 0&&(n.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(n.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new bt().setHex(a.value);break;case"v2":n.uniforms[s].value=new it().fromArray(a.value);break;case"v3":n.uniforms[s].value=new ne().fromArray(a.value);break;case"v4":n.uniforms[s].value=new Zi().fromArray(a.value);break;case"m3":n.uniforms[s].value=new wi().fromArray(a.value);break;case"m4":n.uniforms[s].value=new ri().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(n.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)n.extensions[s]=t.extensions[s];if(t.lights!==void 0&&(n.lights=t.lights),t.clipping!==void 0&&(n.clipping=t.clipping),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new it().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(n.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new it().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(n.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(n.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(n.thicknessMap=r(t.thicknessMap)),t.anisotropyMap!==void 0&&(n.anisotropyMap=r(t.anisotropyMap)),t.sheenColorMap!==void 0&&(n.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const i={ShadowMaterial:wJ,SpriteMaterial:dN,RawShaderMaterial:bJ,ShaderMaterial:Nc,PointsMaterial:Fw,MeshPhysicalMaterial:qo,MeshStandardMaterial:Qw,MeshPhongMaterial:_J,MeshToonMaterial:SJ,MeshNormalMaterial:AJ,MeshLambertMaterial:MJ,MeshDepthMaterial:cN,MeshDistanceMaterial:uN,MeshBasicMaterial:Ja,MeshMatcapMaterial:EJ,LineDashedMaterial:CJ,LineBasicMaterial:ks,Material:yn};return new i[t]}}class Id{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let r=0,n=t.length;r<n;r++)i+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class FJ extends pi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class NJ extends zs{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new aa(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i={},r={};function n(p,f){if(i[f]!==void 0)return i[f];const m=p.interleavedBuffers[f],v=s(p,m.buffer),x=lv(m.type,v),y=new Ow(x,m.stride);return y.uuid=m.uuid,i[f]=y,y}function s(p,f){if(r[f]!==void 0)return r[f];const m=p.arrayBuffers[f],v=new Uint32Array(m).buffer;return r[f]=v,v}const a=t.isInstancedBufferGeometry?new FJ:new pi,o=t.data.index;if(o!==void 0){const p=lv(o.type,o.array);a.setIndex(new Ui(p,1))}const l=t.data.attributes;for(const p in l){const f=l[p];let g;if(f.isInterleavedBufferAttribute){const m=n(t.data,f.data);g=new Wd(m,f.itemSize,f.offset,f.normalized)}else{const m=lv(f.type,f.array),v=f.isInstancedBufferAttribute?Qf:Ui;g=new v(m,f.itemSize,f.normalized)}f.name!==void 0&&(g.name=f.name),f.usage!==void 0&&g.setUsage(f.usage),f.updateRange!==void 0&&(g.updateRange.offset=f.updateRange.offset,g.updateRange.count=f.updateRange.count),a.setAttribute(p,g)}const c=t.data.morphAttributes;if(c)for(const p in c){const f=c[p],g=[];for(let m=0,v=f.length;m<v;m++){const x=f[m];let y;if(x.isInterleavedBufferAttribute){const _=n(t.data,x.data);y=new Wd(_,x.itemSize,x.offset,x.normalized)}else{const _=lv(x.type,x.array);y=new Ui(_,x.itemSize,x.normalized)}x.name!==void 0&&(y.name=x.name),g.push(y)}a.morphAttributes[p]=g}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let p=0,f=h.length;p!==f;++p){const g=h[p];a.addGroup(g.start,g.count,g.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const p=new ne;d.center!==void 0&&p.fromArray(d.center),a.boundingSphere=new Yo(p,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class Yfe extends zs{constructor(t){super(t)}load(t,i,r,n){const s=this,a=this.path===""?Id.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new aa(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(c,i)},r,n)}async loadAsync(t,i){const r=this,n=this.path===""?Id.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const s=new aa(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(o)}parse(t,i){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,s,l,o,r),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(t){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,n,o,a,i),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(t){const i={};if(t!==void 0)for(let r=0,n=t.length;r<n;r++){const s=new Of().fromJSON(t[r]);i[s.uuid]=s}return i}parseSkeletons(t,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new Bw().fromJSON(t[s],n);r[o.uuid]=o}return r}parseGeometries(t,i){const r={};if(t!==void 0){const n=new NJ;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in J5?o=J5[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(t,i){const r={},n={};if(t!==void 0){const s=new dT;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(t){const i={};if(t!==void 0)for(let r=0;r<t.length;r++){const n=t[r],s=o0.parse(n);i[s.uuid]=s}return i}parseImages(t,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:lv(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new TN(i);s=new Zx(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.url;if(Array.isArray(d)){const p=[];for(let f=0,g=d.length;f<g;f++){const m=d[f],v=o(m);v!==null&&(v instanceof HTMLImageElement?p.push(v):p.push(new Iv(v.data,v.width,v.height)))}n[h.uuid]=new ff(p)}else{const p=o(h.url);n[h.uuid]=new ff(p)}}}return n}async parseImagesAsync(t){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:lv(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){n=new Zx(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h],f=await s(p);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new Iv(f.data,f.width,f.height)))}r[l.uuid]=new ff(u)}else{const u=await s(l.url);r[l.uuid]=new ff(u)}}}return r}parseTextures(t,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new Lw,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Iv:u=new mr,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,qfe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],eG),u.wrapT=r(o.wrap[1],eG)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.encoding!==void 0&&(u.encoding=o.encoding),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,tG)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,tG)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(t,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let f=0,g=d.length;f<g;f++){const m=d[f];r[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),p.push(r[m])}return p}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(t.type){case"Scene":a=new mE,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new bt(t.background):a.background=c(t.background)),t.environment!==void 0&&(a.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new aT(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new sT(t.fog.color,t.fog.density))),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":a=new Mr(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new Pl(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new LJ(t.color,t.intensity);break;case"DirectionalLight":a=new IN(t.color,t.intensity);break;case"PointLight":a=new RN(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new OJ(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new DN(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new IJ(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new hT().fromJSON(t);break;case"SkinnedMesh":u=o(t.geometry),h=l(t.material),a=new pN(u,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),h=l(t.material),a=new Ln(u,h);break;case"InstancedMesh":u=o(t.geometry),h=l(t.material);const d=t.count,p=t.instanceMatrix,f=t.instanceColor;a=new fN(u,h,d),a.instanceMatrix=new Qf(new Float32Array(p.array),16),f!==void 0&&(a.instanceColor=new Qf(new Float32Array(f.array),f.itemSize));break;case"LOD":a=new cJ;break;case"Line":a=new ih(o(t.geometry),l(t.material));break;case"LineLoop":a=new mN(o(t.geometry),l(t.material));break;case"LineSegments":a=new kl(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new gN(o(t.geometry),l(t.material));break;case"Sprite":a=new lJ(l(t.material));break;case"Group":a=new Fu;break;case"Bone":a=new oT;break;default:a=new Oi}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],i,r,n,s))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const f=d[p];a.animations.push(s[f])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let p=0;p<d.length;p++){const f=d[p],g=a.getObjectByProperty("uuid",f.object);g!==void 0&&a.addLevel(g,f.distance,f.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}}const qfe={UVMapping:ZC,CubeReflectionMapping:Gd,CubeRefractionMapping:Hd,EquirectangularReflectionMapping:Vx,EquirectangularRefractionMapping:Gx,CubeUVReflectionMapping:I0},eG={RepeatWrapping:jd,ClampToEdgeWrapping:ds,MirroredRepeatWrapping:i0},tG={NearestFilter:Gr,NearestMipmapNearestFilter:Hx,NearestMipmapLinearFilter:Dv,LinearFilter:Dr,LinearMipmapNearestFilter:$C,LinearMipmapLinearFilter:Fc};class UJ extends zs{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=$f.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){$f.add(t,l),i&&i(l),s.manager.itemEnd(t)}).catch(function(l){n&&n(l),s.manager.itemError(t),s.manager.itemEnd(t)}),s.manager.itemStart(t)}}let uS,LN=class{static getContext(){return uS===void 0&&(uS=new(window.AudioContext||window.webkitAudioContext)),uS}static setContext(t){uS=t}};class Qfe extends zs{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new aa(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{const c=l.slice(0);LN.getContext().decodeAudioData(c,function(h){i(h)},o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(t)}}}class Jfe extends hT{constructor(t,i,r=1){super(void 0,r),this.isHemisphereLightProbe=!0;const n=new bt().set(t),s=new bt().set(i),a=new ne(n.r,n.g,n.b),o=new ne(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(c)}}class Kfe extends hT{constructor(t,i=1){super(void 0,i),this.isAmbientLightProbe=!0;const r=new bt().set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const iG=new ri,rG=new ri,Mp=new ri;class Zfe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Mr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Mr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,Mp.copy(t.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(If*i.fov*.5)/i.zoom;let o,l;rG.elements[12]=-n,iG.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Mp.elements[0]=2*i.near/(l-o),Mp.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Mp),o=-a*i.aspect-s,l=a*i.aspect-s,Mp.elements[0]=2*i.near/(l-o),Mp.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Mp)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(rG),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(iG)}}class ON{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nG(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=nG();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function nG(){return(typeof performance>"u"?Date:performance).now()}const Ep=new ne,sG=new ts,$fe=new ne,Cp=new ne;class eme extends Oi{constructor(){super(),this.type="AudioListener",this.context=LN.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ON}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ep,sG,$fe),Cp.set(0,0,-1).applyQuaternion(sG),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Ep.x,n),i.positionY.linearRampToValueAtTime(Ep.y,n),i.positionZ.linearRampToValueAtTime(Ep.z,n),i.forwardX.linearRampToValueAtTime(Cp.x,n),i.forwardY.linearRampToValueAtTime(Cp.y,n),i.forwardZ.linearRampToValueAtTime(Cp.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Ep.x,Ep.y,Ep.z),i.setOrientation(Cp.x,Cp.y,Cp.z,r.x,r.y,r.z)}}class kJ extends Oi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Tp=new ne,aG=new ts,tme=new ne,Pp=new ne;class ime extends kJ{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Tp,aG,tme),Pp.set(0,0,1).applyQuaternion(aG);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Tp.x,r),i.positionY.linearRampToValueAtTime(Tp.y,r),i.positionZ.linearRampToValueAtTime(Tp.z,r),i.orientationX.linearRampToValueAtTime(Pp.x,r),i.orientationY.linearRampToValueAtTime(Pp.y,r),i.orientationZ.linearRampToValueAtTime(Pp.z,r)}else i.setPosition(Tp.x,Tp.y,Tp.z),i.setOrientation(Pp.x,Pp.y,Pp.z)}}class rme{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)t+=i[r];return t/i.length}}class zJ{constructor(t,i,r){this.binding=t,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const r=this.buffer,n=this.valueSize,s=t*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,r=this.buffer,n=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let r=t;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[t+r]}_select(t,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)t[i+a]=t[r+a]}_slerp(t,i,r,n){ts.slerpFlat(t,i,t,i,t,r,n)}_slerpAdditive(t,i,r,n,s){const a=this._workIndex*s;ts.multiplyQuaternionsFlat(t,a,t,i,t,r),ts.slerpFlat(t,i,t,i,t,a,n)}_lerp(t,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[r+o]*n}}_lerpAdditive(t,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[r+a]*n}}}const BN="\\[\\]\\.:\\/",nme=new RegExp("["+BN+"]","g"),FN="[^"+BN+"]",sme="[^"+BN.replace("\\.","")+"]",ame=/((?:WC+[\/:])*)/.source.replace("WC",FN),ome=/(WCOD+)?/.source.replace("WCOD",sme),lme=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",FN),cme=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",FN),ume=new RegExp("^"+ame+ome+lme+cme+"$"),hme=["material","materials","bones","map"];class dme{constructor(t,i,r){const n=r||Ni.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,n)}getValue(t,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,i)}setValue(t,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].unbind()}}class Ni{constructor(t,i,r){this.path=i,this.parsedPath=r||Ni.parseTrackName(i),this.node=Ni.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new Ni.Composite(t,i,r):new Ni(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(nme,"")}static parseTrackName(t){const i=ume.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);hme.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)t[i++]=r[n]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(t||(t=Ni.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===c){c=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const a=t[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ni.Composite=dme;Ni.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ni.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ni.prototype.GetterByBindingType=[Ni.prototype._getValue_direct,Ni.prototype._getValue_array,Ni.prototype._getValue_arrayElement,Ni.prototype._getValue_toArray];Ni.prototype.SetterByBindingTypeAndVersioning=[[Ni.prototype._setValue_direct,Ni.prototype._setValue_direct_setNeedsUpdate,Ni.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_array,Ni.prototype._setValue_array_setNeedsUpdate,Ni.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_arrayElement,Ni.prototype._setValue_arrayElement_setNeedsUpdate,Ni.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ni.prototype._setValue_fromArray,Ni.prototype._setValue_fromArray_setNeedsUpdate,Ni.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class pme{constructor(){this.isAnimationObjectGroup=!0,this.uuid=$a(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,n=arguments.length;r!==n;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],p=d.uuid;let f=i[p];if(f===void 0){f=l++,i[p]=f,t.push(d);for(let g=0,m=a;g!==m;++g)s[g].push(new Ni(d,r[g],n[g]))}else if(f<c){o=t[f];const g=--c,m=t[g];i[m.uuid]=f,t[f]=m,i[p]=g,t[g]=d;for(let v=0,x=a;v!==x;++v){const y=s[v],_=y[g];let A=y[f];y[f]=_,A===void 0&&(A=new Ni(d,r[v],n[v])),y[g]=A}}else t[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=t[h];i[d.uuid]=u,t[u]=d,i[c]=h,t[h]=l;for(let p=0,f=n;p!==f;++p){const g=r[p],m=g[h],v=g[u];g[u]=m,g[h]=v}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,p=t[d],f=--a,g=t[f];i[p.uuid]=h,t[h]=p,i[g.uuid]=d,t[d]=g,t.pop();for(let m=0,v=n;m!==v;++m){const x=r[m],y=x[d],_=x[f];x[h]=y,x[d]=_,x.pop()}}else{const d=--a,p=t[d];d>0&&(i[p.uuid]=h),t[h]=p,t.pop();for(let f=0,g=n;f!==g;++f){const m=r[f];m[h]=m[d],m.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const r=this._bindingsIndicesByPath;let n=r[t];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[t]=n,a.push(t),o.push(i),s.push(h);for(let d=u,p=l.length;d!==p;++d){const f=l[d];h[d]=new Ni(f,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,r=i[t];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=t[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class VJ{constructor(t,i,r=null,n=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:df,endingEnd:df};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=IQ,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=t._clip.duration,a=s/n,o=n/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=t/a,c[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case JF:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case tT:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let n=this.time+t,s=this._loopCount;const a=r===LQ;if(t===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===RQ){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(t,i,r){const n=this._interpolantSettings;r?(n.endingStart=pf,n.endingEnd=pf):(t?n.endingStart=this.zeroSlopeAtStart?pf:df:n.endingStart=jx,i?n.endingEnd=this.zeroSlopeAtEnd?pf:df:n.endingEnd=jx)}_scheduleFading(t,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=r,this}}const fme=new Float32Array(1);class mme extends hh{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const r=t._localRoot||this._root,n=t._clip.tracks,s=n.length,a=t._propertyBindings,o=t._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],p=d.name;let f=u[p];if(f!==void 0)++f.referenceCount,a[h]=f;else{if(f=a[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const g=i&&i._propertyBindings[h].binding.parsedPath;f=new zJ(Ni.create(r,p,g),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),a[h]=f}o[h].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,r)}const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackAction(t){const i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_addInactiveBinding(t,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,r=t.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=t._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(t){const i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackBinding(t){const i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=t[i];return r===void 0&&(r=new EN(new Float32Array(2),new Float32Array(2),1,fme),r.__cacheIndex=i,t[i]=r),r}_takeBackControlInterpolant(t){const i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];t.__cacheIndex=n,i[n]=t,s.__cacheIndex=r,i[r]=s}clipAction(t,i,r){const n=i||this._root,s=n.uuid;let a=typeof t=="string"?o0.findByName(n,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=tT),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new VJ(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(t,i){const r=i||this._root,n=r.uuid,s=typeof t=="string"?o0.findByName(r,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,r=t.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(t){const i=t.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const r=this.existingAction(t,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class NN{constructor(t){this.value=t}clone(){return new NN(this.value.clone===void 0?this.value:this.value.clone())}}let gme=0;class vme extends hh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:gme++}),this.name="",this.usage=Wx,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++)this.uniforms.push(i[r].clone());return this}clone(){return new this.constructor().copy(this)}}class yme extends Ow{constructor(t,i,r=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class xme{constructor(t,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class GJ{constructor(t,i,r=0,n=1/0){this.ray=new hm(t,i),this.near=r,this.far=n,this.camera=null,this.layers=new Lf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(t,i=!0,r=[]){return vL(t,this,r,i),r.sort(oG),r}intersectObjects(t,i=!0,r=[]){for(let n=0,s=t.length;n<s;n++)vL(t[n],this,r,i);return r.sort(oG),r}}function oG(e,t){return e.distance-t.distance}function vL(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){const n=e.children;for(let s=0,a=n.length;s<a;s++)vL(n[s],t,i,!0)}}class yL{constructor(t=1,i=0,r=0){return this.radius=t,this.phi=i,this.theta=r,this}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(Hr(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class wme{constructor(t=1,i=0,r=0){return this.radius=t,this.theta=i,this.y=r,this}set(t,i,r){return this.radius=t,this.theta=i,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const lG=new it;class bme{constructor(t=new it(1/0,1/0),i=new it(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=lG.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,lG).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const cG=new ne,hS=new ne;class _me{constructor(t=new ne,i=new ne){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){cG.subVectors(t,this.start),hS.subVectors(this.end,this.start);const r=hS.dot(hS);let s=hS.dot(cG)/r;return i&&(s=Hr(s,0,1)),s}closestPointToPoint(t,i,r){const n=this.closestPointToPointParameter(t,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const uG=new ne;class Sme extends Oi{constructor(t,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new pi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new Ft(n,3));const s=new ks({fog:!1,toneMapped:!1});this.cone=new kl(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),uG.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(uG),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Dh=new ne,dS=new ri,iD=new ri;class Ame extends kl{constructor(t){const i=HJ(t),r=new pi,n=[],s=[],a=new bt(0,0,1),o=new bt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new Ft(n,3)),r.setAttribute("color",new Ft(s,3));const l=new ks({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,n=r.getAttribute("position");iD.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(dS.multiplyMatrices(iD,o.matrixWorld),Dh.setFromMatrixPosition(dS),n.setXYZ(a,Dh.x,Dh.y,Dh.z),dS.multiplyMatrices(iD,o.parent.matrixWorld),Dh.setFromMatrixPosition(dS),n.setXYZ(a+1,Dh.x,Dh.y,Dh.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function HJ(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,HJ(e.children[i]));return t}class Mme extends Ln{constructor(t,i,r){const n=new N0(i,4,2),s=new Ja({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Eme=new ne,hG=new bt,dG=new bt;class Cme extends Oi{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new F0(i);n.rotateY(Math.PI*.5),this.material=new Ja({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new Ui(a,3)),this.add(new Ln(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");hG.copy(this.light.color),dG.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?hG:dG;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(Eme.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Tme extends kl{constructor(t=10,i=10,r=4473924,n=8947848){r=new bt(r),n=new bt(n);const s=i/2,a=t/i,o=t/2,l=[],c=[];for(let d=0,p=0,f=-o;d<=i;d++,f+=a){l.push(-o,0,f,o,0,f),l.push(f,0,-o,f,0,o);const g=d===s?r:n;g.toArray(c,p),p+=3,g.toArray(c,p),p+=3,g.toArray(c,p),p+=3,g.toArray(c,p),p+=3}const u=new pi;u.setAttribute("position",new Ft(l,3)),u.setAttribute("color",new Ft(c,3));const h=new ks({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Pme extends kl{constructor(t=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new bt(s),a=new bt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),p=Math.sin(d)*t,f=Math.cos(d)*t;o.push(0,0,0),o.push(p,0,f);const g=h&1?s:a;l.push(g.r,g.g,g.b),l.push(g.r,g.g,g.b)}for(let h=0;h<r;h++){const d=h&1?s:a,p=t-t/r*h;for(let f=0;f<n;f++){let g=f/n*(Math.PI*2),m=Math.sin(g)*p,v=Math.cos(g)*p;o.push(m,0,v),l.push(d.r,d.g,d.b),g=(f+1)/n*(Math.PI*2),m=Math.sin(g)*p,v=Math.cos(g)*p,o.push(m,0,v),l.push(d.r,d.g,d.b)}}const c=new pi;c.setAttribute("position",new Ft(o,3)),c.setAttribute("color",new Ft(l,3));const u=new ks({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const pG=new ne,pS=new ne,fG=new ne;class Dme extends Oi{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new pi;n.setAttribute("position",new Ft([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new ks({fog:!1,toneMapped:!1});this.lightPlane=new ih(n,s),this.add(this.lightPlane),n=new pi,n.setAttribute("position",new Ft([0,0,0,0,0,1],3)),this.targetLine=new ih(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),pG.setFromMatrixPosition(this.light.matrixWorld),pS.setFromMatrixPosition(this.light.target.matrixWorld),fG.subVectors(pS,pG),this.lightPlane.lookAt(pS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(pS),this.targetLine.scale.z=fG.length()}}const fS=new ne,Ur=new Iw;class Rme extends kl{constructor(t){const i=new pi,r=new ks({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(f,g){l(f),l(g)}function l(f){n.push(0,0,0),s.push(0,0,0),a[f]===void 0&&(a[f]=[]),a[f].push(n.length/3-1)}i.setAttribute("position",new Ft(n,3)),i.setAttribute("color",new Ft(s,3)),super(i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new bt(16755200),u=new bt(16711680),h=new bt(43775),d=new bt(16777215),p=new bt(3355443);this.setColors(c,u,h,d,p)}setColors(t,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,r=1,n=1;Ur.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Jr("c",i,t,Ur,0,0,-1),Jr("t",i,t,Ur,0,0,1),Jr("n1",i,t,Ur,-r,-n,-1),Jr("n2",i,t,Ur,r,-n,-1),Jr("n3",i,t,Ur,-r,n,-1),Jr("n4",i,t,Ur,r,n,-1),Jr("f1",i,t,Ur,-r,-n,1),Jr("f2",i,t,Ur,r,-n,1),Jr("f3",i,t,Ur,-r,n,1),Jr("f4",i,t,Ur,r,n,1),Jr("u1",i,t,Ur,r*.7,n*1.1,-1),Jr("u2",i,t,Ur,-r*.7,n*1.1,-1),Jr("u3",i,t,Ur,0,n*2,-1),Jr("cf1",i,t,Ur,-r,0,1),Jr("cf2",i,t,Ur,r,0,1),Jr("cf3",i,t,Ur,0,-n,1),Jr("cf4",i,t,Ur,0,n,1),Jr("cn1",i,t,Ur,-r,0,-1),Jr("cn2",i,t,Ur,r,0,-1),Jr("cn3",i,t,Ur,0,-n,-1),Jr("cn4",i,t,Ur,0,n,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Jr(e,t,i,r,n,s,a){fS.set(n,s,a).unproject(r);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],fS.x,fS.y,fS.z)}}const mS=new Ul;class Ime extends kl{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new pi;s.setIndex(new Ui(r,1)),s.setAttribute("position",new Ui(n,3)),super(s,new ks({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&mS.setFromObject(this.object),mS.isEmpty())return;const i=mS.min,r=mS.max,n=this.geometry.attributes.position,s=n.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=i.x,s[4]=r.y,s[5]=r.z,s[6]=i.x,s[7]=i.y,s[8]=r.z,s[9]=r.x,s[10]=i.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=i.z,s[15]=i.x,s[16]=r.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=r.x,s[22]=i.y,s[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Lme extends kl{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new pi;s.setIndex(new Ui(r,1)),s.setAttribute("position",new Ft(n,3)),super(s,new ks({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ome extends ih{constructor(t,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new pi;a.setAttribute("position",new Ft(s,3)),a.computeBoundingSphere(),super(a,new ks({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new pi;l.setAttribute("position",new Ft(o,3)),l.computeBoundingSphere(),this.add(new Ln(l,new Ja({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const mG=new ne;let gS,rD;class Bme extends Oi{constructor(t=new ne(0,0,1),i=new ne(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",gS===void 0&&(gS=new pi,gS.setAttribute("position",new Ft([0,0,0,0,1,0],3)),rD=new pm(0,.5,1,5,1),rD.translate(0,-.5,0)),this.position.copy(i),this.line=new ih(gS,new ks({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ln(rD,new Ja({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{mG.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(mG,i)}}setLength(t,i=t*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Fme extends kl{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new pi;n.setAttribute("position",new Ft(i,3)),n.setAttribute("color",new Ft(r,3));const s=new ks({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(t,i,r){const n=new bt,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Nme{constructor(){this.type="ShapePath",this.color=new bt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new qx,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,r,n){return this.currentPath.quadraticCurveTo(t,i,r,n),this}bezierCurveTo(t,i,r,n,s,a){return this.currentPath.bezierCurveTo(t,i,r,n,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(v){const x=[];for(let y=0,_=v.length;y<_;y++){const A=v[y],S=new Of;S.curves=A.curves,x.push(S)}return x}function r(v,x){const y=x.length;let _=!1;for(let A=y-1,S=0;S<y;A=S++){let C=x[A],M=x[S],E=M.x-C.x,P=M.y-C.y;if(Math.abs(P)>Number.EPSILON){if(P<0&&(C=x[S],E=-E,M=x[A],P=-P),v.y<C.y||v.y>M.y)continue;if(v.y===C.y){if(v.x===C.x)return!0}else{const R=P*(v.x-C.x)-E*(v.y-C.y);if(R===0)return!0;if(R<0)continue;_=!_}}else{if(v.y!==C.y)continue;if(M.x<=v.x&&v.x<=C.x||C.x<=v.x&&v.x<=M.x)return!0}}return _}const n=Pc.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new Of,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=t?!u:u;const h=[],d=[];let p=[],f=0,g;d[f]=void 0,p[f]=[];for(let v=0,x=s.length;v<x;v++)o=s[v],g=o.getPoints(),a=n(g),a=t?!a:a,a?(!u&&d[f]&&f++,d[f]={s:new Of,p:g},d[f].s.curves=o.curves,u&&f++,p[f]=[]):p[f].push({h:o,p:g[0]});if(!d[0])return i(s);if(d.length>1){let v=!1,x=0;for(let y=0,_=d.length;y<_;y++)h[y]=[];for(let y=0,_=d.length;y<_;y++){const A=p[y];for(let S=0;S<A.length;S++){const C=A[S];let M=!0;for(let E=0;E<d.length;E++)r(C.p,d[E].p)&&(y!==E&&x++,M?(M=!1,h[E].push(C)):v=!0);M&&h[y].push(C)}}x>0&&v===!1&&(p=h)}let m;for(let v=0,x=d.length;v<x;v++){l=d[v].s,c.push(l),m=p[v];for(let y=0,_=m.length;y<_;y++)l.holes.push(m[y].h)}return c}}class Ume extends rp{constructor(t,i,r,n,s,a){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(t,i,r,n,s,a)}}class kme extends Nw{constructor(t,i,r,n){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(t,i,r,n)}}class zme extends Uw{constructor(t,i,r,n){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(t,i,r,n)}}class Vme extends kw{constructor(t,i,r,n,s,a,o){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(t,i,r,n,s,a,o)}}class Gme extends pm{constructor(t,i,r,n,s,a,o,l){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(t,i,r,n,s,a,o,l)}}class Hme extends zw{constructor(t,i){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(t,i)}}class jme extends Vw{constructor(t,i){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(t,i)}}class Wme extends Gw{constructor(t,i){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(t,i)}}class Xme extends B0{constructor(t,i,r,n){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(t,i,r,n)}}class Yme extends F0{constructor(t,i){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(t,i)}}class qme extends L0{constructor(t,i,r,n){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(t,i,r,n)}}class Qme extends dh{constructor(t,i,r,n){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(t,i,r,n)}}class Jme extends Hw{constructor(t,i,r,n,s,a){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(t,i,r,n,s,a)}}class Kme extends jw{constructor(t,i){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(t,i)}}class Zme extends N0{constructor(t,i,r,n,s,a,o){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(t,i,r,n,s,a,o)}}class $me extends Ww{constructor(t,i){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(t,i)}}class ege extends Xw{constructor(t,i,r,n,s){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(t,i,r,n,s)}}class tge extends Yw{constructor(t,i,r,n,s,a){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(t,i,r,n,s,a)}}class ige extends qw{constructor(t,i,r,n,s){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(t,i,r,n,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:R0}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=R0);const rge=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:HF,AddEquation:$p,AddOperation:vQ,AdditiveAnimationBlendMode:JF,AdditiveBlending:BI,AlphaFormat:AQ,AlwaysCompare:XQ,AlwaysDepth:uQ,AlwaysStencilFunc:UQ,AmbientLight:LJ,AmbientLightProbe:Kfe,AnimationAction:VJ,AnimationClip:o0,AnimationLoader:zfe,AnimationMixer:mme,AnimationObjectGroup:pme,AnimationUtils:Ffe,ArcCurve:uJ,ArrayCamera:nJ,ArrowHelper:Bme,Audio:kJ,AudioAnalyser:rme,AudioContext:LN,AudioListener:eme,AudioLoader:Qfe,AxesHelper:Fme,BackSide:sa,BasicDepthPacking:BQ,BasicShadowMap:Jq,Bone:oT,BooleanKeyframeTrack:fm,Box2:bme,Box3:Ul,Box3Helper:Lme,BoxBufferGeometry:Ume,BoxGeometry:rp,BoxHelper:Ime,BufferAttribute:Ui,BufferGeometry:pi,BufferGeometryLoader:NJ,ByteType:_Q,Cache:$f,Camera:Iw,CameraHelper:Rme,CanvasTexture:afe,CapsuleBufferGeometry:kme,CapsuleGeometry:Nw,CatmullRomCurve3:hJ,CineonToneMapping:wQ,CircleBufferGeometry:zme,CircleGeometry:Uw,ClampToEdgeWrapping:ds,Clock:ON,Color:bt,ColorKeyframeTrack:CN,ColorManagement:So,CompressedArrayTexture:sfe,CompressedTexture:vN,CompressedTextureLoader:Vfe,ConeBufferGeometry:Vme,ConeGeometry:kw,CubeCamera:aN,CubeReflectionMapping:Gd,CubeRefractionMapping:Hd,CubeTexture:Lw,CubeTextureLoader:Gfe,CubeUVReflectionMapping:I0,CubicBezierCurve:xN,CubicBezierCurve3:dJ,CubicInterpolant:PJ,CullFaceBack:OI,CullFaceFront:Qq,CullFaceFrontBack:ole,CullFaceNone:qq,Curve:zl,CurvePath:fJ,CustomBlending:Kq,CustomToneMapping:bQ,CylinderBufferGeometry:Gme,CylinderGeometry:pm,Cylindrical:wme,Data3DTexture:rN,DataArrayTexture:iT,DataTexture:Iv,DataTextureLoader:Hfe,DataUtils:mce,DecrementStencilOp:gle,DecrementWrapStencilOp:yle,DefaultLoadingManager:hv,DepthFormat:Pd,DepthStencilFormat:Yf,DepthTexture:sJ,DirectionalLight:IN,DirectionalLightHelper:Dme,DiscreteInterpolant:DJ,DisplayP3ColorSpace:$F,DodecahedronBufferGeometry:Hme,DodecahedronGeometry:zw,DoubleSide:Bo,DstAlphaFactor:nQ,DstColorFactor:aQ,DynamicCopyUsage:Ile,DynamicDrawUsage:Rf,DynamicReadUsage:Ple,EdgesGeometry:mJ,EllipseCurve:lT,EqualCompare:VQ,EqualDepth:dQ,EqualStencilFunc:_le,EquirectangularReflectionMapping:Vx,EquirectangularRefractionMapping:Gx,Euler:dm,EventDispatcher:hh,ExtrudeBufferGeometry:jme,ExtrudeGeometry:Vw,FileLoader:aa,Float16BufferAttribute:bce,Float32BufferAttribute:Ft,Float64BufferAttribute:_ce,FloatType:_c,Fog:aT,FogExp2:sT,FramebufferTexture:nfe,FrontSide:Bc,Frustum:rT,GLBufferAttribute:xme,GLSL1:Ole,GLSL3:cL,GreaterCompare:HQ,GreaterDepth:fQ,GreaterEqualCompare:WQ,GreaterEqualDepth:pQ,GreaterEqualStencilFunc:Ele,GreaterStencilFunc:Ale,GridHelper:Tme,Group:Fu,HalfFloatType:r0,HemisphereLight:IJ,HemisphereLightHelper:Cme,HemisphereLightProbe:Jfe,IcosahedronBufferGeometry:Wme,IcosahedronGeometry:Gw,ImageBitmapLoader:UJ,ImageLoader:Zx,ImageUtils:iN,IncrementStencilOp:mle,IncrementWrapStencilOp:vle,InstancedBufferAttribute:Qf,InstancedBufferGeometry:FJ,InstancedInterleavedBuffer:yme,InstancedMesh:fN,Int16BufferAttribute:xce,Int32BufferAttribute:wce,Int8BufferAttribute:gce,IntType:jF,InterleavedBuffer:Ow,InterleavedBufferAttribute:Wd,Interpolant:U0,InterpolateDiscrete:n0,InterpolateLinear:qf,InterpolateSmooth:mM,InvertStencilOp:xle,KeepStencilOp:gM,KeyframeTrack:Vl,LOD:cJ,LatheBufferGeometry:Xme,LatheGeometry:B0,Layers:Lf,LessCompare:zQ,LessDepth:hQ,LessEqualCompare:GQ,LessEqualDepth:hE,LessEqualStencilFunc:Sle,LessStencilFunc:ble,Light:np,LightProbe:hT,Line:ih,Line3:_me,LineBasicMaterial:ks,LineCurve:cT,LineCurve3:pJ,LineDashedMaterial:CJ,LineLoop:mN,LineSegments:kl,LinearEncoding:ZF,LinearFilter:Dr,LinearInterpolant:EN,LinearMipMapLinearFilter:dle,LinearMipMapNearestFilter:hle,LinearMipmapLinearFilter:Fc,LinearMipmapNearestFilter:$C,LinearSRGBColorSpace:jo,LinearToneMapping:yQ,Loader:zs,LoaderUtils:Id,LoadingManager:TN,LoopOnce:RQ,LoopPingPong:LQ,LoopRepeat:IQ,LuminanceAlphaFormat:EQ,LuminanceFormat:MQ,MOUSE:jp,Material:yn,MaterialLoader:dT,MathUtils:tN,Matrix3:wi,Matrix4:ri,MaxEquation:kI,Mesh:Ln,MeshBasicMaterial:Ja,MeshDepthMaterial:cN,MeshDistanceMaterial:uN,MeshLambertMaterial:MJ,MeshMatcapMaterial:EJ,MeshNormalMaterial:AJ,MeshPhongMaterial:_J,MeshPhysicalMaterial:qo,MeshStandardMaterial:Qw,MeshToonMaterial:SJ,MinEquation:UI,MirroredRepeatWrapping:i0,MixOperation:gQ,MultiplyBlending:NI,MultiplyOperation:Rw,NearestFilter:Gr,NearestMipMapLinearFilter:ule,NearestMipMapNearestFilter:cle,NearestMipmapLinearFilter:Dv,NearestMipmapNearestFilter:Hx,NeverCompare:kQ,NeverDepth:cQ,NeverStencilFunc:wle,NoBlending:Wu,NoColorSpace:Rd,NoToneMapping:Tl,NormalAnimationBlendMode:tT,NormalBlending:Df,NotEqualCompare:jQ,NotEqualDepth:mQ,NotEqualStencilFunc:Mle,NumberKeyframeTrack:Kf,Object3D:Oi,ObjectLoader:Yfe,ObjectSpaceNormalMap:NQ,OctahedronBufferGeometry:Yme,OctahedronGeometry:F0,OneFactor:tQ,OneMinusDstAlphaFactor:sQ,OneMinusDstColorFactor:oQ,OneMinusSrcAlphaFactor:GF,OneMinusSrcColorFactor:rQ,OrthographicCamera:Pl,PCFShadowMap:KC,PCFSoftShadowMap:Z1,PMREMGenerator:hL,Path:qx,PerspectiveCamera:Mr,Plane:Mu,PlaneBufferGeometry:qme,PlaneGeometry:L0,PlaneHelper:Ome,PointLight:RN,PointLightHelper:Mme,Points:gN,PointsMaterial:Fw,PolarGridHelper:Pme,PolyhedronBufferGeometry:Qme,PolyhedronGeometry:dh,PositionalAudio:ime,PropertyBinding:Ni,PropertyMixer:zJ,QuadraticBezierCurve:wN,QuadraticBezierCurve3:bN,Quaternion:ts,QuaternionKeyframeTrack:Xd,QuaternionLinearInterpolant:RJ,RED_GREEN_RGTC2_Format:oL,RED_RGTC1_Format:DQ,REVISION:R0,RGBADepthPacking:FQ,RGBAFormat:Sa,RGBAIntegerFormat:QF,RGBA_ASTC_10x10_Format:rL,RGBA_ASTC_10x5_Format:eL,RGBA_ASTC_10x6_Format:tL,RGBA_ASTC_10x8_Format:iL,RGBA_ASTC_12x10_Format:nL,RGBA_ASTC_12x12_Format:sL,RGBA_ASTC_4x4_Format:XI,RGBA_ASTC_5x4_Format:YI,RGBA_ASTC_5x5_Format:qI,RGBA_ASTC_6x5_Format:QI,RGBA_ASTC_6x6_Format:JI,RGBA_ASTC_8x5_Format:KI,RGBA_ASTC_8x6_Format:ZI,RGBA_ASTC_8x8_Format:$I,RGBA_BPTC_Format:fM,RGBA_ETC2_EAC_Format:WI,RGBA_PVRTC_2BPPV1_Format:HI,RGBA_PVRTC_4BPPV1_Format:GI,RGBA_S3TC_DXT1_Format:hM,RGBA_S3TC_DXT3_Format:dM,RGBA_S3TC_DXT5_Format:pM,RGB_ETC1_Format:PQ,RGB_ETC2_Format:jI,RGB_PVRTC_2BPPV1_Format:VI,RGB_PVRTC_4BPPV1_Format:zI,RGB_S3TC_DXT1_Format:uM,RGFormat:TQ,RGIntegerFormat:qF,RawShaderMaterial:bJ,Ray:hm,Raycaster:GJ,RectAreaLight:OJ,RedFormat:CQ,RedIntegerFormat:YF,ReinhardToneMapping:xQ,RepeatWrapping:jd,ReplaceStencilOp:fle,ReverseSubtractEquation:$q,RingBufferGeometry:Jme,RingGeometry:Hw,SIGNED_RED_GREEN_RGTC2_Format:lL,SIGNED_RED_RGTC1_Format:aL,SRGBColorSpace:hi,Scene:mE,ShaderChunk:xi,ShaderLib:xl,ShaderMaterial:Nc,ShadowMaterial:wJ,Shape:Of,ShapeBufferGeometry:Kme,ShapeGeometry:jw,ShapePath:Nme,ShapeUtils:Pc,ShortType:SQ,Skeleton:Bw,SkeletonHelper:Ame,SkinnedMesh:pN,Source:ff,Sphere:Yo,SphereBufferGeometry:Zme,SphereGeometry:N0,Spherical:yL,SphericalHarmonics3:BJ,SplineCurve:_N,SpotLight:DN,SpotLightHelper:Sme,Sprite:lJ,SpriteMaterial:dN,SrcAlphaFactor:VF,SrcAlphaSaturateFactor:lQ,SrcColorFactor:iQ,StaticCopyUsage:Rle,StaticDrawUsage:Wx,StaticReadUsage:Tle,StereoCamera:Zfe,StreamCopyUsage:Lle,StreamDrawUsage:Cle,StreamReadUsage:Dle,StringKeyframeTrack:mm,SubtractEquation:Zq,SubtractiveBlending:FI,TOUCH:Wp,TangentSpaceNormalMap:ip,TetrahedronBufferGeometry:$me,TetrahedronGeometry:Ww,Texture:mr,TextureLoader:Jw,TorusBufferGeometry:ege,TorusGeometry:Xw,TorusKnotBufferGeometry:tge,TorusKnotGeometry:Yw,Triangle:wa,TriangleFanDrawMode:dE,TriangleStripDrawMode:KF,TrianglesDrawMode:OQ,TubeBufferGeometry:ige,TubeGeometry:qw,TwoPassDoubleSide:lle,UVMapping:ZC,Uint16BufferAttribute:nN,Uint32BufferAttribute:sN,Uint8BufferAttribute:vce,Uint8ClampedBufferAttribute:yce,Uniform:NN,UniformsGroup:vme,UniformsLib:wt,UniformsUtils:KQ,UnsignedByteType:Tc,UnsignedInt248Type:Td,UnsignedIntType:Bu,UnsignedShort4444Type:WF,UnsignedShort5551Type:XF,UnsignedShortType:eT,VSMShadowMap:gl,Vector2:it,Vector3:ne,Vector4:Zi,VectorKeyframeTrack:Zf,VideoTexture:rfe,WebGL1Renderer:aJ,WebGL3DRenderTarget:nce,WebGLArrayRenderTarget:rce,WebGLCoordinateSystem:Sc,WebGLCubeRenderTarget:oN,WebGLMultipleRenderTargets:sce,WebGLRenderTarget:Ll,WebGLRenderer:hN,WebGLUtils:rJ,WebGPUCoordinateSystem:Xx,WireframeGeometry:xJ,WrapAroundEnding:jx,ZeroCurvatureEnding:df,ZeroFactor:eQ,ZeroSlopeEnding:pf,ZeroStencilOp:ple,_SRGBAFormat:pE,sRGBEncoding:Dd},Symbol.toStringTag,{value:"Module"}));var jJ={exports:{}},gm={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */gm.ConcurrentRoot=1;gm.ContinuousEventPriority=4;gm.DefaultEventPriority=16;gm.DiscreteEventPriority=1;gm.IdleEventPriority=536870912;gm.LegacyRoot=0;jJ.exports=gm;var dv=jJ.exports;function nge(e){let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(h!==t){const d=t;t=u?h:Object.assign({},t,h),i.forEach(p=>p(t,d))}},n=()=>t,s=(c,u=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(t);function p(){const f=u(t);if(!h(d,f)){const g=d;c(d=f,g)}}return i.add(p),()=>i.delete(p)},l={setState:r,getState:n,subscribe:(c,u,h)=>u||h?s(c,u,h):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}const sge=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),gG=sge?fe.useEffect:fe.useLayoutEffect;function age(e){const t=typeof e=="function"?nge(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=fe.useReducer(m=>m+1,0),a=t.getState(),o=fe.useRef(a),l=fe.useRef(r),c=fe.useRef(n),u=fe.useRef(!1),h=fe.useRef();h.current===void 0&&(h.current=r(a));let d,p=!1;(o.current!==a||l.current!==r||c.current!==n||u.current)&&(d=r(a),p=!n(h.current,d)),gG(()=>{p&&(h.current=d),o.current=a,l.current=r,c.current=n,u.current=!1});const f=fe.useRef(a);gG(()=>{const m=()=>{try{const x=t.getState(),y=l.current(x);c.current(h.current,y)||(o.current=x,h.current=y,s())}catch{u.current=!0,s()}},v=t.subscribe(m);return t.getState()!==f.current&&m(),v},[]);const g=p?d:h.current;return fe.useDebugValue(g),g};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}const oge=e=>typeof e=="object"&&typeof e.then=="function",gf=[];function WJ(e,t,i=(r,n)=>r===n){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let n=0;n<r;n++)if(!i(e[n],t[n]))return!1;return!0}function XJ(e,t=null,i=!1,r={}){t===null&&(t=[e]);for(const s of gf)if(WJ(t,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!i)throw s.promise}const n={keys:t,equal:r.equal,remove:()=>{const s=gf.indexOf(n);s!==-1&&gf.splice(s,1)},promise:(oge(e)?e:e(...t)).then(s=>{n.response=s,r.lifespan&&r.lifespan>0&&(n.timeout=setTimeout(n.remove,r.lifespan))}).catch(s=>n.error=s)};if(gf.push(n),!i)throw n.promise}const lge=(e,t,i)=>XJ(e,t,!1,i),cge=(e,t,i)=>void XJ(e,t,!0,i),uge=e=>{if(e===void 0||e.length===0)gf.splice(0,gf.length);else{const t=gf.find(i=>WJ(e,i.keys,i.equal));t&&t.remove()}};var YJ={exports:{}},qJ={exports:{}},QJ={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(U,j){var k=U.length;U.push(j);e:for(;0<k;){var q=k-1>>>1,W=U[q];if(0<n(W,j))U[q]=j,U[k]=W,k=q;else break e}}function i(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var j=U[0],k=U.pop();if(k!==j){U[0]=k;e:for(var q=0,W=U.length,te=W>>>1;q<te;){var G=2*(q+1)-1,le=U[G],Z=G+1,he=U[Z];if(0>n(le,k))Z<W&&0>n(he,le)?(U[q]=he,U[Z]=k,q=Z):(U[q]=le,U[G]=k,q=G);else if(Z<W&&0>n(he,k))U[q]=he,U[Z]=k,q=Z;else break e}}return j}function n(U,j){var k=U.sortIndex-j.sortIndex;return k!==0?k:U.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(U){for(var j=i(c);j!==null;){if(j.callback===null)r(c);else if(j.startTime<=U)r(c),j.sortIndex=j.expirationTime,t(l,j);else break;j=i(c)}}function _(U){if(g=!1,y(U),!f)if(i(l)!==null)f=!0,K(A);else{var j=i(c);j!==null&&Y(_,j.startTime-U)}}function A(U,j){f=!1,g&&(g=!1,v(M),M=-1),p=!0;var k=d;try{for(y(j),h=i(l);h!==null&&(!(h.expirationTime>j)||U&&!R());){var q=h.callback;if(typeof q=="function"){h.callback=null,d=h.priorityLevel;var W=q(h.expirationTime<=j);j=e.unstable_now(),typeof W=="function"?h.callback=W:h===i(l)&&r(l),y(j)}else r(l);h=i(l)}if(h!==null)var te=!0;else{var G=i(c);G!==null&&Y(_,G.startTime-j),te=!1}return te}finally{h=null,d=k,p=!1}}var S=!1,C=null,M=-1,E=5,P=-1;function R(){return!(e.unstable_now()-P<E)}function O(){if(C!==null){var U=e.unstable_now();P=U;var j=!0;try{j=C(!0,U)}finally{j?L():(S=!1,C=null)}}else S=!1}var L;if(typeof x=="function")L=function(){x(O)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,z=I.port2;I.port1.onmessage=O,L=function(){z.postMessage(null)}}else L=function(){m(O,0)};function K(U){C=U,S||(S=!0,L())}function Y(U,j){M=m(function(){U(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(U){U.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,K(A))},e.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<U?Math.floor(1e3/U):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(U){switch(d){case 1:case 2:case 3:var j=3;break;default:j=d}var k=d;d=j;try{return U()}finally{d=k}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(U,j){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var k=d;d=U;try{return j()}finally{d=k}},e.unstable_scheduleCallback=function(U,j,k){var q=e.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?q+k:q):k=q,U){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=k+W,U={id:u++,callback:j,priorityLevel:U,startTime:k,expirationTime:W,sortIndex:-1},k>q?(U.sortIndex=k,t(c,U),i(l)===null&&U===i(c)&&(g?(v(M),M=-1):g=!0,Y(_,k-q))):(U.sortIndex=W,t(l,U),f||p||(f=!0,K(A))),U},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(U){var j=d;return function(){var k=d;d=j;try{return U.apply(this,arguments)}finally{d=k}}}})(QJ);qJ.exports=QJ;var xL=qJ.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hge=function(t){var i={},r=fe,n=xL,s=Object.assign;function a(w){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+w,T=1;T<arguments.length;T++)b+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+w+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),_=Symbol.for("react.offscreen"),A=Symbol.iterator;function S(w){return w===null||typeof w!="object"?null:(w=A&&w[A]||w["@@iterator"],typeof w=="function"?w:null)}function C(w){if(w==null)return null;if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w;switch(w){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case v:return"SuspenseList"}if(typeof w=="object")switch(w.$$typeof){case f:return(w.displayName||"Context")+".Consumer";case p:return(w._context.displayName||"Context")+".Provider";case g:var b=w.render;return w=w.displayName,w||(w=b.displayName||b.name||"",w=w!==""?"ForwardRef("+w+")":"ForwardRef"),w;case x:return b=w.displayName||null,b!==null?b:C(w.type)||"Memo";case y:b=w._payload,w=w._init;try{return C(w(b))}catch{}}return null}function M(w){var b=w.type;switch(w.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return w=b.render,w=w.displayName||w.name||"",b.displayName||(w!==""?"ForwardRef("+w+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return C(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function E(w){var b=w,T=w;if(w.alternate)for(;b.return;)b=b.return;else{w=b;do b=w,b.flags&4098&&(T=b.return),w=b.return;while(w)}return b.tag===3?T:null}function P(w){if(E(w)!==w)throw Error(a(188))}function R(w){var b=w.alternate;if(!b){if(b=E(w),b===null)throw Error(a(188));return b!==w?null:w}for(var T=w,D=b;;){var B=T.return;if(B===null)break;var V=B.alternate;if(V===null){if(D=B.return,D!==null){T=D;continue}break}if(B.child===V.child){for(V=B.child;V;){if(V===T)return P(B),w;if(V===D)return P(B),b;V=V.sibling}throw Error(a(188))}if(T.return!==D.return)T=B,D=V;else{for(var ce=!1,De=B.child;De;){if(De===T){ce=!0,T=B,D=V;break}if(De===D){ce=!0,D=B,T=V;break}De=De.sibling}if(!ce){for(De=V.child;De;){if(De===T){ce=!0,T=V,D=B;break}if(De===D){ce=!0,D=V,T=B;break}De=De.sibling}if(!ce)throw Error(a(189))}}if(T.alternate!==D)throw Error(a(190))}if(T.tag!==3)throw Error(a(188));return T.stateNode.current===T?w:b}function O(w){return w=R(w),w!==null?L(w):null}function L(w){if(w.tag===5||w.tag===6)return w;for(w=w.child;w!==null;){var b=L(w);if(b!==null)return b;w=w.sibling}return null}function I(w){if(w.tag===5||w.tag===6)return w;for(w=w.child;w!==null;){if(w.tag!==4){var b=I(w);if(b!==null)return b}w=w.sibling}return null}var z=Array.isArray,K=t.getPublicInstance,Y=t.getRootHostContext,U=t.getChildHostContext,j=t.prepareForCommit,k=t.resetAfterCommit,q=t.createInstance,W=t.appendInitialChild,te=t.finalizeInitialChildren,G=t.prepareUpdate,le=t.shouldSetTextContent,Z=t.createTextInstance,he=t.scheduleTimeout,ye=t.cancelTimeout,de=t.noTimeout,xe=t.isPrimaryRenderer,me=t.supportsMutation,ee=t.supportsPersistence,we=t.supportsHydration,Ae=t.getInstanceFromNode,Te=t.preparePortalMount,Re=t.getCurrentEventPriority,Xe=t.detachDeletedInstance,Oe=t.supportsMicrotasks,Be=t.scheduleMicrotask,at=t.supportsTestSelectors,ht=t.findFiberRoot,se=t.getBoundingRect,N=t.getTextContent,H=t.isHiddenSubtree,ve=t.matchAccessibilityRole,X=t.setFocusIfFocusable,Ce=t.setupIntersectionObserver,Ve=t.appendChild,Ye=t.appendChildToContainer,_e=t.commitTextUpdate,Pe=t.commitMount,Qe=t.commitUpdate,st=t.insertBefore,ct=t.insertInContainerBefore,tt=t.removeChild,oe=t.removeChildFromContainer,je=t.resetTextContent,dt=t.hideInstance,J=t.hideTextInstance,be=t.unhideInstance,ue=t.unhideTextInstance,Ne=t.clearContainer,et=t.cloneInstance,_t=t.createContainerChildSet,zt=t.appendChildToContainerChildSet,ti=t.finalizeContainerChildren,ar=t.replaceContainerChildren,Ut=t.cloneHiddenInstance,Wi=t.cloneHiddenTextInstance,Ai=t.canHydrateInstance,Qo=t.canHydrateTextInstance,mh=t.canHydrateSuspenseInstance,gh=t.isSuspenseInstancePending,da=t.isSuspenseInstanceFallback,ae=t.registerSuspenseInstanceRetry,Ue=t.getNextHydratableSibling,Je=t.getFirstHydratableChild,Fe=t.getFirstHydratableChildWithinContainer,Ze=t.getFirstHydratableChildWithinSuspenseInstance,Pt=t.hydrateInstance,re=t.hydrateTextInstance,Me=t.hydrateSuspenseInstance,Ie=t.getNextHydratableInstanceAfterSuspenseInstance,Ee=t.commitHydratedContainer,ke=t.commitHydratedSuspenseInstance,ut=t.clearSuspenseBoundary,pt=t.clearSuspenseBoundaryFromContainer,Dt=t.shouldDeleteUnhydratedTailInstances,Nt=t.didNotMatchHydratedContainerTextInstance,ni=t.didNotMatchHydratedTextInstance,Tt;function gt(w){if(Tt===void 0)try{throw Error()}catch(T){var b=T.stack.trim().match(/\n( *(at )?)/);Tt=b&&b[1]||""}return`
`+Tt+w}var gi=!1;function Rt(w,b){if(!w||gi)return"";gi=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(mt){var D=mt}Reflect.construct(w,[],b)}else{try{b.call()}catch(mt){D=mt}w.call(b.prototype)}else{try{throw Error()}catch(mt){D=mt}w()}}catch(mt){if(mt&&D&&typeof mt.stack=="string"){for(var B=mt.stack.split(`
`),V=D.stack.split(`
`),ce=B.length-1,De=V.length-1;1<=ce&&0<=De&&B[ce]!==V[De];)De--;for(;1<=ce&&0<=De;ce--,De--)if(B[ce]!==V[De]){if(ce!==1||De!==1)do if(ce--,De--,0>De||B[ce]!==V[De]){var $e=`
`+B[ce].replace(" at new "," at ");return w.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",w.displayName)),$e}while(1<=ce&&0<=De);break}}}finally{gi=!1,Error.prepareStackTrace=T}return(w=w?w.displayName||w.name:"")?gt(w):""}var Cr=Object.prototype.hasOwnProperty,qr=[],Pi=-1;function Xt(w){return{current:w}}function Q(w){0>Pi||(w.current=qr[Pi],qr[Pi]=null,Pi--)}function $(w,b){Pi++,qr[Pi]=w.current,w.current=b}var ge={},ie=Xt(ge),Se=Xt(!1),lt=ge;function zi(w,b){var T=w.type.contextTypes;if(!T)return ge;var D=w.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===b)return D.__reactInternalMemoizedMaskedChildContext;var B={},V;for(V in T)B[V]=b[V];return D&&(w=w.stateNode,w.__reactInternalMemoizedUnmaskedChildContext=b,w.__reactInternalMemoizedMaskedChildContext=B),B}function ur(w){return w=w.childContextTypes,w!=null}function Fa(){Q(Se),Q(ie)}function an(w,b,T){if(ie.current!==ge)throw Error(a(168));$(ie,b),$(Se,T)}function Jo(w,b,T){var D=w.stateNode;if(b=b.childContextTypes,typeof D.getChildContext!="function")return T;D=D.getChildContext();for(var B in D)if(!(B in b))throw Error(a(108,M(w)||"Unknown",B));return s({},T,D)}function jl(w){return w=(w=w.stateNode)&&w.__reactInternalMemoizedMergedChildContext||ge,lt=ie.current,$(ie,w),$(Se,Se.current),!0}function ry(w,b,T){var D=w.stateNode;if(!D)throw Error(a(169));T?(w=Jo(w,b,lt),D.__reactInternalMemoizedMergedChildContext=w,Q(Se),Q(ie),$(ie,w)):Q(Se),$(Se,T)}var Ko=Math.clz32?Math.clz32:pne,hne=Math.log,dne=Math.LN2;function pne(w){return w>>>=0,w===0?32:31-(hne(w)/dne|0)|0}var bb=64,_b=4194304;function ny(w){switch(w&-w){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return w&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return w}}function Sb(w,b){var T=w.pendingLanes;if(T===0)return 0;var D=0,B=w.suspendedLanes,V=w.pingedLanes,ce=T&268435455;if(ce!==0){var De=ce&~B;De!==0?D=ny(De):(V&=ce,V!==0&&(D=ny(V)))}else ce=T&~B,ce!==0?D=ny(ce):V!==0&&(D=ny(V));if(D===0)return 0;if(b!==0&&b!==D&&!(b&B)&&(B=D&-D,V=b&-b,B>=V||B===16&&(V&4194240)!==0))return b;if(D&4&&(D|=T&16),b=w.entangledLanes,b!==0)for(w=w.entanglements,b&=D;0<b;)T=31-Ko(b),B=1<<T,D|=w[T],b&=~B;return D}function fne(w,b){switch(w){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mne(w,b){for(var T=w.suspendedLanes,D=w.pingedLanes,B=w.expirationTimes,V=w.pendingLanes;0<V;){var ce=31-Ko(V),De=1<<ce,$e=B[ce];$e===-1?(!(De&T)||De&D)&&(B[ce]=fne(De,b)):$e<=b&&(w.expiredLanes|=De),V&=~De}}function qT(w){return w=w.pendingLanes&-1073741825,w!==0?w:w&1073741824?1073741824:0}function QT(w){for(var b=[],T=0;31>T;T++)b.push(w);return b}function sy(w,b,T){w.pendingLanes|=b,b!==536870912&&(w.suspendedLanes=0,w.pingedLanes=0),w=w.eventTimes,b=31-Ko(b),w[b]=T}function gne(w,b){var T=w.pendingLanes&~b;w.pendingLanes=b,w.suspendedLanes=0,w.pingedLanes=0,w.expiredLanes&=b,w.mutableReadLanes&=b,w.entangledLanes&=b,b=w.entanglements;var D=w.eventTimes;for(w=w.expirationTimes;0<T;){var B=31-Ko(T),V=1<<B;b[B]=0,D[B]=-1,w[B]=-1,T&=~V}}function JT(w,b){var T=w.entangledLanes|=b;for(w=w.entanglements;T;){var D=31-Ko(T),B=1<<D;B&b|w[D]&b&&(w[D]|=b),T&=~B}}var Vi=0;function Zk(w){return w&=-w,1<w?4<w?w&268435455?16:536870912:4:1}var KT=n.unstable_scheduleCallback,$k=n.unstable_cancelCallback,vne=n.unstable_shouldYield,yne=n.unstable_requestPaint,kn=n.unstable_now,ZT=n.unstable_ImmediatePriority,xne=n.unstable_UserBlockingPriority,$T=n.unstable_NormalPriority,wne=n.unstable_IdlePriority,Ab=null,Wl=null;function bne(w){if(Wl&&typeof Wl.onCommitFiberRoot=="function")try{Wl.onCommitFiberRoot(Ab,w,void 0,(w.current.flags&128)===128)}catch{}}function _ne(w,b){return w===b&&(w!==0||1/w===1/b)||w!==w&&b!==b}var Xl=typeof Object.is=="function"?Object.is:_ne,Yc=null,Mb=!1,e2=!1;function ez(w){Yc===null?Yc=[w]:Yc.push(w)}function Sne(w){Mb=!0,ez(w)}function Yl(){if(!e2&&Yc!==null){e2=!0;var w=0,b=Vi;try{var T=Yc;for(Vi=1;w<T.length;w++){var D=T[w];do D=D(!0);while(D!==null)}Yc=null,Mb=!1}catch(B){throw Yc!==null&&(Yc=Yc.slice(w+1)),KT(ZT,Yl),B}finally{Vi=b,e2=!1}}return null}var Ane=o.ReactCurrentBatchConfig;function Eb(w,b){if(Xl(w,b))return!0;if(typeof w!="object"||w===null||typeof b!="object"||b===null)return!1;var T=Object.keys(w),D=Object.keys(b);if(T.length!==D.length)return!1;for(D=0;D<T.length;D++){var B=T[D];if(!Cr.call(b,B)||!Xl(w[B],b[B]))return!1}return!0}function Mne(w){switch(w.tag){case 5:return gt(w.type);case 16:return gt("Lazy");case 13:return gt("Suspense");case 19:return gt("SuspenseList");case 0:case 2:case 15:return w=Rt(w.type,!1),w;case 11:return w=Rt(w.type.render,!1),w;case 1:return w=Rt(w.type,!0),w;default:return""}}function Zo(w,b){if(w&&w.defaultProps){b=s({},b),w=w.defaultProps;for(var T in w)b[T]===void 0&&(b[T]=w[T]);return b}return b}var Cb=Xt(null),Tb=null,Mm=null,t2=null;function i2(){t2=Mm=Tb=null}function tz(w,b,T){xe?($(Cb,b._currentValue),b._currentValue=T):($(Cb,b._currentValue2),b._currentValue2=T)}function r2(w){var b=Cb.current;Q(Cb),xe?w._currentValue=b:w._currentValue2=b}function n2(w,b,T){for(;w!==null;){var D=w.alternate;if((w.childLanes&b)!==b?(w.childLanes|=b,D!==null&&(D.childLanes|=b)):D!==null&&(D.childLanes&b)!==b&&(D.childLanes|=b),w===T)break;w=w.return}}function Em(w,b){Tb=w,t2=Mm=null,w=w.dependencies,w!==null&&w.firstContext!==null&&(w.lanes&b&&(ka=!0),w.firstContext=null)}function so(w){var b=xe?w._currentValue:w._currentValue2;if(t2!==w)if(w={context:w,memoizedValue:b,next:null},Mm===null){if(Tb===null)throw Error(a(308));Mm=w,Tb.dependencies={lanes:0,firstContext:w}}else Mm=Mm.next=w;return b}var ql=null,vh=!1;function s2(w){w.updateQueue={baseState:w.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function iz(w,b){w=w.updateQueue,b.updateQueue===w&&(b.updateQueue={baseState:w.baseState,firstBaseUpdate:w.firstBaseUpdate,lastBaseUpdate:w.lastBaseUpdate,shared:w.shared,effects:w.effects})}function qc(w,b){return{eventTime:w,lane:b,tag:0,payload:null,callback:null,next:null}}function yh(w,b){var T=w.updateQueue;T!==null&&(T=T.shared,on!==null&&w.mode&1&&!(_i&2)?(w=T.interleaved,w===null?(b.next=b,ql===null?ql=[T]:ql.push(T)):(b.next=w.next,w.next=b),T.interleaved=b):(w=T.pending,w===null?b.next=b:(b.next=w.next,w.next=b),T.pending=b))}function Pb(w,b,T){if(b=b.updateQueue,b!==null&&(b=b.shared,(T&4194240)!==0)){var D=b.lanes;D&=w.pendingLanes,T|=D,b.lanes=T,JT(w,T)}}function rz(w,b){var T=w.updateQueue,D=w.alternate;if(D!==null&&(D=D.updateQueue,T===D)){var B=null,V=null;if(T=T.firstBaseUpdate,T!==null){do{var ce={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};V===null?B=V=ce:V=V.next=ce,T=T.next}while(T!==null);V===null?B=V=b:V=V.next=b}else B=V=b;T={baseState:D.baseState,firstBaseUpdate:B,lastBaseUpdate:V,shared:D.shared,effects:D.effects},w.updateQueue=T;return}w=T.lastBaseUpdate,w===null?T.firstBaseUpdate=b:w.next=b,T.lastBaseUpdate=b}function Db(w,b,T,D){var B=w.updateQueue;vh=!1;var V=B.firstBaseUpdate,ce=B.lastBaseUpdate,De=B.shared.pending;if(De!==null){B.shared.pending=null;var $e=De,mt=$e.next;$e.next=null,ce===null?V=mt:ce.next=mt,ce=$e;var Lt=w.alternate;Lt!==null&&(Lt=Lt.updateQueue,De=Lt.lastBaseUpdate,De!==ce&&(De===null?Lt.firstBaseUpdate=mt:De.next=mt,Lt.lastBaseUpdate=$e))}if(V!==null){var fi=B.baseState;ce=0,Lt=mt=$e=null,De=V;do{var Jt=De.lane,or=De.eventTime;if((D&Jt)===Jt){Lt!==null&&(Lt=Lt.next={eventTime:or,lane:0,tag:De.tag,payload:De.payload,callback:De.callback,next:null});e:{var Vt=w,As=De;switch(Jt=b,or=T,As.tag){case 1:if(Vt=As.payload,typeof Vt=="function"){fi=Vt.call(or,fi,Jt);break e}fi=Vt;break e;case 3:Vt.flags=Vt.flags&-65537|128;case 0:if(Vt=As.payload,Jt=typeof Vt=="function"?Vt.call(or,fi,Jt):Vt,Jt==null)break e;fi=s({},fi,Jt);break e;case 2:vh=!0}}De.callback!==null&&De.lane!==0&&(w.flags|=64,Jt=B.effects,Jt===null?B.effects=[De]:Jt.push(De))}else or={eventTime:or,lane:Jt,tag:De.tag,payload:De.payload,callback:De.callback,next:null},Lt===null?(mt=Lt=or,$e=fi):Lt=Lt.next=or,ce|=Jt;if(De=De.next,De===null){if(De=B.shared.pending,De===null)break;Jt=De,De=Jt.next,Jt.next=null,B.lastBaseUpdate=Jt,B.shared.pending=null}}while(1);if(Lt===null&&($e=fi),B.baseState=$e,B.firstBaseUpdate=mt,B.lastBaseUpdate=Lt,b=B.shared.interleaved,b!==null){B=b;do ce|=B.lane,B=B.next;while(B!==b)}else V===null&&(B.shared.lanes=0);Bm|=ce,w.lanes=ce,w.memoizedState=fi}}function nz(w,b,T){if(w=b.effects,b.effects=null,w!==null)for(b=0;b<w.length;b++){var D=w[b],B=D.callback;if(B!==null){if(D.callback=null,D=T,typeof B!="function")throw Error(a(191,B));B.call(D)}}}var sz=new r.Component().refs;function a2(w,b,T,D){b=w.memoizedState,T=T(D,b),T=T==null?b:s({},b,T),w.memoizedState=T,w.lanes===0&&(w.updateQueue.baseState=T)}var Rb={isMounted:function(w){return(w=w._reactInternals)?E(w)===w:!1},enqueueSetState:function(w,b,T){w=w._reactInternals;var D=Hs(),B=bh(w),V=qc(D,B);V.payload=b,T!=null&&(V.callback=T),yh(w,V),b=uo(w,B,D),b!==null&&Pb(b,w,B)},enqueueReplaceState:function(w,b,T){w=w._reactInternals;var D=Hs(),B=bh(w),V=qc(D,B);V.tag=1,V.payload=b,T!=null&&(V.callback=T),yh(w,V),b=uo(w,B,D),b!==null&&Pb(b,w,B)},enqueueForceUpdate:function(w,b){w=w._reactInternals;var T=Hs(),D=bh(w),B=qc(T,D);B.tag=2,b!=null&&(B.callback=b),yh(w,B),b=uo(w,D,T),b!==null&&Pb(b,w,D)}};function az(w,b,T,D,B,V,ce){return w=w.stateNode,typeof w.shouldComponentUpdate=="function"?w.shouldComponentUpdate(D,V,ce):b.prototype&&b.prototype.isPureReactComponent?!Eb(T,D)||!Eb(B,V):!0}function oz(w,b,T){var D=!1,B=ge,V=b.contextType;return typeof V=="object"&&V!==null?V=so(V):(B=ur(b)?lt:ie.current,D=b.contextTypes,V=(D=D!=null)?zi(w,B):ge),b=new b(T,V),w.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Rb,w.stateNode=b,b._reactInternals=w,D&&(w=w.stateNode,w.__reactInternalMemoizedUnmaskedChildContext=B,w.__reactInternalMemoizedMaskedChildContext=V),b}function lz(w,b,T,D){w=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(T,D),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(T,D),b.state!==w&&Rb.enqueueReplaceState(b,b.state,null)}function o2(w,b,T,D){var B=w.stateNode;B.props=T,B.state=w.memoizedState,B.refs=sz,s2(w);var V=b.contextType;typeof V=="object"&&V!==null?B.context=so(V):(V=ur(b)?lt:ie.current,B.context=zi(w,V)),B.state=w.memoizedState,V=b.getDerivedStateFromProps,typeof V=="function"&&(a2(w,b,V,T),B.state=w.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(b=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),b!==B.state&&Rb.enqueueReplaceState(B,B.state,null),Db(w,T,B,D),B.state=w.memoizedState),typeof B.componentDidMount=="function"&&(w.flags|=4194308)}var Cm=[],Tm=0,Ib=null,Lb=0,ao=[],oo=0,dp=null,Qc=1,Jc="";function pp(w,b){Cm[Tm++]=Lb,Cm[Tm++]=Ib,Ib=w,Lb=b}function cz(w,b,T){ao[oo++]=Qc,ao[oo++]=Jc,ao[oo++]=dp,dp=w;var D=Qc;w=Jc;var B=32-Ko(D)-1;D&=~(1<<B),T+=1;var V=32-Ko(b)+B;if(30<V){var ce=B-B%5;V=(D&(1<<ce)-1).toString(32),D>>=ce,B-=ce,Qc=1<<32-Ko(b)+B|T<<B|D,Jc=V+w}else Qc=1<<V|T<<B|D,Jc=w}function l2(w){w.return!==null&&(pp(w,1),cz(w,1,0))}function c2(w){for(;w===Ib;)Ib=Cm[--Tm],Cm[Tm]=null,Lb=Cm[--Tm],Cm[Tm]=null;for(;w===dp;)dp=ao[--oo],ao[oo]=null,Jc=ao[--oo],ao[oo]=null,Qc=ao[--oo],ao[oo]=null}var Na=null,Ua=null,_r=!1,ay=!1,$o=null;function uz(w,b){var T=ho(5,null,null,0);T.elementType="DELETED",T.stateNode=b,T.return=w,b=w.deletions,b===null?(w.deletions=[T],w.flags|=16):b.push(T)}function hz(w,b){switch(w.tag){case 5:return b=Ai(b,w.type,w.pendingProps),b!==null?(w.stateNode=b,Na=w,Ua=Je(b),!0):!1;case 6:return b=Qo(b,w.pendingProps),b!==null?(w.stateNode=b,Na=w,Ua=null,!0):!1;case 13:if(b=mh(b),b!==null){var T=dp!==null?{id:Qc,overflow:Jc}:null;return w.memoizedState={dehydrated:b,treeContext:T,retryLane:1073741824},T=ho(18,null,null,0),T.stateNode=b,T.return=w,w.child=T,Na=w,Ua=null,!0}return!1;default:return!1}}function u2(w){return(w.mode&1)!==0&&(w.flags&128)===0}function h2(w){if(_r){var b=Ua;if(b){var T=b;if(!hz(w,b)){if(u2(w))throw Error(a(418));b=Ue(T);var D=Na;b&&hz(w,b)?uz(D,T):(w.flags=w.flags&-4097|2,_r=!1,Na=w)}}else{if(u2(w))throw Error(a(418));w.flags=w.flags&-4097|2,_r=!1,Na=w}}}function dz(w){for(w=w.return;w!==null&&w.tag!==5&&w.tag!==3&&w.tag!==13;)w=w.return;Na=w}function oy(w){if(!we||w!==Na)return!1;if(!_r)return dz(w),_r=!0,!1;if(w.tag!==3&&(w.tag!==5||Dt(w.type)&&!le(w.type,w.memoizedProps))){var b=Ua;if(b){if(u2(w)){for(w=Ua;w;)w=Ue(w);throw Error(a(418))}for(;b;)uz(w,b),b=Ue(b)}}if(dz(w),w.tag===13){if(!we)throw Error(a(316));if(w=w.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(a(317));Ua=Ie(w)}else Ua=Na?Ue(w.stateNode):null;return!0}function Pm(){we&&(Ua=Na=null,ay=_r=!1)}function d2(w){$o===null?$o=[w]:$o.push(w)}function ly(w,b,T){if(w=T.ref,w!==null&&typeof w!="function"&&typeof w!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(a(309));var D=T.stateNode}if(!D)throw Error(a(147,w));var B=D,V=""+w;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===V?b.ref:(b=function(ce){var De=B.refs;De===sz&&(De=B.refs={}),ce===null?delete De[V]:De[V]=ce},b._stringRef=V,b)}if(typeof w!="string")throw Error(a(284));if(!T._owner)throw Error(a(290,w))}return w}function Ob(w,b){throw w=Object.prototype.toString.call(b),Error(a(31,w==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":w))}function pz(w){var b=w._init;return b(w._payload)}function fz(w){function b(Ge,Le){if(w){var qe=Ge.deletions;qe===null?(Ge.deletions=[Le],Ge.flags|=16):qe.push(Le)}}function T(Ge,Le){if(!w)return null;for(;Le!==null;)b(Ge,Le),Le=Le.sibling;return null}function D(Ge,Le){for(Ge=new Map;Le!==null;)Le.key!==null?Ge.set(Le.key,Le):Ge.set(Le.index,Le),Le=Le.sibling;return Ge}function B(Ge,Le){return Ge=Sh(Ge,Le),Ge.index=0,Ge.sibling=null,Ge}function V(Ge,Le,qe){return Ge.index=qe,w?(qe=Ge.alternate,qe!==null?(qe=qe.index,qe<Le?(Ge.flags|=2,Le):qe):(Ge.flags|=2,Le)):(Ge.flags|=1048576,Le)}function ce(Ge){return w&&Ge.alternate===null&&(Ge.flags|=2),Ge}function De(Ge,Le,qe,Et){return Le===null||Le.tag!==6?(Le=Q2(qe,Ge.mode,Et),Le.return=Ge,Le):(Le=B(Le,qe),Le.return=Ge,Le)}function $e(Ge,Le,qe,Et){var kt=qe.type;return kt===u?Lt(Ge,Le,qe.props.children,Et,qe.key):Le!==null&&(Le.elementType===kt||typeof kt=="object"&&kt!==null&&kt.$$typeof===y&&pz(kt)===Le.type)?(Et=B(Le,qe.props),Et.ref=ly(Ge,Le,qe),Et.return=Ge,Et):(Et=h_(qe.type,qe.key,qe.props,null,Ge.mode,Et),Et.ref=ly(Ge,Le,qe),Et.return=Ge,Et)}function mt(Ge,Le,qe,Et){return Le===null||Le.tag!==4||Le.stateNode.containerInfo!==qe.containerInfo||Le.stateNode.implementation!==qe.implementation?(Le=J2(qe,Ge.mode,Et),Le.return=Ge,Le):(Le=B(Le,qe.children||[]),Le.return=Ge,Le)}function Lt(Ge,Le,qe,Et,kt){return Le===null||Le.tag!==7?(Le=wp(qe,Ge.mode,Et,kt),Le.return=Ge,Le):(Le=B(Le,qe),Le.return=Ge,Le)}function fi(Ge,Le,qe){if(typeof Le=="string"&&Le!==""||typeof Le=="number")return Le=Q2(""+Le,Ge.mode,qe),Le.return=Ge,Le;if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case l:return qe=h_(Le.type,Le.key,Le.props,null,Ge.mode,qe),qe.ref=ly(Ge,null,Le),qe.return=Ge,qe;case c:return Le=J2(Le,Ge.mode,qe),Le.return=Ge,Le;case y:var Et=Le._init;return fi(Ge,Et(Le._payload),qe)}if(z(Le)||S(Le))return Le=wp(Le,Ge.mode,qe,null),Le.return=Ge,Le;Ob(Ge,Le)}return null}function Jt(Ge,Le,qe,Et){var kt=Le!==null?Le.key:null;if(typeof qe=="string"&&qe!==""||typeof qe=="number")return kt!==null?null:De(Ge,Le,""+qe,Et);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case l:return qe.key===kt?$e(Ge,Le,qe,Et):null;case c:return qe.key===kt?mt(Ge,Le,qe,Et):null;case y:return kt=qe._init,Jt(Ge,Le,kt(qe._payload),Et)}if(z(qe)||S(qe))return kt!==null?null:Lt(Ge,Le,qe,Et,null);Ob(Ge,qe)}return null}function or(Ge,Le,qe,Et,kt){if(typeof Et=="string"&&Et!==""||typeof Et=="number")return Ge=Ge.get(qe)||null,De(Le,Ge,""+Et,kt);if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case l:return Ge=Ge.get(Et.key===null?qe:Et.key)||null,$e(Le,Ge,Et,kt);case c:return Ge=Ge.get(Et.key===null?qe:Et.key)||null,mt(Le,Ge,Et,kt);case y:var yi=Et._init;return or(Ge,Le,qe,yi(Et._payload),kt)}if(z(Et)||S(Et))return Ge=Ge.get(qe)||null,Lt(Le,Ge,Et,kt,null);Ob(Le,Et)}return null}function Vt(Ge,Le,qe,Et){for(var kt=null,yi=null,mi=Le,Gi=Le=0,Vn=null;mi!==null&&Gi<qe.length;Gi++){mi.index>Gi?(Vn=mi,mi=null):Vn=mi.sibling;var Hi=Jt(Ge,mi,qe[Gi],Et);if(Hi===null){mi===null&&(mi=Vn);break}w&&mi&&Hi.alternate===null&&b(Ge,mi),Le=V(Hi,Le,Gi),yi===null?kt=Hi:yi.sibling=Hi,yi=Hi,mi=Vn}if(Gi===qe.length)return T(Ge,mi),_r&&pp(Ge,Gi),kt;if(mi===null){for(;Gi<qe.length;Gi++)mi=fi(Ge,qe[Gi],Et),mi!==null&&(Le=V(mi,Le,Gi),yi===null?kt=mi:yi.sibling=mi,yi=mi);return _r&&pp(Ge,Gi),kt}for(mi=D(Ge,mi);Gi<qe.length;Gi++)Vn=or(mi,Ge,Gi,qe[Gi],Et),Vn!==null&&(w&&Vn.alternate!==null&&mi.delete(Vn.key===null?Gi:Vn.key),Le=V(Vn,Le,Gi),yi===null?kt=Vn:yi.sibling=Vn,yi=Vn);return w&&mi.forEach(function(Ah){return b(Ge,Ah)}),_r&&pp(Ge,Gi),kt}function As(Ge,Le,qe,Et){var kt=S(qe);if(typeof kt!="function")throw Error(a(150));if(qe=kt.call(qe),qe==null)throw Error(a(151));for(var yi=kt=null,mi=Le,Gi=Le=0,Vn=null,Hi=qe.next();mi!==null&&!Hi.done;Gi++,Hi=qe.next()){mi.index>Gi?(Vn=mi,mi=null):Vn=mi.sibling;var Ah=Jt(Ge,mi,Hi.value,Et);if(Ah===null){mi===null&&(mi=Vn);break}w&&mi&&Ah.alternate===null&&b(Ge,mi),Le=V(Ah,Le,Gi),yi===null?kt=Ah:yi.sibling=Ah,yi=Ah,mi=Vn}if(Hi.done)return T(Ge,mi),_r&&pp(Ge,Gi),kt;if(mi===null){for(;!Hi.done;Gi++,Hi=qe.next())Hi=fi(Ge,Hi.value,Et),Hi!==null&&(Le=V(Hi,Le,Gi),yi===null?kt=Hi:yi.sibling=Hi,yi=Hi);return _r&&pp(Ge,Gi),kt}for(mi=D(Ge,mi);!Hi.done;Gi++,Hi=qe.next())Hi=or(mi,Ge,Gi,Hi.value,Et),Hi!==null&&(w&&Hi.alternate!==null&&mi.delete(Hi.key===null?Gi:Hi.key),Le=V(Hi,Le,Gi),yi===null?kt=Hi:yi.sibling=Hi,yi=Hi);return w&&mi.forEach(function(tse){return b(Ge,tse)}),_r&&pp(Ge,Gi),kt}function po(Ge,Le,qe,Et){if(typeof qe=="object"&&qe!==null&&qe.type===u&&qe.key===null&&(qe=qe.props.children),typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case l:e:{for(var kt=qe.key,yi=Le;yi!==null;){if(yi.key===kt){if(kt=qe.type,kt===u){if(yi.tag===7){T(Ge,yi.sibling),Le=B(yi,qe.props.children),Le.return=Ge,Ge=Le;break e}}else if(yi.elementType===kt||typeof kt=="object"&&kt!==null&&kt.$$typeof===y&&pz(kt)===yi.type){T(Ge,yi.sibling),Le=B(yi,qe.props),Le.ref=ly(Ge,yi,qe),Le.return=Ge,Ge=Le;break e}T(Ge,yi);break}else b(Ge,yi);yi=yi.sibling}qe.type===u?(Le=wp(qe.props.children,Ge.mode,Et,qe.key),Le.return=Ge,Ge=Le):(Et=h_(qe.type,qe.key,qe.props,null,Ge.mode,Et),Et.ref=ly(Ge,Le,qe),Et.return=Ge,Ge=Et)}return ce(Ge);case c:e:{for(yi=qe.key;Le!==null;){if(Le.key===yi)if(Le.tag===4&&Le.stateNode.containerInfo===qe.containerInfo&&Le.stateNode.implementation===qe.implementation){T(Ge,Le.sibling),Le=B(Le,qe.children||[]),Le.return=Ge,Ge=Le;break e}else{T(Ge,Le);break}else b(Ge,Le);Le=Le.sibling}Le=J2(qe,Ge.mode,Et),Le.return=Ge,Ge=Le}return ce(Ge);case y:return yi=qe._init,po(Ge,Le,yi(qe._payload),Et)}if(z(qe))return Vt(Ge,Le,qe,Et);if(S(qe))return As(Ge,Le,qe,Et);Ob(Ge,qe)}return typeof qe=="string"&&qe!==""||typeof qe=="number"?(qe=""+qe,Le!==null&&Le.tag===6?(T(Ge,Le.sibling),Le=B(Le,qe),Le.return=Ge,Ge=Le):(T(Ge,Le),Le=Q2(qe,Ge.mode,Et),Le.return=Ge,Ge=Le),ce(Ge)):T(Ge,Le)}return po}var Dm=fz(!0),mz=fz(!1),cy={},lo=Xt(cy),uy=Xt(cy),Rm=Xt(cy);function Ql(w){if(w===cy)throw Error(a(174));return w}function p2(w,b){$(Rm,b),$(uy,w),$(lo,cy),w=Y(b),Q(lo),$(lo,w)}function Im(){Q(lo),Q(uy),Q(Rm)}function gz(w){var b=Ql(Rm.current),T=Ql(lo.current);b=U(T,w.type,b),T!==b&&($(uy,w),$(lo,b))}function f2(w){uy.current===w&&(Q(lo),Q(uy))}var Tr=Xt(0);function Bb(w){for(var b=w;b!==null;){if(b.tag===13){var T=b.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||gh(T)||da(T)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if(b.flags&128)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===w)break;for(;b.sibling===null;){if(b.return===null||b.return===w)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var m2=[];function g2(){for(var w=0;w<m2.length;w++){var b=m2[w];xe?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}m2.length=0}var Fb=o.ReactCurrentDispatcher,co=o.ReactCurrentBatchConfig,Lm=0,Nr=null,bs=null,zn=null,Nb=!1,hy=!1,dy=0,Ene=0;function _s(){throw Error(a(321))}function v2(w,b){if(b===null)return!1;for(var T=0;T<b.length&&T<w.length;T++)if(!Xl(w[T],b[T]))return!1;return!0}function y2(w,b,T,D,B,V){if(Lm=V,Nr=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,Fb.current=w===null||w.memoizedState===null?Dne:Rne,w=T(D,B),hy){V=0;do{if(hy=!1,dy=0,25<=V)throw Error(a(301));V+=1,zn=bs=null,b.updateQueue=null,Fb.current=Ine,w=T(D,B)}while(hy)}if(Fb.current=Gb,b=bs!==null&&bs.next!==null,Lm=0,zn=bs=Nr=null,Nb=!1,b)throw Error(a(300));return w}function x2(){var w=dy!==0;return dy=0,w}function Kc(){var w={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zn===null?Nr.memoizedState=zn=w:zn=zn.next=w,zn}function Jl(){if(bs===null){var w=Nr.alternate;w=w!==null?w.memoizedState:null}else w=bs.next;var b=zn===null?Nr.memoizedState:zn.next;if(b!==null)zn=b,bs=w;else{if(w===null)throw Error(a(310));bs=w,w={memoizedState:bs.memoizedState,baseState:bs.baseState,baseQueue:bs.baseQueue,queue:bs.queue,next:null},zn===null?Nr.memoizedState=zn=w:zn=zn.next=w}return zn}function fp(w,b){return typeof b=="function"?b(w):b}function Ub(w){var b=Jl(),T=b.queue;if(T===null)throw Error(a(311));T.lastRenderedReducer=w;var D=bs,B=D.baseQueue,V=T.pending;if(V!==null){if(B!==null){var ce=B.next;B.next=V.next,V.next=ce}D.baseQueue=B=V,T.pending=null}if(B!==null){V=B.next,D=D.baseState;var De=ce=null,$e=null,mt=V;do{var Lt=mt.lane;if((Lm&Lt)===Lt)$e!==null&&($e=$e.next={lane:0,action:mt.action,hasEagerState:mt.hasEagerState,eagerState:mt.eagerState,next:null}),D=mt.hasEagerState?mt.eagerState:w(D,mt.action);else{var fi={lane:Lt,action:mt.action,hasEagerState:mt.hasEagerState,eagerState:mt.eagerState,next:null};$e===null?(De=$e=fi,ce=D):$e=$e.next=fi,Nr.lanes|=Lt,Bm|=Lt}mt=mt.next}while(mt!==null&&mt!==V);$e===null?ce=D:$e.next=De,Xl(D,b.memoizedState)||(ka=!0),b.memoizedState=D,b.baseState=ce,b.baseQueue=$e,T.lastRenderedState=D}if(w=T.interleaved,w!==null){B=w;do V=B.lane,Nr.lanes|=V,Bm|=V,B=B.next;while(B!==w)}else B===null&&(T.lanes=0);return[b.memoizedState,T.dispatch]}function kb(w){var b=Jl(),T=b.queue;if(T===null)throw Error(a(311));T.lastRenderedReducer=w;var D=T.dispatch,B=T.pending,V=b.memoizedState;if(B!==null){T.pending=null;var ce=B=B.next;do V=w(V,ce.action),ce=ce.next;while(ce!==B);Xl(V,b.memoizedState)||(ka=!0),b.memoizedState=V,b.baseQueue===null&&(b.baseState=V),T.lastRenderedState=V}return[V,D]}function vz(){}function yz(w,b){var T=Nr,D=Jl(),B=b(),V=!Xl(D.memoizedState,B);if(V&&(D.memoizedState=B,ka=!0),D=D.queue,fy(bz.bind(null,T,D,w),[w]),D.getSnapshot!==b||V||zn!==null&&zn.memoizedState.tag&1){if(T.flags|=2048,py(9,wz.bind(null,T,D,B,b),void 0,null),on===null)throw Error(a(349));Lm&30||xz(T,b,B)}return B}function xz(w,b,T){w.flags|=16384,w={getSnapshot:b,value:T},b=Nr.updateQueue,b===null?(b={lastEffect:null,stores:null},Nr.updateQueue=b,b.stores=[w]):(T=b.stores,T===null?b.stores=[w]:T.push(w))}function wz(w,b,T,D){b.value=T,b.getSnapshot=D,_z(b)&&uo(w,1,-1)}function bz(w,b,T){return T(function(){_z(b)&&uo(w,1,-1)})}function _z(w){var b=w.getSnapshot;w=w.value;try{var T=b();return!Xl(w,T)}catch{return!0}}function w2(w){var b=Kc();return typeof w=="function"&&(w=w()),b.memoizedState=b.baseState=w,w={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fp,lastRenderedState:w},b.queue=w,w=w.dispatch=Pne.bind(null,Nr,w),[b.memoizedState,w]}function py(w,b,T,D){return w={tag:w,create:b,destroy:T,deps:D,next:null},b=Nr.updateQueue,b===null?(b={lastEffect:null,stores:null},Nr.updateQueue=b,b.lastEffect=w.next=w):(T=b.lastEffect,T===null?b.lastEffect=w.next=w:(D=T.next,T.next=w,w.next=D,b.lastEffect=w)),w}function Sz(){return Jl().memoizedState}function zb(w,b,T,D){var B=Kc();Nr.flags|=w,B.memoizedState=py(1|b,T,void 0,D===void 0?null:D)}function Vb(w,b,T,D){var B=Jl();D=D===void 0?null:D;var V=void 0;if(bs!==null){var ce=bs.memoizedState;if(V=ce.destroy,D!==null&&v2(D,ce.deps)){B.memoizedState=py(b,T,V,D);return}}Nr.flags|=w,B.memoizedState=py(1|b,T,V,D)}function b2(w,b){return zb(8390656,8,w,b)}function fy(w,b){return Vb(2048,8,w,b)}function Az(w,b){return Vb(4,2,w,b)}function Mz(w,b){return Vb(4,4,w,b)}function Ez(w,b){if(typeof b=="function")return w=w(),b(w),function(){b(null)};if(b!=null)return w=w(),b.current=w,function(){b.current=null}}function Cz(w,b,T){return T=T!=null?T.concat([w]):null,Vb(4,4,Ez.bind(null,b,w),T)}function _2(){}function Tz(w,b){var T=Jl();b=b===void 0?null:b;var D=T.memoizedState;return D!==null&&b!==null&&v2(b,D[1])?D[0]:(T.memoizedState=[w,b],w)}function Pz(w,b){var T=Jl();b=b===void 0?null:b;var D=T.memoizedState;return D!==null&&b!==null&&v2(b,D[1])?D[0]:(w=w(),T.memoizedState=[w,b],w)}function Cne(w,b){var T=Vi;Vi=T!==0&&4>T?T:4,w(!0);var D=co.transition;co.transition={};try{w(!1),b()}finally{Vi=T,co.transition=D}}function Dz(){return Jl().memoizedState}function Tne(w,b,T){var D=bh(w);T={lane:D,action:T,hasEagerState:!1,eagerState:null,next:null},Rz(w)?Iz(b,T):(Lz(w,b,T),T=Hs(),w=uo(w,D,T),w!==null&&Oz(w,b,D))}function Pne(w,b,T){var D=bh(w),B={lane:D,action:T,hasEagerState:!1,eagerState:null,next:null};if(Rz(w))Iz(b,B);else{Lz(w,b,B);var V=w.alternate;if(w.lanes===0&&(V===null||V.lanes===0)&&(V=b.lastRenderedReducer,V!==null))try{var ce=b.lastRenderedState,De=V(ce,T);if(B.hasEagerState=!0,B.eagerState=De,Xl(De,ce))return}catch{}finally{}T=Hs(),w=uo(w,D,T),w!==null&&Oz(w,b,D)}}function Rz(w){var b=w.alternate;return w===Nr||b!==null&&b===Nr}function Iz(w,b){hy=Nb=!0;var T=w.pending;T===null?b.next=b:(b.next=T.next,T.next=b),w.pending=b}function Lz(w,b,T){on!==null&&w.mode&1&&!(_i&2)?(w=b.interleaved,w===null?(T.next=T,ql===null?ql=[b]:ql.push(b)):(T.next=w.next,w.next=T),b.interleaved=T):(w=b.pending,w===null?T.next=T:(T.next=w.next,w.next=T),b.pending=T)}function Oz(w,b,T){if(T&4194240){var D=b.lanes;D&=w.pendingLanes,T|=D,b.lanes=T,JT(w,T)}}var Gb={readContext:so,useCallback:_s,useContext:_s,useEffect:_s,useImperativeHandle:_s,useInsertionEffect:_s,useLayoutEffect:_s,useMemo:_s,useReducer:_s,useRef:_s,useState:_s,useDebugValue:_s,useDeferredValue:_s,useTransition:_s,useMutableSource:_s,useSyncExternalStore:_s,useId:_s,unstable_isNewReconciler:!1},Dne={readContext:so,useCallback:function(w,b){return Kc().memoizedState=[w,b===void 0?null:b],w},useContext:so,useEffect:b2,useImperativeHandle:function(w,b,T){return T=T!=null?T.concat([w]):null,zb(4194308,4,Ez.bind(null,b,w),T)},useLayoutEffect:function(w,b){return zb(4194308,4,w,b)},useInsertionEffect:function(w,b){return zb(4,2,w,b)},useMemo:function(w,b){var T=Kc();return b=b===void 0?null:b,w=w(),T.memoizedState=[w,b],w},useReducer:function(w,b,T){var D=Kc();return b=T!==void 0?T(b):b,D.memoizedState=D.baseState=b,w={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:w,lastRenderedState:b},D.queue=w,w=w.dispatch=Tne.bind(null,Nr,w),[D.memoizedState,w]},useRef:function(w){var b=Kc();return w={current:w},b.memoizedState=w},useState:w2,useDebugValue:_2,useDeferredValue:function(w){var b=w2(w),T=b[0],D=b[1];return b2(function(){var B=co.transition;co.transition={};try{D(w)}finally{co.transition=B}},[w]),T},useTransition:function(){var w=w2(!1),b=w[0];return w=Cne.bind(null,w[1]),Kc().memoizedState=w,[b,w]},useMutableSource:function(){},useSyncExternalStore:function(w,b,T){var D=Nr,B=Kc();if(_r){if(T===void 0)throw Error(a(407));T=T()}else{if(T=b(),on===null)throw Error(a(349));Lm&30||xz(D,b,T)}B.memoizedState=T;var V={value:T,getSnapshot:b};return B.queue=V,b2(bz.bind(null,D,V,w),[w]),D.flags|=2048,py(9,wz.bind(null,D,V,T,b),void 0,null),T},useId:function(){var w=Kc(),b=on.identifierPrefix;if(_r){var T=Jc,D=Qc;T=(D&~(1<<32-Ko(D)-1)).toString(32)+T,b=":"+b+"R"+T,T=dy++,0<T&&(b+="H"+T.toString(32)),b+=":"}else T=Ene++,b=":"+b+"r"+T.toString(32)+":";return w.memoizedState=b},unstable_isNewReconciler:!1},Rne={readContext:so,useCallback:Tz,useContext:so,useEffect:fy,useImperativeHandle:Cz,useInsertionEffect:Az,useLayoutEffect:Mz,useMemo:Pz,useReducer:Ub,useRef:Sz,useState:function(){return Ub(fp)},useDebugValue:_2,useDeferredValue:function(w){var b=Ub(fp),T=b[0],D=b[1];return fy(function(){var B=co.transition;co.transition={};try{D(w)}finally{co.transition=B}},[w]),T},useTransition:function(){var w=Ub(fp)[0],b=Jl().memoizedState;return[w,b]},useMutableSource:vz,useSyncExternalStore:yz,useId:Dz,unstable_isNewReconciler:!1},Ine={readContext:so,useCallback:Tz,useContext:so,useEffect:fy,useImperativeHandle:Cz,useInsertionEffect:Az,useLayoutEffect:Mz,useMemo:Pz,useReducer:kb,useRef:Sz,useState:function(){return kb(fp)},useDebugValue:_2,useDeferredValue:function(w){var b=kb(fp),T=b[0],D=b[1];return fy(function(){var B=co.transition;co.transition={};try{D(w)}finally{co.transition=B}},[w]),T},useTransition:function(){var w=kb(fp)[0],b=Jl().memoizedState;return[w,b]},useMutableSource:vz,useSyncExternalStore:yz,useId:Dz,unstable_isNewReconciler:!1};function S2(w,b){try{var T="",D=b;do T+=Mne(D),D=D.return;while(D);var B=T}catch(V){B=`
Error generating stack: `+V.message+`
`+V.stack}return{value:w,source:b,stack:B}}function A2(w,b){try{console.error(b.value)}catch(T){setTimeout(function(){throw T})}}var Lne=typeof WeakMap=="function"?WeakMap:Map;function Bz(w,b,T){T=qc(-1,T),T.tag=3,T.payload={element:null};var D=b.value;return T.callback=function(){n_||(n_=!0,G2=D),A2(w,b)},T}function Fz(w,b,T){T=qc(-1,T),T.tag=3;var D=w.type.getDerivedStateFromError;if(typeof D=="function"){var B=b.value;T.payload=function(){return D(B)},T.callback=function(){A2(w,b)}}var V=w.stateNode;return V!==null&&typeof V.componentDidCatch=="function"&&(T.callback=function(){A2(w,b),typeof D!="function"&&(xh===null?xh=new Set([this]):xh.add(this));var ce=b.stack;this.componentDidCatch(b.value,{componentStack:ce!==null?ce:""})}),T}function Nz(w,b,T){var D=w.pingCache;if(D===null){D=w.pingCache=new Lne;var B=new Set;D.set(b,B)}else B=D.get(b),B===void 0&&(B=new Set,D.set(b,B));B.has(T)||(B.add(T),w=Yne.bind(null,w,b,T),b.then(w,w))}function Uz(w){do{var b;if((b=w.tag===13)&&(b=w.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return w;w=w.return}while(w!==null);return null}function kz(w,b,T,D,B){return w.mode&1?(w.flags|=65536,w.lanes=B,w):(w===b?w.flags|=65536:(w.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(b=qc(-1,1),b.tag=2,yh(T,b))),T.lanes|=1),w)}function Kl(w){w.flags|=4}function zz(w,b){if(w!==null&&w.child===b.child)return!0;if(b.flags&16)return!1;for(w=b.child;w!==null;){if(w.flags&12854||w.subtreeFlags&12854)return!1;w=w.sibling}return!0}var my,gy,Hb,jb;if(me)my=function(w,b){for(var T=b.child;T!==null;){if(T.tag===5||T.tag===6)W(w,T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===b)break;for(;T.sibling===null;){if(T.return===null||T.return===b)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},gy=function(){},Hb=function(w,b,T,D,B){if(w=w.memoizedProps,w!==D){var V=b.stateNode,ce=Ql(lo.current);T=G(V,T,w,D,B,ce),(b.updateQueue=T)&&Kl(b)}},jb=function(w,b,T,D){T!==D&&Kl(b)};else if(ee){my=function(w,b,T,D){for(var B=b.child;B!==null;){if(B.tag===5){var V=B.stateNode;T&&D&&(V=Ut(V,B.type,B.memoizedProps,B)),W(w,V)}else if(B.tag===6)V=B.stateNode,T&&D&&(V=Wi(V,B.memoizedProps,B)),W(w,V);else if(B.tag!==4){if(B.tag===22&&B.memoizedState!==null)V=B.child,V!==null&&(V.return=B),my(w,B,!0,!0);else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===b)break;for(;B.sibling===null;){if(B.return===null||B.return===b)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};var Vz=function(w,b,T,D){for(var B=b.child;B!==null;){if(B.tag===5){var V=B.stateNode;T&&D&&(V=Ut(V,B.type,B.memoizedProps,B)),zt(w,V)}else if(B.tag===6)V=B.stateNode,T&&D&&(V=Wi(V,B.memoizedProps,B)),zt(w,V);else if(B.tag!==4){if(B.tag===22&&B.memoizedState!==null)V=B.child,V!==null&&(V.return=B),Vz(w,B,!0,!0);else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===b)break;for(;B.sibling===null;){if(B.return===null||B.return===b)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};gy=function(w,b){var T=b.stateNode;if(!zz(w,b)){w=T.containerInfo;var D=_t(w);Vz(D,b,!1,!1),T.pendingChildren=D,Kl(b),ti(w,D)}},Hb=function(w,b,T,D,B){var V=w.stateNode,ce=w.memoizedProps;if((w=zz(w,b))&&ce===D)b.stateNode=V;else{var De=b.stateNode,$e=Ql(lo.current),mt=null;ce!==D&&(mt=G(De,T,ce,D,B,$e)),w&&mt===null?b.stateNode=V:(V=et(V,mt,T,ce,D,b,w,De),te(V,T,D,B,$e)&&Kl(b),b.stateNode=V,w?Kl(b):my(V,b,!1,!1))}},jb=function(w,b,T,D){T!==D?(w=Ql(Rm.current),T=Ql(lo.current),b.stateNode=Z(D,w,T,b),Kl(b)):b.stateNode=w.stateNode}}else gy=function(){},Hb=function(){},jb=function(){};function vy(w,b){if(!_r)switch(w.tailMode){case"hidden":b=w.tail;for(var T=null;b!==null;)b.alternate!==null&&(T=b),b=b.sibling;T===null?w.tail=null:T.sibling=null;break;case"collapsed":T=w.tail;for(var D=null;T!==null;)T.alternate!==null&&(D=T),T=T.sibling;D===null?b||w.tail===null?w.tail=null:w.tail.sibling=null:D.sibling=null}}function Ss(w){var b=w.alternate!==null&&w.alternate.child===w.child,T=0,D=0;if(b)for(var B=w.child;B!==null;)T|=B.lanes|B.childLanes,D|=B.subtreeFlags&14680064,D|=B.flags&14680064,B.return=w,B=B.sibling;else for(B=w.child;B!==null;)T|=B.lanes|B.childLanes,D|=B.subtreeFlags,D|=B.flags,B.return=w,B=B.sibling;return w.subtreeFlags|=D,w.childLanes=T,b}function One(w,b,T){var D=b.pendingProps;switch(c2(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ss(b),null;case 1:return ur(b.type)&&Fa(),Ss(b),null;case 3:return D=b.stateNode,Im(),Q(Se),Q(ie),g2(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(w===null||w.child===null)&&(oy(b)?Kl(b):w===null||w.memoizedState.isDehydrated&&!(b.flags&256)||(b.flags|=1024,$o!==null&&(W2($o),$o=null))),gy(w,b),Ss(b),null;case 5:f2(b),T=Ql(Rm.current);var B=b.type;if(w!==null&&b.stateNode!=null)Hb(w,b,B,D,T),w.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!D){if(b.stateNode===null)throw Error(a(166));return Ss(b),null}if(w=Ql(lo.current),oy(b)){if(!we)throw Error(a(175));w=Pt(b.stateNode,b.type,b.memoizedProps,T,w,b,!ay),b.updateQueue=w,w!==null&&Kl(b)}else{var V=q(B,D,T,w,b);my(V,b,!1,!1),b.stateNode=V,te(V,B,D,T,w)&&Kl(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Ss(b),null;case 6:if(w&&b.stateNode!=null)jb(w,b,w.memoizedProps,D);else{if(typeof D!="string"&&b.stateNode===null)throw Error(a(166));if(w=Ql(Rm.current),T=Ql(lo.current),oy(b)){if(!we)throw Error(a(176));if(w=b.stateNode,D=b.memoizedProps,(T=re(w,D,b,!ay))&&(B=Na,B!==null))switch(V=(B.mode&1)!==0,B.tag){case 3:Nt(B.stateNode.containerInfo,w,D,V);break;case 5:ni(B.type,B.memoizedProps,B.stateNode,w,D,V)}T&&Kl(b)}else b.stateNode=Z(D,w,T,b)}return Ss(b),null;case 13:if(Q(Tr),D=b.memoizedState,_r&&Ua!==null&&b.mode&1&&!(b.flags&128)){for(w=Ua;w;)w=Ue(w);return Pm(),b.flags|=98560,b}if(D!==null&&D.dehydrated!==null){if(D=oy(b),w===null){if(!D)throw Error(a(318));if(!we)throw Error(a(344));if(w=b.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(a(317));Me(w,b)}else Pm(),!(b.flags&128)&&(b.memoizedState=null),b.flags|=4;return Ss(b),null}return $o!==null&&(W2($o),$o=null),b.flags&128?(b.lanes=T,b):(D=D!==null,T=!1,w===null?oy(b):T=w.memoizedState!==null,D&&!T&&(b.child.flags|=8192,b.mode&1&&(w===null||Tr.current&1?_n===0&&(_n=3):Y2())),b.updateQueue!==null&&(b.flags|=4),Ss(b),null);case 4:return Im(),gy(w,b),w===null&&Te(b.stateNode.containerInfo),Ss(b),null;case 10:return r2(b.type._context),Ss(b),null;case 17:return ur(b.type)&&Fa(),Ss(b),null;case 19:if(Q(Tr),B=b.memoizedState,B===null)return Ss(b),null;if(D=(b.flags&128)!==0,V=B.rendering,V===null)if(D)vy(B,!1);else{if(_n!==0||w!==null&&w.flags&128)for(w=b.child;w!==null;){if(V=Bb(w),V!==null){for(b.flags|=128,vy(B,!1),w=V.updateQueue,w!==null&&(b.updateQueue=w,b.flags|=4),b.subtreeFlags=0,w=T,D=b.child;D!==null;)T=D,B=w,T.flags&=14680066,V=T.alternate,V===null?(T.childLanes=0,T.lanes=B,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=V.childLanes,T.lanes=V.lanes,T.child=V.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=V.memoizedProps,T.memoizedState=V.memoizedState,T.updateQueue=V.updateQueue,T.type=V.type,B=V.dependencies,T.dependencies=B===null?null:{lanes:B.lanes,firstContext:B.firstContext}),D=D.sibling;return $(Tr,Tr.current&1|2),b.child}w=w.sibling}B.tail!==null&&kn()>V2&&(b.flags|=128,D=!0,vy(B,!1),b.lanes=4194304)}else{if(!D)if(w=Bb(V),w!==null){if(b.flags|=128,D=!0,w=w.updateQueue,w!==null&&(b.updateQueue=w,b.flags|=4),vy(B,!0),B.tail===null&&B.tailMode==="hidden"&&!V.alternate&&!_r)return Ss(b),null}else 2*kn()-B.renderingStartTime>V2&&T!==1073741824&&(b.flags|=128,D=!0,vy(B,!1),b.lanes=4194304);B.isBackwards?(V.sibling=b.child,b.child=V):(w=B.last,w!==null?w.sibling=V:b.child=V,B.last=V)}return B.tail!==null?(b=B.tail,B.rendering=b,B.tail=b.sibling,B.renderingStartTime=kn(),b.sibling=null,w=Tr.current,$(Tr,D?w&1|2:w&1),b):(Ss(b),null);case 22:case 23:return X2(),D=b.memoizedState!==null,w!==null&&w.memoizedState!==null!==D&&(b.flags|=8192),D&&b.mode&1?za&1073741824&&(Ss(b),me&&b.subtreeFlags&6&&(b.flags|=8192)):Ss(b),null;case 24:return null;case 25:return null}throw Error(a(156,b.tag))}var Bne=o.ReactCurrentOwner,ka=!1;function Gs(w,b,T,D){b.child=w===null?mz(b,null,T,D):Dm(b,w.child,T,D)}function Gz(w,b,T,D,B){T=T.render;var V=b.ref;return Em(b,B),D=y2(w,b,T,D,V,B),T=x2(),w!==null&&!ka?(b.updateQueue=w.updateQueue,b.flags&=-2053,w.lanes&=~B,Zc(w,b,B)):(_r&&T&&l2(b),b.flags|=1,Gs(w,b,D,B),b.child)}function Hz(w,b,T,D,B){if(w===null){var V=T.type;return typeof V=="function"&&!q2(V)&&V.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(b.tag=15,b.type=V,jz(w,b,V,D,B)):(w=h_(T.type,null,D,b,b.mode,B),w.ref=b.ref,w.return=b,b.child=w)}if(V=w.child,!(w.lanes&B)){var ce=V.memoizedProps;if(T=T.compare,T=T!==null?T:Eb,T(ce,D)&&w.ref===b.ref)return Zc(w,b,B)}return b.flags|=1,w=Sh(V,D),w.ref=b.ref,w.return=b,b.child=w}function jz(w,b,T,D,B){if(w!==null&&Eb(w.memoizedProps,D)&&w.ref===b.ref)if(ka=!1,(w.lanes&B)!==0)w.flags&131072&&(ka=!0);else return b.lanes=w.lanes,Zc(w,b,B);return M2(w,b,T,D,B)}function Wz(w,b,T){var D=b.pendingProps,B=D.children,V=w!==null?w.memoizedState:null;if(D.mode==="hidden")if(!(b.mode&1))b.memoizedState={baseLanes:0,cachePool:null},$(Om,za),za|=T;else if(T&1073741824)b.memoizedState={baseLanes:0,cachePool:null},D=V!==null?V.baseLanes:T,$(Om,za),za|=D;else return w=V!==null?V.baseLanes|T:T,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:w,cachePool:null},b.updateQueue=null,$(Om,za),za|=w,null;else V!==null?(D=V.baseLanes|T,b.memoizedState=null):D=T,$(Om,za),za|=D;return Gs(w,b,B,T),b.child}function Xz(w,b){var T=b.ref;(w===null&&T!==null||w!==null&&w.ref!==T)&&(b.flags|=512,b.flags|=2097152)}function M2(w,b,T,D,B){var V=ur(T)?lt:ie.current;return V=zi(b,V),Em(b,B),T=y2(w,b,T,D,V,B),D=x2(),w!==null&&!ka?(b.updateQueue=w.updateQueue,b.flags&=-2053,w.lanes&=~B,Zc(w,b,B)):(_r&&D&&l2(b),b.flags|=1,Gs(w,b,T,B),b.child)}function Yz(w,b,T,D,B){if(ur(T)){var V=!0;jl(b)}else V=!1;if(Em(b,B),b.stateNode===null)w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),oz(b,T,D),o2(b,T,D,B),D=!0;else if(w===null){var ce=b.stateNode,De=b.memoizedProps;ce.props=De;var $e=ce.context,mt=T.contextType;typeof mt=="object"&&mt!==null?mt=so(mt):(mt=ur(T)?lt:ie.current,mt=zi(b,mt));var Lt=T.getDerivedStateFromProps,fi=typeof Lt=="function"||typeof ce.getSnapshotBeforeUpdate=="function";fi||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(De!==D||$e!==mt)&&lz(b,ce,D,mt),vh=!1;var Jt=b.memoizedState;ce.state=Jt,Db(b,D,ce,B),$e=b.memoizedState,De!==D||Jt!==$e||Se.current||vh?(typeof Lt=="function"&&(a2(b,T,Lt,D),$e=b.memoizedState),(De=vh||az(b,T,De,D,Jt,$e,mt))?(fi||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(b.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=D,b.memoizedState=$e),ce.props=D,ce.state=$e,ce.context=mt,D=De):(typeof ce.componentDidMount=="function"&&(b.flags|=4194308),D=!1)}else{ce=b.stateNode,iz(w,b),De=b.memoizedProps,mt=b.type===b.elementType?De:Zo(b.type,De),ce.props=mt,fi=b.pendingProps,Jt=ce.context,$e=T.contextType,typeof $e=="object"&&$e!==null?$e=so($e):($e=ur(T)?lt:ie.current,$e=zi(b,$e));var or=T.getDerivedStateFromProps;(Lt=typeof or=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(De!==fi||Jt!==$e)&&lz(b,ce,D,$e),vh=!1,Jt=b.memoizedState,ce.state=Jt,Db(b,D,ce,B);var Vt=b.memoizedState;De!==fi||Jt!==Vt||Se.current||vh?(typeof or=="function"&&(a2(b,T,or,D),Vt=b.memoizedState),(mt=vh||az(b,T,mt,D,Jt,Vt,$e)||!1)?(Lt||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(D,Vt,$e),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(D,Vt,$e)),typeof ce.componentDidUpdate=="function"&&(b.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof ce.componentDidUpdate!="function"||De===w.memoizedProps&&Jt===w.memoizedState||(b.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||De===w.memoizedProps&&Jt===w.memoizedState||(b.flags|=1024),b.memoizedProps=D,b.memoizedState=Vt),ce.props=D,ce.state=Vt,ce.context=$e,D=mt):(typeof ce.componentDidUpdate!="function"||De===w.memoizedProps&&Jt===w.memoizedState||(b.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||De===w.memoizedProps&&Jt===w.memoizedState||(b.flags|=1024),D=!1)}return E2(w,b,T,D,V,B)}function E2(w,b,T,D,B,V){Xz(w,b);var ce=(b.flags&128)!==0;if(!D&&!ce)return B&&ry(b,T,!1),Zc(w,b,V);D=b.stateNode,Bne.current=b;var De=ce&&typeof T.getDerivedStateFromError!="function"?null:D.render();return b.flags|=1,w!==null&&ce?(b.child=Dm(b,w.child,null,V),b.child=Dm(b,null,De,V)):Gs(w,b,De,V),b.memoizedState=D.state,B&&ry(b,T,!0),b.child}function qz(w){var b=w.stateNode;b.pendingContext?an(w,b.pendingContext,b.pendingContext!==b.context):b.context&&an(w,b.context,!1),p2(w,b.containerInfo)}function Qz(w,b,T,D,B){return Pm(),d2(B),b.flags|=256,Gs(w,b,T,D),b.child}var Wb={dehydrated:null,treeContext:null,retryLane:0};function Xb(w){return{baseLanes:w,cachePool:null}}function Jz(w,b,T){var D=b.pendingProps,B=Tr.current,V=!1,ce=(b.flags&128)!==0,De;if((De=ce)||(De=w!==null&&w.memoizedState===null?!1:(B&2)!==0),De?(V=!0,b.flags&=-129):(w===null||w.memoizedState!==null)&&(B|=1),$(Tr,B&1),w===null)return h2(b),w=b.memoizedState,w!==null&&(w=w.dehydrated,w!==null)?(b.mode&1?da(w)?b.lanes=8:b.lanes=1073741824:b.lanes=1,null):(B=D.children,w=D.fallback,V?(D=b.mode,V=b.child,B={mode:"hidden",children:B},!(D&1)&&V!==null?(V.childLanes=0,V.pendingProps=B):V=d_(B,D,0,null),w=wp(w,D,T,null),V.return=b,w.return=b,V.sibling=w,b.child=V,b.child.memoizedState=Xb(T),b.memoizedState=Wb,w):C2(b,B));if(B=w.memoizedState,B!==null){if(De=B.dehydrated,De!==null){if(ce)return b.flags&256?(b.flags&=-257,Yb(w,b,T,Error(a(422)))):b.memoizedState!==null?(b.child=w.child,b.flags|=128,null):(V=D.fallback,B=b.mode,D=d_({mode:"visible",children:D.children},B,0,null),V=wp(V,B,T,null),V.flags|=2,D.return=b,V.return=b,D.sibling=V,b.child=D,b.mode&1&&Dm(b,w.child,null,T),b.child.memoizedState=Xb(T),b.memoizedState=Wb,V);if(!(b.mode&1))b=Yb(w,b,T,null);else if(da(De))b=Yb(w,b,T,Error(a(419)));else if(D=(T&w.childLanes)!==0,ka||D){if(D=on,D!==null){switch(T&-T){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}D=V&(D.suspendedLanes|T)?0:V,D!==0&&D!==B.retryLane&&(B.retryLane=D,uo(w,D,-1))}Y2(),b=Yb(w,b,T,Error(a(421)))}else gh(De)?(b.flags|=128,b.child=w.child,b=qne.bind(null,w),ae(De,b),b=null):(T=B.treeContext,we&&(Ua=Ze(De),Na=b,_r=!0,$o=null,ay=!1,T!==null&&(ao[oo++]=Qc,ao[oo++]=Jc,ao[oo++]=dp,Qc=T.id,Jc=T.overflow,dp=b)),b=C2(b,b.pendingProps.children),b.flags|=4096);return b}return V?(D=Zz(w,b,D.children,D.fallback,T),V=b.child,B=w.child.memoizedState,V.memoizedState=B===null?Xb(T):{baseLanes:B.baseLanes|T,cachePool:null},V.childLanes=w.childLanes&~T,b.memoizedState=Wb,D):(T=Kz(w,b,D.children,T),b.memoizedState=null,T)}return V?(D=Zz(w,b,D.children,D.fallback,T),V=b.child,B=w.child.memoizedState,V.memoizedState=B===null?Xb(T):{baseLanes:B.baseLanes|T,cachePool:null},V.childLanes=w.childLanes&~T,b.memoizedState=Wb,D):(T=Kz(w,b,D.children,T),b.memoizedState=null,T)}function C2(w,b){return b=d_({mode:"visible",children:b},w.mode,0,null),b.return=w,w.child=b}function Kz(w,b,T,D){var B=w.child;return w=B.sibling,T=Sh(B,{mode:"visible",children:T}),!(b.mode&1)&&(T.lanes=D),T.return=b,T.sibling=null,w!==null&&(D=b.deletions,D===null?(b.deletions=[w],b.flags|=16):D.push(w)),b.child=T}function Zz(w,b,T,D,B){var V=b.mode;w=w.child;var ce=w.sibling,De={mode:"hidden",children:T};return!(V&1)&&b.child!==w?(T=b.child,T.childLanes=0,T.pendingProps=De,b.deletions=null):(T=Sh(w,De),T.subtreeFlags=w.subtreeFlags&14680064),ce!==null?D=Sh(ce,D):(D=wp(D,V,B,null),D.flags|=2),D.return=b,T.return=b,T.sibling=D,b.child=T,D}function Yb(w,b,T,D){return D!==null&&d2(D),Dm(b,w.child,null,T),w=C2(b,b.pendingProps.children),w.flags|=2,b.memoizedState=null,w}function $z(w,b,T){w.lanes|=b;var D=w.alternate;D!==null&&(D.lanes|=b),n2(w.return,b,T)}function T2(w,b,T,D,B){var V=w.memoizedState;V===null?w.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:D,tail:T,tailMode:B}:(V.isBackwards=b,V.rendering=null,V.renderingStartTime=0,V.last=D,V.tail=T,V.tailMode=B)}function e4(w,b,T){var D=b.pendingProps,B=D.revealOrder,V=D.tail;if(Gs(w,b,D.children,T),D=Tr.current,D&2)D=D&1|2,b.flags|=128;else{if(w!==null&&w.flags&128)e:for(w=b.child;w!==null;){if(w.tag===13)w.memoizedState!==null&&$z(w,T,b);else if(w.tag===19)$z(w,T,b);else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===b)break e;for(;w.sibling===null;){if(w.return===null||w.return===b)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}D&=1}if($(Tr,D),!(b.mode&1))b.memoizedState=null;else switch(B){case"forwards":for(T=b.child,B=null;T!==null;)w=T.alternate,w!==null&&Bb(w)===null&&(B=T),T=T.sibling;T=B,T===null?(B=b.child,b.child=null):(B=T.sibling,T.sibling=null),T2(b,!1,B,T,V);break;case"backwards":for(T=null,B=b.child,b.child=null;B!==null;){if(w=B.alternate,w!==null&&Bb(w)===null){b.child=B;break}w=B.sibling,B.sibling=T,T=B,B=w}T2(b,!0,T,null,V);break;case"together":T2(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function Zc(w,b,T){if(w!==null&&(b.dependencies=w.dependencies),Bm|=b.lanes,!(T&b.childLanes))return null;if(w!==null&&b.child!==w.child)throw Error(a(153));if(b.child!==null){for(w=b.child,T=Sh(w,w.pendingProps),b.child=T,T.return=b;w.sibling!==null;)w=w.sibling,T=T.sibling=Sh(w,w.pendingProps),T.return=b;T.sibling=null}return b.child}function Fne(w,b,T){switch(b.tag){case 3:qz(b),Pm();break;case 5:gz(b);break;case 1:ur(b.type)&&jl(b);break;case 4:p2(b,b.stateNode.containerInfo);break;case 10:tz(b,b.type._context,b.memoizedProps.value);break;case 13:var D=b.memoizedState;if(D!==null)return D.dehydrated!==null?($(Tr,Tr.current&1),b.flags|=128,null):T&b.child.childLanes?Jz(w,b,T):($(Tr,Tr.current&1),w=Zc(w,b,T),w!==null?w.sibling:null);$(Tr,Tr.current&1);break;case 19:if(D=(T&b.childLanes)!==0,w.flags&128){if(D)return e4(w,b,T);b.flags|=128}var B=b.memoizedState;if(B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),$(Tr,Tr.current),D)break;return null;case 22:case 23:return b.lanes=0,Wz(w,b,T)}return Zc(w,b,T)}function Nne(w,b){switch(c2(b),b.tag){case 1:return ur(b.type)&&Fa(),w=b.flags,w&65536?(b.flags=w&-65537|128,b):null;case 3:return Im(),Q(Se),Q(ie),g2(),w=b.flags,w&65536&&!(w&128)?(b.flags=w&-65537|128,b):null;case 5:return f2(b),null;case 13:if(Q(Tr),w=b.memoizedState,w!==null&&w.dehydrated!==null){if(b.alternate===null)throw Error(a(340));Pm()}return w=b.flags,w&65536?(b.flags=w&-65537|128,b):null;case 19:return Q(Tr),null;case 4:return Im(),null;case 10:return r2(b.type._context),null;case 22:case 23:return X2(),null;case 24:return null;default:return null}}var qb=!1,mp=!1,Une=typeof WeakSet=="function"?WeakSet:Set,At=null;function Qb(w,b){var T=w.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(D){ma(w,b,D)}else T.current=null}function P2(w,b,T){try{T()}catch(D){ma(w,b,D)}}var t4=!1;function kne(w,b){for(j(w.containerInfo),At=b;At!==null;)if(w=At,b=w.child,(w.subtreeFlags&1028)!==0&&b!==null)b.return=w,At=b;else for(;At!==null;){w=At;try{var T=w.alternate;if(w.flags&1024)switch(w.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var D=T.memoizedProps,B=T.memoizedState,V=w.stateNode,ce=V.getSnapshotBeforeUpdate(w.elementType===w.type?D:Zo(w.type,D),B);V.__reactInternalSnapshotBeforeUpdate=ce}break;case 3:me&&Ne(w.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(De){ma(w,w.return,De)}if(b=w.sibling,b!==null){b.return=w.return,At=b;break}At=w.return}return T=t4,t4=!1,T}function gp(w,b,T){var D=b.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var B=D=D.next;do{if((B.tag&w)===w){var V=B.destroy;B.destroy=void 0,V!==void 0&&P2(b,T,V)}B=B.next}while(B!==D)}}function yy(w,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var T=b=b.next;do{if((T.tag&w)===w){var D=T.create;T.destroy=D()}T=T.next}while(T!==b)}}function D2(w){var b=w.ref;if(b!==null){var T=w.stateNode;switch(w.tag){case 5:w=K(T);break;default:w=T}typeof b=="function"?b(w):b.current=w}}function i4(w,b,T){if(Wl&&typeof Wl.onCommitFiberUnmount=="function")try{Wl.onCommitFiberUnmount(Ab,b)}catch{}switch(b.tag){case 0:case 11:case 14:case 15:if(w=b.updateQueue,w!==null&&(w=w.lastEffect,w!==null)){var D=w=w.next;do{var B=D,V=B.destroy;B=B.tag,V!==void 0&&(B&2||B&4)&&P2(b,T,V),D=D.next}while(D!==w)}break;case 1:if(Qb(b,T),w=b.stateNode,typeof w.componentWillUnmount=="function")try{w.props=b.memoizedProps,w.state=b.memoizedState,w.componentWillUnmount()}catch(ce){ma(b,T,ce)}break;case 5:Qb(b,T);break;case 4:me?l4(w,b,T):ee&&ee&&(b=b.stateNode.containerInfo,T=_t(b),ar(b,T))}}function r4(w,b,T){for(var D=b;;)if(i4(w,D,T),D.child===null||me&&D.tag===4){if(D===b)break;for(;D.sibling===null;){if(D.return===null||D.return===b)return;D=D.return}D.sibling.return=D.return,D=D.sibling}else D.child.return=D,D=D.child}function n4(w){var b=w.alternate;b!==null&&(w.alternate=null,n4(b)),w.child=null,w.deletions=null,w.sibling=null,w.tag===5&&(b=w.stateNode,b!==null&&Xe(b)),w.stateNode=null,w.return=null,w.dependencies=null,w.memoizedProps=null,w.memoizedState=null,w.pendingProps=null,w.stateNode=null,w.updateQueue=null}function s4(w){return w.tag===5||w.tag===3||w.tag===4}function a4(w){e:for(;;){for(;w.sibling===null;){if(w.return===null||s4(w.return))return null;w=w.return}for(w.sibling.return=w.return,w=w.sibling;w.tag!==5&&w.tag!==6&&w.tag!==18;){if(w.flags&2||w.child===null||w.tag===4)continue e;w.child.return=w,w=w.child}if(!(w.flags&2))return w.stateNode}}function o4(w){if(me){e:{for(var b=w.return;b!==null;){if(s4(b))break e;b=b.return}throw Error(a(160))}var T=b;switch(T.tag){case 5:b=T.stateNode,T.flags&32&&(je(b),T.flags&=-33),T=a4(w),I2(w,T,b);break;case 3:case 4:b=T.stateNode.containerInfo,T=a4(w),R2(w,T,b);break;default:throw Error(a(161))}}}function R2(w,b,T){var D=w.tag;if(D===5||D===6)w=w.stateNode,b?ct(T,w,b):Ye(T,w);else if(D!==4&&(w=w.child,w!==null))for(R2(w,b,T),w=w.sibling;w!==null;)R2(w,b,T),w=w.sibling}function I2(w,b,T){var D=w.tag;if(D===5||D===6)w=w.stateNode,b?st(T,w,b):Ve(T,w);else if(D!==4&&(w=w.child,w!==null))for(I2(w,b,T),w=w.sibling;w!==null;)I2(w,b,T),w=w.sibling}function l4(w,b,T){for(var D=b,B=!1,V,ce;;){if(!B){B=D.return;e:for(;;){if(B===null)throw Error(a(160));switch(V=B.stateNode,B.tag){case 5:ce=!1;break e;case 3:V=V.containerInfo,ce=!0;break e;case 4:V=V.containerInfo,ce=!0;break e}B=B.return}B=!0}if(D.tag===5||D.tag===6)r4(w,D,T),ce?oe(V,D.stateNode):tt(V,D.stateNode);else if(D.tag===18)ce?pt(V,D.stateNode):ut(V,D.stateNode);else if(D.tag===4){if(D.child!==null){V=D.stateNode.containerInfo,ce=!0,D.child.return=D,D=D.child;continue}}else if(i4(w,D,T),D.child!==null){D.child.return=D,D=D.child;continue}if(D===b)break;for(;D.sibling===null;){if(D.return===null||D.return===b)return;D=D.return,D.tag===4&&(B=!1)}D.sibling.return=D.return,D=D.sibling}}function L2(w,b){if(me){switch(b.tag){case 0:case 11:case 14:case 15:gp(3,b,b.return),yy(3,b),gp(5,b,b.return);return;case 1:return;case 5:var T=b.stateNode;if(T!=null){var D=b.memoizedProps;w=w!==null?w.memoizedProps:D;var B=b.type,V=b.updateQueue;b.updateQueue=null,V!==null&&Qe(T,V,B,w,D,b)}return;case 6:if(b.stateNode===null)throw Error(a(162));T=b.memoizedProps,_e(b.stateNode,w!==null?w.memoizedProps:T,T);return;case 3:we&&w!==null&&w.memoizedState.isDehydrated&&Ee(b.stateNode.containerInfo);return;case 12:return;case 13:Jb(b);return;case 19:Jb(b);return;case 17:return}throw Error(a(163))}switch(b.tag){case 0:case 11:case 14:case 15:gp(3,b,b.return),yy(3,b),gp(5,b,b.return);return;case 12:return;case 13:Jb(b);return;case 19:Jb(b);return;case 3:we&&w!==null&&w.memoizedState.isDehydrated&&Ee(b.stateNode.containerInfo);break;case 22:case 23:return}e:if(ee){switch(b.tag){case 1:case 5:case 6:break e;case 3:case 4:b=b.stateNode,ar(b.containerInfo,b.pendingChildren);break e}throw Error(a(163))}}function Jb(w){var b=w.updateQueue;if(b!==null){w.updateQueue=null;var T=w.stateNode;T===null&&(T=w.stateNode=new Une),b.forEach(function(D){var B=Qne.bind(null,w,D);T.has(D)||(T.add(D),D.then(B,B))})}}function zne(w,b){for(At=b;At!==null;){b=At;var T=b.deletions;if(T!==null)for(var D=0;D<T.length;D++){var B=T[D];try{var V=w;me?l4(V,B,b):r4(V,B,b);var ce=B.alternate;ce!==null&&(ce.return=null),B.return=null}catch(kt){ma(B,b,kt)}}if(T=b.child,b.subtreeFlags&12854&&T!==null)T.return=b,At=T;else for(;At!==null;){b=At;try{var De=b.flags;if(De&32&&me&&je(b.stateNode),De&512){var $e=b.alternate;if($e!==null){var mt=$e.ref;mt!==null&&(typeof mt=="function"?mt(null):mt.current=null)}}if(De&8192)switch(b.tag){case 13:if(b.memoizedState!==null){var Lt=b.alternate;(Lt===null||Lt.memoizedState===null)&&(z2=kn())}break;case 22:var fi=b.memoizedState!==null,Jt=b.alternate,or=Jt!==null&&Jt.memoizedState!==null;if(T=b,me){e:if(D=T,B=fi,V=null,me)for(var Vt=D;;){if(Vt.tag===5){if(V===null){V=Vt;var As=Vt.stateNode;B?dt(As):be(Vt.stateNode,Vt.memoizedProps)}}else if(Vt.tag===6){if(V===null){var po=Vt.stateNode;B?J(po):ue(po,Vt.memoizedProps)}}else if((Vt.tag!==22&&Vt.tag!==23||Vt.memoizedState===null||Vt===D)&&Vt.child!==null){Vt.child.return=Vt,Vt=Vt.child;continue}if(Vt===D)break;for(;Vt.sibling===null;){if(Vt.return===null||Vt.return===D)break e;V===Vt&&(V=null),Vt=Vt.return}V===Vt&&(V=null),Vt.sibling.return=Vt.return,Vt=Vt.sibling}}if(fi&&!or&&T.mode&1){At=T;for(var Ge=T.child;Ge!==null;){for(T=At=Ge;At!==null;){D=At;var Le=D.child;switch(D.tag){case 0:case 11:case 14:case 15:gp(4,D,D.return);break;case 1:Qb(D,D.return);var qe=D.stateNode;if(typeof qe.componentWillUnmount=="function"){var Et=D.return;try{qe.props=D.memoizedProps,qe.state=D.memoizedState,qe.componentWillUnmount()}catch(kt){ma(D,Et,kt)}}break;case 5:Qb(D,D.return);break;case 22:if(D.memoizedState!==null){h4(T);continue}}Le!==null?(Le.return=D,At=Le):h4(T)}Ge=Ge.sibling}}}switch(De&4102){case 2:o4(b),b.flags&=-3;break;case 6:o4(b),b.flags&=-3,L2(b.alternate,b);break;case 4096:b.flags&=-4097;break;case 4100:b.flags&=-4097,L2(b.alternate,b);break;case 4:L2(b.alternate,b)}}catch(kt){ma(b,b.return,kt)}if(T=b.sibling,T!==null){T.return=b.return,At=T;break}At=b.return}}}function Vne(w,b,T){At=w,c4(w)}function c4(w,b,T){for(var D=(w.mode&1)!==0;At!==null;){var B=At,V=B.child;if(B.tag===22&&D){var ce=B.memoizedState!==null||qb;if(!ce){var De=B.alternate,$e=De!==null&&De.memoizedState!==null||mp;De=qb;var mt=mp;if(qb=ce,(mp=$e)&&!mt)for(At=B;At!==null;)ce=At,$e=ce.child,ce.tag===22&&ce.memoizedState!==null?d4(B):$e!==null?($e.return=ce,At=$e):d4(B);for(;V!==null;)At=V,c4(V),V=V.sibling;At=B,qb=De,mp=mt}u4(w)}else B.subtreeFlags&8772&&V!==null?(V.return=B,At=V):u4(w)}}function u4(w){for(;At!==null;){var b=At;if(b.flags&8772){var T=b.alternate;try{if(b.flags&8772)switch(b.tag){case 0:case 11:case 15:mp||yy(5,b);break;case 1:var D=b.stateNode;if(b.flags&4&&!mp)if(T===null)D.componentDidMount();else{var B=b.elementType===b.type?T.memoizedProps:Zo(b.type,T.memoizedProps);D.componentDidUpdate(B,T.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var V=b.updateQueue;V!==null&&nz(b,V,D);break;case 3:var ce=b.updateQueue;if(ce!==null){if(T=null,b.child!==null)switch(b.child.tag){case 5:T=K(b.child.stateNode);break;case 1:T=b.child.stateNode}nz(b,ce,T)}break;case 5:var De=b.stateNode;T===null&&b.flags&4&&Pe(De,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(we&&b.memoizedState===null){var $e=b.alternate;if($e!==null){var mt=$e.memoizedState;if(mt!==null){var Lt=mt.dehydrated;Lt!==null&&ke(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}mp||b.flags&512&&D2(b)}catch(fi){ma(b,b.return,fi)}}if(b===w){At=null;break}if(T=b.sibling,T!==null){T.return=b.return,At=T;break}At=b.return}}function h4(w){for(;At!==null;){var b=At;if(b===w){At=null;break}var T=b.sibling;if(T!==null){T.return=b.return,At=T;break}At=b.return}}function d4(w){for(;At!==null;){var b=At;try{switch(b.tag){case 0:case 11:case 15:var T=b.return;try{yy(4,b)}catch($e){ma(b,T,$e)}break;case 1:var D=b.stateNode;if(typeof D.componentDidMount=="function"){var B=b.return;try{D.componentDidMount()}catch($e){ma(b,B,$e)}}var V=b.return;try{D2(b)}catch($e){ma(b,V,$e)}break;case 5:var ce=b.return;try{D2(b)}catch($e){ma(b,ce,$e)}}}catch($e){ma(b,b.return,$e)}if(b===w){At=null;break}var De=b.sibling;if(De!==null){De.return=b.return,At=De;break}At=b.return}}var Kb=0,Zb=1,$b=2,e_=3,t_=4;if(typeof Symbol=="function"&&Symbol.for){var xy=Symbol.for;Kb=xy("selector.component"),Zb=xy("selector.has_pseudo_class"),$b=xy("selector.role"),e_=xy("selector.test_id"),t_=xy("selector.text")}function O2(w){var b=Ae(w);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(a(364));return b}if(w=ht(w),w===null)throw Error(a(362));return w.stateNode.current}function B2(w,b){switch(b.$$typeof){case Kb:if(w.type===b.value)return!0;break;case Zb:e:{b=b.value,w=[w,0];for(var T=0;T<w.length;){var D=w[T++],B=w[T++],V=b[B];if(D.tag!==5||!H(D)){for(;V!=null&&B2(D,V);)B++,V=b[B];if(B===b.length){b=!0;break e}else for(D=D.child;D!==null;)w.push(D,B),D=D.sibling}}b=!1}return b;case $b:if(w.tag===5&&ve(w.stateNode,b.value))return!0;break;case t_:if((w.tag===5||w.tag===6)&&(w=N(w),w!==null&&0<=w.indexOf(b.value)))return!0;break;case e_:if(w.tag===5&&(w=w.memoizedProps["data-testname"],typeof w=="string"&&w.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function F2(w){switch(w.$$typeof){case Kb:return"<"+(C(w.value)||"Unknown")+">";case Zb:return":has("+(F2(w)||"")+")";case $b:return'[role="'+w.value+'"]';case t_:return'"'+w.value+'"';case e_:return'[data-testname="'+w.value+'"]';default:throw Error(a(365))}}function p4(w,b){var T=[];w=[w,0];for(var D=0;D<w.length;){var B=w[D++],V=w[D++],ce=b[V];if(B.tag!==5||!H(B)){for(;ce!=null&&B2(B,ce);)V++,ce=b[V];if(V===b.length)T.push(B);else for(B=B.child;B!==null;)w.push(B,V),B=B.sibling}}return T}function N2(w,b){if(!at)throw Error(a(363));w=O2(w),w=p4(w,b),b=[],w=Array.from(w);for(var T=0;T<w.length;){var D=w[T++];if(D.tag===5)H(D)||b.push(D.stateNode);else for(D=D.child;D!==null;)w.push(D),D=D.sibling}return b}var Gne=Math.ceil,i_=o.ReactCurrentDispatcher,U2=o.ReactCurrentOwner,Qr=o.ReactCurrentBatchConfig,_i=0,on=null,ln=null,ns=0,za=0,Om=Xt(0),_n=0,wy=null,Bm=0,r_=0,k2=0,by=null,pa=null,z2=0,V2=1/0;function Fm(){V2=kn()+500}var n_=!1,G2=null,xh=null,s_=!1,wh=null,a_=0,_y=0,H2=null,o_=-1,l_=0;function Hs(){return _i&6?kn():o_!==-1?o_:o_=kn()}function bh(w){return w.mode&1?_i&2&&ns!==0?ns&-ns:Ane.transition!==null?(l_===0&&(w=bb,bb<<=1,!(bb&4194240)&&(bb=64),l_=w),l_):(w=Vi,w!==0?w:Re()):1}function uo(w,b,T){if(50<_y)throw _y=0,H2=null,Error(a(185));var D=c_(w,b);return D===null?null:(sy(D,b,T),(!(_i&2)||D!==on)&&(D===on&&(!(_i&2)&&(r_|=b),_n===4&&_h(D,ns)),fa(D,T),b===1&&_i===0&&!(w.mode&1)&&(Fm(),Mb&&Yl())),D)}function c_(w,b){w.lanes|=b;var T=w.alternate;for(T!==null&&(T.lanes|=b),T=w,w=w.return;w!==null;)w.childLanes|=b,T=w.alternate,T!==null&&(T.childLanes|=b),T=w,w=w.return;return T.tag===3?T.stateNode:null}function fa(w,b){var T=w.callbackNode;mne(w,b);var D=Sb(w,w===on?ns:0);if(D===0)T!==null&&$k(T),w.callbackNode=null,w.callbackPriority=0;else if(b=D&-D,w.callbackPriority!==b){if(T!=null&&$k(T),b===1)w.tag===0?Sne(m4.bind(null,w)):ez(m4.bind(null,w)),Oe?Be(function(){_i===0&&Yl()}):KT(ZT,Yl),T=null;else{switch(Zk(D)){case 1:T=ZT;break;case 4:T=xne;break;case 16:T=$T;break;case 536870912:T=wne;break;default:T=$T}T=A4(T,f4.bind(null,w))}w.callbackPriority=b,w.callbackNode=T}}function f4(w,b){if(o_=-1,l_=0,_i&6)throw Error(a(327));var T=w.callbackNode;if(xp()&&w.callbackNode!==T)return null;var D=Sb(w,w===on?ns:0);if(D===0)return null;if(D&30||D&w.expiredLanes||b)b=u_(w,D);else{b=D;var B=_i;_i|=2;var V=y4();(on!==w||ns!==b)&&(Fm(),vp(w,b));do try{Wne();break}catch(De){v4(w,De)}while(1);i2(),i_.current=V,_i=B,ln!==null?b=0:(on=null,ns=0,b=_n)}if(b!==0){if(b===2&&(B=qT(w),B!==0&&(D=B,b=j2(w,B))),b===1)throw T=wy,vp(w,0),_h(w,D),fa(w,kn()),T;if(b===6)_h(w,D);else{if(B=w.current.alternate,!(D&30)&&!Hne(B)&&(b=u_(w,D),b===2&&(V=qT(w),V!==0&&(D=V,b=j2(w,V))),b===1))throw T=wy,vp(w,0),_h(w,D),fa(w,kn()),T;switch(w.finishedWork=B,w.finishedLanes=D,b){case 0:case 1:throw Error(a(345));case 2:yp(w,pa);break;case 3:if(_h(w,D),(D&130023424)===D&&(b=z2+500-kn(),10<b)){if(Sb(w,0)!==0)break;if(B=w.suspendedLanes,(B&D)!==D){Hs(),w.pingedLanes|=w.suspendedLanes&B;break}w.timeoutHandle=he(yp.bind(null,w,pa),b);break}yp(w,pa);break;case 4:if(_h(w,D),(D&4194240)===D)break;for(b=w.eventTimes,B=-1;0<D;){var ce=31-Ko(D);V=1<<ce,ce=b[ce],ce>B&&(B=ce),D&=~V}if(D=B,D=kn()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*Gne(D/1960))-D,10<D){w.timeoutHandle=he(yp.bind(null,w,pa),D);break}yp(w,pa);break;case 5:yp(w,pa);break;default:throw Error(a(329))}}}return fa(w,kn()),w.callbackNode===T?f4.bind(null,w):null}function j2(w,b){var T=by;return w.current.memoizedState.isDehydrated&&(vp(w,b).flags|=256),w=u_(w,b),w!==2&&(b=pa,pa=T,b!==null&&W2(b)),w}function W2(w){pa===null?pa=w:pa.push.apply(pa,w)}function Hne(w){for(var b=w;;){if(b.flags&16384){var T=b.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var D=0;D<T.length;D++){var B=T[D],V=B.getSnapshot;B=B.value;try{if(!Xl(V(),B))return!1}catch{return!1}}}if(T=b.child,b.subtreeFlags&16384&&T!==null)T.return=b,b=T;else{if(b===w)break;for(;b.sibling===null;){if(b.return===null||b.return===w)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function _h(w,b){for(b&=~k2,b&=~r_,w.suspendedLanes|=b,w.pingedLanes&=~b,w=w.expirationTimes;0<b;){var T=31-Ko(b),D=1<<T;w[T]=-1,b&=~D}}function m4(w){if(_i&6)throw Error(a(327));xp();var b=Sb(w,0);if(!(b&1))return fa(w,kn()),null;var T=u_(w,b);if(w.tag!==0&&T===2){var D=qT(w);D!==0&&(b=D,T=j2(w,D))}if(T===1)throw T=wy,vp(w,0),_h(w,b),fa(w,kn()),T;if(T===6)throw Error(a(345));return w.finishedWork=w.current.alternate,w.finishedLanes=b,yp(w,pa),fa(w,kn()),null}function g4(w){wh!==null&&wh.tag===0&&!(_i&6)&&xp();var b=_i;_i|=1;var T=Qr.transition,D=Vi;try{if(Qr.transition=null,Vi=1,w)return w()}finally{Vi=D,Qr.transition=T,_i=b,!(_i&6)&&Yl()}}function X2(){za=Om.current,Q(Om)}function vp(w,b){w.finishedWork=null,w.finishedLanes=0;var T=w.timeoutHandle;if(T!==de&&(w.timeoutHandle=de,ye(T)),ln!==null)for(T=ln.return;T!==null;){var D=T;switch(c2(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&Fa();break;case 3:Im(),Q(Se),Q(ie),g2();break;case 5:f2(D);break;case 4:Im();break;case 13:Q(Tr);break;case 19:Q(Tr);break;case 10:r2(D.type._context);break;case 22:case 23:X2()}T=T.return}if(on=w,ln=w=Sh(w.current,null),ns=za=b,_n=0,wy=null,k2=r_=Bm=0,pa=by=null,ql!==null){for(b=0;b<ql.length;b++)if(T=ql[b],D=T.interleaved,D!==null){T.interleaved=null;var B=D.next,V=T.pending;if(V!==null){var ce=V.next;V.next=B,D.next=ce}T.pending=D}ql=null}return w}function v4(w,b){do{var T=ln;try{if(i2(),Fb.current=Gb,Nb){for(var D=Nr.memoizedState;D!==null;){var B=D.queue;B!==null&&(B.pending=null),D=D.next}Nb=!1}if(Lm=0,zn=bs=Nr=null,hy=!1,dy=0,U2.current=null,T===null||T.return===null){_n=1,wy=b,ln=null;break}e:{var V=w,ce=T.return,De=T,$e=b;if(b=ns,De.flags|=32768,$e!==null&&typeof $e=="object"&&typeof $e.then=="function"){var mt=$e,Lt=De,fi=Lt.tag;if(!(Lt.mode&1)&&(fi===0||fi===11||fi===15)){var Jt=Lt.alternate;Jt?(Lt.updateQueue=Jt.updateQueue,Lt.memoizedState=Jt.memoizedState,Lt.lanes=Jt.lanes):(Lt.updateQueue=null,Lt.memoizedState=null)}var or=Uz(ce);if(or!==null){or.flags&=-257,kz(or,ce,De,V,b),or.mode&1&&Nz(V,mt,b),b=or,$e=mt;var Vt=b.updateQueue;if(Vt===null){var As=new Set;As.add($e),b.updateQueue=As}else Vt.add($e);break e}else{if(!(b&1)){Nz(V,mt,b),Y2();break e}$e=Error(a(426))}}else if(_r&&De.mode&1){var po=Uz(ce);if(po!==null){!(po.flags&65536)&&(po.flags|=256),kz(po,ce,De,V,b),d2($e);break e}}V=$e,_n!==4&&(_n=2),by===null?by=[V]:by.push(V),$e=S2($e,De),De=ce;do{switch(De.tag){case 3:De.flags|=65536,b&=-b,De.lanes|=b;var Ge=Bz(De,$e,b);rz(De,Ge);break e;case 1:V=$e;var Le=De.type,qe=De.stateNode;if(!(De.flags&128)&&(typeof Le.getDerivedStateFromError=="function"||qe!==null&&typeof qe.componentDidCatch=="function"&&(xh===null||!xh.has(qe)))){De.flags|=65536,b&=-b,De.lanes|=b;var Et=Fz(De,V,b);rz(De,Et);break e}}De=De.return}while(De!==null)}w4(T)}catch(kt){b=kt,ln===T&&T!==null&&(ln=T=T.return);continue}break}while(1)}function y4(){var w=i_.current;return i_.current=Gb,w===null?Gb:w}function Y2(){(_n===0||_n===3||_n===2)&&(_n=4),on===null||!(Bm&268435455)&&!(r_&268435455)||_h(on,ns)}function u_(w,b){var T=_i;_i|=2;var D=y4();on===w&&ns===b||vp(w,b);do try{jne();break}catch(B){v4(w,B)}while(1);if(i2(),_i=T,i_.current=D,ln!==null)throw Error(a(261));return on=null,ns=0,_n}function jne(){for(;ln!==null;)x4(ln)}function Wne(){for(;ln!==null&&!vne();)x4(ln)}function x4(w){var b=S4(w.alternate,w,za);w.memoizedProps=w.pendingProps,b===null?w4(w):ln=b,U2.current=null}function w4(w){var b=w;do{var T=b.alternate;if(w=b.return,b.flags&32768){if(T=Nne(T,b),T!==null){T.flags&=32767,ln=T;return}if(w!==null)w.flags|=32768,w.subtreeFlags=0,w.deletions=null;else{_n=6,ln=null;return}}else if(T=One(T,b,za),T!==null){ln=T;return}if(b=b.sibling,b!==null){ln=b;return}ln=b=w}while(b!==null);_n===0&&(_n=5)}function yp(w,b){var T=Vi,D=Qr.transition;try{Qr.transition=null,Vi=1,Xne(w,b,T)}finally{Qr.transition=D,Vi=T}return null}function Xne(w,b,T){do xp();while(wh!==null);if(_i&6)throw Error(a(327));var D=w.finishedWork,B=w.finishedLanes;if(D===null)return null;if(w.finishedWork=null,w.finishedLanes=0,D===w.current)throw Error(a(177));w.callbackNode=null,w.callbackPriority=0;var V=D.lanes|D.childLanes;if(gne(w,V),w===on&&(ln=on=null,ns=0),!(D.subtreeFlags&2064)&&!(D.flags&2064)||s_||(s_=!0,A4($T,function(){return xp(),null})),V=(D.flags&15990)!==0,D.subtreeFlags&15990||V){V=Qr.transition,Qr.transition=null;var ce=Vi;Vi=1;var De=_i;_i|=4,U2.current=null,kne(w,D),zne(w,D),k(w.containerInfo),w.current=D,Vne(D),yne(),_i=De,Vi=ce,Qr.transition=V}else w.current=D;if(s_&&(s_=!1,wh=w,a_=B),V=w.pendingLanes,V===0&&(xh=null),bne(D.stateNode),fa(w,kn()),b!==null)for(T=w.onRecoverableError,D=0;D<b.length;D++)T(b[D]);if(n_)throw n_=!1,w=G2,G2=null,w;return a_&1&&w.tag!==0&&xp(),V=w.pendingLanes,V&1?w===H2?_y++:(_y=0,H2=w):_y=0,Yl(),null}function xp(){if(wh!==null){var w=Zk(a_),b=Qr.transition,T=Vi;try{if(Qr.transition=null,Vi=16>w?16:w,wh===null)var D=!1;else{if(w=wh,wh=null,a_=0,_i&6)throw Error(a(331));var B=_i;for(_i|=4,At=w.current;At!==null;){var V=At,ce=V.child;if(At.flags&16){var De=V.deletions;if(De!==null){for(var $e=0;$e<De.length;$e++){var mt=De[$e];for(At=mt;At!==null;){var Lt=At;switch(Lt.tag){case 0:case 11:case 15:gp(8,Lt,V)}var fi=Lt.child;if(fi!==null)fi.return=Lt,At=fi;else for(;At!==null;){Lt=At;var Jt=Lt.sibling,or=Lt.return;if(n4(Lt),Lt===mt){At=null;break}if(Jt!==null){Jt.return=or,At=Jt;break}At=or}}}var Vt=V.alternate;if(Vt!==null){var As=Vt.child;if(As!==null){Vt.child=null;do{var po=As.sibling;As.sibling=null,As=po}while(As!==null)}}At=V}}if(V.subtreeFlags&2064&&ce!==null)ce.return=V,At=ce;else e:for(;At!==null;){if(V=At,V.flags&2048)switch(V.tag){case 0:case 11:case 15:gp(9,V,V.return)}var Ge=V.sibling;if(Ge!==null){Ge.return=V.return,At=Ge;break e}At=V.return}}var Le=w.current;for(At=Le;At!==null;){ce=At;var qe=ce.child;if(ce.subtreeFlags&2064&&qe!==null)qe.return=ce,At=qe;else e:for(ce=Le;At!==null;){if(De=At,De.flags&2048)try{switch(De.tag){case 0:case 11:case 15:yy(9,De)}}catch(kt){ma(De,De.return,kt)}if(De===ce){At=null;break e}var Et=De.sibling;if(Et!==null){Et.return=De.return,At=Et;break e}At=De.return}}if(_i=B,Yl(),Wl&&typeof Wl.onPostCommitFiberRoot=="function")try{Wl.onPostCommitFiberRoot(Ab,w)}catch{}D=!0}return D}finally{Vi=T,Qr.transition=b}}return!1}function b4(w,b,T){b=S2(T,b),b=Bz(w,b,1),yh(w,b),b=Hs(),w=c_(w,1),w!==null&&(sy(w,1,b),fa(w,b))}function ma(w,b,T){if(w.tag===3)b4(w,w,T);else for(;b!==null;){if(b.tag===3){b4(b,w,T);break}else if(b.tag===1){var D=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(xh===null||!xh.has(D))){w=S2(T,w),w=Fz(b,w,1),yh(b,w),w=Hs(),b=c_(b,1),b!==null&&(sy(b,1,w),fa(b,w));break}}b=b.return}}function Yne(w,b,T){var D=w.pingCache;D!==null&&D.delete(b),b=Hs(),w.pingedLanes|=w.suspendedLanes&T,on===w&&(ns&T)===T&&(_n===4||_n===3&&(ns&130023424)===ns&&500>kn()-z2?vp(w,0):k2|=T),fa(w,b)}function _4(w,b){b===0&&(w.mode&1?(b=_b,_b<<=1,!(_b&130023424)&&(_b=4194304)):b=1);var T=Hs();w=c_(w,b),w!==null&&(sy(w,b,T),fa(w,T))}function qne(w){var b=w.memoizedState,T=0;b!==null&&(T=b.retryLane),_4(w,T)}function Qne(w,b){var T=0;switch(w.tag){case 13:var D=w.stateNode,B=w.memoizedState;B!==null&&(T=B.retryLane);break;case 19:D=w.stateNode;break;default:throw Error(a(314))}D!==null&&D.delete(b),_4(w,T)}var S4;S4=function(w,b,T){if(w!==null)if(w.memoizedProps!==b.pendingProps||Se.current)ka=!0;else{if(!(w.lanes&T)&&!(b.flags&128))return ka=!1,Fne(w,b,T);ka=!!(w.flags&131072)}else ka=!1,_r&&b.flags&1048576&&cz(b,Lb,b.index);switch(b.lanes=0,b.tag){case 2:var D=b.type;w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),w=b.pendingProps;var B=zi(b,ie.current);Em(b,T),B=y2(null,b,D,w,B,T);var V=x2();return b.flags|=1,typeof B=="object"&&B!==null&&typeof B.render=="function"&&B.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,ur(D)?(V=!0,jl(b)):V=!1,b.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,s2(b),B.updater=Rb,b.stateNode=B,B._reactInternals=b,o2(b,D,w,T),b=E2(null,b,D,!0,V,T)):(b.tag=0,_r&&V&&l2(b),Gs(null,b,B,T),b=b.child),b;case 16:D=b.elementType;e:{switch(w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),w=b.pendingProps,B=D._init,D=B(D._payload),b.type=D,B=b.tag=Kne(D),w=Zo(D,w),B){case 0:b=M2(null,b,D,w,T);break e;case 1:b=Yz(null,b,D,w,T);break e;case 11:b=Gz(null,b,D,w,T);break e;case 14:b=Hz(null,b,D,Zo(D.type,w),T);break e}throw Error(a(306,D,""))}return b;case 0:return D=b.type,B=b.pendingProps,B=b.elementType===D?B:Zo(D,B),M2(w,b,D,B,T);case 1:return D=b.type,B=b.pendingProps,B=b.elementType===D?B:Zo(D,B),Yz(w,b,D,B,T);case 3:e:{if(qz(b),w===null)throw Error(a(387));D=b.pendingProps,V=b.memoizedState,B=V.element,iz(w,b),Db(b,D,null,T);var ce=b.memoizedState;if(D=ce.element,we&&V.isDehydrated)if(V={element:D,isDehydrated:!1,cache:ce.cache,transitions:ce.transitions},b.updateQueue.baseState=V,b.memoizedState=V,b.flags&256){B=Error(a(423)),b=Qz(w,b,D,T,B);break e}else if(D!==B){B=Error(a(424)),b=Qz(w,b,D,T,B);break e}else for(we&&(Ua=Fe(b.stateNode.containerInfo),Na=b,_r=!0,$o=null,ay=!1),T=mz(b,null,D,T),b.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Pm(),D===B){b=Zc(w,b,T);break e}Gs(w,b,D,T)}b=b.child}return b;case 5:return gz(b),w===null&&h2(b),D=b.type,B=b.pendingProps,V=w!==null?w.memoizedProps:null,ce=B.children,le(D,B)?ce=null:V!==null&&le(D,V)&&(b.flags|=32),Xz(w,b),Gs(w,b,ce,T),b.child;case 6:return w===null&&h2(b),null;case 13:return Jz(w,b,T);case 4:return p2(b,b.stateNode.containerInfo),D=b.pendingProps,w===null?b.child=Dm(b,null,D,T):Gs(w,b,D,T),b.child;case 11:return D=b.type,B=b.pendingProps,B=b.elementType===D?B:Zo(D,B),Gz(w,b,D,B,T);case 7:return Gs(w,b,b.pendingProps,T),b.child;case 8:return Gs(w,b,b.pendingProps.children,T),b.child;case 12:return Gs(w,b,b.pendingProps.children,T),b.child;case 10:e:{if(D=b.type._context,B=b.pendingProps,V=b.memoizedProps,ce=B.value,tz(b,D,ce),V!==null)if(Xl(V.value,ce)){if(V.children===B.children&&!Se.current){b=Zc(w,b,T);break e}}else for(V=b.child,V!==null&&(V.return=b);V!==null;){var De=V.dependencies;if(De!==null){ce=V.child;for(var $e=De.firstContext;$e!==null;){if($e.context===D){if(V.tag===1){$e=qc(-1,T&-T),$e.tag=2;var mt=V.updateQueue;if(mt!==null){mt=mt.shared;var Lt=mt.pending;Lt===null?$e.next=$e:($e.next=Lt.next,Lt.next=$e),mt.pending=$e}}V.lanes|=T,$e=V.alternate,$e!==null&&($e.lanes|=T),n2(V.return,T,b),De.lanes|=T;break}$e=$e.next}}else if(V.tag===10)ce=V.type===b.type?null:V.child;else if(V.tag===18){if(ce=V.return,ce===null)throw Error(a(341));ce.lanes|=T,De=ce.alternate,De!==null&&(De.lanes|=T),n2(ce,T,b),ce=V.sibling}else ce=V.child;if(ce!==null)ce.return=V;else for(ce=V;ce!==null;){if(ce===b){ce=null;break}if(V=ce.sibling,V!==null){V.return=ce.return,ce=V;break}ce=ce.return}V=ce}Gs(w,b,B.children,T),b=b.child}return b;case 9:return B=b.type,D=b.pendingProps.children,Em(b,T),B=so(B),D=D(B),b.flags|=1,Gs(w,b,D,T),b.child;case 14:return D=b.type,B=Zo(D,b.pendingProps),B=Zo(D.type,B),Hz(w,b,D,B,T);case 15:return jz(w,b,b.type,b.pendingProps,T);case 17:return D=b.type,B=b.pendingProps,B=b.elementType===D?B:Zo(D,B),w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,ur(D)?(w=!0,jl(b)):w=!1,Em(b,T),oz(b,D,B),o2(b,D,B,T),E2(null,b,D,!0,w,T);case 19:return e4(w,b,T);case 22:return Wz(w,b,T)}throw Error(a(156,b.tag))};function A4(w,b){return KT(w,b)}function Jne(w,b,T,D){this.tag=w,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ho(w,b,T,D){return new Jne(w,b,T,D)}function q2(w){return w=w.prototype,!(!w||!w.isReactComponent)}function Kne(w){if(typeof w=="function")return q2(w)?1:0;if(w!=null){if(w=w.$$typeof,w===g)return 11;if(w===x)return 14}return 2}function Sh(w,b){var T=w.alternate;return T===null?(T=ho(w.tag,b,w.key,w.mode),T.elementType=w.elementType,T.type=w.type,T.stateNode=w.stateNode,T.alternate=w,w.alternate=T):(T.pendingProps=b,T.type=w.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=w.flags&14680064,T.childLanes=w.childLanes,T.lanes=w.lanes,T.child=w.child,T.memoizedProps=w.memoizedProps,T.memoizedState=w.memoizedState,T.updateQueue=w.updateQueue,b=w.dependencies,T.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},T.sibling=w.sibling,T.index=w.index,T.ref=w.ref,T}function h_(w,b,T,D,B,V){var ce=2;if(D=w,typeof w=="function")q2(w)&&(ce=1);else if(typeof w=="string")ce=5;else e:switch(w){case u:return wp(T.children,B,V,b);case h:ce=8,B|=8;break;case d:return w=ho(12,T,b,B|2),w.elementType=d,w.lanes=V,w;case m:return w=ho(13,T,b,B),w.elementType=m,w.lanes=V,w;case v:return w=ho(19,T,b,B),w.elementType=v,w.lanes=V,w;case _:return d_(T,B,V,b);default:if(typeof w=="object"&&w!==null)switch(w.$$typeof){case p:ce=10;break e;case f:ce=9;break e;case g:ce=11;break e;case x:ce=14;break e;case y:ce=16,D=null;break e}throw Error(a(130,w==null?w:typeof w,""))}return b=ho(ce,T,b,B),b.elementType=w,b.type=D,b.lanes=V,b}function wp(w,b,T,D){return w=ho(7,w,D,b),w.lanes=T,w}function d_(w,b,T,D){return w=ho(22,w,D,b),w.elementType=_,w.lanes=T,w.stateNode={},w}function Q2(w,b,T){return w=ho(6,w,null,b),w.lanes=T,w}function J2(w,b,T){return b=ho(4,w.children!==null?w.children:[],w.key,b),b.lanes=T,b.stateNode={containerInfo:w.containerInfo,pendingChildren:null,implementation:w.implementation},b}function Zne(w,b,T,D,B){this.tag=b,this.containerInfo=w,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=de,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=QT(0),this.expirationTimes=QT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=QT(0),this.identifierPrefix=D,this.onRecoverableError=B,we&&(this.mutableSourceEagerHydrationData=null)}function M4(w,b,T,D,B,V,ce,De,$e){return w=new Zne(w,b,T,De,$e),b===1?(b=1,V===!0&&(b|=8)):b=0,V=ho(3,null,null,b),w.current=V,V.stateNode=w,V.memoizedState={element:D,isDehydrated:T,cache:null,transitions:null},s2(V),w}function E4(w){if(!w)return ge;w=w._reactInternals;e:{if(E(w)!==w||w.tag!==1)throw Error(a(170));var b=w;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(ur(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(a(171))}if(w.tag===1){var T=w.type;if(ur(T))return Jo(w,T,b)}return b}function C4(w){var b=w._reactInternals;if(b===void 0)throw typeof w.render=="function"?Error(a(188)):(w=Object.keys(w).join(","),Error(a(268,w)));return w=O(b),w===null?null:w.stateNode}function T4(w,b){if(w=w.memoizedState,w!==null&&w.dehydrated!==null){var T=w.retryLane;w.retryLane=T!==0&&T<b?T:b}}function K2(w,b){T4(w,b),(w=w.alternate)&&T4(w,b)}function $ne(w){return w=O(w),w===null?null:w.stateNode}function ese(){return null}return i.attemptContinuousHydration=function(w){if(w.tag===13){var b=Hs();uo(w,134217728,b),K2(w,134217728)}},i.attemptHydrationAtCurrentPriority=function(w){if(w.tag===13){var b=Hs(),T=bh(w);uo(w,T,b),K2(w,T)}},i.attemptSynchronousHydration=function(w){switch(w.tag){case 3:var b=w.stateNode;if(b.current.memoizedState.isDehydrated){var T=ny(b.pendingLanes);T!==0&&(JT(b,T|1),fa(b,kn()),!(_i&6)&&(Fm(),Yl()))}break;case 13:var D=Hs();g4(function(){return uo(w,1,D)}),K2(w,1)}},i.batchedUpdates=function(w,b){var T=_i;_i|=1;try{return w(b)}finally{_i=T,_i===0&&(Fm(),Mb&&Yl())}},i.createComponentSelector=function(w){return{$$typeof:Kb,value:w}},i.createContainer=function(w,b,T,D,B,V,ce){return M4(w,b,!1,null,T,D,B,V,ce)},i.createHasPseudoClassSelector=function(w){return{$$typeof:Zb,value:w}},i.createHydrationContainer=function(w,b,T,D,B,V,ce,De,$e){return w=M4(T,D,!0,w,B,V,ce,De,$e),w.context=E4(null),T=w.current,D=Hs(),B=bh(T),V=qc(D,B),V.callback=b??null,yh(T,V),w.current.lanes=B,sy(w,B,D),fa(w,D),w},i.createPortal=function(w,b,T){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:D==null?null:""+D,children:w,containerInfo:b,implementation:T}},i.createRoleSelector=function(w){return{$$typeof:$b,value:w}},i.createTestNameSelector=function(w){return{$$typeof:e_,value:w}},i.createTextSelector=function(w){return{$$typeof:t_,value:w}},i.deferredUpdates=function(w){var b=Vi,T=Qr.transition;try{return Qr.transition=null,Vi=16,w()}finally{Vi=b,Qr.transition=T}},i.discreteUpdates=function(w,b,T,D,B){var V=Vi,ce=Qr.transition;try{return Qr.transition=null,Vi=1,w(b,T,D,B)}finally{Vi=V,Qr.transition=ce,_i===0&&Fm()}},i.findAllNodes=N2,i.findBoundingRects=function(w,b){if(!at)throw Error(a(363));b=N2(w,b),w=[];for(var T=0;T<b.length;T++)w.push(se(b[T]));for(b=w.length-1;0<b;b--){T=w[b];for(var D=T.x,B=D+T.width,V=T.y,ce=V+T.height,De=b-1;0<=De;De--)if(b!==De){var $e=w[De],mt=$e.x,Lt=mt+$e.width,fi=$e.y,Jt=fi+$e.height;if(D>=mt&&V>=fi&&B<=Lt&&ce<=Jt){w.splice(b,1);break}else if(D!==mt||T.width!==$e.width||Jt<V||fi>ce){if(!(V!==fi||T.height!==$e.height||Lt<D||mt>B)){mt>D&&($e.width+=mt-D,$e.x=D),Lt<B&&($e.width=B-mt),w.splice(b,1);break}}else{fi>V&&($e.height+=fi-V,$e.y=V),Jt<ce&&($e.height=ce-fi),w.splice(b,1);break}}}return w},i.findHostInstance=C4,i.findHostInstanceWithNoPortals=function(w){return w=R(w),w=w!==null?I(w):null,w===null?null:w.stateNode},i.findHostInstanceWithWarning=function(w){return C4(w)},i.flushControlled=function(w){var b=_i;_i|=1;var T=Qr.transition,D=Vi;try{Qr.transition=null,Vi=1,w()}finally{Vi=D,Qr.transition=T,_i=b,_i===0&&(Fm(),Yl())}},i.flushPassiveEffects=xp,i.flushSync=g4,i.focusWithin=function(w,b){if(!at)throw Error(a(363));for(w=O2(w),b=p4(w,b),b=Array.from(b),w=0;w<b.length;){var T=b[w++];if(!H(T)){if(T.tag===5&&X(T.stateNode))return!0;for(T=T.child;T!==null;)b.push(T),T=T.sibling}}return!1},i.getCurrentUpdatePriority=function(){return Vi},i.getFindAllNodesFailureDescription=function(w,b){if(!at)throw Error(a(363));var T=0,D=[];w=[O2(w),0];for(var B=0;B<w.length;){var V=w[B++],ce=w[B++],De=b[ce];if((V.tag!==5||!H(V))&&(B2(V,De)&&(D.push(F2(De)),ce++,ce>T&&(T=ce)),ce<b.length))for(V=V.child;V!==null;)w.push(V,ce),V=V.sibling}if(T<b.length){for(w=[];T<b.length;T++)w.push(F2(b[T]));return`findAllNodes was able to match part of the selector:
  `+(D.join(" > ")+`

No matching component was found for:
  `)+w.join(" > ")}return null},i.getPublicRootInstance=function(w){if(w=w.current,!w.child)return null;switch(w.child.tag){case 5:return K(w.child.stateNode);default:return w.child.stateNode}},i.injectIntoDevTools=function(w){if(w={bundleType:w.bundleType,version:w.version,rendererPackageName:w.rendererPackageName,rendererConfig:w.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:$ne,findFiberByHostInstance:w.findFiberByHostInstance||ese,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")w=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)w=!0;else{try{Ab=b.inject(w),Wl=b}catch{}w=!!b.checkDCE}}return w},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(w,b,T,D){if(!at)throw Error(a(363));w=N2(w,b);var B=Ce(w,T,D).disconnect;return{disconnect:function(){B()}}},i.registerMutableSourceForHydration=function(w,b){var T=b._getVersion;T=T(b._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[b,T]:w.mutableSourceEagerHydrationData.push(b,T)},i.runWithPriority=function(w,b){var T=Vi;try{return Vi=w,b()}finally{Vi=T}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(w,b,T,D){var B=b.current,V=Hs(),ce=bh(B);return T=E4(T),b.context===null?b.context=T:b.pendingContext=T,b=qc(V,ce),b.payload={element:w},D=D===void 0?null:D,D!==null&&(b.callback=D),yh(B,b),w=uo(B,ce,V),w!==null&&Pb(w,B,ce),ce},i};YJ.exports=hge;var dge=YJ.exports;const pge=E0(dge),UN={},fge=e=>void Object.assign(UN,e);function mge(e,t){function i(u,{args:h=[],attach:d,...p},f){let g=`${u[0].toUpperCase()}${u.slice(1)}`,m;if(u==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const v=p.object;m=Vg(v,{type:u,root:f,attach:d,primitive:!0})}else{const v=UN[g];if(!v)throw new Error(`R3F: ${g} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");m=Vg(new v(...h),{type:u,root:f,attach:d,memoizedProps:{args:h}})}return m.__r3f.attach===void 0&&(m instanceof pi?m.__r3f.attach="geometry":m instanceof yn&&(m.__r3f.attach="material")),g!=="inject"&&aD(m,p),m}function r(u,h){let d=!1;if(h){var p,f;(p=h.__r3f)!=null&&p.attach?sD(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(f=u.__r3f)==null||f.objects.push(h),h.__r3f||Vg(h,{}),h.__r3f.parent=u,bL(h),Gg(h)}}function n(u,h,d){let p=!1;if(h){var f,g;if((f=h.__r3f)!=null&&f.attach)sD(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const m=u.children.filter(x=>x!==h),v=m.indexOf(d);u.children=[...m.slice(0,v),h,...m.slice(v)],p=!0}p||(g=u.__r3f)==null||g.objects.push(h),h.__r3f||Vg(h,{}),h.__r3f.parent=u,bL(h),Gg(h)}}function s(u,h,d=!1){u&&[...u].forEach(p=>a(h,p,d))}function a(u,h,d){if(h){var p,f,g;if(h.__r3f&&(h.__r3f.parent=null),(p=u.__r3f)!=null&&p.objects&&(u.__r3f.objects=u.__r3f.objects.filter(_=>_!==h)),(f=h.__r3f)!=null&&f.attach)bG(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var m;u.remove(h),(m=h.__r3f)!=null&&m.root&&Age(yM(h),h)}const x=(g=h.__r3f)==null?void 0:g.primitive,y=!x&&(d===void 0?h.dispose!==null:d);if(!x){var v;s((v=h.__r3f)==null?void 0:v.objects,h,y),s(h.children,h,y)}if(delete h.__r3f,y&&h.dispose&&h.type!=="Scene"){const _=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?xL.unstable_scheduleCallback(xL.unstable_IdlePriority,_):_()}Gg(u)}}function o(u,h,d,p){var f;const g=(f=u.__r3f)==null?void 0:f.parent;if(!g)return;const m=i(h,d,u.__r3f.root);if(u.children){for(const v of u.children)v.__r3f&&r(m,v);u.children=u.children.filter(v=>!v.__r3f)}u.__r3f.objects.forEach(v=>r(m,v)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||a(g,u),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),r(g,m),m.raycast&&m.__r3f.eventCount&&yM(m).getState().internal.interaction.push(m),[p,p.alternate].forEach(v=>{v!==null&&(v.stateNode=m,v.ref&&(typeof v.ref=="function"?v.ref(m):v.ref.current=m))})}const l=()=>{};return{reconciler:pge({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&a(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const p=u.getState().scene;p.__r3f&&n(p,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,p){var f;if(((f=u==null?void 0:u.__r3f)!=null?f:{}).primitive&&p.object&&p.object!==u)return[!0];{const{args:m=[],children:v,...x}=p,{args:y=[],children:_,...A}=d;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((C,M)=>C!==y[M]))return[!0];const S=iK(u,x,A,!0);return S.changes.length?[!1,S]:null}},commitUpdate(u,[h,d],p,f,g,m){h?o(u,p,g,m):aD(u,d)},commitMount(u,h,d,p){var f;const g=(f=u.__r3f)!=null?f:{};u.raycast&&g.handlers&&g.eventCount&&yM(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Vg(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:p}=(h=u.__r3f)!=null?h:{};d&&p&&bG(p,u,d),u.isObject3D&&(u.visible=!1),Gg(u)},unhideInstance(u,h){var d;const{attach:p,parent:f}=(d=u.__r3f)!=null?d:{};p&&f&&sD(f,u,p),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),Gg(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():dv.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&pr.fun(performance.now)?performance.now:pr.fun(Date.now)?Date.now:()=>0,scheduleTimeout:pr.fun(setTimeout)?setTimeout:void 0,cancelTimeout:pr.fun(clearTimeout)?clearTimeout:void 0}),applyProps:aD}}var vG,yG;const nD=e=>"colorSpace"in e||"outputColorSpace"in e,JJ=()=>{var e;return(e=UN.ColorManagement)!=null?e:null},KJ=e=>e&&e.isOrthographicCamera,gge=e=>e&&e.hasOwnProperty("current"),Kw=typeof window<"u"&&((vG=window.document)!=null&&vG.createElement||((yG=window.navigator)==null?void 0:yG.product)==="ReactNative")?fe.useLayoutEffect:fe.useEffect;function ZJ(e){const t=fe.useRef(e);return Kw(()=>void(t.current=e),[e]),t}function vge({set:e}){return Kw(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class $J extends fe.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}$J.getDerivedStateFromError=()=>({error:!0});const eK="__default",xG=new Map,yge=e=>e&&!!e.memoized&&!!e.changes;function tK(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const Vy=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function yM(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const pr={obj:e=>e===Object(e)&&!pr.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(pr.str(e)||pr.num(e)||pr.boo(e))return e===t;const s=pr.obj(e);if(s&&r==="reference")return e===t;const a=pr.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?t:e)if(!pr.equ(e[o],t[o],{strict:n,objects:"reference"}))return!1}else for(o in n?t:e)if(e[o]!==t[o])return!1;if(pr.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function xge(e){const t={nodes:{},materials:{}};return e&&e.traverse(i=>{i.name&&(t.nodes[i.name]=i),i.material&&!t.materials[i.material.name]&&(t.materials[i.material.name]=i.material)}),t}function wge(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function Vg(e,t){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function wL(e,t){let i=e;if(t.includes("-")){const r=t.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],e),{target:i,key:n}}else return{target:i,key:t}}const wG=/-\d+$/;function sD(e,t,i){if(pr.str(i)){if(wG.test(i)){const s=i.replace(wG,""),{target:a,key:o}=wL(e,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=wL(e,i);t.__r3f.previousAttach=r[n],r[n]=t}else t.__r3f.previousAttach=i(e,t)}function bG(e,t,i){var r,n;if(pr.str(i)){const{target:s,key:a}=wL(e,i),o=t.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(n=t.__r3f)==null||delete n.previousAttach}function iK(e,{children:t,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){const u=e.__r3f,h=Object.entries(n),d=[];if(c){const f=Object.keys(l);for(let g=0;g<f.length;g++)n.hasOwnProperty(f[g])||h.unshift([f[g],eK+"remove"])}h.forEach(([f,g])=>{var m;if((m=e.__r3f)!=null&&m.primitive&&f==="object"||pr.equ(g,l[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return d.push([f,g,!0,[]]);let v=[];f.includes("-")&&(v=f.split("-")),d.push([f,g,!1,v]);for(const x in n){const y=n[x];x.startsWith(`${f}-`)&&d.push([x,y,!1,x.split("-")])}});const p={...n};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:d}}const bge=typeof process<"u"&&!1;function aD(e,t){var i;const r=e.__r3f,n=r==null?void 0:r.root,s=n==null||n.getState==null?void 0:n.getState(),{memoized:a,changes:o}=yge(t)?t:iK(e,t),l=r==null?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let u=0;u<o.length;u++){let[h,d,p,f]=o[u];if(nD(e)){const x="srgb",y="srgb-linear";h==="encoding"?(h="colorSpace",d=d===3001?x:y):h==="outputEncoding"&&(h="outputColorSpace",d=d===3001?x:y)}let g=e,m=g[h];if(f.length&&(m=f.reduce((v,x)=>v[x],e),!(m&&m.set))){const[v,...x]=f.reverse();g=x.reverse().reduce((y,_)=>y[_],e),h=v}if(d===eK+"remove")if(g.constructor){let v=xG.get(g.constructor);v||(v=new g.constructor,xG.set(g.constructor,v)),d=v[h]}else d=0;if(p&&r)d?r.handlers[h]=d:delete r.handlers[h],r.eventCount=Object.keys(r.handlers).length;else if(m&&m.set&&(m.copy||m instanceof Lf)){if(Array.isArray(d))m.fromArray?m.fromArray(d):m.set(...d);else if(m.copy&&d&&d.constructor&&(bge?m.constructor.name===d.constructor.name:m.constructor===d.constructor))m.copy(d);else if(d!==void 0){const v=m instanceof bt;!v&&m.setScalar?m.setScalar(d):m instanceof Lf&&d instanceof Lf?m.mask=d.mask:m.set(d),!JJ()&&s&&!s.linear&&v&&m.convertSRGBToLinear()}}else if(g[h]=d,g[h]instanceof mr&&g[h].format===Sa&&g[h].type===Tc&&s){const v=g[h];nD(v)&&nD(s.gl)?v.colorSpace=s.gl.outputColorSpace:v.encoding=s.gl.outputEncoding}Gg(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const u=yM(e).getState().internal,h=u.interaction.indexOf(e);h>-1&&u.interaction.splice(h,1),r.eventCount&&u.interaction.push(e)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(i=e.__r3f)!=null&&i.parent&&bL(e),e}function Gg(e){var t,i;const r=(t=e.__r3f)==null||(i=t.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function bL(e){e.onUpdate==null||e.onUpdate(e)}function _ge(e,t){e.manual||(KJ(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function vS(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Sge(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return dv.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return dv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return dv.ContinuousEventPriority;default:return dv.DefaultEventPriority}}function rK(e,t,i,r){const n=i.get(t);n&&(i.delete(t),i.size===0&&(e.delete(r),n.target.releasePointerCapture(r)))}function Age(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(r=>r!==t),i.initialHits=i.initialHits.filter(r=>r!==t),i.hovered.forEach((r,n)=>{(r.eventObject===t||r.object===t)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{rK(i.capturedMap,t,r,n)})}function Mge(e){function t(l){const{internal:c}=e.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=e.getState(),h=new Set,d=[],p=c?c(u.internal.interaction):u.internal.interaction;for(let v=0;v<p.length;v++){const x=Vy(p[v]);x&&(x.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function f(v){const x=Vy(v);if(!x||!x.events.enabled||x.raycaster.camera===null)return[];if(x.raycaster.camera===void 0){var y;x.events.compute==null||x.events.compute(l,x,(y=x.previousRoot)==null?void 0:y.getState()),x.raycaster.camera===void 0&&(x.raycaster.camera=null)}return x.raycaster.camera?x.raycaster.intersectObject(v,!0):[]}let g=p.flatMap(f).sort((v,x)=>{const y=Vy(v.object),_=Vy(x.object);return!y||!_?v.distance-x.distance:_.events.priority-y.events.priority||v.distance-x.distance}).filter(v=>{const x=vS(v);return h.has(x)?!1:(h.add(x),!0)});u.events.filter&&(g=u.events.filter(g,u));for(const v of g){let x=v.object;for(;x;){var m;(m=x.__r3f)!=null&&m.eventCount&&d.push({...v,eventObject:x}),x=x.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let v of u.internal.capturedMap.get(l.pointerId).values())h.has(vS(v.intersection))||d.push(v.intersection);return d}function n(l,c,u,h){const d=e.getState();if(l.length){const p={stopped:!1};for(const f of l){const g=Vy(f.object)||d,{raycaster:m,pointer:v,camera:x,internal:y}=g,_=new ne(v.x,v.y,0).unproject(x),A=P=>{var R,O;return(R=(O=y.capturedMap.get(P))==null?void 0:O.has(f.eventObject))!=null?R:!1},S=P=>{const R={intersection:f,target:c.target};y.capturedMap.has(P)?y.capturedMap.get(P).set(f.eventObject,R):y.capturedMap.set(P,new Map([[f.eventObject,R]])),c.target.setPointerCapture(P)},C=P=>{const R=y.capturedMap.get(P);R&&rK(y.capturedMap,f.eventObject,R,P)};let M={};for(let P in c){let R=c[P];typeof R!="function"&&(M[P]=R)}let E={...f,...M,pointer:v,intersections:l,stopped:p.stopped,delta:u,unprojectedPoint:_,ray:m.ray,camera:x,stopPropagation(){const P="pointerId"in c&&y.capturedMap.get(c.pointerId);if((!P||P.has(f.eventObject))&&(E.stopped=p.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(R=>R.eventObject===f.eventObject))){const R=l.slice(0,l.indexOf(f));s([...R,f])}},target:{hasPointerCapture:A,setPointerCapture:S,releasePointerCapture:C},currentTarget:{hasPointerCapture:A,setPointerCapture:S,releasePointerCapture:C},nativeEvent:c};if(h(E),p.stopped===!0)break}}return l}function s(l){const{internal:c}=e.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,p=d==null?void 0:d.handlers;if(c.hovered.delete(vS(u)),d!=null&&d.eventCount){const f={...u,intersections:l};p.onPointerOut==null||p.onPointerOut(f),p.onPointerLeave==null||p.onPointerLeave(f)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=e.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=u;const p=l==="onPointerMove",f=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",m=r(u,p?i:void 0),v=f?t(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=m.map(y=>y.eventObject)),f&&!m.length&&v<=2&&(a(u,d.interaction),h&&h(u)),p&&s(m);function x(y){const _=y.eventObject,A=_.__r3f,S=A==null?void 0:A.handlers;if(A!=null&&A.eventCount)if(p){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const C=vS(y),M=d.hovered.get(C);M?M.stopped&&y.stopPropagation():(d.hovered.set(C,y),S.onPointerOver==null||S.onPointerOver(y),S.onPointerEnter==null||S.onPointerEnter(y))}S.onPointerMove==null||S.onPointerMove(y)}else{const C=S[l];C?(!f||d.initialHits.includes(_))&&(a(u,d.interaction.filter(M=>!d.initialHits.includes(M))),C(y)):f&&d.initialHits.includes(_)&&a(u,d.interaction.filter(M=>!d.initialHits.includes(M)))}}n(m,u,v,x)}}return{handlePointer:o}}const nK=e=>!!(e!=null&&e.render),sK=fe.createContext(null),Ege=(e,t)=>{const i=age((o,l)=>{const c=new ne,u=new ne,h=new ne;function d(v=l().camera,x=u,y=l().size){const{width:_,height:A,top:S,left:C}=y,M=_/A;x instanceof ne?h.copy(x):h.set(...x);const E=v.getWorldPosition(c).distanceTo(h);if(KJ(v))return{width:_/v.zoom,height:A/v.zoom,top:S,left:C,factor:1,distance:E,aspect:M};{const P=v.fov*Math.PI/180,R=2*Math.tan(P/2)*E,O=R*(_/A);return{width:O,height:R,top:S,left:C,factor:_/O,distance:E,aspect:M}}}let p;const f=v=>o(x=>({performance:{...x.performance,current:v}})),g=new it;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(v=1)=>e(l(),v),advance:(v,x)=>t(v,x,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ON,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=l();p&&clearTimeout(p),v.performance.current!==v.performance.min&&f(v.performance.min),p=setTimeout(()=>f(l().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:v=>o(x=>({...x,events:{...x.events,...v}})),setSize:(v,x,y,_,A)=>{const S=l().camera,C={width:v,height:x,top:_||0,left:A||0,updateStyle:y};o(M=>({size:C,viewport:{...M.viewport,...d(S,u,C)}}))},setDpr:v=>o(x=>{const y=tK(v);return{viewport:{...x.viewport,dpr:y,initialDpr:x.viewport.initialDpr||y}}}),setFrameloop:(v="always")=>{const x=l().clock;x.stop(),x.elapsedTime=0,v!=="never"&&(x.start(),x.elapsedTime=0),o(()=>({frameloop:v}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:fe.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(v,x,y)=>{const _=l().internal;return _.priority=_.priority+(x>0?1:0),_.subscribers.push({ref:v,priority:x,store:y}),_.subscribers=_.subscribers.sort((A,S)=>A.priority-S.priority),()=>{const A=l().internal;A!=null&&A.subscribers&&(A.priority=A.priority-(x>0?1:0),A.subscribers=A.subscribers.filter(S=>S.ref!==v))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){var d;n=l,s=c.dpr,_ge(o,l),u.setPixelRatio(c.dpr);const p=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,p)}o!==a&&(a=o,h(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};let yS,Cge=new Set,Tge=new Set,Pge=new Set;function oD(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function Gy(e,t){switch(e){case"before":return oD(Cge,t);case"after":return oD(Tge,t);case"tail":return oD(Pge,t)}}let lD,cD;function uD(e,t,i){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),lD=t.internal.subscribers,yS=0;yS<lD.length;yS++)cD=lD[yS],cD.ref.current(cD.store.getState(),r,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Dge(e){let t=!1,i=!1,r,n,s;function a(c){n=requestAnimationFrame(a),t=!0,r=0,Gy("before",c),i=!0;for(const h of e.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=uD(c,s))}if(i=!1,Gy("after",c),r===0)return Gy("tail",c),t=!1,cancelAnimationFrame(n)}function o(c,u=1){var h;if(!c)return e.forEach(d=>o(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):i?c.internal.frames=2:c.internal.frames=1,t||(t=!0,requestAnimationFrame(a)))}function l(c,u=!0,h,d){if(u&&Gy("before",c),h)uD(c,h,d);else for(const p of e.values())uD(c,p.store.getState());u&&Gy("after",c)}return{loop:a,invalidate:o,advance:l}}function aK(){const e=fe.useContext(sK);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Xa(e=i=>i,t){return aK()(e,t)}function k0(e,t=0){const i=aK(),r=i.getState().internal.subscribe,n=ZJ(e);return Kw(()=>r(n,t,i),[t,r,i]),null}const _G=new WeakMap;function oK(e,t){return function(i,...r){let n=_G.get(i);return n||(n=new i,_G.set(i,n)),e&&e(n),Promise.all(r.map(s=>new Promise((a,o)=>n.load(s,l=>{l.scene&&Object.assign(l,xge(l.scene)),a(l)},t,l=>o(new Error(`Could not load ${s}: ${l==null?void 0:l.message}`))))))}}function sp(e,t,i,r){const n=Array.isArray(t)?t:[t],s=lge(oK(i,r),[e,...n],{equal:pr.equ});return Array.isArray(t)?s:s[0]}sp.preload=function(e,t,i){const r=Array.isArray(t)?t:[t];return cge(oK(i),[e,...r])};sp.clear=function(e,t){const i=Array.isArray(t)?t:[t];return uge([e,...i])};const l0=new Map,{invalidate:SG,advance:AG}=Dge(l0),{reconciler:gE,applyProps:mc}=mge(l0,Sge),og={objects:"shallow",strict:!1},Rge=(e,t)=>{const i=typeof e=="function"?e(t):e;return nK(i)?i:new hN({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Ige(e,t){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=t;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:n,top:s,left:a}=e.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function Lge(e){const t=l0.get(e),i=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||Ege(SG,AG),a=i||gE.createContainer(s,dv.ConcurrentRoot,null,!1,null,"",n,null);t||l0.set(e,{fiber:a,store:s});let o,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:p,events:f,onCreated:g,shadows:m=!1,linear:v=!1,flat:x=!1,legacy:y=!1,orthographic:_=!1,frameloop:A="always",dpr:S=[1,2],performance:C,raycaster:M,camera:E,onPointerMissed:P}=u,R=s.getState(),O=R.gl;R.gl||R.set({gl:O=Rge(h,e)});let L=R.raycaster;L||R.set({raycaster:L=new GJ});const{params:I,...z}=M||{};if(pr.equ(z,L,og)||mc(L,{...z}),pr.equ(I,L.params,og)||mc(L,{params:{...L.params,...I}}),!R.camera||R.camera===c&&!pr.equ(c,E,og)){c=E;const k=E instanceof Iw,q=k?E:_?new Pl(0,0,0,0,.1,1e3):new Mr(75,0,.1,1e3);k||(q.position.z=5,E&&(mc(q,E),("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(q.manual=!0,q.updateProjectionMatrix())),!R.camera&&!(E!=null&&E.rotation)&&q.lookAt(0,0,0)),R.set({camera:q}),L.camera=q}if(!R.scene){let k;p instanceof mE?k=p:(k=new mE,p&&mc(k,p)),R.set({scene:Vg(k)})}if(!R.xr){var K;const k=(te,G)=>{const le=s.getState();le.frameloop!=="never"&&AG(te,!0,le,G)},q=()=>{const te=s.getState();te.gl.xr.enabled=te.gl.xr.isPresenting,te.gl.xr.setAnimationLoop(te.gl.xr.isPresenting?k:null),te.gl.xr.isPresenting||SG(te)},W={connect(){const te=s.getState().gl;te.xr.addEventListener("sessionstart",q),te.xr.addEventListener("sessionend",q)},disconnect(){const te=s.getState().gl;te.xr.removeEventListener("sessionstart",q),te.xr.removeEventListener("sessionend",q)}};typeof((K=O.xr)==null?void 0:K.addEventListener)=="function"&&W.connect(),R.set({xr:W})}if(O.shadowMap){const k=O.shadowMap.enabled,q=O.shadowMap.type;if(O.shadowMap.enabled=!!m,pr.boo(m))O.shadowMap.type=Z1;else if(pr.str(m)){var Y;const W={basic:Jq,percentage:KC,soft:Z1,variance:gl};O.shadowMap.type=(Y=W[m])!=null?Y:Z1}else pr.obj(m)&&Object.assign(O.shadowMap,m);(k!==O.shadowMap.enabled||q!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const U=JJ();U&&("enabled"in U?U.enabled=!y:"legacyMode"in U&&(U.legacyMode=y)),l||mc(O,{outputEncoding:v?3e3:3001,toneMapping:x?Tl:HF}),R.legacy!==y&&R.set(()=>({legacy:y})),R.linear!==v&&R.set(()=>({linear:v})),R.flat!==x&&R.set(()=>({flat:x})),h&&!pr.fun(h)&&!nK(h)&&!pr.equ(h,O,og)&&mc(O,h),f&&!R.events.handlers&&R.set({events:f(s)});const j=Ige(e,d);return pr.equ(j,R.size,og)||R.setSize(j.width,j.height,j.updateStyle,j.top,j.left),S&&R.viewport.dpr!==tK(S)&&R.setDpr(S),R.frameloop!==A&&R.setFrameloop(A),R.onPointerMissed||R.set({onPointerMissed:P}),C&&!pr.equ(C,R.performance,og)&&R.set(k=>({performance:{...k.performance,...C}})),o=g,l=!0,this},render(u){return l||this.configure(),gE.updateContainer(He.jsx(Oge,{store:s,children:u,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){lK(e)}}}function Oge({store:e,children:t,onCreated:i,rootElement:r}){return Kw(()=>{const n=e.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),e.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),He.jsx(sK.Provider,{value:e,children:t})}function lK(e,t){const i=l0.get(e),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),gE.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),wge(n),l0.delete(e),t&&t(e)}catch{}},500)})}}gE.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:fe.version});const hD={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Bge(e){const{handlePointer:t}=Mge(e);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(hD).reduce((i,r)=>({...i,[r]:t(r)}),{}),update:()=>{var i;const{events:r,internal:n}=e.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=e.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=hD[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=e.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=hD[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}function _L(e,t,i){var r,n,s,a,o;t==null&&(t=100);function l(){var u=Date.now()-a;u<t&&u>=0?r=setTimeout(l,t-u):(r=null,i||(o=e.apply(s,n),s=n=null))}var c=function(){s=this,n=arguments,a=Date.now();var u=i&&!r;return r||(r=setTimeout(l,t)),u&&(o=e.apply(s,n),s=n=null),o};return c.clear=function(){r&&(clearTimeout(r),r=null)},c.flush=function(){r&&(o=e.apply(s,n),s=n=null,clearTimeout(r),r=null)},c}_L.debounce=_L;var Fge=_L;const MG=E0(Fge);var Nge=Object.defineProperty,Uge=Object.defineProperties,kge=Object.getOwnPropertyDescriptors,EG=Object.getOwnPropertySymbols,zge=Object.prototype.hasOwnProperty,Vge=Object.prototype.propertyIsEnumerable,CG=(e,t,i)=>t in e?Nge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,TG=(e,t)=>{for(var i in t||(t={}))zge.call(t,i)&&CG(e,i,t[i]);if(EG)for(var i of EG(t))Vge.call(t,i)&&CG(e,i,t[i]);return e},Gge=(e,t)=>Uge(e,kge(t)),PG,DG;typeof window<"u"&&((PG=window.document)!=null&&PG.createElement||((DG=window.navigator)==null?void 0:DG.product)==="ReactNative")?fe.useLayoutEffect:fe.useEffect;function cK(e,t,i){if(!e)return;if(i(e)===!0)return e;let r=t?e.return:e.child;for(;r;){const n=cK(r,t,i);if(n)return n;r=t?null:r.sibling}}function uK(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const RG=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=RG;return}return RG.apply(this,arguments)};const kN=uK(fe.createContext(null));class hK extends fe.Component{render(){return fe.createElement(kN.Provider,{value:this._reactInternals},this.props.children)}}function Hge(){const e=fe.useContext(kN);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=fe.useId();return fe.useMemo(()=>{for(const r of[e,e==null?void 0:e.alternate]){if(!r)continue;const n=cK(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===t)return!0;a=a.next}});if(n)return n}},[e,t])}function jge(){const e=Hge(),[t]=fe.useState(()=>new Map);t.clear();let i=e;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==kN&&!t.has(n)&&t.set(n,fe.useContext(uK(n)))}i=i.return}return t}function Wge(){const e=jge();return fe.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>r=>fe.createElement(t,null,fe.createElement(i.Provider,Gge(TG({},r),{value:e.get(i)}))),t=>fe.createElement(hK,TG({},t))),[e])}function Xge({debounce:e,scroll:t,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||typeof window<"u"&&window.ResizeObserver,[s,a]=fe.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!n)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const o=fe.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=fe.useRef(!1);fe.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,p]=fe.useMemo(()=>{const v=()=>{if(!o.current.element)return;const{left:x,top:y,width:_,height:A,bottom:S,right:C,x:M,y:E}=o.current.element.getBoundingClientRect(),P={left:x,top:y,width:_,height:A,bottom:S,right:C,x:M,y:E};o.current.element instanceof HTMLElement&&r&&(P.height=o.current.element.offsetHeight,P.width=o.current.element.offsetWidth),Object.freeze(P),u.current&&!Jge(o.current.lastBounds,P)&&a(o.current.lastBounds=P)};return[v,c?MG(v,c):v,l?MG(v,l):v]},[a,r,l,c]);function f(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(v=>v.removeEventListener("scroll",p,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function g(){var v;o.current.element&&(o.current.resizeObserver=new n(d),(v=o.current.resizeObserver)==null||v.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(x=>x.addEventListener("scroll",p,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const m=v=>{!v||v===o.current.element||(f(),o.current.element=v,o.current.scrollContainers=dK(v),g())};return qge(p,!!t),Yge(d),fe.useEffect(()=>{f(),g()},[t,p,d]),fe.useEffect(()=>f,[]),[m,s,h]}function Yge(e){fe.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function qge(e,t){fe.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function dK(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...dK(e.parentElement)]}const Qge=["x","y","top","bottom","left","right","width","height"],Jge=(e,t)=>Qge.every(i=>e[i]===t[i]),Kge=fe.forwardRef(function({children:t,fallback:i,resize:r,style:n,gl:s,events:a=Bge,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:f,dpr:g,performance:m,raycaster:v,camera:x,scene:y,onPointerMissed:_,onCreated:A,...S},C){fe.useMemo(()=>fge(rge),[]);const M=Wge(),[E,P]=Xge({scroll:!0,debounce:{scroll:50,resize:0},...r}),R=fe.useRef(null),O=fe.useRef(null);fe.useImperativeHandle(C,()=>R.current);const L=ZJ(_),[I,z]=fe.useState(!1),[K,Y]=fe.useState(!1);if(I)throw I;if(K)throw K;const U=fe.useRef(null);Kw(()=>{const k=R.current;P.width>0&&P.height>0&&k&&(U.current||(U.current=Lge(k)),U.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:f,dpr:g,performance:m,raycaster:v,camera:x,scene:y,size:P,onPointerMissed:(...q)=>L.current==null?void 0:L.current(...q),onCreated:q=>{q.events.connect==null||q.events.connect(o?gge(o)?o.current:o:O.current),l&&q.setEvents({compute:(W,te)=>{const G=W[l+"X"],le=W[l+"Y"];te.pointer.set(G/te.size.width*2-1,-(le/te.size.height)*2+1),te.raycaster.setFromCamera(te.pointer,te.camera)}}),A==null||A(q)}}),U.current.render(He.jsx(M,{children:He.jsx($J,{set:Y,children:He.jsx(fe.Suspense,{fallback:He.jsx(vge,{set:z}),children:t})})})))}),fe.useEffect(()=>{const k=R.current;if(k)return()=>lK(k)},[]);const j=o?"none":"auto";return He.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:j,...n},...S,children:He.jsx("div",{ref:E,style:{width:"100%",height:"100%"},children:He.jsx("canvas",{ref:R,style:{display:"block"},children:i})})})}),pK=fe.forwardRef(function(t,i){return He.jsx(hK,{children:He.jsx(Kge,{...t,ref:i})})});function Uc(){return Uc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Uc.apply(null,arguments)}var fK,IG=Nq;fK=IG.createRoot,IG.hydrateRoot;const Zw=new ne,zN=new ne,Zge=new ne,LG=new it;function $ge(e,t,i){const r=Zw.setFromMatrixPosition(e.matrixWorld);r.project(t);const n=i.width/2,s=i.height/2;return[r.x*n+n,-(r.y*s)+s]}function eve(e,t){const i=Zw.setFromMatrixPosition(e.matrixWorld),r=zN.setFromMatrixPosition(t.matrixWorld),n=i.sub(r),s=t.getWorldDirection(Zge);return n.angleTo(s)>Math.PI/2}function tve(e,t,i,r){const n=Zw.setFromMatrixPosition(e.matrixWorld),s=n.clone();s.project(t),LG.set(s.x,s.y),i.setFromCamera(LG,t);const a=i.intersectObjects(r,!0);if(a.length){const o=a[0].distance;return n.distanceTo(i.ray.origin)<o}return!0}function ive(e,t){if(t instanceof Pl)return t.zoom;if(t instanceof Mr){const i=Zw.setFromMatrixPosition(e.matrixWorld),r=zN.setFromMatrixPosition(t.matrixWorld),n=t.fov*Math.PI/180,s=i.distanceTo(r);return 1/(2*Math.tan(n/2)*s)}else return 1}function rve(e,t,i){if(t instanceof Mr||t instanceof Pl){const r=Zw.setFromMatrixPosition(e.matrixWorld),n=zN.setFromMatrixPosition(t.matrixWorld),s=r.distanceTo(n),a=(i[1]-i[0])/(t.far-t.near),o=i[1]-a*t.far;return Math.round(a*s+o)}}const SL=e=>Math.abs(e)<1e-10?0:e;function mK(e,t,i=""){let r="matrix3d(";for(let n=0;n!==16;n++)r+=SL(t[n]*e.elements[n])+(n!==15?",":")");return i+r}const nve=(e=>t=>mK(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),sve=(e=>(t,i)=>mK(t,e(i),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function ave(e){return e&&typeof e=="object"&&"current"in e}const ove=fe.forwardRef(({children:e,eps:t=.001,style:i,className:r,prepend:n,center:s,fullscreen:a,portal:o,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:d,castShadow:p,receiveShadow:f,material:g,geometry:m,zIndexRange:v=[16777271,0],calculatePosition:x=$ge,as:y="div",wrapperClass:_,pointerEvents:A="auto",...S},C)=>{const{gl:M,camera:E,scene:P,size:R,raycaster:O,events:L,viewport:I}=Xa(),[z]=fe.useState(()=>document.createElement(y)),K=fe.useRef(),Y=fe.useRef(null),U=fe.useRef(0),j=fe.useRef([0,0]),k=fe.useRef(null),q=fe.useRef(null),W=(o==null?void 0:o.current)||L.connected||M.domElement.parentNode,te=fe.useRef(null),G=fe.useRef(!1),le=fe.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&ave(h[0]),[h]);fe.useLayoutEffect(()=>{const xe=M.domElement;h&&h==="blending"?(xe.style.zIndex=`${Math.floor(v[0]/2)}`,xe.style.position="absolute",xe.style.pointerEvents="none"):(xe.style.zIndex=null,xe.style.position=null,xe.style.pointerEvents=null)},[h]),fe.useLayoutEffect(()=>{if(Y.current){const xe=K.current=fK(z);if(P.updateMatrixWorld(),u)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const me=x(Y.current,E,R);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${me[0]}px,${me[1]}px,0);transform-origin:0 0;`}return W&&(n?W.prepend(z):W.appendChild(z)),()=>{W&&W.removeChild(z),xe.unmount()}}},[W,u]),fe.useLayoutEffect(()=>{_&&(z.className=_)},[_]);const Z=fe.useMemo(()=>u?{position:"absolute",top:0,left:0,width:R.width,height:R.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-R.height/2,left:-R.width/2,width:R.width,height:R.height},...i},[i,s,a,R,u]),he=fe.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);fe.useLayoutEffect(()=>{if(G.current=!1,u){var xe;(xe=K.current)==null||xe.render(fe.createElement("div",{ref:k,style:Z},fe.createElement("div",{ref:q,style:he},fe.createElement("div",{ref:C,className:r,style:i,children:e}))))}else{var me;(me=K.current)==null||me.render(fe.createElement("div",{ref:C,style:Z,className:r,children:e}))}});const ye=fe.useRef(!0);k0(xe=>{if(Y.current){E.updateMatrixWorld(),Y.current.updateWorldMatrix(!0,!1);const me=u?j.current:x(Y.current,E,R);if(u||Math.abs(U.current-E.zoom)>t||Math.abs(j.current[0]-me[0])>t||Math.abs(j.current[1]-me[1])>t){const ee=eve(Y.current,E);let we=!1;le&&(Array.isArray(h)?we=h.map(Xe=>Xe.current):h!=="blending"&&(we=[P]));const Ae=ye.current;if(we){const Xe=tve(Y.current,E,O,we);ye.current=Xe&&!ee}else ye.current=!ee;Ae!==ye.current&&(d?d(!ye.current):z.style.display=ye.current?"block":"none");const Te=Math.floor(v[0]/2),Re=h?le?[v[0],Te]:[Te-1,0]:v;if(z.style.zIndex=`${rve(Y.current,E,Re)}`,u){const[Xe,Oe]=[R.width/2,R.height/2],Be=E.projectionMatrix.elements[5]*Oe,{isOrthographicCamera:at,top:ht,left:se,bottom:N,right:H}=E,ve=nve(E.matrixWorldInverse),X=at?`scale(${Be})translate(${SL(-(H+se)/2)}px,${SL((ht+N)/2)}px)`:`translateZ(${Be}px)`;let Ce=Y.current.matrixWorld;c&&(Ce=E.matrixWorldInverse.clone().transpose().copyPosition(Ce).scale(Y.current.scale),Ce.elements[3]=Ce.elements[7]=Ce.elements[11]=0,Ce.elements[15]=1),z.style.width=R.width+"px",z.style.height=R.height+"px",z.style.perspective=at?"":`${Be}px`,k.current&&q.current&&(k.current.style.transform=`${X}${ve}translate(${Xe}px,${Oe}px)`,q.current.style.transform=sve(Ce,1/((l||10)/400)))}else{const Xe=l===void 0?1:ive(Y.current,E)*l;z.style.transform=`translate3d(${me[0]}px,${me[1]}px,0) scale(${Xe})`}j.current=me,U.current=E.zoom}}if(!le&&te.current&&!G.current)if(u){if(k.current){const me=k.current.children[0];if(me!=null&&me.clientWidth&&me!=null&&me.clientHeight){const{isOrthographicCamera:ee}=E;if(ee||m)S.scale&&(Array.isArray(S.scale)?S.scale instanceof ne?te.current.scale.copy(S.scale.clone().divideScalar(1)):te.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):te.current.scale.setScalar(1/S.scale));else{const we=(l||10)/400,Ae=me.clientWidth*we,Te=me.clientHeight*we;te.current.scale.set(Ae,Te,1)}G.current=!0}}}else{const me=z.children[0];if(me!=null&&me.clientWidth&&me!=null&&me.clientHeight){const ee=1/I.factor,we=me.clientWidth*ee,Ae=me.clientHeight*ee;te.current.scale.set(we,Ae,1),G.current=!0}te.current.lookAt(xe.camera.position)}});const de=fe.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return fe.createElement("group",Uc({},S,{ref:Y}),h&&!le&&fe.createElement("mesh",{castShadow:p,receiveShadow:f,ref:te},m||fe.createElement("planeGeometry",null),g||fe.createElement("shaderMaterial",{side:Bo,vertexShader:de.vertexShader,fragmentShader:de.fragmentShader})))}),OG=e=>{let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(!Object.is(h,t)){const d=t;t=u??(typeof h!="object"||h===null)?h:Object.assign({},t,h),i.forEach(p=>p(t,d))}},n=()=>t,o={setState:r,getState:n,getInitialState:()=>l,subscribe:c=>(i.add(c),()=>i.delete(c))},l=t=e(r,n,o);return o},lve=e=>e?OG(e):OG,cve=e=>e;function uve(e,t=cve){const i=Ku.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return Ku.useDebugValue(i),i}const BG=e=>{const t=lve(e),i=r=>uve(t,r);return Object.assign(i,t),i},hve=e=>e?BG(e):BG;let Hy=0;const dve=hve(e=>(hv.onStart=(t,i,r)=>{e({active:!0,item:t,loaded:i,total:r,progress:(i-Hy)/(r-Hy)*100})},hv.onLoad=()=>{e({active:!1})},hv.onError=t=>e(i=>({errors:[...i.errors,t]})),hv.onProgress=(t,i,r)=>{i===r&&(Hy=r),e({active:!0,item:t,loaded:i,total:r,progress:(i-Hy)/(r-Hy)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function Lv(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function FG(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function NG(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?FG(Object(i),!0).forEach(function(r){Lv(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FG(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}new it;new it;function gK(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var mo=function e(t,i,r){var n=this;gK(this,e),Lv(this,"dot2",function(s,a){return n.x*s+n.y*a}),Lv(this,"dot3",function(s,a,o){return n.x*s+n.y*a+n.z*o}),this.x=t,this.y=i,this.z=r},pve=[new mo(1,1,0),new mo(-1,1,0),new mo(1,-1,0),new mo(-1,-1,0),new mo(1,0,1),new mo(-1,0,1),new mo(1,0,-1),new mo(-1,0,-1),new mo(0,1,1),new mo(0,-1,1),new mo(0,1,-1),new mo(0,-1,-1)],UG=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],kG=new Array(512),zG=new Array(512),fve=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var i=0;i<256;i++){var r;i&1?r=UG[i]^t&255:r=UG[i]^t>>8&255,kG[i]=kG[i+256]=r,zG[i]=zG[i+256]=pve[r%12]}};fve(0);function mve(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var i=0;i<t.length;i++)e=(e+(i+1)*(t.charCodeAt(i)%96))%2147483647}return e===0&&(e=311),e}function VG(e){var t=mve(e);return function(){var i=t*48271%2147483647;return t=i,i/2147483647}}var gve=function e(t){var i=this;gK(this,e),Lv(this,"seed",0),Lv(this,"init",function(r){i.seed=r,i.value=VG(r)}),Lv(this,"value",VG(this.seed)),this.init(t)},vve=new gve(Math.random()),yve={radius:1,center:[0,0,0]};function xve(e,t){for(var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vve,r=NG(NG({},yve),t),n=r.radius,s=r.center,a=0;a<e.length;a+=3){var o=Math.pow(i.value(),.3333333333333333),l=i.value()*2-1,c=i.value()*2-1,u=i.value()*2-1,h=Math.sqrt(l*l+c*c+u*u);l=o*l/h,c=o*c/h,u=o*u/h,e[a]=l*n+s[0],e[a+1]=c*n+s[1],e[a+2]=u*n+s[2]}return e}const wve=parseInt(R0.replace(/\D+/g,""));function GG(e,t){if(t===OQ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===dE||t===KF){let i=e.getIndex();if(i===null){const a=[],o=e.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);e.setIndex(a),i=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}const r=i.count-2,n=[];if(i)if(t===dE)for(let a=1;a<=r;a++)n.push(i.getX(0)),n.push(i.getX(a)),n.push(i.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(n.push(i.getX(a)),n.push(i.getX(a+1)),n.push(i.getX(a+2))):(n.push(i.getX(a+2)),n.push(i.getX(a+1)),n.push(i.getX(a)));n.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(n),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}var bve=Object.defineProperty,_ve=(e,t,i)=>t in e?bve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Sve=(e,t,i)=>(_ve(e,typeof t!="symbol"?t+"":t,i),i);class Ave{constructor(){Sve(this,"_listeners")}addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}var Mve=Object.defineProperty,Eve=(e,t,i)=>t in e?Mve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Kt=(e,t,i)=>(Eve(e,typeof t!="symbol"?t+"":t,i),i);const xS=new hm,HG=new Mu,Cve=Math.cos(70*(Math.PI/180)),jG=(e,t)=>(e%t+t)%t;let Tve=class extends Ave{constructor(t,i){super(),Kt(this,"object"),Kt(this,"domElement"),Kt(this,"enabled",!0),Kt(this,"target",new ne),Kt(this,"minDistance",0),Kt(this,"maxDistance",1/0),Kt(this,"minZoom",0),Kt(this,"maxZoom",1/0),Kt(this,"minPolarAngle",0),Kt(this,"maxPolarAngle",Math.PI),Kt(this,"minAzimuthAngle",-1/0),Kt(this,"maxAzimuthAngle",1/0),Kt(this,"enableDamping",!1),Kt(this,"dampingFactor",.05),Kt(this,"enableZoom",!0),Kt(this,"zoomSpeed",1),Kt(this,"enableRotate",!0),Kt(this,"rotateSpeed",1),Kt(this,"enablePan",!0),Kt(this,"panSpeed",1),Kt(this,"screenSpacePanning",!0),Kt(this,"keyPanSpeed",7),Kt(this,"zoomToCursor",!1),Kt(this,"autoRotate",!1),Kt(this,"autoRotateSpeed",2),Kt(this,"reverseOrbit",!1),Kt(this,"reverseHorizontalOrbit",!1),Kt(this,"reverseVerticalOrbit",!1),Kt(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Kt(this,"mouseButtons",{LEFT:jp.ROTATE,MIDDLE:jp.DOLLY,RIGHT:jp.PAN}),Kt(this,"touches",{ONE:Wp.ROTATE,TWO:Wp.DOLLY_PAN}),Kt(this,"target0"),Kt(this,"position0"),Kt(this,"zoom0"),Kt(this,"_domElementKeyEvents",null),Kt(this,"getPolarAngle"),Kt(this,"getAzimuthalAngle"),Kt(this,"setPolarAngle"),Kt(this,"setAzimuthalAngle"),Kt(this,"getDistance"),Kt(this,"getZoomScale"),Kt(this,"listenToKeyEvents"),Kt(this,"stopListenToKeyEvents"),Kt(this,"saveState"),Kt(this,"reset"),Kt(this,"update"),Kt(this,"connect"),Kt(this,"dispose"),Kt(this,"dollyIn"),Kt(this,"dollyOut"),Kt(this,"getScale"),Kt(this,"setScale"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=oe=>{let je=jG(oe,2*Math.PI),dt=u.phi;dt<0&&(dt+=2*Math.PI),je<0&&(je+=2*Math.PI);let J=Math.abs(je-dt);2*Math.PI-J<J&&(je<dt?je+=2*Math.PI:dt+=2*Math.PI),h.phi=je-dt,r.update()},this.setAzimuthalAngle=oe=>{let je=jG(oe,2*Math.PI),dt=u.theta;dt<0&&(dt+=2*Math.PI),je<0&&(je+=2*Math.PI);let J=Math.abs(je-dt);2*Math.PI-J<J&&(je<dt?je+=2*Math.PI:dt+=2*Math.PI),h.theta=je-dt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=oe=>{oe.addEventListener("keydown",Ve),this._domElementKeyEvents=oe},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Ve),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const oe=new ne,je=new ne(0,1,0),dt=new ts().setFromUnitVectors(t.up,je),J=dt.clone().invert(),be=new ne,ue=new ts,Ne=2*Math.PI;return function(){const _t=r.object.position;dt.setFromUnitVectors(t.up,je),J.copy(dt).invert(),oe.copy(_t).sub(r.target),oe.applyQuaternion(dt),u.setFromVector3(oe),r.autoRotate&&l===o.NONE&&I(O()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let zt=r.minAzimuthAngle,ti=r.maxAzimuthAngle;isFinite(zt)&&isFinite(ti)&&(zt<-Math.PI?zt+=Ne:zt>Math.PI&&(zt-=Ne),ti<-Math.PI?ti+=Ne:ti>Math.PI&&(ti-=Ne),zt<=ti?u.theta=Math.max(zt,Math.min(ti,u.theta)):u.theta=u.theta>(zt+ti)/2?Math.max(zt,u.theta):Math.min(ti,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(p,r.dampingFactor):r.target.add(p),r.zoomToCursor&&E||r.object.isOrthographicCamera?u.radius=te(u.radius):u.radius=te(u.radius*d),oe.setFromSpherical(u),oe.applyQuaternion(J),_t.copy(r.target).add(oe),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,p.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let ar=!1;if(r.zoomToCursor&&E){let Ut=null;if(r.object instanceof Mr&&r.object.isPerspectiveCamera){const Wi=oe.length();Ut=te(Wi*d);const Ai=Wi-Ut;r.object.position.addScaledVector(C,Ai),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Wi=new ne(M.x,M.y,0);Wi.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),ar=!0;const Ai=new ne(M.x,M.y,0);Ai.unproject(r.object),r.object.position.sub(Ai).add(Wi),r.object.updateMatrixWorld(),Ut=oe.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Ut!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Ut).add(r.object.position):(xS.origin.copy(r.object.position),xS.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(xS.direction))<Cve?t.lookAt(r.target):(HG.setFromNormalAndCoplanarPoint(r.object.up,r.target),xS.intersectPlane(HG,r.target))))}else r.object instanceof Pl&&r.object.isOrthographicCamera&&(ar=d!==1,ar&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,E=!1,ar||be.distanceToSquared(r.object.position)>c||8*(1-ue.dot(r.object.quaternion))>c?(r.dispatchEvent(n),be.copy(r.object.position),ue.copy(r.object.quaternion),ar=!1,!0):!1}})(),this.connect=oe=>{r.domElement=oe,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",Pe),r.domElement.addEventListener("pointerdown",se),r.domElement.addEventListener("pointercancel",H),r.domElement.addEventListener("wheel",Ce)},this.dispose=()=>{var oe,je,dt,J,be,ue;r.domElement&&(r.domElement.style.touchAction="auto"),(oe=r.domElement)==null||oe.removeEventListener("contextmenu",Pe),(je=r.domElement)==null||je.removeEventListener("pointerdown",se),(dt=r.domElement)==null||dt.removeEventListener("pointercancel",H),(J=r.domElement)==null||J.removeEventListener("wheel",Ce),(be=r.domElement)==null||be.ownerDocument.removeEventListener("pointermove",N),(ue=r.domElement)==null||ue.ownerDocument.removeEventListener("pointerup",H),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Ve)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new yL,h=new yL;let d=1;const p=new ne,f=new it,g=new it,m=new it,v=new it,x=new it,y=new it,_=new it,A=new it,S=new it,C=new ne,M=new it;let E=!1;const P=[],R={};function O(){return 2*Math.PI/60/60*r.autoRotateSpeed}function L(){return Math.pow(.95,r.zoomSpeed)}function I(oe){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=oe:h.theta-=oe}function z(oe){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=oe:h.phi-=oe}const K=(()=>{const oe=new ne;return function(dt,J){oe.setFromMatrixColumn(J,0),oe.multiplyScalar(-dt),p.add(oe)}})(),Y=(()=>{const oe=new ne;return function(dt,J){r.screenSpacePanning===!0?oe.setFromMatrixColumn(J,1):(oe.setFromMatrixColumn(J,0),oe.crossVectors(r.object.up,oe)),oe.multiplyScalar(dt),p.add(oe)}})(),U=(()=>{const oe=new ne;return function(dt,J){const be=r.domElement;if(be&&r.object instanceof Mr&&r.object.isPerspectiveCamera){const ue=r.object.position;oe.copy(ue).sub(r.target);let Ne=oe.length();Ne*=Math.tan(r.object.fov/2*Math.PI/180),K(2*dt*Ne/be.clientHeight,r.object.matrix),Y(2*J*Ne/be.clientHeight,r.object.matrix)}else be&&r.object instanceof Pl&&r.object.isOrthographicCamera?(K(dt*(r.object.right-r.object.left)/r.object.zoom/be.clientWidth,r.object.matrix),Y(J*(r.object.top-r.object.bottom)/r.object.zoom/be.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function j(oe){r.object instanceof Mr&&r.object.isPerspectiveCamera||r.object instanceof Pl&&r.object.isOrthographicCamera?d=oe:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function k(oe){j(d/oe)}function q(oe){j(d*oe)}function W(oe){if(!r.zoomToCursor||!r.domElement)return;E=!0;const je=r.domElement.getBoundingClientRect(),dt=oe.clientX-je.left,J=oe.clientY-je.top,be=je.width,ue=je.height;M.x=dt/be*2-1,M.y=-(J/ue)*2+1,C.set(M.x,M.y,1).unproject(r.object).sub(r.object.position).normalize()}function te(oe){return Math.max(r.minDistance,Math.min(r.maxDistance,oe))}function G(oe){f.set(oe.clientX,oe.clientY)}function le(oe){W(oe),_.set(oe.clientX,oe.clientY)}function Z(oe){v.set(oe.clientX,oe.clientY)}function he(oe){g.set(oe.clientX,oe.clientY),m.subVectors(g,f).multiplyScalar(r.rotateSpeed);const je=r.domElement;je&&(I(2*Math.PI*m.x/je.clientHeight),z(2*Math.PI*m.y/je.clientHeight)),f.copy(g),r.update()}function ye(oe){A.set(oe.clientX,oe.clientY),S.subVectors(A,_),S.y>0?k(L()):S.y<0&&q(L()),_.copy(A),r.update()}function de(oe){x.set(oe.clientX,oe.clientY),y.subVectors(x,v).multiplyScalar(r.panSpeed),U(y.x,y.y),v.copy(x),r.update()}function xe(oe){W(oe),oe.deltaY<0?q(L()):oe.deltaY>0&&k(L()),r.update()}function me(oe){let je=!1;switch(oe.code){case r.keys.UP:U(0,r.keyPanSpeed),je=!0;break;case r.keys.BOTTOM:U(0,-r.keyPanSpeed),je=!0;break;case r.keys.LEFT:U(r.keyPanSpeed,0),je=!0;break;case r.keys.RIGHT:U(-r.keyPanSpeed,0),je=!0;break}je&&(oe.preventDefault(),r.update())}function ee(){if(P.length==1)f.set(P[0].pageX,P[0].pageY);else{const oe=.5*(P[0].pageX+P[1].pageX),je=.5*(P[0].pageY+P[1].pageY);f.set(oe,je)}}function we(){if(P.length==1)v.set(P[0].pageX,P[0].pageY);else{const oe=.5*(P[0].pageX+P[1].pageX),je=.5*(P[0].pageY+P[1].pageY);v.set(oe,je)}}function Ae(){const oe=P[0].pageX-P[1].pageX,je=P[0].pageY-P[1].pageY,dt=Math.sqrt(oe*oe+je*je);_.set(0,dt)}function Te(){r.enableZoom&&Ae(),r.enablePan&&we()}function Re(){r.enableZoom&&Ae(),r.enableRotate&&ee()}function Xe(oe){if(P.length==1)g.set(oe.pageX,oe.pageY);else{const dt=tt(oe),J=.5*(oe.pageX+dt.x),be=.5*(oe.pageY+dt.y);g.set(J,be)}m.subVectors(g,f).multiplyScalar(r.rotateSpeed);const je=r.domElement;je&&(I(2*Math.PI*m.x/je.clientHeight),z(2*Math.PI*m.y/je.clientHeight)),f.copy(g)}function Oe(oe){if(P.length==1)x.set(oe.pageX,oe.pageY);else{const je=tt(oe),dt=.5*(oe.pageX+je.x),J=.5*(oe.pageY+je.y);x.set(dt,J)}y.subVectors(x,v).multiplyScalar(r.panSpeed),U(y.x,y.y),v.copy(x)}function Be(oe){const je=tt(oe),dt=oe.pageX-je.x,J=oe.pageY-je.y,be=Math.sqrt(dt*dt+J*J);A.set(0,be),S.set(0,Math.pow(A.y/_.y,r.zoomSpeed)),k(S.y),_.copy(A)}function at(oe){r.enableZoom&&Be(oe),r.enablePan&&Oe(oe)}function ht(oe){r.enableZoom&&Be(oe),r.enableRotate&&Xe(oe)}function se(oe){var je,dt;r.enabled!==!1&&(P.length===0&&((je=r.domElement)==null||je.ownerDocument.addEventListener("pointermove",N),(dt=r.domElement)==null||dt.ownerDocument.addEventListener("pointerup",H)),Qe(oe),oe.pointerType==="touch"?Ye(oe):ve(oe))}function N(oe){r.enabled!==!1&&(oe.pointerType==="touch"?_e(oe):X(oe))}function H(oe){var je,dt,J;st(oe),P.length===0&&((je=r.domElement)==null||je.releasePointerCapture(oe.pointerId),(dt=r.domElement)==null||dt.ownerDocument.removeEventListener("pointermove",N),(J=r.domElement)==null||J.ownerDocument.removeEventListener("pointerup",H)),r.dispatchEvent(a),l=o.NONE}function ve(oe){let je;switch(oe.button){case 0:je=r.mouseButtons.LEFT;break;case 1:je=r.mouseButtons.MIDDLE;break;case 2:je=r.mouseButtons.RIGHT;break;default:je=-1}switch(je){case jp.DOLLY:if(r.enableZoom===!1)return;le(oe),l=o.DOLLY;break;case jp.ROTATE:if(oe.ctrlKey||oe.metaKey||oe.shiftKey){if(r.enablePan===!1)return;Z(oe),l=o.PAN}else{if(r.enableRotate===!1)return;G(oe),l=o.ROTATE}break;case jp.PAN:if(oe.ctrlKey||oe.metaKey||oe.shiftKey){if(r.enableRotate===!1)return;G(oe),l=o.ROTATE}else{if(r.enablePan===!1)return;Z(oe),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function X(oe){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;he(oe);break;case o.DOLLY:if(r.enableZoom===!1)return;ye(oe);break;case o.PAN:if(r.enablePan===!1)return;de(oe);break}}function Ce(oe){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(oe.preventDefault(),r.dispatchEvent(s),xe(oe),r.dispatchEvent(a))}function Ve(oe){r.enabled===!1||r.enablePan===!1||me(oe)}function Ye(oe){switch(ct(oe),P.length){case 1:switch(r.touches.ONE){case Wp.ROTATE:if(r.enableRotate===!1)return;ee(),l=o.TOUCH_ROTATE;break;case Wp.PAN:if(r.enablePan===!1)return;we(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case Wp.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Te(),l=o.TOUCH_DOLLY_PAN;break;case Wp.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Re(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function _e(oe){switch(ct(oe),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;Xe(oe),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;Oe(oe),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;at(oe),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;ht(oe),r.update();break;default:l=o.NONE}}function Pe(oe){r.enabled!==!1&&oe.preventDefault()}function Qe(oe){P.push(oe)}function st(oe){delete R[oe.pointerId];for(let je=0;je<P.length;je++)if(P[je].pointerId==oe.pointerId){P.splice(je,1);return}}function ct(oe){let je=R[oe.pointerId];je===void 0&&(je=new it,R[oe.pointerId]=je),je.set(oe.pageX,oe.pageY)}function tt(oe){const je=oe.pointerId===P[0].pointerId?P[1]:P[0];return R[je.pointerId]}this.dollyIn=(oe=L())=>{q(oe),r.update()},this.dollyOut=(oe=L())=>{k(oe),r.update()},this.getScale=()=>d,this.setScale=oe=>{j(oe),r.update()},this.getZoomScale=()=>L(),i!==void 0&&this.connect(i),this.update()}};function vE(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}const vf="srgb",Xu="srgb-linear",WG=3001,Pve=3e3;class VN extends zs{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Ove(i)}),this.register(function(i){return new Bve(i)}),this.register(function(i){return new jve(i)}),this.register(function(i){return new Wve(i)}),this.register(function(i){return new Xve(i)}),this.register(function(i){return new Nve(i)}),this.register(function(i){return new Uve(i)}),this.register(function(i){return new kve(i)}),this.register(function(i){return new zve(i)}),this.register(function(i){return new Lve(i)}),this.register(function(i){return new Vve(i)}),this.register(function(i){return new Fve(i)}),this.register(function(i){return new Hve(i)}),this.register(function(i){return new Gve(i)}),this.register(function(i){return new Rve(i)}),this.register(function(i){return new Yve(i)}),this.register(function(i){return new qve(i)})}load(t,i,r,n){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=Id.extractUrlBase(t);a=Id.resolveURL(c,this.path)}else a=Id.extractUrlBase(t);this.manager.itemStart(t);const o=function(c){n?n(c):console.error(c),s.manager.itemError(t),s.manager.itemEnd(t)},l=new aa(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(c){try{s.parse(c,a,function(u){i(u),s.manager.itemEnd(t)},o)}catch(u){o(u)}},r,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,i,r,n){let s;const a={},o={};if(typeof t=="string")s=JSON.parse(t);else if(t instanceof ArrayBuffer)if(vE(new Uint8Array(t.slice(0,4)))===vK){try{a[Ci.KHR_BINARY_GLTF]=new Qve(t)}catch(u){n&&n(u);return}s=JSON.parse(a[Ci.KHR_BINARY_GLTF].content)}else s=JSON.parse(vE(new Uint8Array(t)));else s=t;if(s.asset===void 0||s.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new l0e(s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[u.name]=u,a[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case Ci.KHR_MATERIALS_UNLIT:a[u]=new Ive;break;case Ci.KHR_DRACO_MESH_COMPRESSION:a[u]=new Jve(s,this.dracoLoader);break;case Ci.KHR_TEXTURE_TRANSFORM:a[u]=new Kve;break;case Ci.KHR_MESH_QUANTIZATION:a[u]=new Zve;break;default:h.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(r,n)}parseAsync(t,i){const r=this;return new Promise(function(n,s){r.parse(t,i,n,s)})}}function Dve(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ci={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Rve{constructor(t){this.parser=t,this.name=Ci.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,i=this.parser.json.nodes||[];for(let r=0,n=i.length;r<n;r++){const s=i[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){const i=this.parser,r="light:"+t;let n=i.cache.get(r);if(n)return n;const s=i.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let c;const u=new bt(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],Xu);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new IN(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new RN(u),c.distance=h;break;case"spot":c=new DN(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,bu(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=i.createUniqueName(l.name||"light_"+t),n=Promise.resolve(c),i.cache.add(r,n),n}getDependency(t,i){if(t==="light")return this._loadLight(i)}createNodeAttachment(t){const i=this,r=this.parser,s=r.json.nodes[t],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return r._getNodeRef(i.cache,o,l)})}}class Ive{constructor(){this.name=Ci.KHR_MATERIALS_UNLIT}getMaterialType(){return Ja}extendParams(t,i,r){const n=[];t.color=new bt(1,1,1),t.opacity=1;const s=i.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;t.color.setRGB(a[0],a[1],a[2],Xu),t.opacity=a[3]}s.baseColorTexture!==void 0&&n.push(r.assignTexture(t,"map",s.baseColorTexture,vf))}return Promise.all(n)}}class Lve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,i){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(i.emissiveIntensity=s),Promise.resolve()}}class Ove{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];if(a.clearcoatFactor!==void 0&&(i.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(r.assignTexture(i,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(i,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(i,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new it(o,o)}return Promise.all(s)}}class Bve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_DISPERSION}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return i.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Fve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.iridescenceFactor!==void 0&&(i.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(r.assignTexture(i,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(i.iridescenceIOR=a.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(i,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class Nve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_SHEEN}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];i.sheenColor=new bt(0,0,0),i.sheenRoughness=0,i.sheen=1;const a=n.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;i.sheenColor.setRGB(o[0],o[1],o[2],Xu)}return a.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(r.assignTexture(i,"sheenColorMap",a.sheenColorTexture,vf)),a.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(i,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class Uve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.transmissionFactor!==void 0&&(i.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(r.assignTexture(i,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class kve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_VOLUME}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];i.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(r.assignTexture(i,"thicknessMap",a.thicknessTexture)),i.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return i.attenuationColor=new bt().setRGB(o[0],o[1],o[2],Xu),Promise.all(s)}}class zve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_IOR}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return i.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Vve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_SPECULAR}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];i.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(r.assignTexture(i,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return i.specularColor=new bt().setRGB(o[0],o[1],o[2],Xu),a.specularColorTexture!==void 0&&s.push(r.assignTexture(i,"specularColorMap",a.specularColorTexture,vf)),Promise.all(s)}}class Gve{constructor(t){this.parser=t,this.name=Ci.EXT_MATERIALS_BUMP}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return i.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(r.assignTexture(i,"bumpMap",a.bumpTexture)),Promise.all(s)}}class Hve{constructor(t){this.parser=t,this.name=Ci.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const r=this.parser.json.materials[t];return!r.extensions||!r.extensions[this.name]?null:qo}extendMaterialParams(t,i){const r=this.parser,n=r.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.anisotropyStrength!==void 0&&(i.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(i.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(r.assignTexture(i,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class jve{constructor(t){this.parser=t,this.name=Ci.KHR_TEXTURE_BASISU}loadTexture(t){const i=this.parser,r=i.json,n=r.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(t,s.source,a)}}class Wve{constructor(t){this.parser=t,this.name=Ci.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const i=this.name,r=this.parser,n=r.json,s=n.textures[t];if(!s.extensions||!s.extensions[i])return null;const a=s.extensions[i],o=n.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(t,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class Xve{constructor(t){this.parser=t,this.name=Ci.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const i=this.name,r=this.parser,n=r.json,s=n.textures[t];if(!s.extensions||!s.extensions[i])return null;const a=s.extensions[i],o=n.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(t,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class Yve{constructor(t){this.name=Ci.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const i=this.parser.json,r=i.bufferViews[t];if(r.extensions&&r.extensions[this.name]){const n=r.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const l=n.byteOffset||0,c=n.byteLength||0,u=n.count,h=n.byteStride,d=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,h,d,n.mode,n.filter).then(function(p){return p.buffer}):a.ready.then(function(){const p=new ArrayBuffer(u*h);return a.decodeGltfBuffer(new Uint8Array(p),u,h,d,n.mode,n.filter),p})})}else return null}}class qve{constructor(t){this.name=Ci.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const i=this.parser.json,r=i.nodes[t];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const n=i.meshes[r.mesh];for(const c of n.primitives)if(c.mode!==Mo.TRIANGLES&&c.mode!==Mo.TRIANGLE_STRIP&&c.mode!==Mo.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=r.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],d=c[0].count,p=[];for(const f of h){const g=new ri,m=new ne,v=new ts,x=new ne(1,1,1),y=new fN(f.geometry,f.material,d);for(let _=0;_<d;_++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,_),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,_),l.SCALE&&x.fromBufferAttribute(l.SCALE,_),y.setMatrixAt(_,g.compose(m,v,x));for(const _ in l)if(_==="_COLOR_0"){const A=l[_];y.instanceColor=new Qf(A.array,A.itemSize,A.normalized)}else _!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&f.geometry.setAttribute(_,l[_]);Oi.prototype.copy.call(y,f),this.parser.assignFinalMaterial(y),p.push(y)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const vK="glTF",jy=12,XG={JSON:1313821514,BIN:5130562};class Qve{constructor(t){this.name=Ci.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(t,0,jy);if(this.header={magic:vE(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==vK)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-jy,n=new DataView(t,jy);let s=0;for(;s<r;){const a=n.getUint32(s,!0);s+=4;const o=n.getUint32(s,!0);if(s+=4,o===XG.JSON){const l=new Uint8Array(t,jy+s,a);this.content=vE(l)}else if(o===XG.BIN){const l=jy+s;this.body=t.slice(l,l+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Jve{constructor(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ci.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(t,i){const r=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,o={},l={},c={};for(const u in a){const h=AL[u]||u.toLowerCase();o[h]=a[u]}for(const u in t.attributes){const h=AL[u]||u.toLowerCase();if(a[u]!==void 0){const d=r.accessors[t.attributes[u]],p=Ov[d.componentType];c[h]=p.name,l[h]=d.normalized===!0}}return i.getDependency("bufferView",s).then(function(u){return new Promise(function(h,d){n.decodeDracoFile(u,function(p){for(const f in p.attributes){const g=p.attributes[f],m=l[f];m!==void 0&&(g.normalized=m)}h(p)},o,c,Xu,d)})})}}class Kve{constructor(){this.name=Ci.KHR_TEXTURE_TRANSFORM}extendTexture(t,i){return(i.texCoord===void 0||i.texCoord===t.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(t=t.clone(),i.texCoord!==void 0&&(t.channel=i.texCoord),i.offset!==void 0&&t.offset.fromArray(i.offset),i.rotation!==void 0&&(t.rotation=i.rotation),i.scale!==void 0&&t.repeat.fromArray(i.scale),t.needsUpdate=!0),t}}class Zve{constructor(){this.name=Ci.KHR_MESH_QUANTIZATION}}class yK extends U0{constructor(t,i,r,n){super(t,i,r,n)}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n*3+n;for(let a=0;a!==n;a++)i[a]=r[s+a];return i}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,u=n-i,h=(r-i)/u,d=h*h,p=d*h,f=t*c,g=f-c,m=-2*p+3*d,v=p-d,x=1-m,y=v-d+h;for(let _=0;_!==o;_++){const A=a[g+_+o],S=a[g+_+l]*u,C=a[f+_+o],M=a[f+_]*u;s[_]=x*A+y*S+m*C+v*M}return s}}const $ve=new ts;class e0e extends yK{interpolate_(t,i,r,n){const s=super.interpolate_(t,i,r,n);return $ve.fromArray(s).normalize().toArray(s),s}}const Mo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ov={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},YG={9728:Gr,9729:Dr,9984:Hx,9985:$C,9986:Dv,9987:Fc},qG={33071:ds,33648:i0,10497:jd},dD={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},AL={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...wve>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Rh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},t0e={CUBICSPLINE:void 0,LINEAR:qf,STEP:n0},pD={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function i0e(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new Qw({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Bc})),e.DefaultMaterial}function Dp(e,t,i){for(const r in i.extensions)e[r]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function bu(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function r0e(e,t,i){let r=!1,n=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const h=t[c];if(h.POSITION!==void 0&&(r=!0),h.NORMAL!==void 0&&(n=!0),h.COLOR_0!==void 0&&(s=!0),r&&n&&s)break}if(!r&&!n&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,u=t.length;c<u;c++){const h=t[c];if(r){const d=h.POSITION!==void 0?i.getDependency("accessor",h.POSITION):e.attributes.position;a.push(d)}if(n){const d=h.NORMAL!==void 0?i.getDependency("accessor",h.NORMAL):e.attributes.normal;o.push(d)}if(s){const d=h.COLOR_0!==void 0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(d)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],d=c[2];return r&&(e.morphAttributes.position=u),n&&(e.morphAttributes.normal=h),s&&(e.morphAttributes.color=d),e.morphTargetsRelative=!0,e})}function n0e(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function s0e(e){let t;const i=e.extensions&&e.extensions[Ci.KHR_DRACO_MESH_COMPRESSION];if(i?t="draco:"+i.bufferView+":"+i.indices+":"+fD(i.attributes):t=e.indices+":"+fD(e.attributes)+":"+e.mode,e.targets!==void 0)for(let r=0,n=e.targets.length;r<n;r++)t+=":"+fD(e.targets[r]);return t}function fD(e){let t="";const i=Object.keys(e).sort();for(let r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function ML(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function a0e(e){return e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0?"image/jpeg":e.search(/\.webp($|\?)/i)>0||e.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const o0e=new ri;class l0e{constructor(t={},i={}){this.json=t,this.extensions={},this.plugins={},this.options=i,this.cache=new Dve,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,n=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||n&&s<98?this.textureLoader=new Jw(this.options.manager):this.textureLoader=new UJ(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new aa(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,i){const r=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const o={scene:a[0][n.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:n.asset,parser:r,userData:{}};return Dp(s,o,n),bu(o,n),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();t(o)})}).catch(i)}_markDefs(){const t=this.json.nodes||[],i=this.json.skins||[],r=this.json.meshes||[];for(let n=0,s=i.length;n<s;n++){const a=i[n].joints;for(let o=0,l=a.length;o<l;o++)t[a[o]].isBone=!0}for(let n=0,s=t.length;n<s;n++){const a=t[n];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(t,i){i!==void 0&&(t.refs[i]===void 0&&(t.refs[i]=t.uses[i]=0),t.refs[i]++)}_getNodeRef(t,i,r){if(t.refs[i]<=1)return r;const n=r.clone(),s=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,u]of a.children.entries())s(u,o.children[c])};return s(r,n),n.name+="_instance_"+t.uses[i]++,n}_invokeOne(t){const i=Object.values(this.plugins);i.push(this);for(let r=0;r<i.length;r++){const n=t(i[r]);if(n)return n}return null}_invokeAll(t){const i=Object.values(this.plugins);i.unshift(this);const r=[];for(let n=0;n<i.length;n++){const s=t(i[n]);s&&r.push(s)}return r}getDependency(t,i){const r=t+":"+i;let n=this.cache.get(r);if(!n){switch(t){case"scene":n=this.loadScene(i);break;case"node":n=this._invokeOne(function(s){return s.loadNode&&s.loadNode(i)});break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(i)});break;case"accessor":n=this.loadAccessor(i);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(i)});break;case"buffer":n=this.loadBuffer(i);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(i)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(i)});break;case"skin":n=this.loadSkin(i);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(i)});break;case"camera":n=this.loadCamera(i);break;default:if(n=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(t,i)}),!n)throw new Error("Unknown type: "+t);break}this.cache.add(r,n)}return n}getDependencies(t){let i=this.cache.get(t);if(!i){const r=this,n=this.json[t+(t==="mesh"?"es":"s")]||[];i=Promise.all(n.map(function(s,a){return r.getDependency(t,a)})),this.cache.add(t,i)}return i}loadBuffer(t){const i=this.json.buffers[t],r=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&t===0)return Promise.resolve(this.extensions[Ci.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,a){r.load(Id.resolveURL(i.uri,n.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(t){const i=this.json.bufferViews[t];return this.getDependency("buffer",i.buffer).then(function(r){const n=i.byteLength||0,s=i.byteOffset||0;return r.slice(s,s+n)})}loadAccessor(t){const i=this,r=this.json,n=this.json.accessors[t];if(n.bufferView===void 0&&n.sparse===void 0){const a=dD[n.type],o=Ov[n.componentType],l=n.normalized===!0,c=new o(n.count*a);return Promise.resolve(new Ui(c,a,l))}const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],l=dD[n.type],c=Ov[n.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,d=n.byteOffset||0,p=n.bufferView!==void 0?r.bufferViews[n.bufferView].byteStride:void 0,f=n.normalized===!0;let g,m;if(p&&p!==h){const v=Math.floor(d/p),x="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+v+":"+n.count;let y=i.cache.get(x);y||(g=new c(o,v*p,n.count*p/u),y=new Ow(g,p/u),i.cache.add(x,y)),m=new Wd(y,l,d%p/u,f)}else o===null?g=new c(n.count*l):g=new c(o,d,n.count*l),m=new Ui(g,l,f);if(n.sparse!==void 0){const v=dD.SCALAR,x=Ov[n.sparse.indices.componentType],y=n.sparse.indices.byteOffset||0,_=n.sparse.values.byteOffset||0,A=new x(a[1],y,n.sparse.count*v),S=new c(a[2],_,n.sparse.count*l);o!==null&&(m=new Ui(m.array.slice(),m.itemSize,m.normalized));for(let C=0,M=A.length;C<M;C++){const E=A[C];if(m.setX(E,S[C*l]),l>=2&&m.setY(E,S[C*l+1]),l>=3&&m.setZ(E,S[C*l+2]),l>=4&&m.setW(E,S[C*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(t){const i=this.json,r=this.options,s=i.textures[t].source,a=i.images[s];let o=this.textureLoader;if(a.uri){const l=r.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(t,s,o)}loadTextureImage(t,i,r){const n=this,s=this.json,a=s.textures[t],o=s.images[i],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(i,r).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const d=(s.samplers||{})[a.sampler]||{};return u.magFilter=YG[d.magFilter]||Dr,u.minFilter=YG[d.minFilter]||Fc,u.wrapS=qG[d.wrapS]||jd,u.wrapT=qG[d.wrapT]||jd,n.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(t,i){const r=this,n=this.json,s=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(h=>h.clone());const a=n.images[t],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=r.getDependency("bufferView",a.bufferView).then(function(h){c=!0;const d=new Blob([h],{type:a.mimeType});return l=o.createObjectURL(d),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(d,p){let f=d;i.isImageBitmapLoader===!0&&(f=function(g){const m=new mr(g);m.needsUpdate=!0,d(m)}),i.load(Id.resolveURL(h,s.path),f,void 0,p)})}).then(function(h){return c===!0&&o.revokeObjectURL(l),bu(h,a),h.userData.mimeType=a.mimeType||a0e(a.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[t]=u,u}assignTexture(t,i,r,n){const s=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),s.extensions[Ci.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[Ci.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=s.associations.get(a);a=s.extensions[Ci.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,l)}}return n!==void 0&&(typeof n=="number"&&(n=n===WG?vf:Xu),"colorSpace"in a?a.colorSpace=n:a.encoding=n===vf?WG:Pve),t[i]=a,a})}assignFinalMaterial(t){const i=t.geometry;let r=t.material;const n=i.attributes.tangent===void 0,s=i.attributes.color!==void 0,a=i.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Fw,yn.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(t.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new ks,yn.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(n||s||a){let o="ClonedMaterial:"+r.uuid+":";n&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),s&&(l.vertexColors=!0),a&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}t.material=r}getMaterialType(){return Qw}loadMaterial(t){const i=this,r=this.json,n=this.extensions,s=r.materials[t];let a;const o={},l=s.extensions||{},c=[];if(l[Ci.KHR_MATERIALS_UNLIT]){const h=n[Ci.KHR_MATERIALS_UNLIT];a=h.getMaterialType(),c.push(h.extendParams(o,s,i))}else{const h=s.pbrMetallicRoughness||{};if(o.color=new bt(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;o.color.setRGB(d[0],d[1],d[2],Xu),o.opacity=d[3]}h.baseColorTexture!==void 0&&c.push(i.assignTexture(o,"map",h.baseColorTexture,vf)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(i.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),c.push(i.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),a=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,o)})))}s.doubleSided===!0&&(o.side=Bo);const u=s.alphaMode||pD.OPAQUE;if(u===pD.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===pD.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==Ja&&(c.push(i.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new it(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;o.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&a!==Ja&&(c.push(i.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==Ja){const h=s.emissiveFactor;o.emissive=new bt().setRGB(h[0],h[1],h[2],Xu)}return s.emissiveTexture!==void 0&&a!==Ja&&c.push(i.assignTexture(o,"emissiveMap",s.emissiveTexture,vf)),Promise.all(c).then(function(){const h=new a(o);return s.name&&(h.name=s.name),bu(h,s),i.associations.set(h,{materials:t}),s.extensions&&Dp(n,h,s),h})}createUniqueName(t){const i=Ni.sanitizeNodeName(t||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(t){const i=this,r=this.extensions,n=this.primitiveCache;function s(o){return r[Ci.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,i).then(function(l){return QG(l,o,i)})}const a=[];for(let o=0,l=t.length;o<l;o++){const c=t[o],u=s0e(c),h=n[u];if(h)a.push(h.promise);else{let d;c.extensions&&c.extensions[Ci.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=QG(new pi,c,i),n[u]={primitive:c,promise:d},a.push(d)}}return Promise.all(a)}loadMesh(t){const i=this,r=this.json,n=this.extensions,s=r.meshes[t],a=s.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?i0e(this.cache):this.getDependency("material",a[l].material);o.push(u)}return o.push(i.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let p=0,f=u.length;p<f;p++){const g=u[p],m=a[p];let v;const x=c[p];if(m.mode===Mo.TRIANGLES||m.mode===Mo.TRIANGLE_STRIP||m.mode===Mo.TRIANGLE_FAN||m.mode===void 0)v=s.isSkinnedMesh===!0?new pN(g,x):new Ln(g,x),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),m.mode===Mo.TRIANGLE_STRIP?v.geometry=GG(v.geometry,KF):m.mode===Mo.TRIANGLE_FAN&&(v.geometry=GG(v.geometry,dE));else if(m.mode===Mo.LINES)v=new kl(g,x);else if(m.mode===Mo.LINE_STRIP)v=new ih(g,x);else if(m.mode===Mo.LINE_LOOP)v=new mN(g,x);else if(m.mode===Mo.POINTS)v=new gN(g,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(v.geometry.morphAttributes).length>0&&n0e(v,s),v.name=i.createUniqueName(s.name||"mesh_"+t),bu(v,s),m.extensions&&Dp(n,v,m),i.assignFinalMaterial(v),h.push(v)}for(let p=0,f=h.length;p<f;p++)i.associations.set(h[p],{meshes:t,primitives:p});if(h.length===1)return s.extensions&&Dp(n,h[0],s),h[0];const d=new Fu;s.extensions&&Dp(n,d,s),i.associations.set(d,{meshes:t});for(let p=0,f=h.length;p<f;p++)d.add(h[p]);return d})}loadCamera(t){let i;const r=this.json.cameras[t],n=r[r.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?i=new Mr(tN.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):r.type==="orthographic"&&(i=new Pl(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(i.name=this.createUniqueName(r.name)),bu(i,r),Promise.resolve(i)}loadSkin(t){const i=this.json.skins[t],r=[];for(let n=0,s=i.joints.length;n<s;n++)r.push(this._loadNodeShallow(i.joints[n]));return i.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",i.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(n){const s=n.pop(),a=n,o=[],l=[];for(let c=0,u=a.length;c<u;c++){const h=a[c];if(h){o.push(h);const d=new ri;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[c])}return new Bw(o,l)})}loadAnimation(t){const i=this.json,r=this,n=i.animations[t],s=n.name?n.name:"animation_"+t,a=[],o=[],l=[],c=[],u=[];for(let h=0,d=n.channels.length;h<d;h++){const p=n.channels[h],f=n.samplers[p.sampler],g=p.target,m=g.node,v=n.parameters!==void 0?n.parameters[f.input]:f.input,x=n.parameters!==void 0?n.parameters[f.output]:f.output;g.node!==void 0&&(a.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",x)),c.push(f),u.push(g))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const d=h[0],p=h[1],f=h[2],g=h[3],m=h[4],v=[];for(let x=0,y=d.length;x<y;x++){const _=d[x],A=p[x],S=f[x],C=g[x],M=m[x];if(_===void 0)continue;_.updateMatrix&&_.updateMatrix();const E=r._createAnimationTracks(_,A,S,C,M);if(E)for(let P=0;P<E.length;P++)v.push(E[P])}return new o0(s,void 0,v)})}createNodeMesh(t){const i=this.json,r=this,n=i.nodes[t];return n.mesh===void 0?null:r.getDependency("mesh",n.mesh).then(function(s){const a=r._getNodeRef(r.meshCache,n.mesh,s);return n.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=n.weights.length;l<c;l++)o.morphTargetInfluences[l]=n.weights[l]}),a})}loadNode(t){const i=this.json,r=this,n=i.nodes[t],s=r._loadNodeShallow(t),a=[],o=n.children||[];for(let c=0,u=o.length;c<u;c++)a.push(r.getDependency("node",o[c]));const l=n.skin===void 0?Promise.resolve(null):r.getDependency("skin",n.skin);return Promise.all([s,Promise.all(a),l]).then(function(c){const u=c[0],h=c[1],d=c[2];d!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(d,o0e)});for(let p=0,f=h.length;p<f;p++)u.add(h[p]);return u})}_loadNodeShallow(t){const i=this.json,r=this.extensions,n=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const s=i.nodes[t],a=s.name?n.createUniqueName(s.name):"",o=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(t)});return l&&o.push(l),s.camera!==void 0&&o.push(n.getDependency("camera",s.camera).then(function(c){return n._getNodeRef(n.cameraCache,s.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(t)}).forEach(function(c){o.push(c)}),this.nodeCache[t]=Promise.all(o).then(function(c){let u;if(s.isBone===!0?u=new oT:c.length>1?u=new Fu:c.length===1?u=c[0]:u=new Oi,u!==c[0])for(let h=0,d=c.length;h<d;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=a),bu(u,s),s.extensions&&Dp(r,u,s),s.matrix!==void 0){const h=new ri;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return n.associations.has(u)||n.associations.set(u,{}),n.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const i=this.extensions,r=this.json.scenes[t],n=this,s=new Fu;r.name&&(s.name=n.createUniqueName(r.name)),bu(s,r),r.extensions&&Dp(i,s,r);const a=r.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(n.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[d,p]of n.associations)(d instanceof yn||d instanceof mr)&&h.set(d,p);return u.traverse(d=>{const p=n.associations.get(d);p!=null&&h.set(d,p)}),h};return n.associations=c(s),s})}_createAnimationTracks(t,i,r,n,s){const a=[],o=t.name?t.name:t.uuid,l=[];Rh[s.path]===Rh.weights?t.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(o);let c;switch(Rh[s.path]){case Rh.weights:c=Kf;break;case Rh.rotation:c=Xd;break;case Rh.position:case Rh.scale:c=Zf;break;default:switch(r.itemSize){case 1:c=Kf;break;case 2:case 3:default:c=Zf;break}break}const u=n.interpolation!==void 0?t0e[n.interpolation]:qf,h=this._getArrayFromAccessor(r);for(let d=0,p=l.length;d<p;d++){const f=new c(l[d]+"."+Rh[s.path],i.array,h,u);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),a.push(f)}return a}_getArrayFromAccessor(t){let i=t.array;if(t.normalized){const r=ML(i.constructor),n=new Float32Array(i.length);for(let s=0,a=i.length;s<a;s++)n[s]=i[s]*r;i=n}return i}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(r){const n=this instanceof Xd?e0e:yK;return new n(this.times,this.values,this.getValueSize()/3,r)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function c0e(e,t,i){const r=t.attributes,n=new Ul;if(r.POSITION!==void 0){const o=i.json.accessors[r.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(n.set(new ne(l[0],l[1],l[2]),new ne(c[0],c[1],c[2])),o.normalized){const u=ML(Ov[o.componentType]);n.min.multiplyScalar(u),n.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=t.targets;if(s!==void 0){const o=new ne,l=new ne;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const d=i.json.accessors[h.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){const g=ML(Ov[d.componentType]);l.multiplyScalar(g)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(o)}e.boundingBox=n;const a=new Yo;n.getCenter(a.center),a.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=a}function QG(e,t,i){const r=t.attributes,n=[];function s(a,o){return i.getDependency("accessor",a).then(function(l){e.setAttribute(o,l)})}for(const a in r){const o=AL[a]||a.toLowerCase();o in e.attributes||n.push(s(r[a],o))}if(t.indices!==void 0&&!e.index){const a=i.getDependency("accessor",t.indices).then(function(o){e.setIndex(o)});n.push(a)}return bu(e,t),c0e(e,t,i),Promise.all(n).then(function(){return t.targets!==void 0?r0e(e,t.targets,i):e})}class u0e extends pi{constructor(t,i,r,n){super();const s=[],a=[],o=[],l=new ne,c=new ri;c.makeRotationFromEuler(r),c.setPosition(i);const u=new ri;u.copy(c).invert(),h(),this.setAttribute("position",new Ft(s,3)),this.setAttribute("normal",new Ft(a,3)),this.setAttribute("uv",new Ft(o,2));function h(){let g,m=[];const v=new ne,x=new ne;if(t.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const y=t.geometry,_=y.attributes.position,A=y.attributes.normal;if(y.index!==null){const S=y.index;for(g=0;g<S.count;g++)v.fromBufferAttribute(_,S.getX(g)),x.fromBufferAttribute(A,S.getX(g)),d(m,v,x)}else for(g=0;g<_.count;g++)v.fromBufferAttribute(_,g),x.fromBufferAttribute(A,g),d(m,v,x);for(m=p(m,l.set(1,0,0)),m=p(m,l.set(-1,0,0)),m=p(m,l.set(0,1,0)),m=p(m,l.set(0,-1,0)),m=p(m,l.set(0,0,1)),m=p(m,l.set(0,0,-1)),g=0;g<m.length;g++){const S=m[g];o.push(.5+S.position.x/n.x,.5+S.position.y/n.y),S.position.applyMatrix4(c),s.push(S.position.x,S.position.y,S.position.z),a.push(S.normal.x,S.normal.y,S.normal.z)}}function d(g,m,v){m.applyMatrix4(t.matrixWorld),m.applyMatrix4(u),v.transformDirection(t.matrixWorld),g.push(new JG(m.clone(),v.clone()))}function p(g,m){const v=[],x=.5*Math.abs(n.dot(m));for(let y=0;y<g.length;y+=3){let _,A,S,C=0,M,E,P,R;const O=g[y+0].position.dot(m)-x,L=g[y+1].position.dot(m)-x,I=g[y+2].position.dot(m)-x;switch(_=O>0,A=L>0,S=I>0,C=(_?1:0)+(A?1:0)+(S?1:0),C){case 0:{v.push(g[y]),v.push(g[y+1]),v.push(g[y+2]);break}case 1:{if(_&&(M=g[y+1],E=g[y+2],P=f(g[y],M,m,x),R=f(g[y],E,m,x)),A){M=g[y],E=g[y+2],P=f(g[y+1],M,m,x),R=f(g[y+1],E,m,x),v.push(P),v.push(E.clone()),v.push(M.clone()),v.push(E.clone()),v.push(P.clone()),v.push(R);break}S&&(M=g[y],E=g[y+1],P=f(g[y+2],M,m,x),R=f(g[y+2],E,m,x)),v.push(M.clone()),v.push(E.clone()),v.push(P),v.push(R),v.push(P.clone()),v.push(E.clone());break}case 2:{_||(M=g[y].clone(),E=f(M,g[y+1],m,x),P=f(M,g[y+2],m,x),v.push(M),v.push(E),v.push(P)),A||(M=g[y+1].clone(),E=f(M,g[y+2],m,x),P=f(M,g[y],m,x),v.push(M),v.push(E),v.push(P)),S||(M=g[y+2].clone(),E=f(M,g[y],m,x),P=f(M,g[y+1],m,x),v.push(M),v.push(E),v.push(P));break}}}return v}function f(g,m,v,x){const y=g.position.dot(v)-x,_=m.position.dot(v)-x,A=y/(y-_);return new JG(new ne(g.position.x+A*(m.position.x-g.position.x),g.position.y+A*(m.position.y-g.position.y),g.position.z+A*(m.position.z-g.position.z)),new ne(g.normal.x+A*(m.normal.x-g.normal.x),g.normal.y+A*(m.normal.y-g.normal.y),g.normal.z+A*(m.normal.z-g.normal.z)))}}}class JG{constructor(t,i){this.position=t,this.normal=i}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const mD=new WeakMap;let h0e=class extends zs{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,r,n){const s=new aa(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(i).catch(n)},r,n)}decodeDracoFile(t,i,r,n){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(t,s).then(i)}decodeGeometry(t,i){for(const l in i.attributeTypes){const c=i.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(i.attributeTypes[l]=c.name)}const r=JSON.stringify(i);if(mD.has(t)){const l=mD.get(t);if(l.key===r)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,a=t.byteLength,o=this._getWorker(s,a).then(l=>(n=l,new Promise((c,u)=>{n._callbacks[s]={resolve:c,reject:u},n.postMessage({type:"decode",id:s,taskConfig:i,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),mD.set(t,{key:r,promise:o}),o}_createGeometry(t){const i=new pi;t.index&&i.setIndex(new Ui(t.index.array,1));for(let r=0;r<t.attributes.length;r++){const n=t.attributes[r],s=n.name,a=n.array,o=n.itemSize;i.setAttribute(s,new Ui(a,o))}return i}_loadLibrary(t,i){const r=new aa(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((n,s)=>{r.load(t,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{const n=r[0];t||(this.decoderConfig.wasmBinary=r[1]);const s=d0e.toString(),a=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(t,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const a=s.data;switch(a.type){case"decode":n._callbacks[a.id].resolve(a);break;case"error":n._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[t]=i,r._taskLoad+=i,r})}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}};function d0e(){let e,t;onmessage=function(a){const o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":const l=o.buffer,c=o.taskConfig;t.then(u=>{const h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{const f=i(h,d,p,c),g=f.attributes.map(m=>m.array.buffer);f.index&&g.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},g)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){const u=c.attributeIDs,h=c.attributeTypes;let d,p;const f=o.GetEncodedGeometryType(l);if(f===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(f===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const g={index:null,attributes:[]};for(const m in u){const v=self[h[m]];let x,y;if(c.useUniqueIDs)y=u[m],x=o.GetAttributeByUniqueId(d,y);else{if(y=o.GetAttributeId(d,a[u[m]]),y===-1)continue;x=o.GetAttribute(d,y)}g.attributes.push(n(a,o,d,m,v,x))}return f===a.TRIANGULAR_MESH&&(g.index=r(a,o,d)),a.destroy(d),g}function r(a,o,l){const u=l.num_faces()*3,h=u*4,d=a._malloc(h);o.GetTrianglesUInt32Array(l,h,d);const p=new Uint32Array(a.HEAPF32.buffer,d,u).slice();return a._free(d),{array:p,itemSize:1}}function n(a,o,l,c,u,h){const d=h.num_components(),f=l.num_points()*d,g=f*u.BYTES_PER_ELEMENT,m=s(a,u),v=a._malloc(g);o.GetAttributeDataArrayForAllPoints(l,h,m,g,v);const x=new u(a.HEAPF32.buffer,v,f).slice();return a._free(v),{name:c,array:x,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let wS;const gD=()=>{if(wS)return wS;const e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",t="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let n=e;WebAssembly.validate(i)&&(n=t);let s;const a=WebAssembly.instantiate(o(n),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function o(h){const d=new Uint8Array(h.length);for(let f=0;f<h.length;++f){const g=h.charCodeAt(f);d[f]=g>96?g-71:g>64?g-65:g>47?g+4:g>46?63:62}let p=0;for(let f=0;f<h.length;++f)d[p++]=d[f]<60?r[d[f]]:(d[f]-60)*64+d[++f];return d.buffer.slice(0,p)}function l(h,d,p,f,g,m){const v=s.exports.sbrk,x=p+3&-4,y=v(x*f),_=v(g.length),A=new Uint8Array(s.exports.memory.buffer);A.set(g,_);const S=h(y,p,f,_,g.length);if(S===0&&m&&m(y,x,f),d.set(A.subarray(y,y+p*f)),v(y-v(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return wS={ready:a,supported:!0,decodeVertexBuffer(h,d,p,f,g){l(s.exports.meshopt_decodeVertexBuffer,h,d,p,f,s.exports[c[g]])},decodeIndexBuffer(h,d,p,f){l(s.exports.meshopt_decodeIndexBuffer,h,d,p,f)},decodeIndexSequence(h,d,p,f){l(s.exports.meshopt_decodeIndexSequence,h,d,p,f)},decodeGltfBuffer(h,d,p,f,g,m){l(s.exports[u[g]],h,d,p,f,s.exports[c[m]])}},wS},vD=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function GN(e,t){const i=Xa(s=>s.gl),r=sp(Jw,vD(e)?Object.values(e):e);return fe.useLayoutEffect(()=>{t==null||t(r)},[t]),fe.useEffect(()=>{if("initTexture"in i){let s=[];Array.isArray(r)?s=r:r instanceof mr?s=[r]:vD(r)&&(s=Object.values(r)),s.forEach(a=>{a instanceof mr&&i.initTexture(a)})}},[i,r]),fe.useMemo(()=>{if(vD(e)){const s={};let a=0;for(const o in e)s[o]=r[a++];return s}else return r},[e,r])}GN.preload=e=>sp.preload(Jw,e);GN.clear=e=>sp.clear(Jw,e);const p0e=()=>parseInt(R0.replace(/\D+/g,"")),xK=p0e();function f0e(e){return Array.isArray(e)}function yD(e=[0,0,0]){return f0e(e)?e:e instanceof ne||e instanceof dm?[e.x,e.y,e.z]:[e,e,e]}const m0e=fe.forwardRef(function({debug:t,depthTest:i=!1,polygonOffsetFactor:r=-10,map:n,mesh:s,children:a,position:o,rotation:l,scale:c,...u},h){const d=fe.useRef(null);fe.useImperativeHandle(h,()=>d.current);const p=fe.useRef(null),f=fe.useRef({position:new ne,rotation:new dm,scale:new ne(1,1,1)});return fe.useLayoutEffect(()=>{const g=(s==null?void 0:s.current)||d.current.parent,m=d.current;if(!(g instanceof Ln))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(g){mc(f.current,{position:o,scale:c});const v=g.matrixWorld.clone();if(g.matrixWorld.identity(),!l||typeof l=="number"){const x=new Oi;x.position.copy(f.current.position);const y=g.geometry.attributes.position.array;g.geometry.attributes.normal===void 0&&g.geometry.computeVertexNormals();const _=g.geometry.attributes.normal.array;let A=1/0;new ne;let S=new ne;const C=x.position.x,M=x.position.y,E=x.position.z,P=y.length;let R=-1;for(let O=0;O<P;O+=3){const L=y[O],I=y[O+1],z=y[O+2],K=L-C,Y=I-M,U=z-E,j=K*K+Y*Y+U*U;j<A&&(A=j,R=O)}S.fromArray(_,R),x.lookAt(x.position.clone().add(S)),x.rotateZ(Math.PI),x.rotateY(Math.PI),typeof l=="number"&&x.rotateZ(l),mc(f.current,{rotation:x.rotation})}else mc(f.current,{rotation:l});return m.geometry=new u0e(g,f.current.position,f.current.rotation,f.current.scale),g.matrixWorld=v,()=>{m.geometry.dispose()}}},[s,...yD(o),...yD(c),...yD(l)]),fe.useLayoutEffect(()=>{p.current&&(mc(p.current,f.current),p.current.traverse(g=>g.raycast=()=>null))},[t]),fe.createElement("mesh",Uc({ref:d,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":i,"material-map":n},u),a,t&&fe.createElement("mesh",{ref:p},fe.createElement("boxGeometry",null),fe.createElement("meshNormalMaterial",{wireframe:!0}),fe.createElement("axesHelper",null)))});let bS=null,wK="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function bK(e=!0,t=!0,i){return r=>{i&&i(r),e&&(bS||(bS=new h0e),bS.setDecoderPath(typeof e=="string"?e:wK),r.setDRACOLoader(bS)),t&&r.setMeshoptDecoder(typeof gD=="function"?gD():gD)}}const $w=(e,t,i,r)=>sp(VN,e,bK(t,i,r));$w.preload=(e,t,i,r)=>sp.preload(VN,e,bK(t,i,r));$w.clear=e=>sp.clear(VN,e);$w.setDecoderPath=e=>{wK=e};const g0e=fe.forwardRef(({makeDefault:e,camera:t,regress:i,domElement:r,enableDamping:n=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=Xa(S=>S.invalidate),d=Xa(S=>S.camera),p=Xa(S=>S.gl),f=Xa(S=>S.events),g=Xa(S=>S.setEvents),m=Xa(S=>S.set),v=Xa(S=>S.get),x=Xa(S=>S.performance),y=t||d,_=r||f.connected||p.domElement,A=fe.useMemo(()=>new Tve(y),[y]);return k0(()=>{A.enabled&&A.update()},-1),fe.useEffect(()=>(s&&A.connect(s===!0?_:s),A.connect(_),()=>void A.dispose()),[s,_,i,A,h]),fe.useEffect(()=>{const S=E=>{h(),i&&x.regress(),a&&a(E)},C=E=>{o&&o(E)},M=E=>{l&&l(E)};return A.addEventListener("change",S),A.addEventListener("start",C),A.addEventListener("end",M),()=>{A.removeEventListener("start",C),A.removeEventListener("end",M),A.removeEventListener("change",S)}},[a,o,l,A,h,g]),fe.useEffect(()=>{if(e){const S=v().controls;return m({controls:A}),()=>m({controls:S})}},[e,A]),fe.createElement("primitive",Uc({ref:u,object:A,enableDamping:n},c))}),v0e="modulepreload",y0e=function(e){return"/Portfolio/"+e},KG={},ap=function(t,i,r){if(!i||i.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=y0e(s),s in KG)return;KG[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const h=n[u];if(h.href===s&&(!a||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":v0e,a||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),a)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};var _K={exports:{}},x0e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",w0e=x0e,b0e=w0e;function SK(){}function AK(){}AK.resetWarningCache=SK;var _0e=function(){function e(r,n,s,a,o,l){if(l!==b0e){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}e.isRequired=e;function t(){return e}var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:AK,resetWarningCache:SK};return i.PropTypes=i,i};_K.exports=_0e();var MK=_K.exports;const xD=xK>=154?"opaque_fragment":"output_fragment";class S0e extends Fw{constructor(t){super(t),this.onBeforeCompile=(i,r)=>{const{isWebGL2:n}=r.capabilities;i.fragmentShader=i.fragmentShader.replace(`#include <${xD}>`,`
        ${n?`#include <${xD}>`:`#extension GL_OES_standard_derivatives : enable
#include <${xD}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${xK>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const A0e=fe.forwardRef((e,t)=>{const[i]=fe.useState(()=>new S0e(null));return fe.createElement("primitive",Uc({},e,{object:i,ref:t,attach:"material"}))}),M0e=fe.forwardRef(({children:e,enabled:t=!0,speed:i=1,rotationIntensity:r=1,floatIntensity:n=1,floatingRange:s=[-.1,.1],autoInvalidate:a=!1,...o},l)=>{const c=fe.useRef(null);fe.useImperativeHandle(l,()=>c.current,[]);const u=fe.useRef(Math.random()*1e4);return k0(h=>{var d,p;if(!t||i===0)return;a&&h.invalidate();const f=u.current+h.clock.getElapsedTime();c.current.rotation.x=Math.cos(f/4*i)/8*r,c.current.rotation.y=Math.sin(f/4*i)/8*r,c.current.rotation.z=Math.sin(f/4*i)/20*r;let g=Math.sin(f/4*i)/10;g=tN.mapLinear(g,-.1,.1,(d=s==null?void 0:s[0])!==null&&d!==void 0?d:-.1,(p=s==null?void 0:s[1])!==null&&p!==void 0?p:.1),c.current.position.y=g*n,c.current.updateMatrix()}),fe.createElement("group",o,fe.createElement("group",{ref:c,matrixAutoUpdate:!1},e))});let Rp,Wy;const E0e=fe.createContext(null),ZG=new ri,$G=new ne,C0e=fe.forwardRef(({children:e,range:t,limit:i=1e3,...r},n)=>{const s=fe.useRef(null);fe.useImperativeHandle(n,()=>s.current,[]);const[a,o]=fe.useState([]),[[l,c,u]]=fe.useState(()=>[new Float32Array(i*3),Float32Array.from({length:i*3},()=>1),Float32Array.from({length:i},()=>1)]);fe.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),k0(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),ZG.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(i,t!==void 0?t:i,a.length),Rp=0;Rp<a.length;Rp++)Wy=a[Rp].current,Wy.getWorldPosition($G).applyMatrix4(ZG),$G.toArray(l,Rp*3),s.current.geometry.attributes.position.needsUpdate=!0,Wy.matrixWorldNeedsUpdate=!0,Wy.color.toArray(c,Rp*3),s.current.geometry.attributes.color.needsUpdate=!0,u.set([Wy.size],Rp),s.current.geometry.attributes.size.needsUpdate=!0});const h=fe.useMemo(()=>({getParent:()=>s,subscribe:d=>(o(p=>[...p,d]),()=>o(p=>p.filter(f=>f.current!==d.current)))}),[]);return fe.createElement("points",Uc({userData:{instances:a},matrixAutoUpdate:!1,ref:s,raycast:()=>null},r),fe.createElement("bufferGeometry",null,fe.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:Rf}),fe.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:Rf}),fe.createElement("bufferAttribute",{attach:"attributes-size",count:u.length,array:u,itemSize:1,usage:Rf})),fe.createElement(E0e.Provider,{value:h},e))}),T0e=fe.forwardRef(({children:e,positions:t,colors:i,sizes:r,stride:n=3,...s},a)=>{const o=fe.useRef(null);return fe.useImperativeHandle(a,()=>o.current,[]),k0(()=>{const l=o.current.geometry.attributes;l.position.needsUpdate=!0,i&&(l.color.needsUpdate=!0),r&&(l.size.needsUpdate=!0)}),fe.createElement("points",Uc({ref:o},s),fe.createElement("bufferGeometry",null,fe.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/n,array:t,itemSize:n,usage:Rf}),i&&fe.createElement("bufferAttribute",{attach:"attributes-color",count:i.length/n,array:i,itemSize:3,usage:Rf}),r&&fe.createElement("bufferAttribute",{attach:"attributes-size",count:r.length/n,array:r,itemSize:1,usage:Rf})),e)}),P0e=fe.forwardRef((e,t)=>e.positions instanceof Float32Array?fe.createElement(T0e,Uc({},e,{ref:t})):fe.createElement(C0e,Uc({},e,{ref:t})));function EK({all:e,scene:t,camera:i}){const r=Xa(({gl:a})=>a),n=Xa(({camera:a})=>a),s=Xa(({scene:a})=>a);return fe.useLayoutEffect(()=>{const a=[];e&&(t||s).traverse(c=>{c.visible===!1&&(a.push(c),c.visible=!0)}),r.compile(t||s,i||n);const o=new oN(128);new aN(.01,1e5,o).update(r,t||s),o.dispose(),a.forEach(c=>c.visible=!1)},[]),null}const wD=new WeakMap;class CK extends zs{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,i,r,n){const s=new aa(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,a=>{this.parse(a,i,n)},r,n)}parse(t,i,r){this.decodeDracoFile(t,i,null,null,hi).catch(r)}decodeDracoFile(t,i,r,n,s=jo){const a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:s};return this.decodeGeometry(t,a).then(i)}decodeGeometry(t,i){const r=JSON.stringify(i);if(wD.has(t)){const l=wD.get(t);if(l.key===r)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,a=t.byteLength,o=this._getWorker(s,a).then(l=>(n=l,new Promise((c,u)=>{n._callbacks[s]={resolve:c,reject:u},n.postMessage({type:"decode",id:s,taskConfig:i,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),wD.set(t,{key:r,promise:o}),o}_createGeometry(t){const i=new pi;t.index&&i.setIndex(new Ui(t.index.array,1));for(let r=0;r<t.attributes.length;r++){const n=t.attributes[r],s=n.name,a=n.array,o=n.itemSize,l=new Ui(a,o);s==="color"&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=!(a instanceof Float32Array)),i.setAttribute(s,l)}return i}_assignVertexColorSpace(t,i){if(i!==hi)return;const r=new bt;for(let n=0,s=t.count;n<s;n++)r.fromBufferAttribute(t,n).convertSRGBToLinear(),t.setXYZ(n,r.r,r.g,r.b)}_loadLibrary(t,i){const r=new aa(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((n,s)=>{r.load(t,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return t?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{const n=r[0];t||(this.decoderConfig.wasmBinary=r[1]);const s=D0e.toString(),a=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(t,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const a=s.data;switch(a.type){case"decode":n._callbacks[a.id].resolve(a);break;case"error":n._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[t]=i,r._taskLoad+=i,r})}_releaseTask(t,i){t._taskLoad-=t._taskCosts[i],delete t._callbacks[i],delete t._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function D0e(){let e,t;onmessage=function(a){const o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":const l=o.buffer,c=o.taskConfig;t.then(u=>{const h=u.draco,d=new h.Decoder;try{const p=i(h,d,new Int8Array(l),c),f=p.attributes.map(g=>g.array.buffer);p.index&&f.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},f)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{h.destroy(d)}});break}};function i(a,o,l,c){const u=c.attributeIDs,h=c.attributeTypes;let d,p;const f=o.GetEncodedGeometryType(l);if(f===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeArrayToMesh(l,l.byteLength,d);else if(f===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeArrayToPointCloud(l,l.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const g={index:null,attributes:[]};for(const m in u){const v=self[h[m]];let x,y;if(c.useUniqueIDs)y=u[m],x=o.GetAttributeByUniqueId(d,y);else{if(y=o.GetAttributeId(d,a[u[m]]),y===-1)continue;x=o.GetAttribute(d,y)}const _=n(a,o,d,m,v,x);m==="color"&&(_.vertexColorSpace=c.vertexColorSpace),g.attributes.push(_)}return f===a.TRIANGULAR_MESH&&(g.index=r(a,o,d)),a.destroy(d),g}function r(a,o,l){const u=l.num_faces()*3,h=u*4,d=a._malloc(h);o.GetTrianglesUInt32Array(l,h,d);const p=new Uint32Array(a.HEAPF32.buffer,d,u).slice();return a._free(d),{array:p,itemSize:1}}function n(a,o,l,c,u,h){const d=h.num_components(),f=l.num_points()*d,g=f*u.BYTES_PER_ELEMENT,m=s(a,u),v=a._malloc(g);o.GetAttributeDataArrayForAllPoints(l,h,m,g,v);const x=new u(a.HEAPF32.buffer,v,f).slice();return a._free(v),{name:c,array:x,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}const R0e=()=>{const{progress:e}=dve(),t={display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},i={fontSize:14,color:"#F1F1F1",fontWeight:800,marginTop:40};return He.jsxs(ove,{as:"div",center:!0,style:t,children:[He.jsx("span",{className:"canvas-loader"}),He.jsxs("p",{style:i,children:[e.toFixed(2),"%"]})]})},I0e=()=>{const{scene:e}=$w("./planet/scene.gltf",void 0,t=>{const i=new CK;t.setDRACOLoader(i)});return He.jsx("primitive",{object:e,scale:2.5,"position-y":0,"rotation-y":0})},L0e=()=>He.jsxs(pK,{frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},camera:{fov:45,near:.1,far:200,position:[-4,3,6]},shadows:!0,children:[He.jsx(g0e,{autoRotate:!0,enableZoom:!1,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2}),He.jsx(fe.Suspense,{fallback:He.jsx(R0e,{}),children:He.jsx(I0e,{})}),He.jsx(EK,{all:!0})]});Ku.memo(({iconUrl:e})=>{const[t]=GN([e]);return He.jsxs(M0e,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[He.jsx("ambientLight",{intensity:.25}),He.jsx("directionalLight",{position:[0,0,.05]}),He.jsxs("mesh",{castShadow:!0,receiveShadow:!0,scale:2.75,children:[He.jsx("icosahedronGeometry",{args:[1,1]}),He.jsx("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),He.jsx(m0e,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:t,flatShading:!0})]})]})});const O0e=({isMobile:e})=>{const{scene:t}=$w("./desktop_pc/scene.gltf",void 0,i=>{const r=new CK;i.setDRACOLoader(r)});return He.jsxs("mesh",{children:[He.jsx("hemisphereLight",{intensity:.15,groundColor:"black"}),He.jsx("spotLight",{position:[-20,50,10],angle:.12,penumbra:1,intensity:1,castShadow:!0,"shadow-mapSize":1024}),He.jsx("pointLight",{intensity:1}),He.jsx("primitive",{object:t,scale:e?.7:.75,position:e?[0,-3,-2.2]:[0,-3.25,-1.5],rotation:[-.01,-.2,-.1]})]})};Ku.memo(O0e);const B0e=1500,F0e=()=>{const e=fe.useRef({rotation:{x:0,y:0,z:Math.PI/4}}),t=xve(new Float32Array(B0e*3),{radius:1.2});return k0((i,r)=>{e.current.rotation.x-=r/10,e.current.rotation.y-=r/15}),He.jsx("group",{rotation:[0,0,Math.PI/4],children:He.jsx(P0e,{ref:e,positions:t,stride:3,frustumCulled:!0,children:He.jsx(A0e,{transparent:!0,color:"#f272c8",size:.002,sizeAttenuation:!0,depthWrite:!1})})})},N0e=()=>He.jsx("div",{className:"stars-canvas-container",children:He.jsxs(pK,{camera:{position:[0,0,1]},children:[He.jsx(fe.Suspense,{fallback:null,children:He.jsx(F0e,{})}),He.jsx(EK,{all:!0})]})}),TK=fe.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),pT=fe.createContext({}),HN=fe.createContext(null),fT=typeof document<"u",U0e=fT?fe.useLayoutEffect:fe.useEffect,PK=fe.createContext({strict:!1}),jN=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),k0e="framerAppearId",DK="data-"+jN(k0e);function z0e(e,t,i,r){const{visualElement:n}=fe.useContext(pT),s=fe.useContext(PK),a=fe.useContext(HN),o=fe.useContext(TK).reducedMotion,l=fe.useRef();r=r||s.renderer,!l.current&&r&&(l.current=r(e,{visualState:t,parent:n,props:i,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:o}));const c=l.current;fe.useInsertionEffect(()=>{c&&c.update(i,a)});const u=fe.useRef(!!(i[DK]&&!window.HandoffComplete));return U0e(()=>{c&&(c.render(),u.current&&c.animationState&&c.animationState.animateChanges())}),fe.useEffect(()=>{c&&(c.updateFeatures(),!u.current&&c.animationState&&c.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),c}function pv(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function V0e(e,t,i){return fe.useCallback(r=>{r&&e.mount&&e.mount(r),t&&(r?t.mount(r):t.unmount()),i&&(typeof i=="function"?i(r):pv(i)&&(i.current=r))},[t])}function $x(e){return typeof e=="string"||Array.isArray(e)}function mT(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const WN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],XN=["initial",...WN];function gT(e){return mT(e.animate)||XN.some(t=>$x(e[t]))}function RK(e){return!!(gT(e)||e.variants)}function G0e(e,t){if(gT(e)){const{initial:i,animate:r}=e;return{initial:i===!1||$x(i)?i:void 0,animate:$x(r)?r:void 0}}return e.inherit!==!1?t:{}}function H0e(e){const{initial:t,animate:i}=G0e(e,fe.useContext(pT));return fe.useMemo(()=>({initial:t,animate:i}),[eH(t),eH(i)])}function eH(e){return Array.isArray(e)?e.join(" "):e}const tH={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ew={};for(const e in tH)ew[e]={isEnabled:t=>tH[e].some(i=>!!t[i])};function j0e(e){for(const t in e)ew[t]={...ew[t],...e[t]}}const IK=fe.createContext({}),LK=fe.createContext({}),W0e=Symbol.for("motionComponentSymbol");function X0e({preloadedFeatures:e,createVisualElement:t,useRender:i,useVisualState:r,Component:n}){e&&j0e(e);function s(o,l){let c;const u={...fe.useContext(TK),...o,layoutId:Y0e(o)},{isStatic:h}=u,d=H0e(o),p=r(o,h);if(!h&&fT){d.visualElement=z0e(n,p,u,t);const f=fe.useContext(LK),g=fe.useContext(PK).strict;d.visualElement&&(c=d.visualElement.loadFeatures(u,g,e,f))}return fe.createElement(pT.Provider,{value:d},c&&d.visualElement?fe.createElement(c,{visualElement:d.visualElement,...u}):null,i(n,o,V0e(p,d.visualElement,l),p,h,d.visualElement))}const a=fe.forwardRef(s);return a[W0e]=n,a}function Y0e({layoutId:e}){const t=fe.useContext(IK).id;return t&&e!==void 0?t+"-"+e:e}function q0e(e){function t(r,n={}){return X0e(e(r,n))}if(typeof Proxy>"u")return t;const i=new Map;return new Proxy(t,{get:(r,n)=>(i.has(n)||i.set(n,t(n)),i.get(n))})}const Q0e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function YN(e){return typeof e!="string"||e.includes("-")?!1:!!(Q0e.indexOf(e)>-1||/[A-Z]/.test(e))}const yE={};function J0e(e){Object.assign(yE,e)}const eb=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],vm=new Set(eb);function OK(e,{layout:t,layoutId:i}){return vm.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!yE[e]||e==="opacity")}const La=e=>!!(e&&e.getVelocity),K0e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Z0e=eb.length;function $0e(e,{enableHardwareAcceleration:t=!0,allowTransformNone:i=!0},r,n){let s="";for(let a=0;a<Z0e;a++){const o=eb[a];if(e[o]!==void 0){const l=K0e[o]||o;s+=`${l}(${e[o]}) `}}return t&&!e.z&&(s+="translateZ(0)"),s=s.trim(),n?s=n(e,r?"":s):i&&r&&(s="none"),s}const BK=e=>t=>typeof t=="string"&&t.startsWith(e),FK=BK("--"),EL=BK("var(--"),eye=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,tye=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Yd=(e,t,i)=>Math.min(Math.max(i,e),t),ym={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},rx={...ym,transform:e=>Yd(0,1,e)},_S={...ym,default:1},nx=e=>Math.round(e*1e5)/1e5,vT=/(-)?([\d]*\.?[\d])+/g,NK=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,iye=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function tb(e){return typeof e=="string"}const ib=e=>({test:t=>tb(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Qh=ib("deg"),Dc=ib("%"),si=ib("px"),rye=ib("vh"),nye=ib("vw"),iH={...Dc,parse:e=>Dc.parse(e)/100,transform:e=>Dc.transform(e*100)},rH={...ym,transform:Math.round},UK={borderWidth:si,borderTopWidth:si,borderRightWidth:si,borderBottomWidth:si,borderLeftWidth:si,borderRadius:si,radius:si,borderTopLeftRadius:si,borderTopRightRadius:si,borderBottomRightRadius:si,borderBottomLeftRadius:si,width:si,maxWidth:si,height:si,maxHeight:si,size:si,top:si,right:si,bottom:si,left:si,padding:si,paddingTop:si,paddingRight:si,paddingBottom:si,paddingLeft:si,margin:si,marginTop:si,marginRight:si,marginBottom:si,marginLeft:si,rotate:Qh,rotateX:Qh,rotateY:Qh,rotateZ:Qh,scale:_S,scaleX:_S,scaleY:_S,scaleZ:_S,skew:Qh,skewX:Qh,skewY:Qh,distance:si,translateX:si,translateY:si,translateZ:si,x:si,y:si,z:si,perspective:si,transformPerspective:si,opacity:rx,originX:iH,originY:iH,originZ:si,zIndex:rH,fillOpacity:rx,strokeOpacity:rx,numOctaves:rH};function qN(e,t,i,r){const{style:n,vars:s,transform:a,transformOrigin:o}=e;let l=!1,c=!1,u=!0;for(const h in t){const d=t[h];if(FK(h)){s[h]=d;continue}const p=UK[h],f=tye(d,p);if(vm.has(h)){if(l=!0,a[h]=f,!u)continue;d!==(p.default||0)&&(u=!1)}else h.startsWith("origin")?(c=!0,o[h]=f):n[h]=f}if(t.transform||(l||r?n.transform=$0e(e.transform,i,u,r):n.transform&&(n.transform="none")),c){const{originX:h="50%",originY:d="50%",originZ:p=0}=o;n.transformOrigin=`${h} ${d} ${p}`}}const QN=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function kK(e,t,i){for(const r in t)!La(t[r])&&!OK(r,i)&&(e[r]=t[r])}function sye({transformTemplate:e},t,i){return fe.useMemo(()=>{const r=QN();return qN(r,t,{enableHardwareAcceleration:!i},e),Object.assign({},r.vars,r.style)},[t])}function aye(e,t,i){const r=e.style||{},n={};return kK(n,r,e),Object.assign(n,sye(e,t,i)),e.transformValues?e.transformValues(n):n}function oye(e,t,i){const r={},n=aye(e,t,i);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const lye=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function xE(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||lye.has(e)}let zK=e=>!xE(e);function cye(e){e&&(zK=t=>t.startsWith("on")?!xE(t):e(t))}try{cye(require("@emotion/is-prop-valid").default)}catch{}function uye(e,t,i){const r={};for(const n in e)n==="values"&&typeof e.values=="object"||(zK(n)||i===!0&&xE(n)||!t&&!xE(n)||e.draggable&&n.startsWith("onDrag"))&&(r[n]=e[n]);return r}function nH(e,t,i){return typeof e=="string"?e:si.transform(t+i*e)}function hye(e,t,i){const r=nH(t,e.x,e.width),n=nH(i,e.y,e.height);return`${r} ${n}`}const dye={offset:"stroke-dashoffset",array:"stroke-dasharray"},pye={offset:"strokeDashoffset",array:"strokeDasharray"};function fye(e,t,i=1,r=0,n=!0){e.pathLength=1;const s=n?dye:pye;e[s.offset]=si.transform(-r);const a=si.transform(t),o=si.transform(i);e[s.array]=`${a} ${o}`}function JN(e,{attrX:t,attrY:i,attrScale:r,originX:n,originY:s,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...c},u,h,d){if(qN(e,c,u,d),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:f,dimensions:g}=e;p.transform&&(g&&(f.transform=p.transform),delete p.transform),g&&(n!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=hye(g,n!==void 0?n:.5,s!==void 0?s:.5)),t!==void 0&&(p.x=t),i!==void 0&&(p.y=i),r!==void 0&&(p.scale=r),a!==void 0&&fye(p,a,o,l,!1)}const VK=()=>({...QN(),attrs:{}}),KN=e=>typeof e=="string"&&e.toLowerCase()==="svg";function mye(e,t,i,r){const n=fe.useMemo(()=>{const s=VK();return JN(s,t,{enableHardwareAcceleration:!1},KN(r),e.transformTemplate),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};kK(s,e.style,e),n.style={...s,...n.style}}return n}function gye(e=!1){return(i,r,n,{latestValues:s},a)=>{const l=(YN(i)?mye:oye)(r,s,a,i),u={...uye(r,typeof i=="string",e),...l,ref:n},{children:h}=r,d=fe.useMemo(()=>La(h)?h.get():h,[h]);return fe.createElement(i,{...u,children:d})}}function GK(e,{style:t,vars:i},r,n){Object.assign(e.style,t,n&&n.getProjectionStyles(r));for(const s in i)e.style.setProperty(s,i[s])}const HK=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function jK(e,t,i,r){GK(e,t,void 0,r);for(const n in t.attrs)e.setAttribute(HK.has(n)?n:jN(n),t.attrs[n])}function ZN(e,t){const{style:i}=e,r={};for(const n in i)(La(i[n])||t.style&&La(t.style[n])||OK(n,e))&&(r[n]=i[n]);return r}function WK(e,t){const i=ZN(e,t);for(const r in e)if(La(e[r])||La(t[r])){const n=eb.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[n]=e[r]}return i}function $N(e,t,i,r={},n={}){return typeof t=="function"&&(t=t(i!==void 0?i:e.custom,r,n)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(i!==void 0?i:e.custom,r,n)),t}function vye(e){const t=fe.useRef(null);return t.current===null&&(t.current=e()),t.current}const wE=e=>Array.isArray(e),yye=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),xye=e=>wE(e)?e[e.length-1]||0:e;function xM(e){const t=La(e)?e.get():e;return yye(t)?t.toValue():t}function wye({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:i},r,n,s){const a={latestValues:bye(r,n,s,e),renderState:t()};return i&&(a.mount=o=>i(r,o,a)),a}const XK=e=>(t,i)=>{const r=fe.useContext(pT),n=fe.useContext(HN),s=()=>wye(e,t,r,n);return i?s():vye(s)};function bye(e,t,i,r){const n={},s=r(e,{});for(const d in s)n[d]=xM(s[d]);let{initial:a,animate:o}=e;const l=gT(e),c=RK(e);t&&c&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let u=i?i.initial===!1:!1;u=u||a===!1;const h=u?o:a;return h&&typeof h!="boolean"&&!mT(h)&&(Array.isArray(h)?h:[h]).forEach(p=>{const f=$N(e,p);if(!f)return;const{transitionEnd:g,transition:m,...v}=f;for(const x in v){let y=v[x];if(Array.isArray(y)){const _=u?y.length-1:0;y=y[_]}y!==null&&(n[x]=y)}for(const x in g)n[x]=g[x]}),n}const Wr=e=>e;class sH{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const i=this.order.indexOf(t);i!==-1&&(this.order.splice(i,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function _ye(e){let t=new sH,i=new sH,r=0,n=!1,s=!1;const a=new WeakSet,o={schedule:(l,c=!1,u=!1)=>{const h=u&&n,d=h?t:i;return c&&a.add(l),d.add(l)&&h&&n&&(r=t.order.length),l},cancel:l=>{i.remove(l),a.delete(l)},process:l=>{if(n){s=!0;return}if(n=!0,[t,i]=[i,t],i.clear(),r=t.order.length,r)for(let c=0;c<r;c++){const u=t.order[c];u(l),a.has(u)&&(o.schedule(u),e())}n=!1,s&&(s=!1,o.process(l))}};return o}const SS=["prepare","read","update","preRender","render","postRender"],Sye=40;function Aye(e,t){let i=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},s=SS.reduce((h,d)=>(h[d]=_ye(()=>i=!0),h),{}),a=h=>s[h].process(n),o=()=>{const h=performance.now();i=!1,n.delta=r?1e3/60:Math.max(Math.min(h-n.timestamp,Sye),1),n.timestamp=h,n.isProcessing=!0,SS.forEach(a),n.isProcessing=!1,i&&t&&(r=!1,e(o))},l=()=>{i=!0,r=!0,n.isProcessing||e(o)};return{schedule:SS.reduce((h,d)=>{const p=s[d];return h[d]=(f,g=!1,m=!1)=>(i||l(),p.schedule(f,g,m)),h},{}),cancel:h=>SS.forEach(d=>s[d].cancel(h)),state:n,steps:s}}const{schedule:br,cancel:rh,state:Rs,steps:bD}=Aye(typeof requestAnimationFrame<"u"?requestAnimationFrame:Wr,!0),Mye={useVisualState:XK({scrapeMotionValuesFromProps:WK,createRenderState:VK,onMount:(e,t,{renderState:i,latestValues:r})=>{br.read(()=>{try{i.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{i.dimensions={x:0,y:0,width:0,height:0}}}),br.render(()=>{JN(i,r,{enableHardwareAcceleration:!1},KN(t.tagName),e.transformTemplate),jK(t,i)})}})},Eye={useVisualState:XK({scrapeMotionValuesFromProps:ZN,createRenderState:QN})};function Cye(e,{forwardMotionProps:t=!1},i,r){return{...YN(e)?Mye:Eye,preloadedFeatures:i,useRender:gye(t),createVisualElement:r,Component:e}}function Nu(e,t,i,r={passive:!0}){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i)}const YK=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function yT(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}const Tye=e=>t=>YK(t)&&e(t,yT(t));function Yu(e,t,i,r){return Nu(e,t,Tye(i),r)}const Pye=(e,t)=>i=>t(e(i)),Ld=(...e)=>e.reduce(Pye);function qK(e){let t=null;return()=>{const i=()=>{t=null};return t===null?(t=e,i):!1}}const aH=qK("dragHorizontal"),oH=qK("dragVertical");function QK(e){let t=!1;if(e==="y")t=oH();else if(e==="x")t=aH();else{const i=aH(),r=oH();i&&r?t=()=>{i(),r()}:(i&&i(),r&&r())}return t}function JK(){const e=QK(!0);return e?(e(),!1):!0}class op{constructor(t){this.isMounted=!1,this.node=t}update(){}}function lH(e,t){const i="pointer"+(t?"enter":"leave"),r="onHover"+(t?"Start":"End"),n=(s,a)=>{if(s.pointerType==="touch"||JK())return;const o=e.getProps();e.animationState&&o.whileHover&&e.animationState.setActive("whileHover",t),o[r]&&br.update(()=>o[r](s,a))};return Yu(e.current,i,n,{passive:!e.getProps()[r]})}class Dye extends op{mount(){this.unmount=Ld(lH(this.node,!0),lH(this.node,!1))}unmount(){}}class Rye extends op{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ld(Nu(this.node.current,"focus",()=>this.onFocus()),Nu(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const KK=(e,t)=>t?e===t?!0:KK(e,t.parentElement):!1;function _D(e,t){if(!t)return;const i=new PointerEvent("pointer"+e);t(i,yT(i))}class Iye extends op{constructor(){super(...arguments),this.removeStartListeners=Wr,this.removeEndListeners=Wr,this.removeAccessibleListeners=Wr,this.startPointerPress=(t,i)=>{if(this.isPressing)return;this.removeEndListeners();const r=this.node.getProps(),s=Yu(window,"pointerup",(o,l)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:u,globalTapTarget:h}=this.node.getProps();br.update(()=>{!h&&!KK(this.node.current,o.target)?u&&u(o,l):c&&c(o,l)})},{passive:!(r.onTap||r.onPointerUp)}),a=Yu(window,"pointercancel",(o,l)=>this.cancelPress(o,l),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=Ld(s,a),this.startPress(t,i)},this.startAccessiblePress=()=>{const t=s=>{if(s.key!=="Enter"||this.isPressing)return;const a=o=>{o.key!=="Enter"||!this.checkPressEnd()||_D("up",(l,c)=>{const{onTap:u}=this.node.getProps();u&&br.update(()=>u(l,c))})};this.removeEndListeners(),this.removeEndListeners=Nu(this.node.current,"keyup",a),_D("down",(o,l)=>{this.startPress(o,l)})},i=Nu(this.node.current,"keydown",t),r=()=>{this.isPressing&&_D("cancel",(s,a)=>this.cancelPress(s,a))},n=Nu(this.node.current,"blur",r);this.removeAccessibleListeners=Ld(i,n)}}startPress(t,i){this.isPressing=!0;const{onTapStart:r,whileTap:n}=this.node.getProps();n&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&br.update(()=>r(t,i))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!JK()}cancelPress(t,i){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&br.update(()=>r(t,i))}mount(){const t=this.node.getProps(),i=Yu(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),r=Nu(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Ld(i,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const CL=new WeakMap,SD=new WeakMap,Lye=e=>{const t=CL.get(e.target);t&&t(e)},Oye=e=>{e.forEach(Lye)};function Bye({root:e,...t}){const i=e||document;SD.has(i)||SD.set(i,{});const r=SD.get(i),n=JSON.stringify(t);return r[n]||(r[n]=new IntersectionObserver(Oye,{root:e,...t})),r[n]}function Fye(e,t,i){const r=Bye(t);return CL.set(e,i),r.observe(e),()=>{CL.delete(e),r.unobserve(e)}}const Nye={some:0,all:1};class Uye extends op{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s}=t,a={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:Nye[n]},o=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),d=c?u:h;d&&d(l)};return Fye(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(kye(t,i))&&this.startObserver()}unmount(){}}function kye({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const zye={inView:{Feature:Uye},tap:{Feature:Iye},focus:{Feature:Rye},hover:{Feature:Dye}};function ZK(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}function Vye(e){const t={};return e.values.forEach((i,r)=>t[r]=i.get()),t}function Gye(e){const t={};return e.values.forEach((i,r)=>t[r]=i.getVelocity()),t}function xT(e,t,i){const r=e.getProps();return $N(r,t,i!==void 0?i:r.custom,Vye(e),Gye(e))}let Hye=Wr,eU=Wr;const Od=e=>e*1e3,qu=e=>e/1e3,jye={current:!1},$K=e=>Array.isArray(e)&&typeof e[0]=="number";function eZ(e){return!!(!e||typeof e=="string"&&tZ[e]||$K(e)||Array.isArray(e)&&e.every(eZ))}const I1=([e,t,i,r])=>`cubic-bezier(${e}, ${t}, ${i}, ${r})`,tZ={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:I1([0,.65,.55,1]),circOut:I1([.55,0,1,.45]),backIn:I1([.31,.01,.66,-.59]),backOut:I1([.33,1.53,.69,.99])};function iZ(e){if(e)return $K(e)?I1(e):Array.isArray(e)?e.map(iZ):tZ[e]}function Wye(e,t,i,{delay:r=0,duration:n,repeat:s=0,repeatType:a="loop",ease:o,times:l}={}){const c={[t]:i};l&&(c.offset=l);const u=iZ(o);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:r,duration:n,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"})}function Xye(e,{repeat:t,repeatType:i="loop"}){const r=t&&i!=="loop"&&t%2===1?0:e.length-1;return e[r]}const rZ=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,Yye=1e-7,qye=12;function Qye(e,t,i,r,n){let s,a,o=0;do a=t+(i-t)/2,s=rZ(a,r,n)-e,s>0?i=a:t=a;while(Math.abs(s)>Yye&&++o<qye);return a}function rb(e,t,i,r){if(e===t&&i===r)return Wr;const n=s=>Qye(s,0,1,e,i);return s=>s===0||s===1?s:rZ(n(s),t,r)}const Jye=rb(.42,0,1,1),Kye=rb(0,0,.58,1),nZ=rb(.42,0,.58,1),Zye=e=>Array.isArray(e)&&typeof e[0]!="number",sZ=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,aZ=e=>t=>1-e(1-t),tU=e=>1-Math.sin(Math.acos(e)),oZ=aZ(tU),$ye=sZ(tU),lZ=rb(.33,1.53,.69,.99),iU=aZ(lZ),e1e=sZ(iU),t1e=e=>(e*=2)<1?.5*iU(e):.5*(2-Math.pow(2,-10*(e-1))),i1e={linear:Wr,easeIn:Jye,easeInOut:nZ,easeOut:Kye,circIn:tU,circInOut:$ye,circOut:oZ,backIn:iU,backInOut:e1e,backOut:lZ,anticipate:t1e},cH=e=>{if(Array.isArray(e)){eU(e.length===4);const[t,i,r,n]=e;return rb(t,i,r,n)}else if(typeof e=="string")return i1e[e];return e},rU=(e,t)=>i=>!!(tb(i)&&iye.test(i)&&i.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(i,t)),cZ=(e,t,i)=>r=>{if(!tb(r))return r;const[n,s,a,o]=r.match(vT);return{[e]:parseFloat(n),[t]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},r1e=e=>Yd(0,255,e),AD={...ym,transform:e=>Math.round(r1e(e))},yf={test:rU("rgb","red"),parse:cZ("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:r=1})=>"rgba("+AD.transform(e)+", "+AD.transform(t)+", "+AD.transform(i)+", "+nx(rx.transform(r))+")"};function n1e(e){let t="",i="",r="",n="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),r=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),r=e.substring(3,4),n=e.substring(4,5),t+=t,i+=i,r+=r,n+=n),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const TL={test:rU("#"),parse:n1e,transform:yf.transform},fv={test:rU("hsl","hue"),parse:cZ("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:r=1})=>"hsla("+Math.round(e)+", "+Dc.transform(nx(t))+", "+Dc.transform(nx(i))+", "+nx(rx.transform(r))+")"},Ks={test:e=>yf.test(e)||TL.test(e)||fv.test(e),parse:e=>yf.test(e)?yf.parse(e):fv.test(e)?fv.parse(e):TL.parse(e),transform:e=>tb(e)?e:e.hasOwnProperty("red")?yf.transform(e):fv.transform(e)},Ir=(e,t,i)=>-i*e+i*t+e;function MD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function s1e({hue:e,saturation:t,lightness:i,alpha:r}){e/=360,t/=100,i/=100;let n=0,s=0,a=0;if(!t)n=s=a=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;n=MD(l,o,e+1/3),s=MD(l,o,e),a=MD(l,o,e-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}const ED=(e,t,i)=>{const r=e*e;return Math.sqrt(Math.max(0,i*(t*t-r)+r))},a1e=[TL,yf,fv],o1e=e=>a1e.find(t=>t.test(e));function uH(e){const t=o1e(e);let i=t.parse(e);return t===fv&&(i=s1e(i)),i}const uZ=(e,t)=>{const i=uH(e),r=uH(t),n={...i};return s=>(n.red=ED(i.red,r.red,s),n.green=ED(i.green,r.green,s),n.blue=ED(i.blue,r.blue,s),n.alpha=Ir(i.alpha,r.alpha,s),yf.transform(n))};function l1e(e){var t,i;return isNaN(e)&&tb(e)&&(((t=e.match(vT))===null||t===void 0?void 0:t.length)||0)+(((i=e.match(NK))===null||i===void 0?void 0:i.length)||0)>0}const hZ={regex:eye,countKey:"Vars",token:"${v}",parse:Wr},dZ={regex:NK,countKey:"Colors",token:"${c}",parse:Ks.parse},pZ={regex:vT,countKey:"Numbers",token:"${n}",parse:ym.parse};function CD(e,{regex:t,countKey:i,token:r,parse:n}){const s=e.tokenised.match(t);s&&(e["num"+i]=s.length,e.tokenised=e.tokenised.replace(t,r),e.values.push(...s.map(n)))}function bE(e){const t=e.toString(),i={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return i.value.includes("var(--")&&CD(i,hZ),CD(i,dZ),CD(i,pZ),i}function fZ(e){return bE(e).values}function mZ(e){const{values:t,numColors:i,numVars:r,tokenised:n}=bE(e),s=t.length;return a=>{let o=n;for(let l=0;l<s;l++)l<r?o=o.replace(hZ.token,a[l]):l<r+i?o=o.replace(dZ.token,Ks.transform(a[l])):o=o.replace(pZ.token,nx(a[l]));return o}}const c1e=e=>typeof e=="number"?0:e;function u1e(e){const t=fZ(e);return mZ(e)(t.map(c1e))}const qd={test:l1e,parse:fZ,createTransformer:mZ,getAnimatableNone:u1e},gZ=(e,t)=>i=>`${i>0?t:e}`;function vZ(e,t){return typeof e=="number"?i=>Ir(e,t,i):Ks.test(e)?uZ(e,t):e.startsWith("var(")?gZ(e,t):xZ(e,t)}const yZ=(e,t)=>{const i=[...e],r=i.length,n=e.map((s,a)=>vZ(s,t[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}},h1e=(e,t)=>{const i={...e,...t},r={};for(const n in i)e[n]!==void 0&&t[n]!==void 0&&(r[n]=vZ(e[n],t[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}},xZ=(e,t)=>{const i=qd.createTransformer(t),r=bE(e),n=bE(t);return r.numVars===n.numVars&&r.numColors===n.numColors&&r.numNumbers>=n.numNumbers?Ld(yZ(r.values,n.values),i):gZ(e,t)},tw=(e,t,i)=>{const r=t-e;return r===0?1:(i-e)/r},hH=(e,t)=>i=>Ir(e,t,i);function d1e(e){return typeof e=="number"?hH:typeof e=="string"?Ks.test(e)?uZ:xZ:Array.isArray(e)?yZ:typeof e=="object"?h1e:hH}function p1e(e,t,i){const r=[],n=i||d1e(e[0]),s=e.length-1;for(let a=0;a<s;a++){let o=n(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||Wr:t;o=Ld(l,o)}r.push(o)}return r}function wZ(e,t,{clamp:i=!0,ease:r,mixer:n}={}){const s=e.length;if(eU(s===t.length),s===1)return()=>t[0];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=p1e(t,r,n),o=a.length,l=c=>{let u=0;if(o>1)for(;u<e.length-2&&!(c<e[u+1]);u++);const h=tw(e[u],e[u+1],c);return a[u](h)};return i?c=>l(Yd(e[0],e[s-1],c)):l}function f1e(e,t){const i=e[e.length-1];for(let r=1;r<=t;r++){const n=tw(0,t,r);e.push(Ir(i,1,n))}}function m1e(e){const t=[0];return f1e(t,e.length-1),t}function g1e(e,t){return e.map(i=>i*t)}function v1e(e,t){return e.map(()=>t||nZ).splice(0,e.length-1)}function _E({duration:e=300,keyframes:t,times:i,ease:r="easeInOut"}){const n=Zye(r)?r.map(cH):cH(r),s={done:!1,value:t[0]},a=g1e(i&&i.length===t.length?i:m1e(t),e),o=wZ(a,t,{ease:Array.isArray(n)?n:v1e(t,n)});return{calculatedDuration:e,next:l=>(s.value=o(l),s.done=l>=e,s)}}function bZ(e,t){return t?e*(1e3/t):0}const y1e=5;function _Z(e,t,i){const r=Math.max(t-y1e,0);return bZ(i-e(r),t-r)}const TD=.001,x1e=.01,dH=10,w1e=.05,b1e=1;function _1e({duration:e=800,bounce:t=.25,velocity:i=0,mass:r=1}){let n,s;Hye(e<=Od(dH));let a=1-t;a=Yd(w1e,b1e,a),e=Yd(x1e,dH,qu(e)),a<1?(n=c=>{const u=c*a,h=u*e,d=u-i,p=PL(c,a),f=Math.exp(-h);return TD-d/p*f},s=c=>{const h=c*a*e,d=h*i+i,p=Math.pow(a,2)*Math.pow(c,2)*e,f=Math.exp(-h),g=PL(Math.pow(c,2),a);return(-n(c)+TD>0?-1:1)*((d-p)*f)/g}):(n=c=>{const u=Math.exp(-c*e),h=(c-i)*e+1;return-TD+u*h},s=c=>{const u=Math.exp(-c*e),h=(i-c)*(e*e);return u*h});const o=5/e,l=A1e(n,s,o);if(e=Od(e),isNaN(l))return{stiffness:100,damping:10,duration:e};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:a*2*Math.sqrt(r*c),duration:e}}}const S1e=12;function A1e(e,t,i){let r=i;for(let n=1;n<S1e;n++)r=r-e(r)/t(r);return r}function PL(e,t){return e*Math.sqrt(1-t*t)}const M1e=["duration","bounce"],E1e=["stiffness","damping","mass"];function pH(e,t){return t.some(i=>e[i]!==void 0)}function C1e(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!pH(e,E1e)&&pH(e,M1e)){const i=_1e(e);t={...t,...i,mass:1},t.isResolvedFromDuration=!0}return t}function SZ({keyframes:e,restDelta:t,restSpeed:i,...r}){const n=e[0],s=e[e.length-1],a={done:!1,value:n},{stiffness:o,damping:l,mass:c,duration:u,velocity:h,isResolvedFromDuration:d}=C1e({...r,velocity:-qu(r.velocity||0)}),p=h||0,f=l/(2*Math.sqrt(o*c)),g=s-n,m=qu(Math.sqrt(o/c)),v=Math.abs(g)<5;i||(i=v?.01:2),t||(t=v?.005:.5);let x;if(f<1){const y=PL(m,f);x=_=>{const A=Math.exp(-f*m*_);return s-A*((p+f*m*g)/y*Math.sin(y*_)+g*Math.cos(y*_))}}else if(f===1)x=y=>s-Math.exp(-m*y)*(g+(p+m*g)*y);else{const y=m*Math.sqrt(f*f-1);x=_=>{const A=Math.exp(-f*m*_),S=Math.min(y*_,300);return s-A*((p+f*m*g)*Math.sinh(S)+y*g*Math.cosh(S))/y}}return{calculatedDuration:d&&u||null,next:y=>{const _=x(y);if(d)a.done=y>=u;else{let A=p;y!==0&&(f<1?A=_Z(x,y,_):A=0);const S=Math.abs(A)<=i,C=Math.abs(s-_)<=t;a.done=S&&C}return a.value=a.done?s:_,a}}}function fH({keyframes:e,velocity:t=0,power:i=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:u}){const h=e[0],d={done:!1,value:h},p=M=>o!==void 0&&M<o||l!==void 0&&M>l,f=M=>o===void 0?l:l===void 0||Math.abs(o-M)<Math.abs(l-M)?o:l;let g=i*t;const m=h+g,v=a===void 0?m:a(m);v!==m&&(g=v-h);const x=M=>-g*Math.exp(-M/r),y=M=>v+x(M),_=M=>{const E=x(M),P=y(M);d.done=Math.abs(E)<=c,d.value=d.done?v:P};let A,S;const C=M=>{p(d.value)&&(A=M,S=SZ({keyframes:[d.value,f(d.value)],velocity:_Z(y,M,d.value),damping:n,stiffness:s,restDelta:c,restSpeed:u}))};return C(0),{calculatedDuration:null,next:M=>{let E=!1;return!S&&A===void 0&&(E=!0,_(M),C(M)),A!==void 0&&M>A?S.next(M-A):(!E&&_(M),d)}}}const T1e=e=>{const t=({timestamp:i})=>e(i);return{start:()=>br.update(t,!0),stop:()=>rh(t),now:()=>Rs.isProcessing?Rs.timestamp:performance.now()}},mH=2e4;function gH(e){let t=0;const i=50;let r=e.next(t);for(;!r.done&&t<mH;)t+=i,r=e.next(t);return t>=mH?1/0:t}const P1e={decay:fH,inertia:fH,tween:_E,keyframes:_E,spring:SZ};function SE({autoplay:e=!0,delay:t=0,driver:i=T1e,keyframes:r,type:n="keyframes",repeat:s=0,repeatDelay:a=0,repeatType:o="loop",onPlay:l,onStop:c,onComplete:u,onUpdate:h,...d}){let p=1,f=!1,g,m;const v=()=>{m=new Promise(q=>{g=q})};v();let x;const y=P1e[n]||_E;let _;y!==_E&&typeof r[0]!="number"&&(_=wZ([0,100],r,{clamp:!1}),r=[0,100]);const A=y({...d,keyframes:r});let S;o==="mirror"&&(S=y({...d,keyframes:[...r].reverse(),velocity:-(d.velocity||0)}));let C="idle",M=null,E=null,P=null;A.calculatedDuration===null&&s&&(A.calculatedDuration=gH(A));const{calculatedDuration:R}=A;let O=1/0,L=1/0;R!==null&&(O=R+a,L=O*(s+1)-a);let I=0;const z=q=>{if(E===null)return;p>0&&(E=Math.min(E,q)),p<0&&(E=Math.min(q-L/p,E)),M!==null?I=M:I=Math.round(q-E)*p;const W=I-t*(p>=0?1:-1),te=p>=0?W<0:W>L;I=Math.max(W,0),C==="finished"&&M===null&&(I=L);let G=I,le=A;if(s){const de=Math.min(I,L)/O;let xe=Math.floor(de),me=de%1;!me&&de>=1&&(me=1),me===1&&xe--,xe=Math.min(xe,s+1),!!(xe%2)&&(o==="reverse"?(me=1-me,a&&(me-=a/O)):o==="mirror"&&(le=S)),G=Yd(0,1,me)*O}const Z=te?{done:!1,value:r[0]}:le.next(G);_&&(Z.value=_(Z.value));let{done:he}=Z;!te&&R!==null&&(he=p>=0?I>=L:I<=0);const ye=M===null&&(C==="finished"||C==="running"&&he);return h&&h(Z.value),ye&&U(),Z},K=()=>{x&&x.stop(),x=void 0},Y=()=>{C="idle",K(),g(),v(),E=P=null},U=()=>{C="finished",u&&u(),K(),g()},j=()=>{if(f)return;x||(x=i(z));const q=x.now();l&&l(),M!==null?E=q-M:(!E||C==="finished")&&(E=q),C==="finished"&&v(),P=E,M=null,C="running",x.start()};e&&j();const k={then(q,W){return m.then(q,W)},get time(){return qu(I)},set time(q){q=Od(q),I=q,M!==null||!x||p===0?M=q:E=x.now()-q/p},get duration(){const q=A.calculatedDuration===null?gH(A):A.calculatedDuration;return qu(q)},get speed(){return p},set speed(q){q===p||!x||(p=q,k.time=qu(I))},get state(){return C},play:j,pause:()=>{C="paused",M=I},stop:()=>{f=!0,C!=="idle"&&(C="idle",c&&c(),Y())},cancel:()=>{P!==null&&z(P),Y()},complete:()=>{C="finished"},sample:q=>(E=0,z(q))};return k}function D1e(e){let t;return()=>(t===void 0&&(t=e()),t)}const R1e=D1e(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),I1e=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),AS=10,L1e=2e4,O1e=(e,t)=>t.type==="spring"||e==="backgroundColor"||!eZ(t.ease);function B1e(e,t,{onUpdate:i,onComplete:r,...n}){if(!(R1e()&&I1e.has(t)&&!n.repeatDelay&&n.repeatType!=="mirror"&&n.damping!==0&&n.type!=="inertia"))return!1;let a=!1,o,l,c=!1;const u=()=>{l=new Promise(y=>{o=y})};u();let{keyframes:h,duration:d=300,ease:p,times:f}=n;if(O1e(t,n)){const y=SE({...n,repeat:0,delay:0});let _={done:!1,value:h[0]};const A=[];let S=0;for(;!_.done&&S<L1e;)_=y.sample(S),A.push(_.value),S+=AS;f=void 0,h=A,d=S-AS,p="linear"}const g=Wye(e.owner.current,t,h,{...n,duration:d,ease:p,times:f}),m=()=>{c=!1,g.cancel()},v=()=>{c=!0,br.update(m),o(),u()};return g.onfinish=()=>{c||(e.set(Xye(h,n)),r&&r(),v())},{then(y,_){return l.then(y,_)},attachTimeline(y){return g.timeline=y,g.onfinish=null,Wr},get time(){return qu(g.currentTime||0)},set time(y){g.currentTime=Od(y)},get speed(){return g.playbackRate},set speed(y){g.playbackRate=y},get duration(){return qu(d)},play:()=>{a||(g.play(),rh(m))},pause:()=>g.pause(),stop:()=>{if(a=!0,g.playState==="idle")return;const{currentTime:y}=g;if(y){const _=SE({...n,autoplay:!1});e.setWithVelocity(_.sample(y-AS).value,_.sample(y).value,AS)}v()},complete:()=>{c||g.finish()},cancel:v}}function F1e({keyframes:e,delay:t,onUpdate:i,onComplete:r}){const n=()=>(i&&i(e[e.length-1]),r&&r(),{time:0,speed:1,duration:0,play:Wr,pause:Wr,stop:Wr,then:s=>(s(),Promise.resolve()),cancel:Wr,complete:Wr});return t?SE({keyframes:[0,1],duration:0,delay:t,onComplete:n}):n()}const N1e={type:"spring",stiffness:500,damping:25,restSpeed:10},U1e=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),k1e={type:"keyframes",duration:.8},z1e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},V1e=(e,{keyframes:t})=>t.length>2?k1e:vm.has(e)?e.startsWith("scale")?U1e(t[1]):N1e:z1e,DL=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(qd.test(t)||t==="0")&&!t.startsWith("url(")),G1e=new Set(["brightness","contrast","saturate","opacity"]);function H1e(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=i.match(vT)||[];if(!r)return e;const n=i.replace(r,"");let s=G1e.has(t)?1:0;return r!==i&&(s*=100),t+"("+s+n+")"}const j1e=/([a-z-]*)\(.*?\)/g,RL={...qd,getAnimatableNone:e=>{const t=e.match(j1e);return t?t.map(H1e).join(" "):e}},W1e={...UK,color:Ks,backgroundColor:Ks,outlineColor:Ks,fill:Ks,stroke:Ks,borderColor:Ks,borderTopColor:Ks,borderRightColor:Ks,borderBottomColor:Ks,borderLeftColor:Ks,filter:RL,WebkitFilter:RL},nU=e=>W1e[e];function AZ(e,t){let i=nU(e);return i!==RL&&(i=qd),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const MZ=e=>/^0[^.\s]+$/.test(e);function X1e(e){if(typeof e=="number")return e===0;if(e!==null)return e==="none"||e==="0"||MZ(e)}function Y1e(e,t,i,r){const n=DL(t,i);let s;Array.isArray(i)?s=[...i]:s=[null,i];const a=r.from!==void 0?r.from:e.get();let o;const l=[];for(let c=0;c<s.length;c++)s[c]===null&&(s[c]=c===0?a:s[c-1]),X1e(s[c])&&l.push(c),typeof s[c]=="string"&&s[c]!=="none"&&s[c]!=="0"&&(o=s[c]);if(n&&l.length&&o)for(let c=0;c<l.length;c++){const u=l[c];s[u]=AZ(t,o)}return s}function q1e({when:e,delay:t,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length}function sU(e,t){return e[t]||e.default||e}const Q1e={skipAnimations:!1},aU=(e,t,i,r={})=>n=>{const s=sU(r,e)||{},a=s.delay||r.delay||0;let{elapsed:o=0}=r;o=o-Od(a);const l=Y1e(t,e,i,s),c=l[0],u=l[l.length-1],h=DL(e,c),d=DL(e,u);let p={keyframes:l,velocity:t.getVelocity(),ease:"easeOut",...s,delay:-o,onUpdate:f=>{t.set(f),s.onUpdate&&s.onUpdate(f)},onComplete:()=>{n(),s.onComplete&&s.onComplete()}};if(q1e(s)||(p={...p,...V1e(e,p)}),p.duration&&(p.duration=Od(p.duration)),p.repeatDelay&&(p.repeatDelay=Od(p.repeatDelay)),!h||!d||jye.current||s.type===!1||Q1e.skipAnimations)return F1e(p);if(!r.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const f=B1e(t,e,p);if(f)return f}return SE(p)};function AE(e){return!!(La(e)&&e.add)}const EZ=e=>/^\-?\d*\.?\d+$/.test(e);function oU(e,t){e.indexOf(t)===-1&&e.push(t)}function lU(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}class cU{constructor(){this.subscriptions=[]}add(t){return oU(this.subscriptions,t),()=>lU(this.subscriptions,t)}notify(t,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(t,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const J1e=e=>!isNaN(parseFloat(e));class K1e{constructor(t,i={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(r,n=!0)=>{this.prev=this.current,this.current=r;const{delta:s,timestamp:a}=Rs;this.lastUpdated!==a&&(this.timeDelta=s,this.lastUpdated=a,br.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>br.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=J1e(this.current),this.owner=i.owner}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new cU);const r=this.events[t].add(i);return t==="change"?()=>{r(),br.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,r){this.set(i),this.prev=t,this.timeDelta=r}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?bZ(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function c0(e,t){return new K1e(e,t)}const CZ=e=>t=>t.test(e),Z1e={test:e=>e==="auto",parse:e=>e},TZ=[ym,si,Dc,Qh,nye,rye,Z1e],Xy=e=>TZ.find(CZ(e)),$1e=[...TZ,Ks,qd],exe=e=>$1e.find(CZ(e));function txe(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,c0(i))}function ixe(e,t){const i=xT(e,t);let{transitionEnd:r={},transition:n={},...s}=i?e.makeTargetAnimatable(i,!1):{};s={...s,...r};for(const a in s){const o=xye(s[a]);txe(e,a,o)}}function rxe(e,t,i){var r,n;const s=Object.keys(t).filter(o=>!e.hasValue(o)),a=s.length;if(a)for(let o=0;o<a;o++){const l=s[o],c=t[l];let u=null;Array.isArray(c)&&(u=c[0]),u===null&&(u=(n=(r=i[l])!==null&&r!==void 0?r:e.readValue(l))!==null&&n!==void 0?n:t[l]),u!=null&&(typeof u=="string"&&(EZ(u)||MZ(u))?u=parseFloat(u):!exe(u)&&qd.test(c)&&(u=AZ(l,c)),e.addValue(l,c0(u,{owner:e})),i[l]===void 0&&(i[l]=u),u!==null&&e.setBaseTarget(l,u))}}function nxe(e,t){return t?(t[e]||t.default||t).from:void 0}function sxe(e,t,i){const r={};for(const n in e){const s=nxe(n,t);if(s!==void 0)r[n]=s;else{const a=i.getValue(n);a&&(r[n]=a.get())}}return r}function axe({protectedKeys:e,needsAnimating:t},i){const r=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,r}function oxe(e,t){const i=e.get();if(Array.isArray(t)){for(let r=0;r<t.length;r++)if(t[r]!==i)return!0}else return i!==t}function PZ(e,t,{delay:i=0,transitionOverride:r,type:n}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:a,...o}=e.makeTargetAnimatable(t);const l=e.getValue("willChange");r&&(s=r);const c=[],u=n&&e.animationState&&e.animationState.getState()[n];for(const h in o){const d=e.getValue(h),p=o[h];if(!d||p===void 0||u&&axe(u,h))continue;const f={delay:i,elapsed:0,...sU(s||{},h)};if(window.HandoffAppearAnimations){const v=e.getProps()[DK];if(v){const x=window.HandoffAppearAnimations(v,h,d,br);x!==null&&(f.elapsed=x,f.isHandoff=!0)}}let g=!f.isHandoff&&!oxe(d,p);if(f.type==="spring"&&(d.getVelocity()||f.velocity)&&(g=!1),d.animation&&(g=!1),g)continue;d.start(aU(h,d,p,e.shouldReduceMotion&&vm.has(h)?{type:!1}:f));const m=d.animation;AE(l)&&(l.add(h),m.then(()=>l.remove(h))),c.push(m)}return a&&Promise.all(c).then(()=>{a&&ixe(e,a)}),c}function IL(e,t,i={}){const r=xT(e,t,i.custom);let{transition:n=e.getDefaultTransition()||{}}=r||{};i.transitionOverride&&(n=i.transitionOverride);const s=r?()=>Promise.all(PZ(e,r,i)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:h}=n;return lxe(e,t,c+l,u,h,i)}:()=>Promise.resolve(),{when:o}=n;if(o){const[l,c]=o==="beforeChildren"?[s,a]:[a,s];return l().then(()=>c())}else return Promise.all([s(),a(i.delay)])}function lxe(e,t,i=0,r=0,n=1,s){const a=[],o=(e.variantChildren.size-1)*r,l=n===1?(c=0)=>c*r:(c=0)=>o-c*r;return Array.from(e.variantChildren).sort(cxe).forEach((c,u)=>{c.notify("AnimationStart",t),a.push(IL(c,t,{...s,delay:i+l(u)}).then(()=>c.notify("AnimationComplete",t)))}),Promise.all(a)}function cxe(e,t){return e.sortNodePosition(t)}function uxe(e,t,i={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const n=t.map(s=>IL(e,s,i));r=Promise.all(n)}else if(typeof t=="string")r=IL(e,t,i);else{const n=typeof t=="function"?xT(e,t,i.custom):t;r=Promise.all(PZ(e,n,i))}return r.then(()=>e.notify("AnimationComplete",t))}const hxe=[...WN].reverse(),dxe=WN.length;function pxe(e){return t=>Promise.all(t.map(({animation:i,options:r})=>uxe(e,i,r)))}function fxe(e){let t=pxe(e);const i=gxe();let r=!0;const n=(l,c)=>{const u=xT(e,c);if(u){const{transition:h,transitionEnd:d,...p}=u;l={...l,...p,...d}}return l};function s(l){t=l(e)}function a(l,c){const u=e.getProps(),h=e.getVariantContext(!0)||{},d=[],p=new Set;let f={},g=1/0;for(let v=0;v<dxe;v++){const x=hxe[v],y=i[x],_=u[x]!==void 0?u[x]:h[x],A=$x(_),S=x===c?y.isActive:null;S===!1&&(g=v);let C=_===h[x]&&_!==u[x]&&A;if(C&&r&&e.manuallyAnimateOnMount&&(C=!1),y.protectedKeys={...f},!y.isActive&&S===null||!_&&!y.prevProp||mT(_)||typeof _=="boolean")continue;let E=mxe(y.prevProp,_)||x===c&&y.isActive&&!C&&A||v>g&&A,P=!1;const R=Array.isArray(_)?_:[_];let O=R.reduce(n,{});S===!1&&(O={});const{prevResolvedValues:L={}}=y,I={...L,...O},z=K=>{E=!0,p.has(K)&&(P=!0,p.delete(K)),y.needsAnimating[K]=!0};for(const K in I){const Y=O[K],U=L[K];if(f.hasOwnProperty(K))continue;let j=!1;wE(Y)&&wE(U)?j=!ZK(Y,U):j=Y!==U,j?Y!==void 0?z(K):p.add(K):Y!==void 0&&p.has(K)?z(K):y.protectedKeys[K]=!0}y.prevProp=_,y.prevResolvedValues=O,y.isActive&&(f={...f,...O}),r&&e.blockInitialAnimation&&(E=!1),E&&(!C||P)&&d.push(...R.map(K=>({animation:K,options:{type:x,...l}})))}if(p.size){const v={};p.forEach(x=>{const y=e.getBaseTarget(x);y!==void 0&&(v[x]=y)}),d.push({animation:v})}let m=!!d.length;return r&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(m=!1),r=!1,m?t(d):Promise.resolve()}function o(l,c,u){var h;if(i[l].isActive===c)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(p=>{var f;return(f=p.animationState)===null||f===void 0?void 0:f.setActive(l,c)}),i[l].isActive=c;const d=a(u,l);for(const p in i)i[p].protectedKeys={};return d}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i}}function mxe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!ZK(t,e):!1}function Ip(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function gxe(){return{animate:Ip(!0),whileInView:Ip(),whileHover:Ip(),whileTap:Ip(),whileDrag:Ip(),whileFocus:Ip(),exit:Ip()}}class vxe extends op{constructor(t){super(t),t.animationState||(t.animationState=fxe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),mT(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){}}let yxe=0;class xxe extends op{constructor(){super(...arguments),this.id=yxe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i,custom:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const s=this.node.animationState.setActive("exit",!t,{custom:r??this.node.getProps().custom});i&&!t&&s.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const wxe={animation:{Feature:vxe},exit:{Feature:xxe}},vH=(e,t)=>Math.abs(e-t);function bxe(e,t){const i=vH(e.x,t.x),r=vH(e.y,t.y);return Math.sqrt(i**2+r**2)}class DZ{constructor(t,i,{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=DD(this.lastMoveEventInfo,this.history),d=this.startEvent!==null,p=bxe(h.offset,{x:0,y:0})>=3;if(!d&&!p)return;const{point:f}=h,{timestamp:g}=Rs;this.history.push({...f,timestamp:g});const{onStart:m,onMove:v}=this.handlers;d||(m&&m(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,h)},this.handlePointerMove=(h,d)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=PD(d,this.transformPagePoint),br.update(this.updatePoint,!0)},this.handlePointerUp=(h,d)=>{this.end();const{onEnd:p,onSessionEnd:f,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=DD(h.type==="pointercancel"?this.lastMoveEventInfo:PD(d,this.transformPagePoint),this.history);this.startEvent&&p&&p(h,m),f&&f(h,m)},!YK(t))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=r,this.contextWindow=n||window;const a=yT(t),o=PD(a,this.transformPagePoint),{point:l}=o,{timestamp:c}=Rs;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=i;u&&u(t,DD(o,this.history)),this.removeListeners=Ld(Yu(this.contextWindow,"pointermove",this.handlePointerMove),Yu(this.contextWindow,"pointerup",this.handlePointerUp),Yu(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),rh(this.updatePoint)}}function PD(e,t){return t?{point:t(e.point)}:e}function yH(e,t){return{x:e.x-t.x,y:e.y-t.y}}function DD({point:e},t){return{point:e,delta:yH(e,RZ(t)),offset:yH(e,_xe(t)),velocity:Sxe(t,.1)}}function _xe(e){return e[0]}function RZ(e){return e[e.length-1]}function Sxe(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,r=null;const n=RZ(e);for(;i>=0&&(r=e[i],!(n.timestamp-r.timestamp>Od(t)));)i--;if(!r)return{x:0,y:0};const s=qu(n.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function to(e){return e.max-e.min}function LL(e,t=0,i=.01){return Math.abs(e-t)<=i}function xH(e,t,i,r=.5){e.origin=r,e.originPoint=Ir(t.min,t.max,e.origin),e.scale=to(i)/to(t),(LL(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=Ir(i.min,i.max,e.origin)-e.originPoint,(LL(e.translate)||isNaN(e.translate))&&(e.translate=0)}function sx(e,t,i,r){xH(e.x,t.x,i.x,r?r.originX:void 0),xH(e.y,t.y,i.y,r?r.originY:void 0)}function wH(e,t,i){e.min=i.min+t.min,e.max=e.min+to(t)}function Axe(e,t,i){wH(e.x,t.x,i.x),wH(e.y,t.y,i.y)}function bH(e,t,i){e.min=t.min-i.min,e.max=e.min+to(t)}function ax(e,t,i){bH(e.x,t.x,i.x),bH(e.y,t.y,i.y)}function Mxe(e,{min:t,max:i},r){return t!==void 0&&e<t?e=r?Ir(t,e,r.min):Math.max(e,t):i!==void 0&&e>i&&(e=r?Ir(i,e,r.max):Math.min(e,i)),e}function _H(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function Exe(e,{top:t,left:i,bottom:r,right:n}){return{x:_H(e.x,i,n),y:_H(e.y,t,r)}}function SH(e,t){let i=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,r]=[r,i]),{min:i,max:r}}function Cxe(e,t){return{x:SH(e.x,t.x),y:SH(e.y,t.y)}}function Txe(e,t){let i=.5;const r=to(e),n=to(t);return n>r?i=tw(t.min,t.max-r,e.min):r>n&&(i=tw(e.min,e.max-n,t.min)),Yd(0,1,i)}function Pxe(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const OL=.35;function Dxe(e=OL){return e===!1?e=0:e===!0&&(e=OL),{x:AH(e,"left","right"),y:AH(e,"top","bottom")}}function AH(e,t,i){return{min:MH(e,t),max:MH(e,i)}}function MH(e,t){return typeof e=="number"?e:e[t]||0}const EH=()=>({translate:0,scale:1,origin:0,originPoint:0}),mv=()=>({x:EH(),y:EH()}),CH=()=>({min:0,max:0}),dn=()=>({x:CH(),y:CH()});function Ao(e){return[e("x"),e("y")]}function IZ({top:e,left:t,right:i,bottom:r}){return{x:{min:t,max:i},y:{min:e,max:r}}}function Rxe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Ixe(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}function RD(e){return e===void 0||e===1}function BL({scale:e,scaleX:t,scaleY:i}){return!RD(e)||!RD(t)||!RD(i)}function Yp(e){return BL(e)||LZ(e)||e.z||e.rotate||e.rotateX||e.rotateY}function LZ(e){return TH(e.x)||TH(e.y)}function TH(e){return e&&e!=="0%"}function ME(e,t,i){const r=e-i,n=t*r;return i+n}function PH(e,t,i,r,n){return n!==void 0&&(e=ME(e,n,r)),ME(e,i,r)+t}function FL(e,t=0,i=1,r,n){e.min=PH(e.min,t,i,r,n),e.max=PH(e.max,t,i,r,n)}function OZ(e,{x:t,y:i}){FL(e.x,t.translate,t.scale,t.originPoint),FL(e.y,i.translate,i.scale,i.originPoint)}function Lxe(e,t,i,r=!1){const n=i.length;if(!n)return;t.x=t.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const l=s.instance;l&&l.style&&l.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&gv(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,OZ(e,a)),r&&Yp(s.latestValues)&&gv(e,s.latestValues))}t.x=DH(t.x),t.y=DH(t.y)}function DH(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Zh(e,t){e.min=e.min+t,e.max=e.max+t}function RH(e,t,[i,r,n]){const s=t[n]!==void 0?t[n]:.5,a=Ir(e.min,e.max,s);FL(e,t[i],t[r],a,t.scale)}const Oxe=["x","scaleX","originX"],Bxe=["y","scaleY","originY"];function gv(e,t){RH(e.x,t,Oxe),RH(e.y,t,Bxe)}function BZ(e,t){return IZ(Ixe(e.getBoundingClientRect(),t))}function Fxe(e,t,i){const r=BZ(e,i),{scroll:n}=t;return n&&(Zh(r.x,n.offset.x),Zh(r.y,n.offset.y)),r}const FZ=({current:e})=>e?e.ownerDocument.defaultView:null,Nxe=new WeakMap;class Uxe{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=dn(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const n=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(yT(u,"page").point)},s=(u,h)=>{const{drag:d,dragPropagation:p,onDragStart:f}=this.getProps();if(d&&!p&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=QK(d),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ao(m=>{let v=this.getAxisMotionValue(m).get()||0;if(Dc.test(v)){const{projection:x}=this.visualElement;if(x&&x.layout){const y=x.layout.layoutBox[m];y&&(v=to(y)*(parseFloat(v)/100))}}this.originPoint[m]=v}),f&&br.update(()=>f(u,h),!1,!0);const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},a=(u,h)=>{const{dragPropagation:d,dragDirectionLock:p,onDirectionLock:f,onDrag:g}=this.getProps();if(!d&&!this.openGlobalLock)return;const{offset:m}=h;if(p&&this.currentDirection===null){this.currentDirection=kxe(m),this.currentDirection!==null&&f&&f(this.currentDirection);return}this.updateAxis("x",h.point,m),this.updateAxis("y",h.point,m),this.visualElement.render(),g&&g(u,h)},o=(u,h)=>this.stop(u,h),l=()=>Ao(u=>{var h;return this.getAnimationState(u)==="paused"&&((h=this.getAxisMotionValue(u).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new DZ(t,{onSessionStart:n,onStart:s,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:FZ(this.visualElement)})}stop(t,i){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=i;this.startAnimation(n);const{onDragEnd:s}=this.getProps();s&&br.update(()=>s(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,r){const{drag:n}=this.getProps();if(!r||!MS(t,n,this.currentDirection))return;const s=this.getAxisMotionValue(t);let a=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(a=Mxe(a,this.constraints[t],this.elastic[t])),s.set(a)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,s=this.constraints;i&&pv(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&n?this.constraints=Exe(n.layoutBox,i):this.constraints=!1,this.elastic=Dxe(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Ao(a=>{this.getAxisMotionValue(a)&&(this.constraints[a]=Pxe(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!pv(t))return!1;const r=t.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=Fxe(r,n.root,this.visualElement.getTransformPagePoint());let a=Cxe(n.layout.layoutBox,s);if(i){const o=i(Rxe(a));this.hasMutatedConstraints=!!o,o&&(a=IZ(o))}return a}startAnimation(t){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=Ao(u=>{if(!MS(u,i,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const d=n?200:1e6,p=n?40:1e7,f={type:"inertia",velocity:r?t[u]:0,bounceStiffness:d,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,f)});return Promise.all(c).then(o)}startAxisValueAnimation(t,i){const r=this.getAxisMotionValue(t);return r.start(aU(t,r,0,i))}stopAnimation(){Ao(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ao(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i="_drag"+t.toUpperCase(),r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Ao(i=>{const{drag:r}=this.getProps();if(!MS(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(t[i]-Ir(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!pv(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Ao(a=>{const o=this.getAxisMotionValue(a);if(o){const l=o.get();n[a]=Txe({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Ao(a=>{if(!MS(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(Ir(l,c,n[a]))})}addListeners(){if(!this.visualElement.current)return;Nxe.set(this.visualElement,this);const t=this.visualElement.current,i=Yu(t,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();pv(l)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),r();const a=Nu(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Ao(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),i(),s(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=OL,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function MS(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function kxe(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class zxe extends op{constructor(t){super(t),this.removeGroupControls=Wr,this.removeListeners=Wr,this.controls=new Uxe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Wr}unmount(){this.removeGroupControls(),this.removeListeners()}}const IH=e=>(t,i)=>{e&&br.update(()=>e(t,i))};class Vxe extends op{constructor(){super(...arguments),this.removePointerDownListener=Wr}onPointerDown(t){this.session=new DZ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:FZ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:IH(t),onStart:IH(i),onMove:r,onEnd:(s,a)=>{delete this.session,n&&br.update(()=>n(s,a))}}}mount(){this.removePointerDownListener=Yu(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function Gxe(){const e=fe.useContext(HN);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:i,register:r}=e,n=fe.useId();return fe.useEffect(()=>r(n),[]),!t&&i?[!1,()=>i&&i(n)]:[!0]}const wM={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function LH(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Yy={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(si.test(e))e=parseFloat(e);else return e;const i=LH(e,t.target.x),r=LH(e,t.target.y);return`${i}% ${r}%`}},Hxe={correct:(e,{treeScale:t,projectionDelta:i})=>{const r=e,n=qd.parse(e);if(n.length>5)return r;const s=qd.createTransformer(e),a=typeof n[0]!="number"?1:0,o=i.x.scale*t.x,l=i.y.scale*t.y;n[0+a]/=o,n[1+a]/=l;const c=Ir(o,l,.5);return typeof n[2+a]=="number"&&(n[2+a]/=c),typeof n[3+a]=="number"&&(n[3+a]/=c),s(n)}};class jxe extends Ku.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=t;J0e(Wxe),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),wM.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,a=r.projection;return a&&(a.isPresent=s,n||t.layoutDependency!==i||i===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?a.promote():a.relegate()||br.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=t;n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function NZ(e){const[t,i]=Gxe(),r=fe.useContext(IK);return Ku.createElement(jxe,{...e,layoutGroup:r,switchLayoutGroup:fe.useContext(LK),isPresent:t,safeToRemove:i})}const Wxe={borderRadius:{...Yy,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Yy,borderTopRightRadius:Yy,borderBottomLeftRadius:Yy,borderBottomRightRadius:Yy,boxShadow:Hxe},UZ=["TopLeft","TopRight","BottomLeft","BottomRight"],Xxe=UZ.length,OH=e=>typeof e=="string"?parseFloat(e):e,BH=e=>typeof e=="number"||si.test(e);function Yxe(e,t,i,r,n,s){n?(e.opacity=Ir(0,i.opacity!==void 0?i.opacity:1,qxe(r)),e.opacityExit=Ir(t.opacity!==void 0?t.opacity:1,0,Qxe(r))):s&&(e.opacity=Ir(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,r));for(let a=0;a<Xxe;a++){const o=`border${UZ[a]}Radius`;let l=FH(t,o),c=FH(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||BH(l)===BH(c)?(e[o]=Math.max(Ir(OH(l),OH(c),r),0),(Dc.test(c)||Dc.test(l))&&(e[o]+="%")):e[o]=c}(t.rotate||i.rotate)&&(e.rotate=Ir(t.rotate||0,i.rotate||0,r))}function FH(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const qxe=kZ(0,.5,oZ),Qxe=kZ(.5,.95,Wr);function kZ(e,t,i){return r=>r<e?0:r>t?1:i(tw(e,t,r))}function NH(e,t){e.min=t.min,e.max=t.max}function go(e,t){NH(e.x,t.x),NH(e.y,t.y)}function UH(e,t,i,r,n){return e-=t,e=ME(e,1/i,r),n!==void 0&&(e=ME(e,1/n,r)),e}function Jxe(e,t=0,i=1,r=.5,n,s=e,a=e){if(Dc.test(t)&&(t=parseFloat(t),t=Ir(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=Ir(s.min,s.max,r);e===s&&(o-=t),e.min=UH(e.min,t,i,o,n),e.max=UH(e.max,t,i,o,n)}function kH(e,t,[i,r,n],s,a){Jxe(e,t[i],t[r],t[n],t.scale,s,a)}const Kxe=["x","scaleX","originX"],Zxe=["y","scaleY","originY"];function zH(e,t,i,r){kH(e.x,t,Kxe,i?i.x:void 0,r?r.x:void 0),kH(e.y,t,Zxe,i?i.y:void 0,r?r.y:void 0)}function VH(e){return e.translate===0&&e.scale===1}function zZ(e){return VH(e.x)&&VH(e.y)}function $xe(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function VZ(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function GH(e){return to(e.x)/to(e.y)}class ewe{constructor(){this.members=[]}add(t){oU(this.members,t),t.scheduleRender()}remove(t){if(lU(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(n=>t===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,i){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,i&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:r}=t;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function HH(e,t,i){let r="";const n=e.x.translate/t.x,s=e.y.translate/t.y;if((n||s)&&(r=`translate3d(${n}px, ${s}px, 0) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),i){const{rotate:l,rotateX:c,rotateY:u}=i;l&&(r+=`rotate(${l}deg) `),c&&(r+=`rotateX(${c}deg) `),u&&(r+=`rotateY(${u}deg) `)}const a=e.x.scale*t.x,o=e.y.scale*t.y;return(a!==1||o!==1)&&(r+=`scale(${a}, ${o})`),r||"none"}const twe=(e,t)=>e.depth-t.depth;class iwe{constructor(){this.children=[],this.isDirty=!1}add(t){oU(this.children,t),this.isDirty=!0}remove(t){lU(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(twe),this.isDirty=!1,this.children.forEach(t)}}function rwe(e,t){const i=performance.now(),r=({timestamp:n})=>{const s=n-i;s>=t&&(rh(r),e(s-t))};return br.read(r,!0),()=>rh(r)}function nwe(e){window.MotionDebug&&window.MotionDebug.record(e)}function swe(e){return e instanceof SVGElement&&e.tagName!=="svg"}function awe(e,t,i){const r=La(e)?e:c0(e);return r.start(aU("",r,t,i)),r.animation}const jH=["","X","Y","Z"],owe={visibility:"hidden"},WH=1e3;let lwe=0;const qp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function GZ({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a={},o=t==null?void 0:t()){this.id=lwe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,qp.totalNodes=qp.resolvedTargetDeltas=qp.recalculatedProjection=0,this.nodes.forEach(hwe),this.nodes.forEach(gwe),this.nodes.forEach(vwe),this.nodes.forEach(dwe),nwe(qp)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new iwe)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new cU),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=swe(a),this.instance=a;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(c||l)&&(this.isLayoutDirty=!0),e){let h;const d=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=rwe(d,250),wM.hasAnimatedSinceResize&&(wM.hasAnimatedSinceResize=!1,this.nodes.forEach(YH))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:d,hasRelativeTargetChanged:p,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||u.getDefaultTransition()||_we,{onLayoutAnimationStart:m,onLayoutAnimationComplete:v}=u.getProps(),x=!this.targetLayout||!VZ(this.targetLayout,f)||p,y=!d&&p;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||y||d&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,y);const _={...sU(g,"layout"),onPlay:m,onComplete:v};(u.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_)}else d||YH(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,rh(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ywe),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(XH);return}this.isUpdating||this.nodes.forEach(fwe),this.isUpdating=!1,this.nodes.forEach(mwe),this.nodes.forEach(cwe),this.nodes.forEach(uwe),this.clearAllSnapshots();const o=performance.now();Rs.delta=Yd(0,1e3/60,o-Rs.timestamp),Rs.timestamp=o,Rs.isProcessing=!0,bD.update.process(Rs),bD.preRender.process(Rs),bD.render.process(Rs),Rs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(pwe),this.sharedNodes.forEach(xwe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,br.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){br.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=dn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&(this.scroll={animationId:this.root.animationId,phase:a,isRoot:r(this.instance),offset:i(this.instance)})}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform,o=this.projectionDelta&&!zZ(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;a&&(o||Yp(this.latestValues)||u)&&(n(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),Swe(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return dn();const o=a.measureViewportBox(),{scroll:l}=this.root;return l&&(Zh(o.x,l.offset.x),Zh(o.y,l.offset.y)),o}removeElementScroll(a){const o=dn();go(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:h}=c;if(c!==this.root&&u&&h.layoutScroll){if(u.isRoot){go(o,a);const{scroll:d}=this.root;d&&(Zh(o.x,-d.offset.x),Zh(o.y,-d.offset.y))}Zh(o.x,u.offset.x),Zh(o.y,u.offset.y)}}return o}applyTransform(a,o=!1){const l=dn();go(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&gv(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Yp(u.latestValues)&&gv(l,u.latestValues)}return Yp(this.latestValues)&&gv(l,this.latestValues),l}removeTransform(a){const o=dn();go(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Yp(c.latestValues))continue;BL(c.latestValues)&&c.updateSnapshot();const u=dn(),h=c.measurePageBox();go(u,h),zH(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Yp(this.latestValues)&&zH(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Rs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:h,layoutId:d}=this.options;if(!(!this.layout||!(h||d))){if(this.resolvedRelativeTargetAt=Rs.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=dn(),this.relativeTargetOrigin=dn(),ax(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),go(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=dn(),this.targetWithTransforms=dn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Axe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):go(this.target,this.layout.layoutBox),OZ(this.target,this.targetDelta)):go(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=dn(),this.relativeTargetOrigin=dn(),ax(this.relativeTargetOrigin,this.target,p.target),go(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}qp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||BL(this.parent.latestValues)||LZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Rs.timestamp&&(c=!1),c)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;go(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,p=this.treeScale.y;Lxe(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox);const{target:f}=o;if(!f){this.projectionTransform&&(this.projectionDelta=mv(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=mv(),this.projectionDeltaWithTransform=mv());const g=this.projectionTransform;sx(this.projectionDelta,this.layoutCorrected,f,this.latestValues),this.projectionTransform=HH(this.projectionDelta,this.treeScale),(this.projectionTransform!==g||this.treeScale.x!==d||this.treeScale.y!==p)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f)),qp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},h=mv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=dn(),p=l?l.source:void 0,f=this.layout?this.layout.source:void 0,g=p!==f,m=this.getStack(),v=!m||m.members.length<=1,x=!!(g&&!v&&this.options.crossfade===!0&&!this.path.some(bwe));this.animationProgress=0;let y;this.mixTargetDelta=_=>{const A=_/1e3;qH(h.x,a.x,A),qH(h.y,a.y,A),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ax(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),wwe(this.relativeTarget,this.relativeTargetOrigin,d,A),y&&$xe(this.relativeTarget,y)&&(this.isProjectionDirty=!1),y||(y=dn()),go(y,this.relativeTarget)),g&&(this.animationValues=u,Yxe(u,c,this.latestValues,A,x,v)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=A},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(rh(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=br.update(()=>{wM.hasAnimatedSinceResize=!0,this.currentAnimation=awe(0,WH,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(WH),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:u}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&HZ(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||dn();const h=to(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=to(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}go(o,l),gv(o,u),sx(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new ewe),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.rotate||l.rotateX||l.rotateY||l.rotateZ)&&(o=!0),!o)return;const c={};for(let u=0;u<jH.length;u++){const h="rotate"+jH[u];l[h]&&(c[h]=l[h],a.setStaticValue(h,0))}a.render();for(const u in c)a.setStaticValue(u,c[u]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return owe;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=xM(a==null?void 0:a.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=xM(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Yp(this.latestValues)&&(g.transform=u?u({},""):"none",this.hasProjected=!1),g}const d=h.animationValues||h.latestValues;this.applyTransformsToTarget(),c.transform=HH(this.projectionDeltaWithTransform,this.treeScale,d),u&&(c.transform=u(d,c.transform));const{x:p,y:f}=this.projectionDelta;c.transformOrigin=`${p.origin*100}% ${f.origin*100}% 0`,h.animationValues?c.opacity=h===this?(l=(o=d.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:c.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const g in yE){if(d[g]===void 0)continue;const{correct:m,applyTo:v}=yE[g],x=c.transform==="none"?d[g]:m(d[g],h);if(v){const y=v.length;for(let _=0;_<y;_++)c[v[_]]=x}else c[g]=x}return this.options.layoutId&&(c.pointerEvents=h===this?xM(a==null?void 0:a.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(XH),this.root.sharedNodes.clear()}}}function cwe(e){e.updateLayout()}function uwe(e){var t;const i=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:s}=e.options,a=i.source!==e.layout.source;s==="size"?Ao(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],p=to(d);d.min=r[h].min,d.max=d.min+p}):HZ(s,i.layoutBox,r)&&Ao(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],p=to(r[h]);d.max=d.min+p,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+p)});const o=mv();sx(o,r,i.layoutBox);const l=mv();a?sx(l,e.applyTransform(n,!0),i.measuredBox):sx(l,r,i.layoutBox);const c=!zZ(o);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:d,layout:p}=h;if(d&&p){const f=dn();ax(f,i.layoutBox,d.layoutBox);const g=dn();ax(g,r,p.layoutBox),VZ(f,g)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=g,e.relativeTargetOrigin=f,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:i,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function hwe(e){qp.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function dwe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function pwe(e){e.clearSnapshot()}function XH(e){e.clearMeasurements()}function fwe(e){e.isLayoutDirty=!1}function mwe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function YH(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function gwe(e){e.resolveTargetDelta()}function vwe(e){e.calcProjection()}function ywe(e){e.resetRotation()}function xwe(e){e.removeLeadSnapshot()}function qH(e,t,i){e.translate=Ir(t.translate,0,i),e.scale=Ir(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function QH(e,t,i,r){e.min=Ir(t.min,i.min,r),e.max=Ir(t.max,i.max,r)}function wwe(e,t,i,r){QH(e.x,t.x,i.x,r),QH(e.y,t.y,i.y,r)}function bwe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const _we={duration:.45,ease:[.4,0,.1,1]},JH=e=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(e),KH=JH("applewebkit/")&&!JH("chrome/")?Math.round:Wr;function ZH(e){e.min=KH(e.min),e.max=KH(e.max)}function Swe(e){ZH(e.x),ZH(e.y)}function HZ(e,t,i){return e==="position"||e==="preserve-aspect"&&!LL(GH(t),GH(i),.2)}const Awe=GZ({attachResizeListener:(e,t)=>Nu(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ID={current:void 0},jZ=GZ({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!ID.current){const e=new Awe({});e.mount(window),e.setOptions({layoutScroll:!0}),ID.current=e}return ID.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Mwe={pan:{Feature:Vxe},drag:{Feature:zxe,ProjectionNode:jZ,MeasureLayout:NZ}},Ewe=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Cwe(e){const t=Ewe.exec(e);if(!t)return[,];const[,i,r]=t;return[i,r]}function NL(e,t,i=1){const[r,n]=Cwe(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const a=s.trim();return EZ(a)?parseFloat(a):a}else return EL(n)?NL(n,t,i+1):n}function Twe(e,{...t},i){const r=e.current;if(!(r instanceof Element))return{target:t,transitionEnd:i};i&&(i={...i}),e.values.forEach(n=>{const s=n.get();if(!EL(s))return;const a=NL(s,r);a&&n.set(a)});for(const n in t){const s=t[n];if(!EL(s))continue;const a=NL(s,r);a&&(t[n]=a,i||(i={}),i[n]===void 0&&(i[n]=s))}return{target:t,transitionEnd:i}}const Pwe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),WZ=e=>Pwe.has(e),Dwe=e=>Object.keys(e).some(WZ),$H=e=>e===ym||e===si,ej=(e,t)=>parseFloat(e.split(", ")[t]),tj=(e,t)=>(i,{transform:r})=>{if(r==="none"||!r)return 0;const n=r.match(/^matrix3d\((.+)\)$/);if(n)return ej(n[1],t);{const s=r.match(/^matrix\((.+)\)$/);return s?ej(s[1],e):0}},Rwe=new Set(["x","y","z"]),Iwe=eb.filter(e=>!Rwe.has(e));function Lwe(e){const t=[];return Iwe.forEach(i=>{const r=e.getValue(i);r!==void 0&&(t.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),t.length&&e.render(),t}const u0={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:tj(4,13),y:tj(5,14)};u0.translateX=u0.x;u0.translateY=u0.y;const Owe=(e,t,i)=>{const r=t.measureViewportBox(),n=t.current,s=getComputedStyle(n),{display:a}=s,o={};a==="none"&&t.setStaticValue("display",e.display||"block"),i.forEach(c=>{o[c]=u0[c](r,s)}),t.render();const l=t.measureViewportBox();return i.forEach(c=>{const u=t.getValue(c);u&&u.jump(o[c]),e[c]=u0[c](l,s)}),e},Bwe=(e,t,i={},r={})=>{t={...t},r={...r};const n=Object.keys(t).filter(WZ);let s=[],a=!1;const o=[];if(n.forEach(l=>{const c=e.getValue(l);if(!e.hasValue(l))return;let u=i[l],h=Xy(u);const d=t[l];let p;if(wE(d)){const f=d.length,g=d[0]===null?1:0;u=d[g],h=Xy(u);for(let m=g;m<f&&d[m]!==null;m++)p?eU(Xy(d[m])===p):p=Xy(d[m])}else p=Xy(d);if(h!==p)if($H(h)&&$H(p)){const f=c.get();typeof f=="string"&&c.set(parseFloat(f)),typeof d=="string"?t[l]=parseFloat(d):Array.isArray(d)&&p===si&&(t[l]=d.map(parseFloat))}else h!=null&&h.transform&&(p!=null&&p.transform)&&(u===0||d===0)?u===0?c.set(p.transform(u)):t[l]=h.transform(d):(a||(s=Lwe(e),a=!0),o.push(l),r[l]=r[l]!==void 0?r[l]:t[l],c.jump(d))}),o.length){const l=o.indexOf("height")>=0?window.pageYOffset:null,c=Owe(t,e,o);return s.length&&s.forEach(([u,h])=>{e.getValue(u).set(h)}),e.render(),fT&&l!==null&&window.scrollTo({top:l}),{target:c,transitionEnd:r}}else return{target:t,transitionEnd:r}};function Fwe(e,t,i,r){return Dwe(t)?Bwe(e,t,i,r):{target:t,transitionEnd:r}}const Nwe=(e,t,i,r)=>{const n=Twe(e,t,r);return t=n.target,r=n.transitionEnd,Fwe(e,t,i,r)},UL={current:null},XZ={current:!1};function Uwe(){if(XZ.current=!0,!!fT)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>UL.current=e.matches;e.addListener(t),t()}else UL.current=!1}function kwe(e,t,i){const{willChange:r}=t;for(const n in t){const s=t[n],a=i[n];if(La(s))e.addValue(n,s),AE(r)&&r.add(n);else if(La(a))e.addValue(n,c0(s,{owner:e})),AE(r)&&r.remove(n);else if(a!==s)if(e.hasValue(n)){const o=e.getValue(n);!o.hasAnimated&&o.set(s)}else{const o=e.getStaticValue(n);e.addValue(n,c0(o!==void 0?o:s,{owner:e}))}}for(const n in i)t[n]===void 0&&e.removeValue(n);return t}const ij=new WeakMap,YZ=Object.keys(ew),zwe=YZ.length,rj=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Vwe=XN.length;class Gwe{constructor({parent:t,props:i,presenceContext:r,reducedMotionConfig:n,visualState:s},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>br.render(this.render,!1,!0);const{latestValues:o,renderState:l}=s;this.latestValues=o,this.baseTarget={...o},this.initialValues=i.initial?{...o}:{},this.renderState=l,this.parent=t,this.props=i,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=n,this.options=a,this.isControllingVariants=gT(i),this.isVariantNode=RK(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(i,{});for(const h in u){const d=u[h];o[h]!==void 0&&La(d)&&(d.set(o[h],!1),AE(c)&&c.add(h))}}scrapeMotionValuesFromProps(t,i){return{}}mount(t){this.current=t,ij.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),XZ.current||Uwe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:UL.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){ij.delete(this.current),this.projection&&this.projection.unmount(),rh(this.notifyUpdate),rh(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,i){const r=vm.has(t),n=i.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&br.update(this.notifyUpdate,!1,!0),r&&this.projection&&(this.projection.isTransformDirty=!0)}),s=i.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{n(),s()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...i},r,n,s){let a,o;for(let l=0;l<zwe;l++){const c=YZ[l],{isEnabled:u,Feature:h,ProjectionNode:d,MeasureLayout:p}=ew[c];d&&(a=d),u(i)&&(!this.features[c]&&h&&(this.features[c]=new h(this)),p&&(o=p))}if((this.type==="html"||this.type==="svg")&&!this.projection&&a){this.projection=new a(this.latestValues,this.parent&&this.parent.projection);const{layoutId:l,layout:c,drag:u,dragConstraints:h,layoutScroll:d,layoutRoot:p}=i;this.projection.setOptions({layoutId:l,layout:c,alwaysMeasureLayout:!!u||h&&pv(h),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof c=="string"?c:"both",initialPromotionConfig:s,layoutScroll:d,layoutRoot:p})}return o}updateFeatures(){for(const t in this.features){const i=this.features[t];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):dn()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}makeTargetAnimatable(t,i=!0){return this.makeTargetAnimatableFromInstance(t,this.props,i)}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<rj.length;r++){const n=rj[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s=t["on"+n];s&&(this.propEventSubscriptions[n]=this.on(n,s))}this.prevMotionValues=kwe(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const r=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(r.initial=this.props.initial),r}const i={};for(let r=0;r<Vwe;r++){const n=XN[r],s=this.props[n];($x(s)||s===!1)&&(i[n]=s)}return i}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){i!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,i)),this.values.set(t,i),this.latestValues[t]=i.get()}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&i!==void 0&&(r=c0(i,{owner:this}),this.addValue(t,r)),r}readValue(t){var i;return this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(i=this.getBaseTargetFromProps(this.props,t))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,t,this.options)}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:r}=this.props,n=typeof r=="string"||typeof r=="object"?(i=$N(this.props,r))===null||i===void 0?void 0:i[t]:void 0;if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!La(s)?s:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new cU),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class qZ extends Gwe{sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:r}){delete i[t],delete r[t]}makeTargetAnimatableFromInstance({transition:t,transitionEnd:i,...r},{transformValues:n},s){let a=sxe(r,t||{},this);if(n&&(i&&(i=n(i)),r&&(r=n(r)),a&&(a=n(a))),s){rxe(this,r,a);const o=Nwe(this,r,a,i);i=o.transitionEnd,r=o.target}return{transition:t,transitionEnd:i,...r}}}function Hwe(e){return window.getComputedStyle(e)}class jwe extends qZ{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,i){if(vm.has(i)){const r=nU(i);return r&&r.default||0}else{const r=Hwe(t),n=(FK(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(t,{transformPagePoint:i}){return BZ(t,i)}build(t,i,r,n){qN(t,i,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,i){return ZN(t,i)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;La(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}renderInstance(t,i,r,n){GK(t,i,r,n)}}class Wwe extends qZ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(vm.has(i)){const r=nU(i);return r&&r.default||0}return i=HK.has(i)?i:jN(i),t.getAttribute(i)}measureInstanceViewportBox(){return dn()}scrapeMotionValuesFromProps(t,i){return WK(t,i)}build(t,i,r,n){JN(t,i,r,this.isSVGTag,n.transformTemplate)}renderInstance(t,i,r,n){jK(t,i,r,n)}mount(t){this.isSVGTag=KN(t.tagName),super.mount(t)}}const Xwe=(e,t)=>YN(e)?new Wwe(t,{enableHardwareAcceleration:!1}):new jwe(t,{enableHardwareAcceleration:!0}),Ywe={layout:{ProjectionNode:jZ,MeasureLayout:NZ}},qwe={...wxe,...zye,...Mwe,...Ywe},kc=q0e((e,t)=>Cye(e,t,qwe,Xwe)),Dl={paddingX:"sm:px-16 px-6",paddingY:"sm:py-16 py-6",padding:"sm:px-16 px-6 sm:py-16 py-10",heroHeadText:"font-black text-white lg:text-[80px] sm:text-[60px] xs:text-[50px] text-[40px] lg:leading-[98px] mt-2",heroSubText:"text-[#dfd9ff] font-medium lg:text-[30px] sm:text-[26px] xs:text-[20px] text-[16px] lg:leading-[40px]",sectionHeadText:"text-white font-black md:text-[60px] sm:text-[50px] xs:text-[40px] text-[30px]",sectionSubText:"sm:text-[18px] text-[14px] text-secondary uppercase tracking-wider"};var QZ={exports:{}};(function(e,t){(function(i,r){e.exports=r(fe)})(typeof self<"u"?self:M1,i=>(()=>{var r={7403:(o,l,c)=>{c.d(l,{default:()=>U});var u=c(4087),h=c.n(u);const d=function(j){return new RegExp(/<[a-z][\s\S]*>/i).test(j)},p=function(j,k){return Math.floor(Math.random()*(k-j+1))+j};var f="TYPE_CHARACTER",g="REMOVE_CHARACTER",m="REMOVE_ALL",v="REMOVE_LAST_VISIBLE_NODE",x="PAUSE_FOR",y="CALL_FUNCTION",_="ADD_HTML_TAG_ELEMENT",A="CHANGE_DELETE_SPEED",S="CHANGE_DELAY",C="CHANGE_CURSOR",M="PASTE_STRING",E="HTML_TAG";function P(j){return P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},P(j)}function R(j,k){var q=Object.keys(j);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(j);k&&(W=W.filter(function(te){return Object.getOwnPropertyDescriptor(j,te).enumerable})),q.push.apply(q,W)}return q}function O(j){for(var k=1;k<arguments.length;k++){var q=arguments[k]!=null?arguments[k]:{};k%2?R(Object(q),!0).forEach(function(W){K(j,W,q[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(q)):R(Object(q)).forEach(function(W){Object.defineProperty(j,W,Object.getOwnPropertyDescriptor(q,W))})}return j}function L(j){return function(k){if(Array.isArray(k))return I(k)}(j)||function(k){if(typeof Symbol<"u"&&k[Symbol.iterator]!=null||k["@@iterator"]!=null)return Array.from(k)}(j)||function(k,q){if(k){if(typeof k=="string")return I(k,q);var W=Object.prototype.toString.call(k).slice(8,-1);return W==="Object"&&k.constructor&&(W=k.constructor.name),W==="Map"||W==="Set"?Array.from(k):W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W)?I(k,q):void 0}}(j)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function I(j,k){(k==null||k>j.length)&&(k=j.length);for(var q=0,W=new Array(k);q<k;q++)W[q]=j[q];return W}function z(j,k){for(var q=0;q<k.length;q++){var W=k[q];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(j,Y(W.key),W)}}function K(j,k,q){return(k=Y(k))in j?Object.defineProperty(j,k,{value:q,enumerable:!0,configurable:!0,writable:!0}):j[k]=q,j}function Y(j){var k=function(q,W){if(P(q)!=="object"||q===null)return q;var te=q[Symbol.toPrimitive];if(te!==void 0){var G=te.call(q,"string");if(P(G)!=="object")return G;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(q)}(j);return P(k)==="symbol"?k:String(k)}const U=function(){function j(W,te){var G=this;if(function(Z,he){if(!(Z instanceof he))throw new TypeError("Cannot call a class as a function")}(this,j),K(this,"state",{cursorAnimation:null,lastFrameTime:null,pauseUntil:null,eventQueue:[],eventLoop:null,eventLoopPaused:!1,reverseCalledEvents:[],calledEvents:[],visibleNodes:[],initialOptions:null,elements:{container:null,wrapper:document.createElement("span"),cursor:document.createElement("span")}}),K(this,"options",{strings:null,cursor:"|",delay:"natural",pauseFor:1500,deleteSpeed:"natural",loop:!1,autoStart:!1,devMode:!1,skipAddStyles:!1,wrapperClassName:"Typewriter__wrapper",cursorClassName:"Typewriter__cursor",stringSplitter:null,onCreateTextNode:null,onRemoveNode:null}),K(this,"setupWrapperElement",function(){G.state.elements.container&&(G.state.elements.wrapper.className=G.options.wrapperClassName,G.state.elements.cursor.className=G.options.cursorClassName,G.state.elements.cursor.innerHTML=G.options.cursor,G.state.elements.container.innerHTML="",G.state.elements.container.appendChild(G.state.elements.wrapper),G.state.elements.container.appendChild(G.state.elements.cursor))}),K(this,"start",function(){return G.state.eventLoopPaused=!1,G.runEventLoop(),G}),K(this,"pause",function(){return G.state.eventLoopPaused=!0,G}),K(this,"stop",function(){return G.state.eventLoop&&((0,u.cancel)(G.state.eventLoop),G.state.eventLoop=null),G}),K(this,"pauseFor",function(Z){return G.addEventToQueue(x,{ms:Z}),G}),K(this,"typeOutAllStrings",function(){return typeof G.options.strings=="string"?(G.typeString(G.options.strings).pauseFor(G.options.pauseFor),G):(G.options.strings.forEach(function(Z){G.typeString(Z).pauseFor(G.options.pauseFor).deleteAll(G.options.deleteSpeed)}),G)}),K(this,"typeString",function(Z){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(d(Z))return G.typeOutHTMLString(Z,he);if(Z){var ye=(G.options||{}).stringSplitter,de=typeof ye=="function"?ye(Z):Z.split("");G.typeCharacters(de,he)}return G}),K(this,"pasteString",function(Z){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return d(Z)?G.typeOutHTMLString(Z,he,!0):(Z&&G.addEventToQueue(M,{character:Z,node:he}),G)}),K(this,"typeOutHTMLString",function(Z){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,ye=arguments.length>2?arguments[2]:void 0,de=function(we){var Ae=document.createElement("div");return Ae.innerHTML=we,Ae.childNodes}(Z);if(de.length>0)for(var xe=0;xe<de.length;xe++){var me=de[xe],ee=me.innerHTML;me&&me.nodeType!==3?(me.innerHTML="",G.addEventToQueue(_,{node:me,parentNode:he}),ye?G.pasteString(ee,me):G.typeString(ee,me)):me.textContent&&(ye?G.pasteString(me.textContent,he):G.typeString(me.textContent,he))}return G}),K(this,"deleteAll",function(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"natural";return G.addEventToQueue(m,{speed:Z}),G}),K(this,"changeDeleteSpeed",function(Z){if(!Z)throw new Error("Must provide new delete speed");return G.addEventToQueue(A,{speed:Z}),G}),K(this,"changeDelay",function(Z){if(!Z)throw new Error("Must provide new delay");return G.addEventToQueue(S,{delay:Z}),G}),K(this,"changeCursor",function(Z){if(!Z)throw new Error("Must provide new cursor");return G.addEventToQueue(C,{cursor:Z}),G}),K(this,"deleteChars",function(Z){if(!Z)throw new Error("Must provide amount of characters to delete");for(var he=0;he<Z;he++)G.addEventToQueue(g);return G}),K(this,"callFunction",function(Z,he){if(!Z||typeof Z!="function")throw new Error("Callback must be a function");return G.addEventToQueue(y,{cb:Z,thisArg:he}),G}),K(this,"typeCharacters",function(Z){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!Z||!Array.isArray(Z))throw new Error("Characters must be an array");return Z.forEach(function(ye){G.addEventToQueue(f,{character:ye,node:he})}),G}),K(this,"removeCharacters",function(Z){if(!Z||!Array.isArray(Z))throw new Error("Characters must be an array");return Z.forEach(function(){G.addEventToQueue(g)}),G}),K(this,"addEventToQueue",function(Z,he){var ye=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return G.addEventToStateProperty(Z,he,ye,"eventQueue")}),K(this,"addReverseCalledEvent",function(Z,he){var ye=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return G.options.loop?G.addEventToStateProperty(Z,he,ye,"reverseCalledEvents"):G}),K(this,"addEventToStateProperty",function(Z,he){var ye=arguments.length>2&&arguments[2]!==void 0&&arguments[2],de=arguments.length>3?arguments[3]:void 0,xe={eventName:Z,eventArgs:he||{}};return G.state[de]=ye?[xe].concat(L(G.state[de])):[].concat(L(G.state[de]),[xe]),G}),K(this,"runEventLoop",function(){G.state.lastFrameTime||(G.state.lastFrameTime=Date.now());var Z=Date.now(),he=Z-G.state.lastFrameTime;if(!G.state.eventQueue.length){if(!G.options.loop)return;G.state.eventQueue=L(G.state.calledEvents),G.state.calledEvents=[],G.options=O({},G.state.initialOptions)}if(G.state.eventLoop=h()(G.runEventLoop),!G.state.eventLoopPaused){if(G.state.pauseUntil){if(Z<G.state.pauseUntil)return;G.state.pauseUntil=null}var ye,de=L(G.state.eventQueue),xe=de.shift();if(!(he<=(ye=xe.eventName===v||xe.eventName===g?G.options.deleteSpeed==="natural"?p(40,80):G.options.deleteSpeed:G.options.delay==="natural"?p(120,160):G.options.delay))){var me=xe.eventName,ee=xe.eventArgs;switch(G.logInDevMode({currentEvent:xe,state:G.state,delay:ye}),me){case M:case f:var we=ee.character,Ae=ee.node,Te=document.createTextNode(we),Re=Te;G.options.onCreateTextNode&&typeof G.options.onCreateTextNode=="function"&&(Re=G.options.onCreateTextNode(we,Te)),Re&&(Ae?Ae.appendChild(Re):G.state.elements.wrapper.appendChild(Re)),G.state.visibleNodes=[].concat(L(G.state.visibleNodes),[{type:"TEXT_NODE",character:we,node:Re}]);break;case g:de.unshift({eventName:v,eventArgs:{removingCharacterNode:!0}});break;case x:var Xe=xe.eventArgs.ms;G.state.pauseUntil=Date.now()+parseInt(Xe);break;case y:var Oe=xe.eventArgs,Be=Oe.cb,at=Oe.thisArg;Be.call(at,{elements:G.state.elements});break;case _:var ht=xe.eventArgs,se=ht.node,N=ht.parentNode;N?N.appendChild(se):G.state.elements.wrapper.appendChild(se),G.state.visibleNodes=[].concat(L(G.state.visibleNodes),[{type:E,node:se,parentNode:N||G.state.elements.wrapper}]);break;case m:var H=G.state.visibleNodes,ve=ee.speed,X=[];ve&&X.push({eventName:A,eventArgs:{speed:ve,temp:!0}});for(var Ce=0,Ve=H.length;Ce<Ve;Ce++)X.push({eventName:v,eventArgs:{removingCharacterNode:!1}});ve&&X.push({eventName:A,eventArgs:{speed:G.options.deleteSpeed,temp:!0}}),de.unshift.apply(de,X);break;case v:var Ye=xe.eventArgs.removingCharacterNode;if(G.state.visibleNodes.length){var _e=G.state.visibleNodes.pop(),Pe=_e.type,Qe=_e.node,st=_e.character;G.options.onRemoveNode&&typeof G.options.onRemoveNode=="function"&&G.options.onRemoveNode({node:Qe,character:st}),Qe&&Qe.parentNode.removeChild(Qe),Pe===E&&Ye&&de.unshift({eventName:v,eventArgs:{}})}break;case A:G.options.deleteSpeed=xe.eventArgs.speed;break;case S:G.options.delay=xe.eventArgs.delay;break;case C:G.options.cursor=xe.eventArgs.cursor,G.state.elements.cursor.innerHTML=xe.eventArgs.cursor}G.options.loop&&(xe.eventName===v||xe.eventArgs&&xe.eventArgs.temp||(G.state.calledEvents=[].concat(L(G.state.calledEvents),[xe]))),G.state.eventQueue=de,G.state.lastFrameTime=Z}}}),W)if(typeof W=="string"){var le=document.querySelector(W);if(!le)throw new Error("Could not find container element");this.state.elements.container=le}else this.state.elements.container=W;te&&(this.options=O(O({},this.options),te)),this.state.initialOptions=O({},this.options),this.init()}var k,q;return k=j,(q=[{key:"init",value:function(){var W,te;this.setupWrapperElement(),this.addEventToQueue(C,{cursor:this.options.cursor},!0),this.addEventToQueue(m,null,!0),!window||window.___TYPEWRITER_JS_STYLES_ADDED___||this.options.skipAddStyles||(W=".Typewriter__cursor{-webkit-animation:Typewriter-cursor 1s infinite;animation:Typewriter-cursor 1s infinite;margin-left:1px}@-webkit-keyframes Typewriter-cursor{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes Typewriter-cursor{0%{opacity:0}50%{opacity:1}100%{opacity:0}}",(te=document.createElement("style")).appendChild(document.createTextNode(W)),document.head.appendChild(te),window.___TYPEWRITER_JS_STYLES_ADDED___=!0),this.options.autoStart===!0&&this.options.strings&&this.typeOutAllStrings().start()}},{key:"logInDevMode",value:function(W){this.options.devMode&&console.log(W)}}])&&z(k.prototype,q),Object.defineProperty(k,"prototype",{writable:!1}),j}()},8552:(o,l,c)=>{var u=c(852)(c(5639),"DataView");o.exports=u},1989:(o,l,c)=>{var u=c(1789),h=c(401),d=c(7667),p=c(1327),f=c(1866);function g(m){var v=-1,x=m==null?0:m.length;for(this.clear();++v<x;){var y=m[v];this.set(y[0],y[1])}}g.prototype.clear=u,g.prototype.delete=h,g.prototype.get=d,g.prototype.has=p,g.prototype.set=f,o.exports=g},8407:(o,l,c)=>{var u=c(7040),h=c(4125),d=c(2117),p=c(7518),f=c(4705);function g(m){var v=-1,x=m==null?0:m.length;for(this.clear();++v<x;){var y=m[v];this.set(y[0],y[1])}}g.prototype.clear=u,g.prototype.delete=h,g.prototype.get=d,g.prototype.has=p,g.prototype.set=f,o.exports=g},7071:(o,l,c)=>{var u=c(852)(c(5639),"Map");o.exports=u},3369:(o,l,c)=>{var u=c(4785),h=c(1285),d=c(6e3),p=c(9916),f=c(5265);function g(m){var v=-1,x=m==null?0:m.length;for(this.clear();++v<x;){var y=m[v];this.set(y[0],y[1])}}g.prototype.clear=u,g.prototype.delete=h,g.prototype.get=d,g.prototype.has=p,g.prototype.set=f,o.exports=g},3818:(o,l,c)=>{var u=c(852)(c(5639),"Promise");o.exports=u},8525:(o,l,c)=>{var u=c(852)(c(5639),"Set");o.exports=u},8668:(o,l,c)=>{var u=c(3369),h=c(619),d=c(2385);function p(f){var g=-1,m=f==null?0:f.length;for(this.__data__=new u;++g<m;)this.add(f[g])}p.prototype.add=p.prototype.push=h,p.prototype.has=d,o.exports=p},6384:(o,l,c)=>{var u=c(8407),h=c(7465),d=c(3779),p=c(7599),f=c(4758),g=c(4309);function m(v){var x=this.__data__=new u(v);this.size=x.size}m.prototype.clear=h,m.prototype.delete=d,m.prototype.get=p,m.prototype.has=f,m.prototype.set=g,o.exports=m},2705:(o,l,c)=>{var u=c(5639).Symbol;o.exports=u},1149:(o,l,c)=>{var u=c(5639).Uint8Array;o.exports=u},577:(o,l,c)=>{var u=c(852)(c(5639),"WeakMap");o.exports=u},4963:o=>{o.exports=function(l,c){for(var u=-1,h=l==null?0:l.length,d=0,p=[];++u<h;){var f=l[u];c(f,u,l)&&(p[d++]=f)}return p}},4636:(o,l,c)=>{var u=c(2545),h=c(5694),d=c(1469),p=c(4144),f=c(5776),g=c(6719),m=Object.prototype.hasOwnProperty;o.exports=function(v,x){var y=d(v),_=!y&&h(v),A=!y&&!_&&p(v),S=!y&&!_&&!A&&g(v),C=y||_||A||S,M=C?u(v.length,String):[],E=M.length;for(var P in v)!x&&!m.call(v,P)||C&&(P=="length"||A&&(P=="offset"||P=="parent")||S&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||f(P,E))||M.push(P);return M}},2488:o=>{o.exports=function(l,c){for(var u=-1,h=c.length,d=l.length;++u<h;)l[d+u]=c[u];return l}},2908:o=>{o.exports=function(l,c){for(var u=-1,h=l==null?0:l.length;++u<h;)if(c(l[u],u,l))return!0;return!1}},8470:(o,l,c)=>{var u=c(7813);o.exports=function(h,d){for(var p=h.length;p--;)if(u(h[p][0],d))return p;return-1}},8866:(o,l,c)=>{var u=c(2488),h=c(1469);o.exports=function(d,p,f){var g=p(d);return h(d)?g:u(g,f(d))}},4239:(o,l,c)=>{var u=c(2705),h=c(9607),d=c(2333),p=u?u.toStringTag:void 0;o.exports=function(f){return f==null?f===void 0?"[object Undefined]":"[object Null]":p&&p in Object(f)?h(f):d(f)}},9454:(o,l,c)=>{var u=c(4239),h=c(7005);o.exports=function(d){return h(d)&&u(d)=="[object Arguments]"}},939:(o,l,c)=>{var u=c(2492),h=c(7005);o.exports=function d(p,f,g,m,v){return p===f||(p==null||f==null||!h(p)&&!h(f)?p!=p&&f!=f:u(p,f,g,m,d,v))}},2492:(o,l,c)=>{var u=c(6384),h=c(7114),d=c(8351),p=c(6096),f=c(4160),g=c(1469),m=c(4144),v=c(6719),x="[object Arguments]",y="[object Array]",_="[object Object]",A=Object.prototype.hasOwnProperty;o.exports=function(S,C,M,E,P,R){var O=g(S),L=g(C),I=O?y:f(S),z=L?y:f(C),K=(I=I==x?_:I)==_,Y=(z=z==x?_:z)==_,U=I==z;if(U&&m(S)){if(!m(C))return!1;O=!0,K=!1}if(U&&!K)return R||(R=new u),O||v(S)?h(S,C,M,E,P,R):d(S,C,I,M,E,P,R);if(!(1&M)){var j=K&&A.call(S,"__wrapped__"),k=Y&&A.call(C,"__wrapped__");if(j||k){var q=j?S.value():S,W=k?C.value():C;return R||(R=new u),P(q,W,M,E,R)}}return!!U&&(R||(R=new u),p(S,C,M,E,P,R))}},8458:(o,l,c)=>{var u=c(3560),h=c(5346),d=c(3218),p=c(346),f=/^\[object .+?Constructor\]$/,g=Function.prototype,m=Object.prototype,v=g.toString,x=m.hasOwnProperty,y=RegExp("^"+v.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(_){return!(!d(_)||h(_))&&(u(_)?y:f).test(p(_))}},8749:(o,l,c)=>{var u=c(4239),h=c(1780),d=c(7005),p={};p["[object Float32Array]"]=p["[object Float64Array]"]=p["[object Int8Array]"]=p["[object Int16Array]"]=p["[object Int32Array]"]=p["[object Uint8Array]"]=p["[object Uint8ClampedArray]"]=p["[object Uint16Array]"]=p["[object Uint32Array]"]=!0,p["[object Arguments]"]=p["[object Array]"]=p["[object ArrayBuffer]"]=p["[object Boolean]"]=p["[object DataView]"]=p["[object Date]"]=p["[object Error]"]=p["[object Function]"]=p["[object Map]"]=p["[object Number]"]=p["[object Object]"]=p["[object RegExp]"]=p["[object Set]"]=p["[object String]"]=p["[object WeakMap]"]=!1,o.exports=function(f){return d(f)&&h(f.length)&&!!p[u(f)]}},280:(o,l,c)=>{var u=c(5726),h=c(6916),d=Object.prototype.hasOwnProperty;o.exports=function(p){if(!u(p))return h(p);var f=[];for(var g in Object(p))d.call(p,g)&&g!="constructor"&&f.push(g);return f}},2545:o=>{o.exports=function(l,c){for(var u=-1,h=Array(l);++u<l;)h[u]=c(u);return h}},1717:o=>{o.exports=function(l){return function(c){return l(c)}}},4757:o=>{o.exports=function(l,c){return l.has(c)}},4429:(o,l,c)=>{var u=c(5639)["__core-js_shared__"];o.exports=u},7114:(o,l,c)=>{var u=c(8668),h=c(2908),d=c(4757);o.exports=function(p,f,g,m,v,x){var y=1&g,_=p.length,A=f.length;if(_!=A&&!(y&&A>_))return!1;var S=x.get(p),C=x.get(f);if(S&&C)return S==f&&C==p;var M=-1,E=!0,P=2&g?new u:void 0;for(x.set(p,f),x.set(f,p);++M<_;){var R=p[M],O=f[M];if(m)var L=y?m(O,R,M,f,p,x):m(R,O,M,p,f,x);if(L!==void 0){if(L)continue;E=!1;break}if(P){if(!h(f,function(I,z){if(!d(P,z)&&(R===I||v(R,I,g,m,x)))return P.push(z)})){E=!1;break}}else if(R!==O&&!v(R,O,g,m,x)){E=!1;break}}return x.delete(p),x.delete(f),E}},8351:(o,l,c)=>{var u=c(2705),h=c(1149),d=c(7813),p=c(7114),f=c(8776),g=c(1814),m=u?u.prototype:void 0,v=m?m.valueOf:void 0;o.exports=function(x,y,_,A,S,C,M){switch(_){case"[object DataView]":if(x.byteLength!=y.byteLength||x.byteOffset!=y.byteOffset)return!1;x=x.buffer,y=y.buffer;case"[object ArrayBuffer]":return!(x.byteLength!=y.byteLength||!C(new h(x),new h(y)));case"[object Boolean]":case"[object Date]":case"[object Number]":return d(+x,+y);case"[object Error]":return x.name==y.name&&x.message==y.message;case"[object RegExp]":case"[object String]":return x==y+"";case"[object Map]":var E=f;case"[object Set]":var P=1&A;if(E||(E=g),x.size!=y.size&&!P)return!1;var R=M.get(x);if(R)return R==y;A|=2,M.set(x,y);var O=p(E(x),E(y),A,S,C,M);return M.delete(x),O;case"[object Symbol]":if(v)return v.call(x)==v.call(y)}return!1}},6096:(o,l,c)=>{var u=c(8234),h=Object.prototype.hasOwnProperty;o.exports=function(d,p,f,g,m,v){var x=1&f,y=u(d),_=y.length;if(_!=u(p).length&&!x)return!1;for(var A=_;A--;){var S=y[A];if(!(x?S in p:h.call(p,S)))return!1}var C=v.get(d),M=v.get(p);if(C&&M)return C==p&&M==d;var E=!0;v.set(d,p),v.set(p,d);for(var P=x;++A<_;){var R=d[S=y[A]],O=p[S];if(g)var L=x?g(O,R,S,p,d,v):g(R,O,S,d,p,v);if(!(L===void 0?R===O||m(R,O,f,g,v):L)){E=!1;break}P||(P=S=="constructor")}if(E&&!P){var I=d.constructor,z=p.constructor;I==z||!("constructor"in d)||!("constructor"in p)||typeof I=="function"&&I instanceof I&&typeof z=="function"&&z instanceof z||(E=!1)}return v.delete(d),v.delete(p),E}},1957:(o,l,c)=>{var u=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=u},8234:(o,l,c)=>{var u=c(8866),h=c(9551),d=c(3674);o.exports=function(p){return u(p,d,h)}},5050:(o,l,c)=>{var u=c(7019);o.exports=function(h,d){var p=h.__data__;return u(d)?p[typeof d=="string"?"string":"hash"]:p.map}},852:(o,l,c)=>{var u=c(8458),h=c(7801);o.exports=function(d,p){var f=h(d,p);return u(f)?f:void 0}},9607:(o,l,c)=>{var u=c(2705),h=Object.prototype,d=h.hasOwnProperty,p=h.toString,f=u?u.toStringTag:void 0;o.exports=function(g){var m=d.call(g,f),v=g[f];try{g[f]=void 0;var x=!0}catch{}var y=p.call(g);return x&&(m?g[f]=v:delete g[f]),y}},9551:(o,l,c)=>{var u=c(4963),h=c(479),d=Object.prototype.propertyIsEnumerable,p=Object.getOwnPropertySymbols,f=p?function(g){return g==null?[]:(g=Object(g),u(p(g),function(m){return d.call(g,m)}))}:h;o.exports=f},4160:(o,l,c)=>{var u=c(8552),h=c(7071),d=c(3818),p=c(8525),f=c(577),g=c(4239),m=c(346),v="[object Map]",x="[object Promise]",y="[object Set]",_="[object WeakMap]",A="[object DataView]",S=m(u),C=m(h),M=m(d),E=m(p),P=m(f),R=g;(u&&R(new u(new ArrayBuffer(1)))!=A||h&&R(new h)!=v||d&&R(d.resolve())!=x||p&&R(new p)!=y||f&&R(new f)!=_)&&(R=function(O){var L=g(O),I=L=="[object Object]"?O.constructor:void 0,z=I?m(I):"";if(z)switch(z){case S:return A;case C:return v;case M:return x;case E:return y;case P:return _}return L}),o.exports=R},7801:o=>{o.exports=function(l,c){return l==null?void 0:l[c]}},1789:(o,l,c)=>{var u=c(4536);o.exports=function(){this.__data__=u?u(null):{},this.size=0}},401:o=>{o.exports=function(l){var c=this.has(l)&&delete this.__data__[l];return this.size-=c?1:0,c}},7667:(o,l,c)=>{var u=c(4536),h=Object.prototype.hasOwnProperty;o.exports=function(d){var p=this.__data__;if(u){var f=p[d];return f==="__lodash_hash_undefined__"?void 0:f}return h.call(p,d)?p[d]:void 0}},1327:(o,l,c)=>{var u=c(4536),h=Object.prototype.hasOwnProperty;o.exports=function(d){var p=this.__data__;return u?p[d]!==void 0:h.call(p,d)}},1866:(o,l,c)=>{var u=c(4536);o.exports=function(h,d){var p=this.__data__;return this.size+=this.has(h)?0:1,p[h]=u&&d===void 0?"__lodash_hash_undefined__":d,this}},5776:o=>{var l=/^(?:0|[1-9]\d*)$/;o.exports=function(c,u){var h=typeof c;return!!(u=u??9007199254740991)&&(h=="number"||h!="symbol"&&l.test(c))&&c>-1&&c%1==0&&c<u}},7019:o=>{o.exports=function(l){var c=typeof l;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?l!=="__proto__":l===null}},5346:(o,l,c)=>{var u,h=c(4429),d=(u=/[^.]+$/.exec(h&&h.keys&&h.keys.IE_PROTO||""))?"Symbol(src)_1."+u:"";o.exports=function(p){return!!d&&d in p}},5726:o=>{var l=Object.prototype;o.exports=function(c){var u=c&&c.constructor;return c===(typeof u=="function"&&u.prototype||l)}},7040:o=>{o.exports=function(){this.__data__=[],this.size=0}},4125:(o,l,c)=>{var u=c(8470),h=Array.prototype.splice;o.exports=function(d){var p=this.__data__,f=u(p,d);return!(f<0||(f==p.length-1?p.pop():h.call(p,f,1),--this.size,0))}},2117:(o,l,c)=>{var u=c(8470);o.exports=function(h){var d=this.__data__,p=u(d,h);return p<0?void 0:d[p][1]}},7518:(o,l,c)=>{var u=c(8470);o.exports=function(h){return u(this.__data__,h)>-1}},4705:(o,l,c)=>{var u=c(8470);o.exports=function(h,d){var p=this.__data__,f=u(p,h);return f<0?(++this.size,p.push([h,d])):p[f][1]=d,this}},4785:(o,l,c)=>{var u=c(1989),h=c(8407),d=c(7071);o.exports=function(){this.size=0,this.__data__={hash:new u,map:new(d||h),string:new u}}},1285:(o,l,c)=>{var u=c(5050);o.exports=function(h){var d=u(this,h).delete(h);return this.size-=d?1:0,d}},6e3:(o,l,c)=>{var u=c(5050);o.exports=function(h){return u(this,h).get(h)}},9916:(o,l,c)=>{var u=c(5050);o.exports=function(h){return u(this,h).has(h)}},5265:(o,l,c)=>{var u=c(5050);o.exports=function(h,d){var p=u(this,h),f=p.size;return p.set(h,d),this.size+=p.size==f?0:1,this}},8776:o=>{o.exports=function(l){var c=-1,u=Array(l.size);return l.forEach(function(h,d){u[++c]=[d,h]}),u}},4536:(o,l,c)=>{var u=c(852)(Object,"create");o.exports=u},6916:(o,l,c)=>{var u=c(5569)(Object.keys,Object);o.exports=u},1167:(o,l,c)=>{o=c.nmd(o);var u=c(1957),h=l&&!l.nodeType&&l,d=h&&o&&!o.nodeType&&o,p=d&&d.exports===h&&u.process,f=function(){try{return d&&d.require&&d.require("util").types||p&&p.binding&&p.binding("util")}catch{}}();o.exports=f},2333:o=>{var l=Object.prototype.toString;o.exports=function(c){return l.call(c)}},5569:o=>{o.exports=function(l,c){return function(u){return l(c(u))}}},5639:(o,l,c)=>{var u=c(1957),h=typeof self=="object"&&self&&self.Object===Object&&self,d=u||h||Function("return this")();o.exports=d},619:o=>{o.exports=function(l){return this.__data__.set(l,"__lodash_hash_undefined__"),this}},2385:o=>{o.exports=function(l){return this.__data__.has(l)}},1814:o=>{o.exports=function(l){var c=-1,u=Array(l.size);return l.forEach(function(h){u[++c]=h}),u}},7465:(o,l,c)=>{var u=c(8407);o.exports=function(){this.__data__=new u,this.size=0}},3779:o=>{o.exports=function(l){var c=this.__data__,u=c.delete(l);return this.size=c.size,u}},7599:o=>{o.exports=function(l){return this.__data__.get(l)}},4758:o=>{o.exports=function(l){return this.__data__.has(l)}},4309:(o,l,c)=>{var u=c(8407),h=c(7071),d=c(3369);o.exports=function(p,f){var g=this.__data__;if(g instanceof u){var m=g.__data__;if(!h||m.length<199)return m.push([p,f]),this.size=++g.size,this;g=this.__data__=new d(m)}return g.set(p,f),this.size=g.size,this}},346:o=>{var l=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return l.call(c)}catch{}try{return c+""}catch{}}return""}},7813:o=>{o.exports=function(l,c){return l===c||l!=l&&c!=c}},5694:(o,l,c)=>{var u=c(9454),h=c(7005),d=Object.prototype,p=d.hasOwnProperty,f=d.propertyIsEnumerable,g=u(function(){return arguments}())?u:function(m){return h(m)&&p.call(m,"callee")&&!f.call(m,"callee")};o.exports=g},1469:o=>{var l=Array.isArray;o.exports=l},8612:(o,l,c)=>{var u=c(3560),h=c(1780);o.exports=function(d){return d!=null&&h(d.length)&&!u(d)}},4144:(o,l,c)=>{o=c.nmd(o);var u=c(5639),h=c(5062),d=l&&!l.nodeType&&l,p=d&&o&&!o.nodeType&&o,f=p&&p.exports===d?u.Buffer:void 0,g=(f?f.isBuffer:void 0)||h;o.exports=g},8446:(o,l,c)=>{var u=c(939);o.exports=function(h,d){return u(h,d)}},3560:(o,l,c)=>{var u=c(4239),h=c(3218);o.exports=function(d){if(!h(d))return!1;var p=u(d);return p=="[object Function]"||p=="[object GeneratorFunction]"||p=="[object AsyncFunction]"||p=="[object Proxy]"}},1780:o=>{o.exports=function(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=9007199254740991}},3218:o=>{o.exports=function(l){var c=typeof l;return l!=null&&(c=="object"||c=="function")}},7005:o=>{o.exports=function(l){return l!=null&&typeof l=="object"}},6719:(o,l,c)=>{var u=c(8749),h=c(1717),d=c(1167),p=d&&d.isTypedArray,f=p?h(p):u;o.exports=f},3674:(o,l,c)=>{var u=c(4636),h=c(280),d=c(8612);o.exports=function(p){return d(p)?u(p):h(p)}},479:o=>{o.exports=function(){return[]}},5062:o=>{o.exports=function(){return!1}},75:function(o){(function(){var l,c,u,h,d,p;typeof performance<"u"&&performance!==null&&performance.now?o.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(o.exports=function(){return(l()-d)/1e6},c=process.hrtime,h=(l=function(){var f;return 1e9*(f=c())[0]+f[1]})(),p=1e9*process.uptime(),d=h-p):Date.now?(o.exports=function(){return Date.now()-u},u=Date.now()):(o.exports=function(){return new Date().getTime()-u},u=new Date().getTime())}).call(this)},4087:(o,l,c)=>{for(var u=c(75),h=typeof window>"u"?c.g:window,d=["moz","webkit"],p="AnimationFrame",f=h["request"+p],g=h["cancel"+p]||h["cancelRequest"+p],m=0;!f&&m<d.length;m++)f=h[d[m]+"Request"+p],g=h[d[m]+"Cancel"+p]||h[d[m]+"CancelRequest"+p];if(!f||!g){var v=0,x=0,y=[];f=function(_){if(y.length===0){var A=u(),S=Math.max(0,16.666666666666668-(A-v));v=S+A,setTimeout(function(){var C=y.slice(0);y.length=0;for(var M=0;M<C.length;M++)if(!C[M].cancelled)try{C[M].callback(v)}catch(E){setTimeout(function(){throw E},0)}},Math.round(S))}return y.push({handle:++x,callback:_,cancelled:!1}),x},g=function(_){for(var A=0;A<y.length;A++)y[A].handle===_&&(y[A].cancelled=!0)}}o.exports=function(_){return f.call(h,_)},o.exports.cancel=function(){g.apply(h,arguments)},o.exports.polyfill=function(_){_||(_=h),_.requestAnimationFrame=f,_.cancelAnimationFrame=g}},8156:o=>{o.exports=i}},n={};function s(o){var l=n[o];if(l!==void 0)return l.exports;var c=n[o]={id:o,loaded:!1,exports:{}};return r[o].call(c.exports,c,c.exports,s),c.loaded=!0,c.exports}s.n=o=>{var l=o&&o.__esModule?()=>o.default:()=>o;return s.d(l,{a:l}),l},s.d=(o,l)=>{for(var c in l)s.o(l,c)&&!s.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:l[c]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(o,l)=>Object.prototype.hasOwnProperty.call(o,l),s.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var a={};return(()=>{s.d(a,{default:()=>y});var o=s(8156),l=s.n(o),c=s(7403),u=s(8446),h=s.n(u);function d(_){return d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},d(_)}function p(_,A){for(var S=0;S<A.length;S++){var C=A[S];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(_,v(C.key),C)}}function f(_,A){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,C){return S.__proto__=C,S},f(_,A)}function g(_){if(_===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function m(_){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(A){return A.__proto__||Object.getPrototypeOf(A)},m(_)}function v(_){var A=function(S,C){if(d(S)!=="object"||S===null)return S;var M=S[Symbol.toPrimitive];if(M!==void 0){var E=M.call(S,"string");if(d(E)!=="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(S)}(_);return d(A)==="symbol"?A:String(A)}var x=function(_){(function(R,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(O&&O.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),O&&f(R,O)})(P,_);var A,S,C,M,E=(C=P,M=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}(),function(){var R,O=m(C);if(M){var L=m(this).constructor;R=Reflect.construct(O,arguments,L)}else R=O.apply(this,arguments);return function(I,z){if(z&&(d(z)==="object"||typeof z=="function"))return z;if(z!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(I)}(this,R)});function P(){var R,O,L,I;(function(U,j){if(!(U instanceof j))throw new TypeError("Cannot call a class as a function")})(this,P);for(var z=arguments.length,K=new Array(z),Y=0;Y<z;Y++)K[Y]=arguments[Y];return O=g(R=E.call.apply(E,[this].concat(K))),I={instance:null},(L=v(L="state"))in O?Object.defineProperty(O,L,{value:I,enumerable:!0,configurable:!0,writable:!0}):O[L]=I,R}return A=P,(S=[{key:"componentDidMount",value:function(){var R=this,O=new c.default(this.typewriter,this.props.options);this.setState({instance:O},function(){var L=R.props.onInit;L&&L(O)})}},{key:"componentDidUpdate",value:function(R){h()(this.props.options,R.options)||this.setState({instance:new c.default(this.typewriter,this.props.options)})}},{key:"componentWillUnmount",value:function(){this.state.instance&&this.state.instance.stop()}},{key:"render",value:function(){var R=this,O=this.props.component;return l().createElement(O,{ref:function(L){return R.typewriter=L},className:"Typewriter","data-testid":"typewriter-wrapper"})}}])&&p(A.prototype,S),Object.defineProperty(A,"prototype",{writable:!1}),P}(o.Component);x.defaultProps={component:"div"};const y=x})(),a.default})())})(QZ);var Qwe=QZ.exports;const Jwe=E0(Qwe);var Kwe=Object.create,wT=Object.defineProperty,Zwe=Object.getOwnPropertyDescriptor,$we=Object.getOwnPropertyNames,ebe=Object.getPrototypeOf,tbe=Object.prototype.hasOwnProperty,ibe=(e,t,i)=>t in e?wT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,xm=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),rbe=(e,t)=>{for(var i in t)wT(e,i,{get:t[i],enumerable:!0})},nbe=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of $we(t))!tbe.call(e,n)&&n!==i&&wT(e,n,{get:()=>t[n],enumerable:!(r=Zwe(t,n))||r.enumerable});return e},lp=(e,t,i)=>(i=e!=null?Kwe(ebe(e)):{},nbe(t||!e||!e.__esModule?wT(i,"default",{value:e,enumerable:!0}):i,e)),xf=(e,t,i)=>(ibe(e,typeof t!="symbol"?t+"":t,i),i),sbe=xm((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),JZ=xm((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,p,f,g,m,v,x,y,_=r[0].length,A=r.length;if(A<_)throw new TypeError("Invalid matrix: m < n");for(var S=[],C=[],M=[],E=n==="f"?A:_,P=v=f=0;P<A;P++)C[P]=new Array(E).fill(0);for(P=0;P<_;P++)M[P]=new Array(_).fill(0);var R,O=new Array(_).fill(0);for(P=0;P<A;P++)for(l=0;l<_;l++)C[P][l]=r[P][l];for(P=0;P<_;P++){for(S[P]=f,m=0,u=P+1,l=P;l<A;l++)m+=Math.pow(C[l][P],2);if(m<o)f=0;else for(g=(p=C[P][P])*(f=p<0?Math.sqrt(m):-Math.sqrt(m))-m,C[P][P]=p-f,l=u;l<_;l++){for(m=0,c=P;c<A;c++)m+=C[c][P]*C[c][l];for(p=m/g,c=P;c<A;c++)C[c][l]=C[c][l]+p*C[c][P]}for(O[P]=f,m=0,l=u;l<_;l++)m+=Math.pow(C[P][l],2);if(m<o)f=0;else{for(g=(p=C[P][P+1])*(f=p<0?Math.sqrt(m):-Math.sqrt(m))-m,C[P][P+1]=p-f,l=u;l<_;l++)S[l]=C[P][l]/g;for(l=u;l<A;l++){for(m=0,c=u;c<_;c++)m+=C[l][c]*C[P][c];for(c=u;c<_;c++)C[l][c]=C[l][c]+m*S[c]}}v<(x=Math.abs(O[P])+Math.abs(S[P]))&&(v=x)}if(s)for(P=_-1;0<=P;P--){if(f!==0){for(g=C[P][P+1]*f,l=u;l<_;l++)M[l][P]=C[P][l]/g;for(l=u;l<_;l++){for(m=0,c=u;c<_;c++)m+=C[P][c]*M[c][l];for(c=u;c<_;c++)M[c][l]=M[c][l]+m*M[c][P]}}for(l=u;l<_;l++)M[P][l]=0,M[l][P]=0;M[P][P]=1,f=S[P],u=P}if(n){if(n==="f")for(P=_;P<A;P++){for(l=_;l<A;l++)C[P][l]=0;C[P][P]=1}for(P=_-1;0<=P;P--){for(u=P+1,f=O[P],l=u;l<E;l++)C[P][l]=0;if(f!==0){for(g=C[P][P]*f,l=u;l<E;l++){for(m=0,c=u;c<A;c++)m+=C[c][P]*C[c][l];for(p=m/g,c=P;c<A;c++)C[c][l]=C[c][l]+p*C[c][P]}for(l=P;l<A;l++)C[l][P]=C[l][P]/f}else for(l=P;l<A;l++)C[l][P]=0;C[P][P]=C[P][P]+1}}for(a*=v,c=_-1;0<=c;c--)for(var L=0;L<50;L++){for(R=!1,u=c;0<=u;u--){if(Math.abs(S[u])<=a){R=!0;break}if(Math.abs(O[u-1])<=a)break}if(!R){for(d=0,h=u-(m=1),P=u;P<c+1&&(p=m*S[P],S[P]=d*S[P],!(Math.abs(p)<=a));P++)if(f=O[P],O[P]=Math.sqrt(p*p+f*f),d=f/(g=O[P]),m=-p/g,n)for(l=0;l<A;l++)x=C[l][h],y=C[l][P],C[l][h]=x*d+y*m,C[l][P]=-x*m+y*d}if(y=O[c],u===c){if(y<0&&(O[c]=-y,s))for(l=0;l<_;l++)M[l][c]=-M[l][c];break}for(v=O[u],p=(((x=O[c-1])-y)*(x+y)+((f=S[c-1])-(g=S[c]))*(f+g))/(2*g*x),f=Math.sqrt(p*p+1),p=((v-y)*(v+y)+g*(x/(p<0?p-f:p+f)-g))/v,P=u+(m=d=1);P<c+1;P++){if(f=S[P],x=O[P],g=m*f,f*=d,y=Math.sqrt(p*p+g*g),p=v*(d=p/(S[P-1]=y))+f*(m=g/y),f=-v*m+f*d,g=x*m,x*=d,s)for(l=0;l<_;l++)v=M[l][P-1],y=M[l][P],M[l][P-1]=v*d+y*m,M[l][P]=-v*m+y*d;if(y=Math.sqrt(p*p+g*g),p=(d=p/(O[P-1]=y))*f+(m=g/y)*x,v=-m*f+d*x,n)for(l=0;l<A;l++)x=C[l][P-1],y=C[l][P],C[l][P-1]=x*d+y*m,C[l][P]=-x*m+y*d}S[u]=0,S[c]=p,O[c]=v}for(P=0;P<_;P++)O[P]<a&&(O[P]=0);return{u:C,q:O,v:M}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),abe=xm((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),obe=xm((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),lbe=xm((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(f){return'"'+c(f.text)+'"'},class:function(f){var g="",m;for(m=0;m<f.parts.length;m++)g+=f.parts[m]instanceof Array?u(f.parts[m][0])+"-"+u(f.parts[m][1]):u(f.parts[m]);return"["+(f.inverted?"^":"")+g+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function l(f){return f.charCodeAt(0).toString(16).toUpperCase()}function c(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+l(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+l(g)})}function u(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+l(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+l(g)})}function h(f){return o[f.type](f)}function d(f){var g=new Array(f.length),m,v;for(m=0;m<f.length;m++)g[m]=h(f[m]);if(g.sort(),g.length>0){for(m=1,v=1;m<g.length;m++)g[m-1]!==g[m]&&(g[v]=g[m],v++);g.length=v}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function p(f){return f?'"'+c(f)+'"':"end of input"}return"Expected "+d(s)+" but "+p(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:dt},c=dt,u=function(Q){if(!Q)return[];for(var $=[],ge=0;ge<Q.length;ge++)$=$.concat.apply($,Q[ge]);var ie=$[0];return ie&&ie.code=="m"&&(delete ie.relative,ie.code="M"),$},h=function(Q,$){return Cr(Q,$)},d=/^[Mm]/,p=Qe(["M","m"],!1,!1),f=function(Q,$,ge){var ie=Xt(Q,[$]);return ge&&(ie=ie.concat(Xt(Q=="M"?"L":"l",ge[1]))),ie},g=/^[Zz]/,m=Qe(["Z","z"],!1,!1),v=function(){return Xt("Z")},x=/^[Ll]/,y=Qe(["L","l"],!1,!1),_=function(Q,$){return Xt(Q,$)},A=/^[Hh]/,S=Qe(["H","h"],!1,!1),C=function(Q,$){return Xt(Q,$.map(function(ge){return{x:ge}}))},M=/^[Vv]/,E=Qe(["V","v"],!1,!1),P=function(Q,$){return Xt(Q,$.map(function(ge){return{y:ge}}))},R=/^[Cc]/,O=Qe(["C","c"],!1,!1),L=function(Q,$,ge){return{x1:Q.x,y1:Q.y,x2:$.x,y2:$.y,x:ge.x,y:ge.y}},I=/^[Ss]/,z=Qe(["S","s"],!1,!1),K=function(Q,$){return{x2:Q.x,y2:Q.y,x:$.x,y:$.y}},Y=/^[Qq]/,U=Qe(["Q","q"],!1,!1),j=function(Q,$){return{x1:Q.x,y1:Q.y,x:$.x,y:$.y}},k=/^[Tt]/,q=Qe(["T","t"],!1,!1),W=/^[Aa]/,te=Qe(["A","a"],!1,!1),G=function(Q,$,ge,ie,Se,lt){return{rx:Q,ry:$,xAxisRotation:ge,largeArc:ie,sweep:Se,x:lt.x,y:lt.y}},le=function(Q,$){return{x:Q,y:$}},Z=function(Q){return Q*1},he=function(Q){return Q.join("")*1},ye=/^[01]/,de=Qe(["0","1"],!1,!1),xe=function(Q){return Q=="1"},me=function(){return""},ee=",",we=Pe(",",!1),Ae=function(Q){return Q.join("")},Te=".",Re=Pe(".",!1),Xe=/^[eE]/,Oe=Qe(["e","E"],!1,!1),Be=/^[+\-]/,at=Qe(["+","-"],!1,!1),ht=/^[0-9]/,se=Qe([["0","9"]],!1,!1),N=function(Q){return Q.join("")},H=/^[ \t\n\r]/,ve=Qe([" ","	",`
`,"\r"],!1,!1),X=0,Ce=[{line:1,column:1}],Ve=0,Ye=[],_e;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function Pe(Q,$){return{type:"literal",text:Q,ignoreCase:$}}function Qe(Q,$,ge){return{type:"class",parts:Q,inverted:$,ignoreCase:ge}}function st(){return{type:"end"}}function ct(Q){var $=Ce[Q],ge;if($)return $;for(ge=Q-1;!Ce[ge];)ge--;for($=Ce[ge],$={line:$.line,column:$.column};ge<Q;)s.charCodeAt(ge)===10?($.line++,$.column=1):$.column++,ge++;return Ce[Q]=$,$}function tt(Q,$){var ge=ct(Q),ie=ct($);return{start:{offset:Q,line:ge.line,column:ge.column},end:{offset:$,line:ie.line,column:ie.column}}}function oe(Q){X<Ve||(X>Ve&&(Ve=X,Ye=[]),Ye.push(Q))}function je(Q,$,ge){return new r(r.buildMessage(Q,$),Q,$,ge)}function dt(){var Q,$,ge,ie,Se;for(Q=X,$=[],ge=Rt();ge!==o;)$.push(ge),ge=Rt();if($!==o)if(ge=J(),ge===o&&(ge=null),ge!==o){for(ie=[],Se=Rt();Se!==o;)ie.push(Se),Se=Rt();ie!==o?($=u(ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;else X=Q,Q=o;return Q}function J(){var Q,$,ge,ie,Se,lt;if(Q=X,$=be(),$!==o){for(ge=[],ie=X,Se=[],lt=Rt();lt!==o;)Se.push(lt),lt=Rt();for(Se!==o?(lt=be(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;){for(ge.push(ie),ie=X,Se=[],lt=Rt();lt!==o;)Se.push(lt),lt=Rt();Se!==o?(lt=be(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o)}ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function be(){var Q,$,ge,ie,Se,lt;if(Q=X,$=Ne(),$!==o){for(ge=[],ie=X,Se=[],lt=Rt();lt!==o;)Se.push(lt),lt=Rt();for(Se!==o?(lt=ue(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;){for(ge.push(ie),ie=X,Se=[],lt=Rt();lt!==o;)Se.push(lt),lt=Rt();Se!==o?(lt=ue(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o)}ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function ue(){var Q;return Q=et(),Q===o&&(Q=_t(),Q===o&&(Q=ti(),Q===o&&(Q=Ut(),Q===o&&(Q=Wi(),Q===o&&(Q=mh(),Q===o&&(Q=ae(),Q===o&&(Q=Fe(),Q===o&&(Q=Pt())))))))),Q}function Ne(){var Q,$,ge,ie,Se,lt,zi;if(Q=X,d.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(p)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=Ie(),ie!==o?(Se=X,lt=pt(),lt===o&&(lt=null),lt!==o?(zi=zt(),zi!==o?(lt=[lt,zi],Se=lt):(X=Se,Se=o)):(X=Se,Se=o),Se===o&&(Se=null),Se!==o?($=f($,ie,Se),Q=$):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function et(){var Q,$;return Q=X,g.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(m)),$!==o&&($=v()),Q=$,Q}function _t(){var Q,$,ge,ie;if(Q=X,x.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(y)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=zt(),ie!==o?($=_($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function zt(){var Q,$,ge,ie,Se,lt;if(Q=X,$=Ie(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Ie(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Ie(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function ti(){var Q,$,ge,ie;if(Q=X,A.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(S)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=ar(),ie!==o?($=C($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function ar(){var Q,$,ge,ie,Se,lt;if(Q=X,$=ke(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=ke(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=ke(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Ut(){var Q,$,ge,ie;if(Q=X,M.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(E)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=ar(),ie!==o?($=P($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Wi(){var Q,$,ge,ie;if(Q=X,R.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(O)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=Ai(),ie!==o?($=_($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Ai(){var Q,$,ge,ie,Se,lt;if(Q=X,$=Qo(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Qo(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Qo(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Qo(){var Q,$,ge,ie,Se,lt;return Q=X,$=Ie(),$!==o?(ge=pt(),ge===o&&(ge=null),ge!==o?(ie=Ie(),ie!==o?(Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Ie(),lt!==o?($=L($,ie,lt),Q=$):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o),Q}function mh(){var Q,$,ge,ie;if(Q=X,I.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(z)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=gh(),ie!==o?($=_($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function gh(){var Q,$,ge,ie,Se,lt;if(Q=X,$=da(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=da(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=da(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function da(){var Q,$,ge,ie;return Q=X,$=Ie(),$!==o?(ge=pt(),ge===o&&(ge=null),ge!==o?(ie=Ie(),ie!==o?($=K($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o),Q}function ae(){var Q,$,ge,ie;if(Q=X,Y.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(U)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=Ue(),ie!==o?($=_($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Ue(){var Q,$,ge,ie,Se,lt;if(Q=X,$=Je(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Je(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Je(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Je(){var Q,$,ge,ie;return Q=X,$=Ie(),$!==o?(ge=pt(),ge===o&&(ge=null),ge!==o?(ie=Ie(),ie!==o?($=j($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o),Q}function Fe(){var Q,$,ge,ie;if(Q=X,k.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(q)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=Ze(),ie!==o?($=_($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Ze(){var Q,$,ge,ie,Se,lt;if(Q=X,$=Ie(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Ie(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Ie(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Pt(){var Q,$,ge,ie;if(Q=X,W.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(te)),$!==o){for(ge=[],ie=Rt();ie!==o;)ge.push(ie),ie=Rt();ge!==o?(ie=re(),ie!==o?($=_($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)}else X=Q,Q=o;return Q}function re(){var Q,$,ge,ie,Se,lt;if(Q=X,$=Me(),$!==o){for(ge=[],ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Me(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ie!==o;)ge.push(ie),ie=X,Se=pt(),Se===o&&(Se=null),Se!==o?(lt=Me(),lt!==o?(Se=[Se,lt],ie=Se):(X=ie,ie=o)):(X=ie,ie=o);ge!==o?($=h($,ge),Q=$):(X=Q,Q=o)}else X=Q,Q=o;return Q}function Me(){var Q,$,ge,ie,Se,lt,zi,ur,Fa,an,Jo,jl;return Q=X,$=Ee(),$!==o?(ge=pt(),ge===o&&(ge=null),ge!==o?(ie=Ee(),ie!==o?(Se=pt(),Se===o&&(Se=null),Se!==o?(lt=ke(),lt!==o?(zi=pt(),zi!==o?(ur=ut(),ur!==o?(Fa=pt(),Fa===o&&(Fa=null),Fa!==o?(an=ut(),an!==o?(Jo=pt(),Jo===o&&(Jo=null),Jo!==o?(jl=Ie(),jl!==o?($=G($,ie,lt,ur,an,jl),Q=$):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o),Q}function Ie(){var Q,$,ge,ie;return Q=X,$=ke(),$!==o?(ge=pt(),ge===o&&(ge=null),ge!==o?(ie=ke(),ie!==o?($=le($,ie),Q=$):(X=Q,Q=o)):(X=Q,Q=o)):(X=Q,Q=o),Q}function Ee(){var Q,$;return Q=X,$=Nt(),$===o&&($=gi()),$!==o&&($=Z($)),Q=$,Q}function ke(){var Q,$,ge,ie;return Q=X,$=X,ge=gt(),ge===o&&(ge=null),ge!==o?(ie=Nt(),ie!==o?(ge=[ge,ie],$=ge):(X=$,$=o)):(X=$,$=o),$===o&&($=X,ge=gt(),ge===o&&(ge=null),ge!==o?(ie=gi(),ie!==o?(ge=[ge,ie],$=ge):(X=$,$=o)):(X=$,$=o)),$!==o&&($=he($)),Q=$,Q}function ut(){var Q,$;return Q=X,ye.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(de)),$!==o&&($=xe($)),Q=$,Q}function pt(){var Q,$,ge,ie,Se;if(Q=X,$=[],ge=Rt(),ge!==o)for(;ge!==o;)$.push(ge),ge=Rt();else $=o;if($!==o)if(ge=Dt(),ge===o&&(ge=null),ge!==o){for(ie=[],Se=Rt();Se!==o;)ie.push(Se),Se=Rt();ie!==o?($=[$,ge,ie],Q=$):(X=Q,Q=o)}else X=Q,Q=o;else X=Q,Q=o;if(Q===o){if(Q=X,$=X,ge=Dt(),ge!==o){for(ie=[],Se=Rt();Se!==o;)ie.push(Se),Se=Rt();ie!==o?(ge=[ge,ie],$=ge):(X=$,$=o)}else X=$,$=o;$!==o&&($=me()),Q=$}return Q}function Dt(){var Q;return s.charCodeAt(X)===44?(Q=ee,X++):(Q=o,oe(we)),Q}function Nt(){var Q,$,ge,ie;return Q=X,$=X,ge=ni(),ge!==o?(ie=Tt(),ie===o&&(ie=null),ie!==o?(ge=[ge,ie],$=ge):(X=$,$=o)):(X=$,$=o),$===o&&($=X,ge=gi(),ge!==o?(ie=Tt(),ie!==o?(ge=[ge,ie],$=ge):(X=$,$=o)):(X=$,$=o)),$!==o&&($=Ae($)),Q=$,Q}function ni(){var Q,$,ge,ie,Se;return Q=X,$=X,ge=gi(),ge===o&&(ge=null),ge!==o?(s.charCodeAt(X)===46?(ie=Te,X++):(ie=o,oe(Re)),ie!==o?(Se=gi(),Se!==o?(ge=[ge,ie,Se],$=ge):(X=$,$=o)):(X=$,$=o)):(X=$,$=o),$===o&&($=X,ge=gi(),ge!==o?(s.charCodeAt(X)===46?(ie=Te,X++):(ie=o,oe(Re)),ie!==o?(ge=[ge,ie],$=ge):(X=$,$=o)):(X=$,$=o)),$!==o&&($=Ae($)),Q=$,Q}function Tt(){var Q,$,ge,ie,Se;return Q=X,$=X,Xe.test(s.charAt(X))?(ge=s.charAt(X),X++):(ge=o,oe(Oe)),ge!==o?(ie=gt(),ie===o&&(ie=null),ie!==o?(Se=gi(),Se!==o?(ge=[ge,ie,Se],$=ge):(X=$,$=o)):(X=$,$=o)):(X=$,$=o),$!==o&&($=Ae($)),Q=$,Q}function gt(){var Q;return Be.test(s.charAt(X))?(Q=s.charAt(X),X++):(Q=o,oe(at)),Q}function gi(){var Q,$,ge;if(Q=X,$=[],ht.test(s.charAt(X))?(ge=s.charAt(X),X++):(ge=o,oe(se)),ge!==o)for(;ge!==o;)$.push(ge),ht.test(s.charAt(X))?(ge=s.charAt(X),X++):(ge=o,oe(se));else $=o;return $!==o&&($=N($)),Q=$,Q}function Rt(){var Q,$;return Q=X,H.test(s.charAt(X))?($=s.charAt(X),X++):($=o,oe(ve)),$!==o&&($=me()),Q=$,Q}function Cr(Q,$){if(!$)return[Q];for(var ge=[Q],ie=0,Se=$.length;ie<Se;ie++)ge[ie+1]=$[ie][1];return ge}var qr={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Pi in qr)qr[Pi.toUpperCase()]=qr[Pi];function Xt(Q,$){$||($=[{}]);for(var ge=$.length;ge--;){var ie={code:Q,command:qr[Q]};Q==Q.toLowerCase()&&(ie.relative=!0);for(var Se in $[ge])ie[Se]=$[ge][Se];$[ge]=ie}return $}if(_e=c(),_e!==o&&X===s.length)return _e;throw _e!==o&&X<s.length&&oe(st()),je(Ye,Ve<s.length?s.charAt(Ve):null,Ve<s.length?tt(Ve,Ve+1):tt(Ve,Ve))}t.exports={SyntaxError:r,parse:n}}),KZ=xm((e,t)=>{var i=lbe().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),cbe=xm((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),z0="149",vo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ube=0,nj=1,hbe=2,uU=1,dbe=2,L1=3,Ol=0,Zn=1,Bs=2,xn=0,Bf=1,sj=2,aj=3,oj=4,pbe=5,Hg=100,fbe=101,mbe=102,lj=103,cj=104,gbe=200,vbe=201,ybe=202,xbe=203,ZZ=204,$Z=205,wbe=206,bbe=207,_be=208,Sbe=209,Abe=210,Mbe=0,Ebe=1,Cbe=2,kL=3,Tbe=4,Pbe=5,Dbe=6,Rbe=7,e$=0,Ibe=1,Lbe=2,Rc=0,Obe=1,Bbe=2,Fbe=3,Nbe=4,Ube=5,t$=300,em=301,tm=302,zL=303,VL=304,nb=306,Uu=1e3,xr=1001,GL=1002,vi=1003,uj=1004,LD=1005,di=1006,kbe=1007,h0=1008,Us=1009,zbe=1010,Vbe=1011,i$=1012,Gbe=1013,ku=1014,Ki=1015,nh=1016,Hbe=1017,jbe=1018,Ff=1020,Wbe=1021,Er=1023,Xbe=1024,Ybe=1025,Nf=1026,im=1027,bM=1028,qbe=1029,EE=1030,Qbe=1031,r$=1033,OD=33776,BD=33777,FD=33778,ND=33779,hj=35840,dj=35841,pj=35842,fj=35843,Jbe=36196,mj=37492,gj=37496,vj=37808,yj=37809,xj=37810,wj=37811,bj=37812,_j=37813,Sj=37814,Aj=37815,Mj=37816,Ej=37817,Cj=37818,Tj=37819,Pj=37820,Dj=37821,UD=36492,Kbe=36283,Rj=36284,Ij=36285,Lj=36286,n$=2200,s$=2201,hU=2202,CE=2300,TE=2301,kD=2302,vv=2400,yv=2401,PE=2402,dU=2500,Zbe=2501,Bl=3e3,ci=3001,ph=3200,a$=3201,$be=0,e_e=1,pc="srgb",DE="srgb-linear",zD=7680,t_e=519,HL=35044,i_e=35048,jL="300 es",WL=1035,ws=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},Ps=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Oj=1234567,ox=Math.PI/180,iw=180/Math.PI;function ko(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ps[e&255]+Ps[e>>8&255]+Ps[e>>16&255]+Ps[e>>24&255]+"-"+Ps[t&255]+Ps[t>>8&255]+"-"+Ps[t>>16&15|64]+Ps[t>>24&255]+"-"+Ps[i&63|128]+Ps[i>>8&255]+"-"+Ps[i>>16&255]+Ps[i>>24&255]+Ps[r&255]+Ps[r>>8&255]+Ps[r>>16&255]+Ps[r>>24&255]).toLowerCase()}function pn(e,t,i){return Math.max(t,Math.min(i,e))}function pU(e,t){return(e%t+t)%t}function r_e(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function n_e(e,t,i){return e!==t?(i-e)/(t-e):0}function lx(e,t,i){return(1-i)*e+i*t}function s_e(e,t,i,r){return lx(e,t,1-Math.exp(-i*r))}function a_e(e,t=1){return t-Math.abs(pU(e,t*2)-t)}function o_e(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function l_e(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function c_e(e,t){return e+Math.floor(Math.random()*(t-e+1))}function u_e(e,t){return e+Math.random()*(t-e)}function h_e(e){return e*(.5-Math.random())}function d_e(e){e!==void 0&&(Oj=e);let t=Oj+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function p_e(e){return e*ox}function f_e(e){return e*iw}function XL(e){return(e&e-1)===0&&e!==0}function o$(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function RE(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function m_e(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function zu(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function lr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var St=Object.freeze({__proto__:null,DEG2RAD:ox,RAD2DEG:iw,ceilPowerOfTwo:o$,clamp:pn,damp:s_e,degToRad:p_e,denormalize:zu,euclideanModulo:pU,floorPowerOfTwo:RE,generateUUID:ko,inverseLerp:n_e,isPowerOfTwo:XL,lerp:lx,mapLinear:r_e,normalize:lr,pingpong:a_e,radToDeg:f_e,randFloat:u_e,randFloatSpread:h_e,randInt:c_e,seededRandom:d_e,setQuaternionFromProperEuler:m_e,smootherstep:l_e,smoothstep:o_e}),pe=class{constructor(e=0,t=0){pe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},gn=class{constructor(){gn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],f=r[0],g=r[3],m=r[6],v=r[1],x=r[4],y=r[7],_=r[2],A=r[5],S=r[8];return n[0]=s*f+a*v+o*_,n[3]=s*g+a*x+o*A,n[6]=s*m+a*y+o*S,n[1]=l*f+c*v+u*_,n[4]=l*g+c*x+u*A,n[7]=l*m+c*y+u*S,n[2]=h*f+d*v+p*_,n[5]=h*g+d*x+p*A,n[8]=h*m+d*y+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,p=t*u+i*h+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=u*f,e[1]=(r*l-c*i)*f,e[2]=(a*i-r*s)*f,e[3]=h*f,e[4]=(c*t-r*o)*f,e[5]=(r*n-a*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*n)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(VD.makeScale(e,t)),this}rotate(e){return this.premultiply(VD.makeRotation(-e)),this}translate(e,t){return this.premultiply(VD.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},VD=new gn;function l$(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var g_e={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ES(e,t){return new g_e[e](t)}function rw(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function v_e(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function Uf(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function _M(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var GD={[pc]:{[DE]:Uf},[DE]:{[pc]:_M}},Ws={legacyMode:!0,get workingColorSpace(){return DE},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(GD[t]&&GD[t][i]!==void 0){let r=GD[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},c$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Sn={r:0,g:0,b:0},nl={h:0,s:0,l:0},CS={h:0,s:0,l:0};function HD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function TS(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var jt=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=pc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ws.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Ws.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ws.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Ws.workingColorSpace){if(e=pU(e,1),t=pn(t,0,1),i=pn(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=HD(s,n,e+1/3),this.g=HD(s,n,e),this.b=HD(s,n,e-1/3)}return Ws.toWorkingColorSpace(this,r),this}setStyle(e,t=pc){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Ws.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Ws.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Ws.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Ws.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=pc){let i=c$[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Uf(e.r),this.g=Uf(e.g),this.b=Uf(e.b),this}copyLinearToSRGB(e){return this.r=_M(e.r),this.g=_M(e.g),this.b=_M(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=pc){return Ws.fromWorkingColorSpace(TS(this,Sn),e),pn(Sn.r*255,0,255)<<16^pn(Sn.g*255,0,255)<<8^pn(Sn.b*255,0,255)<<0}getHexString(e=pc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ws.workingColorSpace){Ws.fromWorkingColorSpace(TS(this,Sn),t);let i=Sn.r,r=Sn.g,n=Sn.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-i)/u+2;break;case n:o=(i-r)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=Ws.workingColorSpace){return Ws.fromWorkingColorSpace(TS(this,Sn),t),e.r=Sn.r,e.g=Sn.g,e.b=Sn.b,e}getStyle(e=pc){return Ws.fromWorkingColorSpace(TS(this,Sn),e),e!==pc?`color(${e} ${Sn.r} ${Sn.g} ${Sn.b})`:`rgb(${Sn.r*255|0},${Sn.g*255|0},${Sn.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(nl),nl.h+=e,nl.s+=t,nl.l+=i,this.setHSL(nl.h,nl.s,nl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(nl),e.getHSL(CS);let i=lx(nl.h,CS.h,t),r=lx(nl.s,CS.s,t),n=lx(nl.l,CS.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};jt.NAMES=c$;var lg,u$=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{lg===void 0&&(lg=rw("canvas")),lg.width=e.width,lg.height=e.height;let i=lg.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=lg}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=rw("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=Uf(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Uf(t[i]/255)*255):t[i]=Uf(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},h$=class{constructor(e=null){this.isSource=!0,this.uuid=ko(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(jD(r[s].image)):n.push(jD(r[s]))}else n=jD(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function jD(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?u$.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var y_e=0,Br=class extends ws{constructor(e=Br.DEFAULT_IMAGE,t=Br.DEFAULT_MAPPING,i=xr,r=xr,n=di,s=h0,a=Er,o=Us,l=Br.DEFAULT_ANISOTROPY,c=Bl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:y_e++}),this.uuid=ko(),this.name="",this.source=new h$(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new pe(0,0),this.repeat=new pe(1,1),this.center=new pe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==t$)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Uu:e.x=e.x-Math.floor(e.x);break;case xr:e.x=e.x<0?0:1;break;case GL:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Uu:e.y=e.y-Math.floor(e.y);break;case xr:e.y=e.y<0?0:1;break;case GL:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Br.DEFAULT_IMAGE=null;Br.DEFAULT_MAPPING=t$;Br.DEFAULT_ANISOTROPY=1;var ii=class{constructor(e=0,t=0,i=0,r=1){ii.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let m=(a+1)/2,v=(u+1)/2,x=(f+1)/2,y=(o+c)/4,_=(l+d)/4,A=(h+p)/4;return m>v&&m>x?m<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(m),r=y/i,n=_/i):v>x?v<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(v),i=y/r,n=A/r):x<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(x),i=_/n,r=A/n),this.set(i,r,n,t),this}let g=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(g)<.001&&(g=1),this.x=(p-h)/g,this.y=(l-d)/g,this.z=(c-o)/g,this.w=Math.acos((a+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Di=class extends ws{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ii(0,0,e,t),this.scissorTest=!1,this.viewport=new ii(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new Br(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:di,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new h$(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},d$=class extends Br{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=vi,this.minFilter=vi,this.wrapR=xr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},x_e=class extends Br{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=vi,this.minFilter=vi,this.wrapR=xr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},p$=class extends Di{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},$t=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(a===1){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(u!==f||o!==h||l!==d||c!==p){let g=1-a,m=o*h+l*d+c*p+u*f,v=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){let _=Math.sqrt(x),A=Math.atan2(_,m*v);g=Math.sin(g*A)/_,a=Math.sin(a*A)/_}let y=a*v;if(o=o*g+h*y,l=l*g+d*y,c=c*g+p*y,u=u*g+f*y,g===1-a){let _=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=_,l*=_,c*=_,u*=_}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=n[s],h=n[s+1],d=n[s+2],p=n[s+3];return e[t]=a*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-a*d,e[t+2]=l*p+c*d+a*h-o*u,e[t+3]=c*p-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=o(i/2),d=o(r/2),p=o(n/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(pn(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},F=class{constructor(e=0,t=0,i=0){F.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Bj.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Bj.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,s=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*r-a*i,c=o*i+a*t-n*r,u=o*r+n*i-s*t,h=-n*t-s*i-a*r;return this.x=l*o+h*-n+c*-a-u*-s,this.y=c*o+h*-s+u*-n-l*-a,this.z=u*o+h*-a+l*-s-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return WD.copy(this).projectOnVector(e),this.sub(WD)}reflect(e){return this.sub(WD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(pn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},WD=new F,Bj=new $t,nn=class{constructor(e=new F(1/0,1/0,1/0),t=new F(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Lp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Lp.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Lp)}else i.boundingBox===null&&i.computeBoundingBox(),XD.copy(i.boundingBox),XD.applyMatrix4(e.matrixWorld),this.union(XD);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Lp),Lp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(qy),PS.subVectors(this.max,qy),cg.subVectors(e.a,qy),ug.subVectors(e.b,qy),hg.subVectors(e.c,qy),Ih.subVectors(ug,cg),Lh.subVectors(hg,ug),Op.subVectors(cg,hg);let t=[0,-Ih.z,Ih.y,0,-Lh.z,Lh.y,0,-Op.z,Op.y,Ih.z,0,-Ih.x,Lh.z,0,-Lh.x,Op.z,0,-Op.x,-Ih.y,Ih.x,0,-Lh.y,Lh.x,0,-Op.y,Op.x,0];return!YD(t,cg,ug,hg,PS)||(t=[1,0,0,0,1,0,0,0,1],!YD(t,cg,ug,hg,PS))?!1:(DS.crossVectors(Ih,Lh),t=[DS.x,DS.y,DS.z],YD(t,cg,ug,hg,PS))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Lp.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Lp).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(au[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),au[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),au[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),au[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),au[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),au[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),au[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),au[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(au),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},au=[new F,new F,new F,new F,new F,new F,new F,new F],Lp=new F,XD=new nn,cg=new F,ug=new F,hg=new F,Ih=new F,Lh=new F,Op=new F,qy=new F,PS=new F,DS=new F,Bp=new F;function YD(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Bp.fromArray(e,s);let o=n.x*Math.abs(Bp.x)+n.y*Math.abs(Bp.y)+n.z*Math.abs(Bp.z),l=t.dot(Bp),c=i.dot(Bp),u=r.dot(Bp);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var w_e=new nn,Qy=new F,qD=new F,Oa=class{constructor(e=new F,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):w_e.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Qy.subVectors(e,this.center);let t=Qy.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Qy,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(qD.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Qy.copy(e.center).add(qD)),this.expandByPoint(Qy.copy(e.center).sub(qD))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},ou=new F,QD=new F,RS=new F,Oh=new F,JD=new F,IS=new F,KD=new F,V0=class{constructor(e=new F,t=new F(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ou)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=ou.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ou.copy(this.direction).multiplyScalar(t).add(this.origin),ou.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){QD.copy(e).add(t).multiplyScalar(.5),RS.copy(t).sub(e).normalize(),Oh.copy(this.origin).sub(QD);let n=e.distanceTo(t)*.5,s=-this.direction.dot(RS),a=Oh.dot(this.direction),o=-Oh.dot(RS),l=Oh.lengthSq(),c=Math.abs(1-s*s),u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=n*c,u>=0)if(h>=-p)if(h<=p){let f=1/c;u*=f,h*=f,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(RS).multiplyScalar(h).add(QD),d}intersectSphere(e,t){ou.subVectors(e.center,this.origin);let i=ou.dot(this.direction),r=ou.dot(ou)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,ou)!==null}intersectTriangle(e,t,i,r,n){JD.subVectors(t,e),IS.subVectors(i,e),KD.crossVectors(JD,IS);let s=this.direction.dot(KD),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Oh.subVectors(this.origin,e);let o=a*this.direction.dot(IS.crossVectors(Oh,IS));if(o<0)return null;let l=a*this.direction.dot(JD.cross(Oh));if(l<0||o+l>s)return null;let c=-a*Oh.dot(KD);return c<0?null:this.at(c/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},ot=class{constructor(){ot.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,g){let m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=a,m[13]=o,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=d,m[7]=p,m[11]=f,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ot().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/dg.setFromMatrixColumn(e,0).length(),n=1/dg.setFromMatrixColumn(e,1).length(),s=1/dg.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if(e.order==="XYZ"){let h=s*c,d=s*u,p=a*c,f=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-a*o,t[2]=f-h*l,t[6]=p+d*l,t[10]=s*o}else if(e.order==="YXZ"){let h=o*c,d=o*u,p=l*c,f=l*u;t[0]=h+f*a,t[4]=p*a-d,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=d*a-p,t[6]=f+h*a,t[10]=s*o}else if(e.order==="ZXY"){let h=o*c,d=o*u,p=l*c,f=l*u;t[0]=h-f*a,t[4]=-s*u,t[8]=p+d*a,t[1]=d+p*a,t[5]=s*c,t[9]=f-h*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let h=s*c,d=s*u,p=a*c,f=a*u;t[0]=o*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=o*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let h=s*o,d=s*l,p=a*o,f=a*l;t[0]=o*c,t[4]=f-h*u,t[8]=p*u+d,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=d*u+p,t[10]=h-f*u}else if(e.order==="XZY"){let h=s*o,d=s*l,p=a*o,f=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=h*u+f,t[5]=s*c,t[9]=d*u-p,t[2]=p*u-d,t[6]=a*c,t[10]=f*u+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(b_e,e,__e)}lookAt(e,t,i){let r=this.elements;return Ha.subVectors(e,t),Ha.lengthSq()===0&&(Ha.z=1),Ha.normalize(),Bh.crossVectors(i,Ha),Bh.lengthSq()===0&&(Math.abs(i.z)===1?Ha.x+=1e-4:Ha.z+=1e-4,Ha.normalize(),Bh.crossVectors(i,Ha)),Bh.normalize(),LS.crossVectors(Ha,Bh),r[0]=Bh.x,r[4]=LS.x,r[8]=Ha.x,r[1]=Bh.y,r[5]=LS.y,r[9]=Ha.y,r[2]=Bh.z,r[6]=LS.z,r[10]=Ha.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],f=i[6],g=i[10],m=i[14],v=i[3],x=i[7],y=i[11],_=i[15],A=r[0],S=r[4],C=r[8],M=r[12],E=r[1],P=r[5],R=r[9],O=r[13],L=r[2],I=r[6],z=r[10],K=r[14],Y=r[3],U=r[7],j=r[11],k=r[15];return n[0]=s*A+a*E+o*L+l*Y,n[4]=s*S+a*P+o*I+l*U,n[8]=s*C+a*R+o*z+l*j,n[12]=s*M+a*O+o*K+l*k,n[1]=c*A+u*E+h*L+d*Y,n[5]=c*S+u*P+h*I+d*U,n[9]=c*C+u*R+h*z+d*j,n[13]=c*M+u*O+h*K+d*k,n[2]=p*A+f*E+g*L+m*Y,n[6]=p*S+f*P+g*I+m*U,n[10]=p*C+f*R+g*z+m*j,n[14]=p*M+f*O+g*K+m*k,n[3]=v*A+x*E+y*L+_*Y,n[7]=v*S+x*P+y*I+_*U,n[11]=v*C+x*R+y*z+_*j,n[15]=v*M+x*O+y*K+_*k,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],p=e[3],f=e[7],g=e[11],m=e[15];return p*(+n*o*u-r*l*u-n*a*h+i*l*h+r*a*d-i*o*d)+f*(+t*o*d-t*l*h+n*s*h-r*s*d+r*l*c-n*o*c)+g*(+t*l*u-t*a*d-n*s*u+i*s*d+n*a*c-i*l*c)+m*(-r*a*c-t*o*u+t*a*h+r*s*u-i*s*h+i*o*c)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15],v=u*g*l-f*h*l+f*o*d-a*g*d-u*o*m+a*h*m,x=p*h*l-c*g*l-p*o*d+s*g*d+c*o*m-s*h*m,y=c*f*l-p*u*l+p*a*d-s*f*d-c*a*m+s*u*m,_=p*u*o-c*f*o-p*a*h+s*f*h+c*a*g-s*u*g,A=t*v+i*x+r*y+n*_;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/A;return e[0]=v*S,e[1]=(f*h*n-u*g*n-f*r*d+i*g*d+u*r*m-i*h*m)*S,e[2]=(a*g*n-f*o*n+f*r*l-i*g*l-a*r*m+i*o*m)*S,e[3]=(u*o*n-a*h*n-u*r*l+i*h*l+a*r*d-i*o*d)*S,e[4]=x*S,e[5]=(c*g*n-p*h*n+p*r*d-t*g*d-c*r*m+t*h*m)*S,e[6]=(p*o*n-s*g*n-p*r*l+t*g*l+s*r*m-t*o*m)*S,e[7]=(s*h*n-c*o*n+c*r*l-t*h*l-s*r*d+t*o*d)*S,e[8]=y*S,e[9]=(p*u*n-c*f*n-p*i*d+t*f*d+c*i*m-t*u*m)*S,e[10]=(s*f*n-p*a*n+p*i*l-t*f*l-s*i*m+t*a*m)*S,e[11]=(c*a*n-s*u*n-c*i*l+t*u*l+s*i*d-t*a*d)*S,e[12]=_*S,e[13]=(c*f*r-p*u*r+p*i*h-t*f*h-c*i*g+t*u*g)*S,e[14]=(p*a*r-s*f*r-p*i*o+t*f*o+s*i*g-t*a*g)*S,e[15]=(s*u*r-c*a*r+c*i*o-t*u*o-s*i*h+t*a*h)*S,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,a=e.y,o=e.z,l=n*s,c=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+i,c*o-r*s,0,l*o-r*a,c*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,c=s+s,u=a+a,h=n*l,d=n*c,p=n*u,f=s*c,g=s*u,m=a*u,v=o*l,x=o*c,y=o*u,_=i.x,A=i.y,S=i.z;return r[0]=(1-(f+m))*_,r[1]=(d+y)*_,r[2]=(p-x)*_,r[3]=0,r[4]=(d-y)*A,r[5]=(1-(h+m))*A,r[6]=(g+v)*A,r[7]=0,r[8]=(p+x)*S,r[9]=(g-v)*S,r[10]=(1-(h+f))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=dg.set(r[0],r[1],r[2]).length(),s=dg.set(r[4],r[5],r[6]).length(),a=dg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],sl.copy(this);let o=1/n,l=1/s,c=1/a;return sl.elements[0]*=o,sl.elements[1]*=o,sl.elements[2]*=o,sl.elements[4]*=l,sl.elements[5]*=l,sl.elements[6]*=l,sl.elements[8]*=c,sl.elements[9]*=c,sl.elements[10]*=c,t.setFromRotationMatrix(sl),i.x=n,i.y=s,i.z=a,this}makePerspective(e,t,i,r,n,s){let a=this.elements,o=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,s){let a=this.elements,o=1/(t-e),l=1/(i-r),c=1/(s-n),u=(t+e)*o,h=(i+r)*l,d=(s+n)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},dg=new F,sl=new ot,b_e=new F(0,0,0),__e=new F(1,1,1),Bh=new F,LS=new F,Ha=new F,Fj=new ot,Nj=new $t,Pn=class{constructor(e=0,t=0,i=0,r=Pn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(pn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-pn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(pn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-pn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(pn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-pn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Fj.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Fj,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Nj.setFromEuler(this),this.setFromQuaternion(Nj,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Pn.DEFAULT_ORDER="XYZ";var fU=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},S_e=0,Uj=new F,pg=new $t,lu=new ot,OS=new F,Jy=new F,A_e=new F,M_e=new $t,kj=new F(1,0,0),zj=new F(0,1,0),Vj=new F(0,0,1),E_e={type:"added"},Gj={type:"removed"},Qi=class extends ws{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:S_e++}),this.uuid=ko(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qi.DEFAULT_UP.clone();let e=new F,t=new Pn,i=new $t,r=new F(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ot},normalMatrix:{value:new gn}}),this.matrix=new ot,this.matrixWorld=new ot,this.matrixAutoUpdate=Qi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new fU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return pg.setFromAxisAngle(e,t),this.quaternion.multiply(pg),this}rotateOnWorldAxis(e,t){return pg.setFromAxisAngle(e,t),this.quaternion.premultiply(pg),this}rotateX(e){return this.rotateOnAxis(kj,e)}rotateY(e){return this.rotateOnAxis(zj,e)}rotateZ(e){return this.rotateOnAxis(Vj,e)}translateOnAxis(e,t){return Uj.copy(e).applyQuaternion(this.quaternion),this.position.add(Uj.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(kj,e)}translateY(e){return this.translateOnAxis(zj,e)}translateZ(e){return this.translateOnAxis(Vj,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(lu.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?OS.copy(e):OS.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),Jy.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?lu.lookAt(Jy,OS,this.up):lu.lookAt(OS,Jy,this.up),this.quaternion.setFromRotationMatrix(lu),r&&(lu.extractRotation(r.matrixWorld),pg.setFromRotationMatrix(lu),this.quaternion.premultiply(pg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(E_e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Gj)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(Gj)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),lu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),lu.multiply(e.parent.matrixWorld)),e.applyMatrix4(lu),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Jy,e,A_e),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Jy,M_e,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(e.shapes,u)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};Qi.DEFAULT_UP=new F(0,1,0);Qi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var al=new F,cu=new F,ZD=new F,uu=new F,fg=new F,mg=new F,Hj=new F,$D=new F,eR=new F,tR=new F,ps=class{constructor(e=new F,t=new F,i=new F){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),al.subVectors(e,t),r.cross(al);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){al.subVectors(r,t),cu.subVectors(i,t),ZD.subVectors(e,t);let s=al.dot(al),a=al.dot(cu),o=al.dot(ZD),l=cu.dot(cu),c=cu.dot(ZD),u=s*l-a*a;if(u===0)return n.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,p=(s*c-a*o)*h;return n.set(1-d-p,p,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,uu),uu.x>=0&&uu.y>=0&&uu.x+uu.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,uu),o.set(0,0),o.addScaledVector(n,uu.x),o.addScaledVector(s,uu.y),o.addScaledVector(a,uu.z),o}static isFrontFacing(e,t,i,r){return al.subVectors(i,t),cu.subVectors(e,t),al.cross(cu).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return al.subVectors(this.c,this.b),cu.subVectors(this.a,this.b),al.cross(cu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ps.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ps.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return ps.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return ps.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ps.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;fg.subVectors(r,i),mg.subVectors(n,i),$D.subVectors(e,i);let o=fg.dot($D),l=mg.dot($D);if(o<=0&&l<=0)return t.copy(i);eR.subVectors(e,r);let c=fg.dot(eR),u=mg.dot(eR);if(c>=0&&u<=c)return t.copy(r);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(i).addScaledVector(fg,s);tR.subVectors(e,n);let d=fg.dot(tR),p=mg.dot(tR);if(p>=0&&d<=p)return t.copy(n);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(mg,a);let g=c*p-d*u;if(g<=0&&u-c>=0&&d-p>=0)return Hj.subVectors(n,r),a=(u-c)/(u-c+(d-p)),t.copy(r).addScaledVector(Hj,a);let m=1/(g+f+h);return s=f*m,a=h*m,t.copy(i).addScaledVector(fg,s).addScaledVector(mg,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},C_e=0,sb=class extends ws{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:C_e++}),this.uuid=ko(),this.name="",this.type="Material",this.blending=Bf,this.side=Ol,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ZZ,this.blendDst=$Z,this.blendEquation=Hg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=kL,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=t_e,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zD,this.stencilZFail=zD,this.stencilZPass=zD,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Bf&&(i.blending=this.blending),this.side!==Ol&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},sh=class extends sb{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=e$,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},un=new F,BS=new pe,Wt=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=HL,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)BS.fromBufferAttribute(this,t),BS.applyMatrix3(e),this.setXY(t,BS.x,BS.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)un.fromBufferAttribute(this,t),un.applyMatrix3(e),this.setXYZ(t,un.x,un.y,un.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)un.fromBufferAttribute(this,t),un.applyMatrix4(e),this.setXYZ(t,un.x,un.y,un.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)un.fromBufferAttribute(this,t),un.applyNormalMatrix(e),this.setXYZ(t,un.x,un.y,un.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)un.fromBufferAttribute(this,t),un.transformDirection(e),this.setXYZ(t,un.x,un.y,un.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=zu(t,this.array)),t}setX(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=zu(t,this.array)),t}setY(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=zu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=zu(t,this.array)),t}setW(e,t){return this.normalized&&(t=lr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array),n=lr(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==HL&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},f$=class extends Wt{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Bv=class extends Wt{constructor(e,t,i){super(new Uint32Array(e),t,i)}},xt=class extends Wt{constructor(e,t,i){super(new Float32Array(e),t,i)}},T_e=0,yo=new ot,iR=new Qi,gg=new F,ja=new nn,Ky=new nn,Hn=new F,Ot=class extends ws{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:T_e++}),this.uuid=ko(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(l$(e)?Bv:f$)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new gn().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return yo.makeRotationFromQuaternion(e),this.applyMatrix4(yo),this}rotateX(e){return yo.makeRotationX(e),this.applyMatrix4(yo),this}rotateY(e){return yo.makeRotationY(e),this.applyMatrix4(yo),this}rotateZ(e){return yo.makeRotationZ(e),this.applyMatrix4(yo),this}translate(e,t,i){return yo.makeTranslation(e,t,i),this.applyMatrix4(yo),this}scale(e,t,i){return yo.makeScale(e,t,i),this.applyMatrix4(yo),this}lookAt(e){return iR.lookAt(e),iR.updateMatrix(),this.applyMatrix4(iR.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(gg).negate(),this.translate(gg.x,gg.y,gg.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new xt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new nn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new F(-1/0,-1/0,-1/0),new F(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];ja.setFromBufferAttribute(n),this.morphTargetsRelative?(Hn.addVectors(this.boundingBox.min,ja.min),this.boundingBox.expandByPoint(Hn),Hn.addVectors(this.boundingBox.max,ja.max),this.boundingBox.expandByPoint(Hn)):(this.boundingBox.expandByPoint(ja.min),this.boundingBox.expandByPoint(ja.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Oa);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new F,1/0);return}if(e){let i=this.boundingSphere.center;if(ja.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];Ky.setFromBufferAttribute(a),this.morphTargetsRelative?(Hn.addVectors(ja.min,Ky.min),ja.expandByPoint(Hn),Hn.addVectors(ja.max,Ky.max),ja.expandByPoint(Hn)):(ja.expandByPoint(Ky.min),ja.expandByPoint(Ky.max))}ja.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)Hn.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(Hn));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)Hn.fromBufferAttribute(a,l),o&&(gg.fromBufferAttribute(e,l),Hn.add(gg)),r=Math.max(r,i.distanceToSquared(Hn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wt(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<a;E++)l[E]=new F,c[E]=new F;let u=new F,h=new F,d=new F,p=new pe,f=new pe,g=new pe,m=new F,v=new F;function x(E,P,R){u.fromArray(r,E*3),h.fromArray(r,P*3),d.fromArray(r,R*3),p.fromArray(s,E*2),f.fromArray(s,P*2),g.fromArray(s,R*2),h.sub(u),d.sub(u),f.sub(p),g.sub(p);let O=1/(f.x*g.y-g.x*f.y);!isFinite(O)||(m.copy(h).multiplyScalar(g.y).addScaledVector(d,-f.y).multiplyScalar(O),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-g.x).multiplyScalar(O),l[E].add(m),l[P].add(m),l[R].add(m),c[E].add(v),c[P].add(v),c[R].add(v))}let y=this.groups;y.length===0&&(y=[{start:0,count:i.length}]);for(let E=0,P=y.length;E<P;++E){let R=y[E],O=R.start,L=R.count;for(let I=O,z=O+L;I<z;I+=3)x(i[I+0],i[I+1],i[I+2])}let _=new F,A=new F,S=new F,C=new F;function M(E){S.fromArray(n,E*3),C.copy(S);let P=l[E];_.copy(P),_.sub(S.multiplyScalar(S.dot(P))).normalize(),A.crossVectors(C,P);let R=A.dot(c[E])<0?-1:1;o[E*4]=_.x,o[E*4+1]=_.y,o[E*4+2]=_.z,o[E*4+3]=R}for(let E=0,P=y.length;E<P;++E){let R=y[E],O=R.start,L=R.count;for(let I=O,z=O+L;I<z;I+=3)M(i[I+0]),M(i[I+1]),M(i[I+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Wt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new F,n=new F,s=new F,a=new F,o=new F,l=new F,c=new F,u=new F;if(e)for(let h=0,d=e.count;h<d;h+=3){let p=e.getX(h+0),f=e.getX(h+1),g=e.getX(h+2);r.fromBufferAttribute(t,p),n.fromBufferAttribute(t,f),s.fromBufferAttribute(t,g),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,g),a.add(c),o.add(c),l.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)r.fromBufferAttribute(t,h+0),n.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Hn.fromBufferAttribute(e,t),Hn.normalize(),e.setXYZ(t,Hn.x,Hn.y,Hn.z)}toNonIndexed(){function e(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,p=0;for(let f=0,g=o.length;f<g;f++){a.isInterleavedBufferAttribute?d=o[f]*a.data.stride+a.offset:d=o[f]*c;for(let m=0;m<c;m++)h[p++]=l[d++]}return new Wt(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Ot,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=e(h,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(e.data))}c.length>0&&(r[o]=c,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(t))}let n=e.morphAttributes;for(let l in n){let c=[],u=n[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},jj=new ot,vg=new V0,rR=new Oa,Zy=new F,$y=new F,e1=new F,nR=new F,FS=new F,NS=new pe,US=new pe,kS=new pe,sR=new F,zS=new F,cr=class extends Qi{constructor(e=new Ot,t=new sh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(n&&a){FS.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(nR.fromBufferAttribute(u,e),s?FS.addScaledVector(nR,c):FS.addScaledVector(nR.sub(t),c))}t.add(FS)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),rR.copy(i.boundingSphere),rR.applyMatrix4(n),e.ray.intersectsSphere(rR)===!1)||(jj.copy(n).invert(),vg.copy(e.ray).applyMatrix4(jj),i.boundingBox!==null&&vg.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],g=r[f.materialIndex],m=Math.max(f.start,h.start),v=Math.min(a.count,Math.min(f.start+f.count,h.start+h.count));for(let x=m,y=v;x<y;x+=3){let _=a.getX(x),A=a.getX(x+1),S=a.getX(x+2);s=VS(this,g,e,vg,l,c,_,A,S),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(a.count,h.start+h.count);for(let f=d,g=p;f<g;f+=3){let m=a.getX(f),v=a.getX(f+1),x=a.getX(f+2);s=VS(this,r,e,vg,l,c,m,v,x),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],g=r[f.materialIndex],m=Math.max(f.start,h.start),v=Math.min(o.count,Math.min(f.start+f.count,h.start+h.count));for(let x=m,y=v;x<y;x+=3){let _=x,A=x+1,S=x+2;s=VS(this,g,e,vg,l,c,_,A,S),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let f=d,g=p;f<g;f+=3){let m=f,v=f+1,x=f+2;s=VS(this,r,e,vg,l,c,m,v,x),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}}};function P_e(e,t,i,r,n,s,a,o){let l;if(t.side===Zn?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Ol,o),l===null)return null;zS.copy(o),zS.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(zS);return c<i.near||c>i.far?null:{distance:c,point:zS.clone(),object:e}}function VS(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,Zy),e.getVertexPosition(o,$y),e.getVertexPosition(l,e1);let c=P_e(e,t,i,r,Zy,$y,e1,sR);if(c){n&&(NS.fromBufferAttribute(n,a),US.fromBufferAttribute(n,o),kS.fromBufferAttribute(n,l),c.uv=ps.getUV(sR,Zy,$y,e1,NS,US,kS,new pe)),s&&(NS.fromBufferAttribute(s,a),US.fromBufferAttribute(s,o),kS.fromBufferAttribute(s,l),c.uv2=ps.getUV(sR,Zy,$y,e1,NS,US,kS,new pe));let u={a,b:o,c:l,normal:new F,materialIndex:0};ps.getNormal(Zy,$y,e1,u.normal),c.face=u}return c}var Fl=class extends Ot{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;p("z","y","x",-1,-1,i,t,e,s,n,0),p("z","y","x",1,-1,i,t,-e,s,n,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new xt(l,3)),this.setAttribute("normal",new xt(c,3)),this.setAttribute("uv",new xt(u,2));function p(f,g,m,v,x,y,_,A,S,C,M){let E=y/S,P=_/C,R=y/2,O=_/2,L=A/2,I=S+1,z=C+1,K=0,Y=0,U=new F;for(let j=0;j<z;j++){let k=j*P-O;for(let q=0;q<I;q++){let W=q*E-R;U[f]=W*v,U[g]=k*x,U[m]=L,l.push(U.x,U.y,U.z),U[f]=0,U[g]=0,U[m]=A>0?1:-1,c.push(U.x,U.y,U.z),u.push(q/S),u.push(1-j/C),K+=1}}for(let j=0;j<C;j++)for(let k=0;k<S;k++){let q=h+k+I*j,W=h+k+I*(j+1),te=h+(k+1)+I*(j+1),G=h+(k+1)+I*j;o.push(q,W,G),o.push(W,te,G),Y+=6}a.addGroup(d,Y,M),d+=Y,h+=K}}static fromJSON(e){return new Fl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function d0(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Js(e){let t={};for(let i=0;i<e.length;i++){let r=d0(e[i]);for(let n in r)t[n]=r[n]}return t}function D_e(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function m$(e){return e.getRenderTarget()===null&&e.outputEncoding===ci?pc:DE}var G0={clone:d0,merge:Js},R_e=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,I_e=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Ri=class extends sb{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=R_e,this.fragmentShader=I_e,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=d0(e.uniforms),this.uniformsGroups=D_e(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},cp=class extends Qi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ot,this.projectionMatrix=new ot,this.projectionMatrixInverse=new ot}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Ls=class extends cp{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=iw*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(ox*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return iw*2*Math.atan(Math.tan(ox*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(ox*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},yg=-90,xg=1,L_e=class extends Qi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Ls(yg,xg,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new Ls(yg,xg,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new Ls(yg,xg,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new Ls(yg,xg,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new Ls(yg,xg,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Ls(yg,xg,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=Rc,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},mU=class extends Br{constructor(e,t,i,r,n,s,a,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:em,super(e,t,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},O_e=class extends Di{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new mU(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:di}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Fl(5,5,5),n=new Ri({name:"CubemapFromEquirect",uniforms:d0(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Zn,blending:xn});n.uniforms.tEquirect.value=t;let s=new cr(r,n),a=t.minFilter;return t.minFilter===h0&&(t.minFilter=di),new L_e(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},aR=new F,B_e=new F,F_e=new gn,ba=class{constructor(e=new F(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=aR.subVectors(i,t).cross(B_e.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(aR),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||F_e.getNormalMatrix(e),r=this.coplanarPoint(aR).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},wg=new Oa,GS=new F,gU=class{constructor(e=new ba,t=new ba,i=new ba,r=new ba,n=new ba,s=new ba){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],g=i[12],m=i[13],v=i[14],x=i[15];return t[0].setComponents(a-r,u-o,f-h,x-g).normalize(),t[1].setComponents(a+r,u+o,f+h,x+g).normalize(),t[2].setComponents(a+n,u+l,f+d,x+m).normalize(),t[3].setComponents(a-n,u-l,f-d,x-m).normalize(),t[4].setComponents(a-s,u-c,f-p,x-v).normalize(),t[5].setComponents(a+s,u+c,f+p,x+v).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),wg.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(wg)}intersectsSprite(e){return wg.center.set(0,0,0),wg.radius=.7071067811865476,wg.applyMatrix4(e.matrixWorld),this.intersectsSphere(wg)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(GS.x=r.normal.x>0?e.max.x:e.min.x,GS.y=r.normal.y>0?e.max.y:e.min.y,GS.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(GS)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function g$(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function N_e(e,t){let i=t.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,d),c.onUploadCallback();let f;if(h instanceof Float32Array)f=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(h instanceof Int16Array)f=5122;else if(h instanceof Uint32Array)f=5125;else if(h instanceof Int32Array)f=5124;else if(h instanceof Int8Array)f=5120;else if(h instanceof Uint8Array)f=5121;else if(h instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:f,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,p=u.updateRange;e.bindBuffer(h,c),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var zc=class extends Ot{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],p=[],f=[],g=[];for(let m=0;m<c;m++){let v=m*h-s;for(let x=0;x<l;x++){let y=x*u-n;p.push(y,-v,0),f.push(0,0,1),g.push(x/a),g.push(1-m/o)}}for(let m=0;m<o;m++)for(let v=0;v<a;v++){let x=v+l*m,y=v+l*(m+1),_=v+1+l*(m+1),A=v+1+l*m;d.push(x,y,A),d.push(y,_,A)}this.setIndex(d),this.setAttribute("position",new xt(p,3)),this.setAttribute("normal",new xt(f,3)),this.setAttribute("uv",new xt(g,2))}static fromJSON(e){return new zc(e.width,e.height,e.widthSegments,e.heightSegments)}},U_e=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,k_e=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,z_e=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,V_e=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,G_e=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,H_e=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,j_e="vec3 transformed = vec3( position );",W_e=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,X_e=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Y_e=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,q_e=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Q_e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,J_e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,K_e=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Z_e=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,$_e=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,eSe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,tSe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,iSe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,rSe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,nSe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,sSe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,aSe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,oSe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,lSe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,cSe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,uSe="gl_FragColor = linearToOutputTexel( gl_FragColor );",hSe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,dSe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,pSe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,fSe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,mSe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,gSe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,vSe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,ySe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,xSe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,wSe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,bSe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,_Se=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,SSe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ASe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,MSe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,ESe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,CSe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,TSe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,PSe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,DSe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,RSe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ISe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,LSe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,OSe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,BSe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,FSe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,NSe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,USe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,kSe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,zSe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,VSe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,GSe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,HSe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,jSe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,WSe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,XSe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,YSe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,qSe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,QSe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,JSe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,KSe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,ZSe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,$Se=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,eAe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,tAe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,iAe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,rAe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,nAe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,sAe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,aAe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,oAe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,lAe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,cAe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,uAe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,hAe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dAe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,pAe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,fAe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,mAe=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,gAe=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,vAe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,yAe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,xAe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,wAe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,bAe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,_Ae=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,SAe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,AAe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,MAe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,EAe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,CAe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,TAe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,PAe=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,DAe=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,RAe=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,IAe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,LAe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,OAe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,BAe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,FAe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,NAe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,UAe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,kAe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,zAe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,VAe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,GAe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,HAe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,jAe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,WAe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,XAe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,YAe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,qAe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,QAe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,JAe=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,KAe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZAe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$Ae=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eMe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,tMe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iMe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,rMe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,nMe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sMe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aMe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,oMe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lMe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cMe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uMe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,hMe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,dMe=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pMe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,fMe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mMe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ui={alphamap_fragment:U_e,alphamap_pars_fragment:k_e,alphatest_fragment:z_e,alphatest_pars_fragment:V_e,aomap_fragment:G_e,aomap_pars_fragment:H_e,begin_vertex:j_e,beginnormal_vertex:W_e,bsdfs:X_e,iridescence_fragment:Y_e,bumpmap_pars_fragment:q_e,clipping_planes_fragment:Q_e,clipping_planes_pars_fragment:J_e,clipping_planes_pars_vertex:K_e,clipping_planes_vertex:Z_e,color_fragment:$_e,color_pars_fragment:eSe,color_pars_vertex:tSe,color_vertex:iSe,common:rSe,cube_uv_reflection_fragment:nSe,defaultnormal_vertex:sSe,displacementmap_pars_vertex:aSe,displacementmap_vertex:oSe,emissivemap_fragment:lSe,emissivemap_pars_fragment:cSe,encodings_fragment:uSe,encodings_pars_fragment:hSe,envmap_fragment:dSe,envmap_common_pars_fragment:pSe,envmap_pars_fragment:fSe,envmap_pars_vertex:mSe,envmap_physical_pars_fragment:CSe,envmap_vertex:gSe,fog_vertex:vSe,fog_pars_vertex:ySe,fog_fragment:xSe,fog_pars_fragment:wSe,gradientmap_pars_fragment:bSe,lightmap_fragment:_Se,lightmap_pars_fragment:SSe,lights_lambert_fragment:ASe,lights_lambert_pars_fragment:MSe,lights_pars_begin:ESe,lights_toon_fragment:TSe,lights_toon_pars_fragment:PSe,lights_phong_fragment:DSe,lights_phong_pars_fragment:RSe,lights_physical_fragment:ISe,lights_physical_pars_fragment:LSe,lights_fragment_begin:OSe,lights_fragment_maps:BSe,lights_fragment_end:FSe,logdepthbuf_fragment:NSe,logdepthbuf_pars_fragment:USe,logdepthbuf_pars_vertex:kSe,logdepthbuf_vertex:zSe,map_fragment:VSe,map_pars_fragment:GSe,map_particle_fragment:HSe,map_particle_pars_fragment:jSe,metalnessmap_fragment:WSe,metalnessmap_pars_fragment:XSe,morphcolor_vertex:YSe,morphnormal_vertex:qSe,morphtarget_pars_vertex:QSe,morphtarget_vertex:JSe,normal_fragment_begin:KSe,normal_fragment_maps:ZSe,normal_pars_fragment:$Se,normal_pars_vertex:eAe,normal_vertex:tAe,normalmap_pars_fragment:iAe,clearcoat_normal_fragment_begin:rAe,clearcoat_normal_fragment_maps:nAe,clearcoat_pars_fragment:sAe,iridescence_pars_fragment:aAe,output_fragment:oAe,packing:lAe,premultiplied_alpha_fragment:cAe,project_vertex:uAe,dithering_fragment:hAe,dithering_pars_fragment:dAe,roughnessmap_fragment:pAe,roughnessmap_pars_fragment:fAe,shadowmap_pars_fragment:mAe,shadowmap_pars_vertex:gAe,shadowmap_vertex:vAe,shadowmask_pars_fragment:yAe,skinbase_vertex:xAe,skinning_pars_vertex:wAe,skinning_vertex:bAe,skinnormal_vertex:_Ae,specularmap_fragment:SAe,specularmap_pars_fragment:AAe,tonemapping_fragment:MAe,tonemapping_pars_fragment:EAe,transmission_fragment:CAe,transmission_pars_fragment:TAe,uv_pars_fragment:PAe,uv_pars_vertex:DAe,uv_vertex:RAe,uv2_pars_fragment:IAe,uv2_pars_vertex:LAe,uv2_vertex:OAe,worldpos_vertex:BAe,background_vert:FAe,background_frag:NAe,backgroundCube_vert:UAe,backgroundCube_frag:kAe,cube_vert:zAe,cube_frag:VAe,depth_vert:GAe,depth_frag:HAe,distanceRGBA_vert:jAe,distanceRGBA_frag:WAe,equirect_vert:XAe,equirect_frag:YAe,linedashed_vert:qAe,linedashed_frag:QAe,meshbasic_vert:JAe,meshbasic_frag:KAe,meshlambert_vert:ZAe,meshlambert_frag:$Ae,meshmatcap_vert:eMe,meshmatcap_frag:tMe,meshnormal_vert:iMe,meshnormal_frag:rMe,meshphong_vert:nMe,meshphong_frag:sMe,meshphysical_vert:aMe,meshphysical_frag:oMe,meshtoon_vert:lMe,meshtoon_frag:cMe,points_vert:uMe,points_frag:hMe,shadow_vert:dMe,shadow_frag:pMe,sprite_vert:fMe,sprite_frag:mMe},vt={common:{diffuse:{value:new jt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new gn},uv2Transform:{value:new gn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new pe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gn}},sprite:{diffuse:{value:new jt(16777215)},opacity:{value:1},center:{value:new pe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gn}}},gc={basic:{uniforms:Js([vt.common,vt.specularmap,vt.envmap,vt.aomap,vt.lightmap,vt.fog]),vertexShader:ui.meshbasic_vert,fragmentShader:ui.meshbasic_frag},lambert:{uniforms:Js([vt.common,vt.specularmap,vt.envmap,vt.aomap,vt.lightmap,vt.emissivemap,vt.bumpmap,vt.normalmap,vt.displacementmap,vt.fog,vt.lights,{emissive:{value:new jt(0)}}]),vertexShader:ui.meshlambert_vert,fragmentShader:ui.meshlambert_frag},phong:{uniforms:Js([vt.common,vt.specularmap,vt.envmap,vt.aomap,vt.lightmap,vt.emissivemap,vt.bumpmap,vt.normalmap,vt.displacementmap,vt.fog,vt.lights,{emissive:{value:new jt(0)},specular:{value:new jt(1118481)},shininess:{value:30}}]),vertexShader:ui.meshphong_vert,fragmentShader:ui.meshphong_frag},standard:{uniforms:Js([vt.common,vt.envmap,vt.aomap,vt.lightmap,vt.emissivemap,vt.bumpmap,vt.normalmap,vt.displacementmap,vt.roughnessmap,vt.metalnessmap,vt.fog,vt.lights,{emissive:{value:new jt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ui.meshphysical_vert,fragmentShader:ui.meshphysical_frag},toon:{uniforms:Js([vt.common,vt.aomap,vt.lightmap,vt.emissivemap,vt.bumpmap,vt.normalmap,vt.displacementmap,vt.gradientmap,vt.fog,vt.lights,{emissive:{value:new jt(0)}}]),vertexShader:ui.meshtoon_vert,fragmentShader:ui.meshtoon_frag},matcap:{uniforms:Js([vt.common,vt.bumpmap,vt.normalmap,vt.displacementmap,vt.fog,{matcap:{value:null}}]),vertexShader:ui.meshmatcap_vert,fragmentShader:ui.meshmatcap_frag},points:{uniforms:Js([vt.points,vt.fog]),vertexShader:ui.points_vert,fragmentShader:ui.points_frag},dashed:{uniforms:Js([vt.common,vt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ui.linedashed_vert,fragmentShader:ui.linedashed_frag},depth:{uniforms:Js([vt.common,vt.displacementmap]),vertexShader:ui.depth_vert,fragmentShader:ui.depth_frag},normal:{uniforms:Js([vt.common,vt.bumpmap,vt.normalmap,vt.displacementmap,{opacity:{value:1}}]),vertexShader:ui.meshnormal_vert,fragmentShader:ui.meshnormal_frag},sprite:{uniforms:Js([vt.sprite,vt.fog]),vertexShader:ui.sprite_vert,fragmentShader:ui.sprite_frag},background:{uniforms:{uvTransform:{value:new gn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ui.background_vert,fragmentShader:ui.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ui.backgroundCube_vert,fragmentShader:ui.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ui.cube_vert,fragmentShader:ui.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ui.equirect_vert,fragmentShader:ui.equirect_frag},distanceRGBA:{uniforms:Js([vt.common,vt.displacementmap,{referencePosition:{value:new F},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ui.distanceRGBA_vert,fragmentShader:ui.distanceRGBA_frag},shadow:{uniforms:Js([vt.lights,vt.fog,{color:{value:new jt(0)},opacity:{value:1}}]),vertexShader:ui.shadow_vert,fragmentShader:ui.shadow_frag}};gc.physical={uniforms:Js([gc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new pe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new jt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new pe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new jt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new jt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ui.meshphysical_vert,fragmentShader:ui.meshphysical_frag};var HS={r:0,b:0,g:0};function gMe(e,t,i,r,n,s,a){let o=new jt(0),l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(m,v){let x=!1,y=v.isScene===!0?v.background:null;y&&y.isTexture&&(y=(v.backgroundBlurriness>0?i:t).get(y));let _=e.xr,A=_.getSession&&_.getSession();A&&A.environmentBlendMode==="additive"&&(y=null),y===null?g(o,l):y&&y.isColor&&(g(y,1),x=!0),(e.autoClear||x)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===nb)?(u===void 0&&(u=new cr(new Fl(1,1,1),new Ri({name:"BackgroundCubeMaterial",uniforms:d0(gc.backgroundCube.uniforms),vertexShader:gc.backgroundCube.vertexShader,fragmentShader:gc.backgroundCube.fragmentShader,side:Zn,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,C,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=y,u.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,u.material.toneMapped=y.encoding!==ci,(h!==y||d!==y.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):y&&y.isTexture&&(c===void 0&&(c=new cr(new zc(2,2),new Ri({name:"BackgroundMaterial",uniforms:d0(gc.background.uniforms),vertexShader:gc.background.vertexShader,fragmentShader:gc.background.fragmentShader,side:Ol,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=y,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=y.encoding!==ci,y.matrixAutoUpdate===!0&&y.updateMatrix(),c.material.uniforms.uvTransform.value.copy(y.matrix),(h!==y||d!==y.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function g(m,v){m.getRGB(HS,m$(e)),r.buffers.color.setClear(HS.r,HS.g,HS.b,v,a)}return{getClearColor:function(){return o},setClearColor:function(m,v=1){o.set(m),l=v,g(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,g(o,l)},render:f}}function vMe(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=m(null),c=l,u=!1;function h(I,z,K,Y,U){let j=!1;if(a){let k=g(Y,K,z);c!==k&&(c=k,p(c.object)),j=v(I,Y,K,U),j&&x(I,Y,K,U)}else{let k=z.wireframe===!0;(c.geometry!==Y.id||c.program!==K.id||c.wireframe!==k)&&(c.geometry=Y.id,c.program=K.id,c.wireframe=k,j=!0)}U!==null&&i.update(U,34963),(j||u)&&(u=!1,M(I,z,K,Y),U!==null&&e.bindBuffer(34963,i.get(U).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(I){return r.isWebGL2?e.bindVertexArray(I):s.bindVertexArrayOES(I)}function f(I){return r.isWebGL2?e.deleteVertexArray(I):s.deleteVertexArrayOES(I)}function g(I,z,K){let Y=K.wireframe===!0,U=o[I.id];U===void 0&&(U={},o[I.id]=U);let j=U[z.id];j===void 0&&(j={},U[z.id]=j);let k=j[Y];return k===void 0&&(k=m(d()),j[Y]=k),k}function m(I){let z=[],K=[],Y=[];for(let U=0;U<n;U++)z[U]=0,K[U]=0,Y[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:K,attributeDivisors:Y,object:I,attributes:{},index:null}}function v(I,z,K,Y){let U=c.attributes,j=z.attributes,k=0,q=K.getAttributes();for(let W in q)if(q[W].location>=0){let te=U[W],G=j[W];if(G===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(G=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(G=I.instanceColor)),te===void 0||te.attribute!==G||G&&te.data!==G.data)return!0;k++}return c.attributesNum!==k||c.index!==Y}function x(I,z,K,Y){let U={},j=z.attributes,k=0,q=K.getAttributes();for(let W in q)if(q[W].location>=0){let te=j[W];te===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(te=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(te=I.instanceColor));let G={};G.attribute=te,te&&te.data&&(G.data=te.data),U[W]=G,k++}c.attributes=U,c.attributesNum=k,c.index=Y}function y(){let I=c.newAttributes;for(let z=0,K=I.length;z<K;z++)I[z]=0}function _(I){A(I,0)}function A(I,z){let K=c.newAttributes,Y=c.enabledAttributes,U=c.attributeDivisors;K[I]=1,Y[I]===0&&(e.enableVertexAttribArray(I),Y[I]=1),U[I]!==z&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,z),U[I]=z)}function S(){let I=c.newAttributes,z=c.enabledAttributes;for(let K=0,Y=z.length;K<Y;K++)z[K]!==I[K]&&(e.disableVertexAttribArray(K),z[K]=0)}function C(I,z,K,Y,U,j){r.isWebGL2===!0&&(K===5124||K===5125)?e.vertexAttribIPointer(I,z,K,U,j):e.vertexAttribPointer(I,z,K,Y,U,j)}function M(I,z,K,Y){if(r.isWebGL2===!1&&(I.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;y();let U=Y.attributes,j=K.getAttributes(),k=z.defaultAttributeValues;for(let q in j){let W=j[q];if(W.location>=0){let te=U[q];if(te===void 0&&(q==="instanceMatrix"&&I.instanceMatrix&&(te=I.instanceMatrix),q==="instanceColor"&&I.instanceColor&&(te=I.instanceColor)),te!==void 0){let G=te.normalized,le=te.itemSize,Z=i.get(te);if(Z===void 0)continue;let he=Z.buffer,ye=Z.type,de=Z.bytesPerElement;if(te.isInterleavedBufferAttribute){let xe=te.data,me=xe.stride,ee=te.offset;if(xe.isInstancedInterleavedBuffer){for(let we=0;we<W.locationSize;we++)A(W.location+we,xe.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let we=0;we<W.locationSize;we++)_(W.location+we);e.bindBuffer(34962,he);for(let we=0;we<W.locationSize;we++)C(W.location+we,le/W.locationSize,ye,G,me*de,(ee+le/W.locationSize*we)*de)}else{if(te.isInstancedBufferAttribute){for(let xe=0;xe<W.locationSize;xe++)A(W.location+xe,te.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let xe=0;xe<W.locationSize;xe++)_(W.location+xe);e.bindBuffer(34962,he);for(let xe=0;xe<W.locationSize;xe++)C(W.location+xe,le/W.locationSize,ye,G,le*de,le/W.locationSize*xe*de)}}else if(k!==void 0){let G=k[q];if(G!==void 0)switch(G.length){case 2:e.vertexAttrib2fv(W.location,G);break;case 3:e.vertexAttrib3fv(W.location,G);break;case 4:e.vertexAttrib4fv(W.location,G);break;default:e.vertexAttrib1fv(W.location,G)}}}}S()}function E(){O();for(let I in o){let z=o[I];for(let K in z){let Y=z[K];for(let U in Y)f(Y[U].object),delete Y[U];delete z[K]}delete o[I]}}function P(I){if(o[I.id]===void 0)return;let z=o[I.id];for(let K in z){let Y=z[K];for(let U in Y)f(Y[U].object),delete Y[U];delete z[K]}delete o[I.id]}function R(I){for(let z in o){let K=o[z];if(K[I.id]===void 0)continue;let Y=K[I.id];for(let U in Y)f(Y[U].object),delete Y[U];delete K[I.id]}}function O(){L(),u=!0,c!==l&&(c=l,p(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:O,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:P,releaseStatesOfProgram:R,initAttributes:y,enableAttribute:_,disableUnusedAttributes:S}}function yMe(e,t,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function xMe(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let C=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(C){if(C==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";C="mediump"}return C==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),g=e.getParameter(34921),m=e.getParameter(36347),v=e.getParameter(36348),x=e.getParameter(36349),y=d>0,_=a||t.has("OES_texture_float"),A=y&&_,S=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:g,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:x,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:A,maxSamples:S}}function wMe(e){let t=this,i=null,r=0,n=!1,s=!1,a=new ba,o=new gn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){let f=h.clippingPlanes,g=h.clipIntersection,m=h.clipShadows,v=e.get(h);if(!n||f===null||f.length===0||s&&!m)s?u(null):c();else{let x=s?0:r,y=x*4,_=v.clippingState||null;l.value=_,_=u(f,d,y,p);for(let A=0;A!==y;++A)_[A]=i[A];v.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){let g=h!==null?h.length:0,m=null;if(g!==0){if(m=l.value,f!==!0||m===null){let v=p+g*4,x=d.matrixWorldInverse;o.getNormalMatrix(x),(m===null||m.length<v)&&(m=new Float32Array(v));for(let y=0,_=p;y!==g;++y,_+=4)a.copy(h[y]).applyMatrix4(x,o),a.normal.toArray(m,_),m[_+3]=a.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,m}}function bMe(e){let t=new WeakMap;function i(a,o){return o===zL?a.mapping=em:o===VL&&(a.mapping=tm),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===zL||o===VL)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new O_e(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var bT=class extends cp{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},xv=4,Wj=[.125,.215,.35,.446,.526,.582],tf=20,oR=new bT,Xj=new jt,lR=null,Qp=(1+Math.sqrt(5))/2,bg=1/Qp,Yj=[new F(1,1,1),new F(-1,1,1),new F(1,1,-1),new F(-1,1,-1),new F(0,Qp,bg),new F(0,Qp,-bg),new F(bg,0,Qp),new F(-bg,0,Qp),new F(Qp,bg,0),new F(-Qp,bg,0)],qj=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){lR=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Kj(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Jj(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(lR),e.scissorTest=!1,jS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===em||e.mapping===tm?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),lR=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:di,minFilter:di,generateMipmaps:!1,type:nh,format:Er,encoding:Bl,depthBuffer:!1},r=Qj(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Qj(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_Me(n)),this._blurMaterial=SMe(n,e,t)}return r}_compileMaterial(e){let t=new cr(this._lodPlanes[0],e);this._renderer.compile(t,oR)}_sceneToCubeUV(e,t,i,r){let n=new Ls(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Xj),o.toneMapping=Rc,o.autoClear=!1;let u=new sh({name:"PMREM.Background",side:Zn,depthWrite:!1,depthTest:!1}),h=new cr(new Fl,u),d=!1,p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(Xj),d=!0);for(let f=0;f<6;f++){let g=f%3;g===0?(n.up.set(0,s[f],0),n.lookAt(a[f],0,0)):g===1?(n.up.set(0,0,s[f]),n.lookAt(0,a[f],0)):(n.up.set(0,s[f],0),n.lookAt(0,0,a[f]));let m=this._cubeSize;jS(r,g*m,f>2?m:0,m,m),o.setRenderTarget(r),d&&o.render(h,n),o.render(e,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===em||e.mapping===tm;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Kj()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Jj());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new cr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;jS(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,oR)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=Yj[(r-1)%Yj.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new cr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*tf-1),f=n/p,g=isFinite(n)?1+Math.floor(c*f):tf;g>tf&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${tf}`);let m=[],v=0;for(let S=0;S<tf;++S){let C=S/f,M=Math.exp(-C*C/2);m.push(M),S===0?v+=M:S<g&&(v+=2*M)}for(let S=0;S<m.length;S++)m[S]=m[S]/v;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=m,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:x}=this;h.dTheta.value=p,h.mipInt.value=x-i;let y=this._sizeLods[r],_=3*y*(r>x-xv?r-x+xv:0),A=4*(this._cubeSize-y);jS(t,_,A,3*y,2*y),o.setRenderTarget(t),o.render(u,oR)}};function _Me(e){let t=[],i=[],r=[],n=e,s=e-xv+1+Wj.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-xv?l=Wj[a-e+xv-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,g=3,m=2,v=1,x=new Float32Array(g*f*p),y=new Float32Array(m*f*p),_=new Float32Array(v*f*p);for(let S=0;S<p;S++){let C=S%3*2/3-1,M=S>2?0:-1,E=[C,M,0,C+2/3,M,0,C+2/3,M+1,0,C,M,0,C+2/3,M+1,0,C,M+1,0];x.set(E,g*f*S),y.set(d,m*f*S);let P=[S,S,S,S,S,S];_.set(P,v*f*S)}let A=new Ot;A.setAttribute("position",new Wt(x,g)),A.setAttribute("uv",new Wt(y,m)),A.setAttribute("faceIndex",new Wt(_,v)),t.push(A),n>xv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function Qj(e,t,i){let r=new Di(e,t,i);return r.texture.mapping=nb,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function jS(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function SMe(e,t,i){let r=new Float32Array(tf),n=new F(0,1,0);return new Ri({name:"SphericalGaussianBlur",defines:{n:tf,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:vU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:xn,depthTest:!1,depthWrite:!1})}function Jj(){return new Ri({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:vU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:xn,depthTest:!1,depthWrite:!1})}function Kj(){return new Ri({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:vU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:xn,depthTest:!1,depthWrite:!1})}function vU(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function AMe(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===zL||l===VL,u=l===em||l===tm;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new qj(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new qj(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function MMe(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function EMe(e,t,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",a),delete n[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let f in d)t.update(d[f],34962);let p=h.morphAttributes;for(let f in p){let g=p[f];for(let m=0,v=g.length;m<v;m++)t.update(g[m],34962)}}function c(h){let d=[],p=h.index,f=h.attributes.position,g=0;if(p!==null){let x=p.array;g=p.version;for(let y=0,_=x.length;y<_;y+=3){let A=x[y+0],S=x[y+1],C=x[y+2];d.push(A,S,S,C,C,A)}}else{let x=f.array;g=f.version;for(let y=0,_=x.length/3-1;y<_;y+=3){let A=y+0,S=y+1,C=y+2;d.push(A,S,S,C,C,A)}}let m=new(l$(d)?Bv:f$)(d,1);m.version=g;let v=s.get(h);v&&t.remove(v),s.set(h,m)}function u(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function CMe(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,f){if(f===0)return;let g,m;if(n)g=e,m="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[m](s,p,o,d*l,f),i.update(p,s,f)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function TMe(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function PMe(e,t){return e[0]-t[0]}function DMe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function RMe(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new ii,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(t.isWebGL2===!0){let f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=f!==void 0?f.length:0,m=s.get(u);if(m===void 0||m.count!==g){let y=function(){I.dispose(),s.delete(u),u.removeEventListener("dispose",y)};m!==void 0&&m.texture.dispose();let _=u.morphAttributes.position!==void 0,A=u.morphAttributes.normal!==void 0,S=u.morphAttributes.color!==void 0,C=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],E=u.morphAttributes.color||[],P=0;_===!0&&(P=1),A===!0&&(P=2),S===!0&&(P=3);let R=u.attributes.position.count*P,O=1;R>t.maxTextureSize&&(O=Math.ceil(R/t.maxTextureSize),R=t.maxTextureSize);let L=new Float32Array(R*O*4*g),I=new d$(L,R,O,g);I.type=Ki,I.needsUpdate=!0;let z=P*4;for(let K=0;K<g;K++){let Y=C[K],U=M[K],j=E[K],k=R*O*4*K;for(let q=0;q<Y.count;q++){let W=q*z;_===!0&&(a.fromBufferAttribute(Y,q),L[k+W+0]=a.x,L[k+W+1]=a.y,L[k+W+2]=a.z,L[k+W+3]=0),A===!0&&(a.fromBufferAttribute(U,q),L[k+W+4]=a.x,L[k+W+5]=a.y,L[k+W+6]=a.z,L[k+W+7]=0),S===!0&&(a.fromBufferAttribute(j,q),L[k+W+8]=a.x,L[k+W+9]=a.y,L[k+W+10]=a.z,L[k+W+11]=j.itemSize===4?a.w:1)}}m={count:g,texture:I,size:new pe(R,O)},s.set(u,m),u.addEventListener("dispose",y)}let v=0;for(let y=0;y<p.length;y++)v+=p[y];let x=u.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",m.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",m.size)}else{let f=p===void 0?0:p.length,g=r[u.id];if(g===void 0||g.length!==f){g=[];for(let _=0;_<f;_++)g[_]=[_,0];r[u.id]=g}for(let _=0;_<f;_++){let A=g[_];A[0]=_,A[1]=p[_]}g.sort(DMe);for(let _=0;_<8;_++)_<f&&g[_][1]?(o[_][0]=g[_][0],o[_][1]=g[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(PMe);let m=u.morphAttributes.position,v=u.morphAttributes.normal,x=0;for(let _=0;_<8;_++){let A=o[_],S=A[0],C=A[1];S!==Number.MAX_SAFE_INTEGER&&C?(m&&u.getAttribute("morphTarget"+_)!==m[S]&&u.setAttribute("morphTarget"+_,m[S]),v&&u.getAttribute("morphNormal"+_)!==v[S]&&u.setAttribute("morphNormal"+_,v[S]),n[_]=C,x+=C):(m&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),v&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),n[_]=0)}let y=u.morphTargetsRelative?1:1-x;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function IMe(e,t,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=t.get(l,u);return n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var v$=new Br,y$=new d$,x$=new x_e,w$=new mU,Zj=[],$j=[],e6=new Float32Array(16),t6=new Float32Array(9),i6=new Float32Array(4);function H0(e,t,i){let r=e[0];if(r==null||r<=0||r>0)return e;let n=t*i,s=Zj[n];if(s===void 0&&(s=new Float32Array(n),Zj[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Fn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Nn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function _T(e,t){let i=$j[t];i===void 0&&(i=new Int32Array(t),$j[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function LMe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function OMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Fn(i,t))return;e.uniform2fv(this.addr,t),Nn(i,t)}}function BMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Fn(i,t))return;e.uniform3fv(this.addr,t),Nn(i,t)}}function FMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Fn(i,t))return;e.uniform4fv(this.addr,t),Nn(i,t)}}function NMe(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Fn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Nn(i,t)}else{if(Fn(i,r))return;i6.set(r),e.uniformMatrix2fv(this.addr,!1,i6),Nn(i,r)}}function UMe(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Fn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Nn(i,t)}else{if(Fn(i,r))return;t6.set(r),e.uniformMatrix3fv(this.addr,!1,t6),Nn(i,r)}}function kMe(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Fn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Nn(i,t)}else{if(Fn(i,r))return;e6.set(r),e.uniformMatrix4fv(this.addr,!1,e6),Nn(i,r)}}function zMe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function VMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Fn(i,t))return;e.uniform2iv(this.addr,t),Nn(i,t)}}function GMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Fn(i,t))return;e.uniform3iv(this.addr,t),Nn(i,t)}}function HMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Fn(i,t))return;e.uniform4iv(this.addr,t),Nn(i,t)}}function jMe(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function WMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Fn(i,t))return;e.uniform2uiv(this.addr,t),Nn(i,t)}}function XMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Fn(i,t))return;e.uniform3uiv(this.addr,t),Nn(i,t)}}function YMe(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Fn(i,t))return;e.uniform4uiv(this.addr,t),Nn(i,t)}}function qMe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||v$,n)}function QMe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||x$,n)}function JMe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||w$,n)}function KMe(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||y$,n)}function ZMe(e){switch(e){case 5126:return LMe;case 35664:return OMe;case 35665:return BMe;case 35666:return FMe;case 35674:return NMe;case 35675:return UMe;case 35676:return kMe;case 5124:case 35670:return zMe;case 35667:case 35671:return VMe;case 35668:case 35672:return GMe;case 35669:case 35673:return HMe;case 5125:return jMe;case 36294:return WMe;case 36295:return XMe;case 36296:return YMe;case 35678:case 36198:case 36298:case 36306:case 35682:return qMe;case 35679:case 36299:case 36307:return QMe;case 35680:case 36300:case 36308:case 36293:return JMe;case 36289:case 36303:case 36311:case 36292:return KMe}}function $Me(e,t){e.uniform1fv(this.addr,t)}function eEe(e,t){let i=H0(t,this.size,2);e.uniform2fv(this.addr,i)}function tEe(e,t){let i=H0(t,this.size,3);e.uniform3fv(this.addr,i)}function iEe(e,t){let i=H0(t,this.size,4);e.uniform4fv(this.addr,i)}function rEe(e,t){let i=H0(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function nEe(e,t){let i=H0(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function sEe(e,t){let i=H0(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function aEe(e,t){e.uniform1iv(this.addr,t)}function oEe(e,t){e.uniform2iv(this.addr,t)}function lEe(e,t){e.uniform3iv(this.addr,t)}function cEe(e,t){e.uniform4iv(this.addr,t)}function uEe(e,t){e.uniform1uiv(this.addr,t)}function hEe(e,t){e.uniform2uiv(this.addr,t)}function dEe(e,t){e.uniform3uiv(this.addr,t)}function pEe(e,t){e.uniform4uiv(this.addr,t)}function fEe(e,t,i){let r=this.cache,n=t.length,s=_T(i,n);Fn(r,s)||(e.uniform1iv(this.addr,s),Nn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||v$,s[a])}function mEe(e,t,i){let r=this.cache,n=t.length,s=_T(i,n);Fn(r,s)||(e.uniform1iv(this.addr,s),Nn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||x$,s[a])}function gEe(e,t,i){let r=this.cache,n=t.length,s=_T(i,n);Fn(r,s)||(e.uniform1iv(this.addr,s),Nn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||w$,s[a])}function vEe(e,t,i){let r=this.cache,n=t.length,s=_T(i,n);Fn(r,s)||(e.uniform1iv(this.addr,s),Nn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||y$,s[a])}function yEe(e){switch(e){case 5126:return $Me;case 35664:return eEe;case 35665:return tEe;case 35666:return iEe;case 35674:return rEe;case 35675:return nEe;case 35676:return sEe;case 5124:case 35670:return aEe;case 35667:case 35671:return oEe;case 35668:case 35672:return lEe;case 35669:case 35673:return cEe;case 5125:return uEe;case 36294:return hEe;case 36295:return dEe;case 36296:return pEe;case 35678:case 36198:case 36298:case 36306:case 35682:return fEe;case 35679:case 36299:case 36307:return mEe;case 35680:case 36300:case 36308:case 36293:return gEe;case 36289:case 36303:case 36311:case 36292:return vEe}}var xEe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=ZMe(t.type)}},wEe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=yEe(t.type)}},bEe=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},cR=/(\w+)(\])?(\[|\.)?/g;function r6(e,t){e.seq.push(t),e.map[t.id]=t}function _Ee(e,t,i){let r=e.name,n=r.length;for(cR.lastIndex=0;;){let s=cR.exec(r),a=cR.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){r6(i,c===void 0?new xEe(o,e,t):new wEe(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new bEe(o),r6(i,u)),i=u}}}var SM=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);_Ee(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function n6(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var SEe=0;function AEe(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function MEe(e){switch(e){case Bl:return["Linear","( value )"];case ci:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function s6(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+AEe(e.getShaderSource(t),a)}else return n}function EEe(e,t){let i=MEe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function CEe(e,t){let i;switch(t){case Obe:i="Linear";break;case Bbe:i="Reinhard";break;case Fbe:i="OptimizedCineon";break;case Nbe:i="ACESFilmic";break;case Ube:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function TEe(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(O1).join(`
`)}function PEe(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function DEe(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function O1(e){return e!==""}function a6(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function o6(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var REe=/^[ \t]*#include +<([\w\d./]+)>/gm;function YL(e){return e.replace(REe,IEe)}function IEe(e,t){let i=ui[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return YL(i)}var LEe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function l6(e){return e.replace(LEe,OEe)}function OEe(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function c6(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function BEe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===uU?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===dbe?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===L1&&(t="SHADOWMAP_TYPE_VSM"),t}function FEe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case em:case tm:t="ENVMAP_TYPE_CUBE";break;case nb:t="ENVMAP_TYPE_CUBE_UV";break}return t}function NEe(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case tm:t="ENVMAP_MODE_REFRACTION";break}return t}function UEe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case e$:t="ENVMAP_BLENDING_MULTIPLY";break;case Ibe:t="ENVMAP_BLENDING_MIX";break;case Lbe:t="ENVMAP_BLENDING_ADD";break}return t}function kEe(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function zEe(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=BEe(i),c=FEe(i),u=NEe(i),h=UEe(i),d=kEe(i),p=i.isWebGL2?"":TEe(i),f=PEe(s),g=n.createProgram(),m,v,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=[f].filter(O1).join(`
`),m.length>0&&(m+=`
`),v=[p,f].filter(O1).join(`
`),v.length>0&&(v+=`
`)):(m=[c6(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(O1).join(`
`),v=[p,c6(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Rc?"#define TONE_MAPPING":"",i.toneMapping!==Rc?ui.tonemapping_pars_fragment:"",i.toneMapping!==Rc?CEe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ui.encodings_pars_fragment,EEe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(O1).join(`
`)),a=YL(a),a=a6(a,i),a=o6(a,i),o=YL(o),o=a6(o,i),o=o6(o,i),a=l6(a),o=l6(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",i.glslVersion===jL?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===jL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let y=x+m+a,_=x+v+o,A=n6(n,35633,y),S=n6(n,35632,_);if(n.attachShader(g,A),n.attachShader(g,S),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),e.debug.checkShaderErrors){let E=n.getProgramInfoLog(g).trim(),P=n.getShaderInfoLog(A).trim(),R=n.getShaderInfoLog(S).trim(),O=!0,L=!0;if(n.getProgramParameter(g,35714)===!1){O=!1;let I=s6(n,A,"vertex"),z=s6(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,35715)+`

Program Info Log: `+E+`
`+I+`
`+z)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(P===""||R==="")&&(L=!1);L&&(this.diagnostics={runnable:O,programLog:E,vertexShader:{log:P,prefix:m},fragmentShader:{log:R,prefix:v}})}n.deleteShader(A),n.deleteShader(S);let C;this.getUniforms=function(){return C===void 0&&(C=new SM(n,g)),C};let M;return this.getAttributes=function(){return M===void 0&&(M=DEe(n,g)),M},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=SEe++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=A,this.fragmentShader=S,this}var VEe=0,GEe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new HEe(e),t.set(e,i)),i}},HEe=class{constructor(e){this.id=VEe++,this.code=e,this.usedTimes=0}};function jEe(e,t,i,r,n,s,a){let o=new fU,l=new GEe,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(M,E,P,R,O){let L=R.fog,I=O.geometry,z=M.isMeshStandardMaterial?R.environment:null,K=(M.isMeshStandardMaterial?i:t).get(M.envMap||z),Y=K&&K.mapping===nb?K.image.height:null,U=f[M.type];M.precision!==null&&(p=n.getMaxPrecision(M.precision),p!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",p,"instead."));let j=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,k=j!==void 0?j.length:0,q=0;I.morphAttributes.position!==void 0&&(q=1),I.morphAttributes.normal!==void 0&&(q=2),I.morphAttributes.color!==void 0&&(q=3);let W,te,G,le;if(U){let xe=gc[U];W=xe.vertexShader,te=xe.fragmentShader}else W=M.vertexShader,te=M.fragmentShader,l.update(M),G=l.getVertexShaderID(M),le=l.getFragmentShaderID(M);let Z=e.getRenderTarget(),he=M.alphaTest>0,ye=M.clearcoat>0,de=M.iridescence>0;return{isWebGL2:u,shaderID:U,shaderName:M.type,vertexShader:W,fragmentShader:te,defines:M.defines,customVertexShaderID:G,customFragmentShaderID:le,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:p,instancing:O.isInstancedMesh===!0,instancingColor:O.isInstancedMesh===!0&&O.instanceColor!==null,supportsVertexTextures:d,outputEncoding:Z===null?e.outputEncoding:Z.isXRRenderTarget===!0?Z.texture.encoding:Bl,map:!!M.map,matcap:!!M.matcap,envMap:!!K,envMapMode:K&&K.mapping,envMapCubeUVHeight:Y,lightMap:!!M.lightMap,aoMap:!!M.aoMap,emissiveMap:!!M.emissiveMap,bumpMap:!!M.bumpMap,normalMap:!!M.normalMap,objectSpaceNormalMap:M.normalMapType===e_e,tangentSpaceNormalMap:M.normalMapType===$be,decodeVideoTexture:!!M.map&&M.map.isVideoTexture===!0&&M.map.encoding===ci,clearcoat:ye,clearcoatMap:ye&&!!M.clearcoatMap,clearcoatRoughnessMap:ye&&!!M.clearcoatRoughnessMap,clearcoatNormalMap:ye&&!!M.clearcoatNormalMap,iridescence:de,iridescenceMap:de&&!!M.iridescenceMap,iridescenceThicknessMap:de&&!!M.iridescenceThicknessMap,displacementMap:!!M.displacementMap,roughnessMap:!!M.roughnessMap,metalnessMap:!!M.metalnessMap,specularMap:!!M.specularMap,specularIntensityMap:!!M.specularIntensityMap,specularColorMap:!!M.specularColorMap,opaque:M.transparent===!1&&M.blending===Bf,alphaMap:!!M.alphaMap,alphaTest:he,gradientMap:!!M.gradientMap,sheen:M.sheen>0,sheenColorMap:!!M.sheenColorMap,sheenRoughnessMap:!!M.sheenRoughnessMap,transmission:M.transmission>0,transmissionMap:!!M.transmissionMap,thicknessMap:!!M.thicknessMap,combine:M.combine,vertexTangents:!!M.normalMap&&!!I.attributes.tangent,vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!I.attributes.color&&I.attributes.color.itemSize===4,vertexUvs:!!M.map||!!M.bumpMap||!!M.normalMap||!!M.specularMap||!!M.alphaMap||!!M.emissiveMap||!!M.roughnessMap||!!M.metalnessMap||!!M.clearcoatMap||!!M.clearcoatRoughnessMap||!!M.clearcoatNormalMap||!!M.iridescenceMap||!!M.iridescenceThicknessMap||!!M.displacementMap||!!M.transmissionMap||!!M.thicknessMap||!!M.specularIntensityMap||!!M.specularColorMap||!!M.sheenColorMap||!!M.sheenRoughnessMap,uvsVertexOnly:!(M.map||M.bumpMap||M.normalMap||M.specularMap||M.alphaMap||M.emissiveMap||M.roughnessMap||M.metalnessMap||M.clearcoatNormalMap||M.iridescenceMap||M.iridescenceThicknessMap||M.transmission>0||M.transmissionMap||M.thicknessMap||M.specularIntensityMap||M.specularColorMap||M.sheen>0||M.sheenColorMap||M.sheenRoughnessMap)&&!!M.displacementMap,fog:!!L,useFog:M.fog===!0,fogExp2:L&&L.isFogExp2,flatShading:!!M.flatShading,sizeAttenuation:M.sizeAttenuation,logarithmicDepthBuffer:h,skinning:O.isSkinnedMesh===!0,morphTargets:I.morphAttributes.position!==void 0,morphNormals:I.morphAttributes.normal!==void 0,morphColors:I.morphAttributes.color!==void 0,morphTargetsCount:k,morphTextureStride:q,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:M.dithering,shadowMapEnabled:e.shadowMap.enabled&&P.length>0,shadowMapType:e.shadowMap.type,toneMapping:M.toneMapped?e.toneMapping:Rc,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Bs,flipSided:M.side===Zn,useDepthPacking:!!M.depthPacking,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionDerivatives:M.extensions&&M.extensions.derivatives,extensionFragDepth:M.extensions&&M.extensions.fragDepth,extensionDrawBuffers:M.extensions&&M.extensions.drawBuffers,extensionShaderTextureLOD:M.extensions&&M.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:M.customProgramCacheKey()}}function m(M){let E=[];if(M.shaderID?E.push(M.shaderID):(E.push(M.customVertexShaderID),E.push(M.customFragmentShaderID)),M.defines!==void 0)for(let P in M.defines)E.push(P),E.push(M.defines[P]);return M.isRawShaderMaterial===!1&&(v(E,M),x(E,M),E.push(e.outputEncoding)),E.push(M.customProgramCacheKey),E.join()}function v(M,E){M.push(E.precision),M.push(E.outputEncoding),M.push(E.envMapMode),M.push(E.envMapCubeUVHeight),M.push(E.combine),M.push(E.vertexUvs),M.push(E.fogExp2),M.push(E.sizeAttenuation),M.push(E.morphTargetsCount),M.push(E.morphAttributeCount),M.push(E.numDirLights),M.push(E.numPointLights),M.push(E.numSpotLights),M.push(E.numSpotLightMaps),M.push(E.numHemiLights),M.push(E.numRectAreaLights),M.push(E.numDirLightShadows),M.push(E.numPointLightShadows),M.push(E.numSpotLightShadows),M.push(E.numSpotLightShadowsWithMaps),M.push(E.shadowMapType),M.push(E.toneMapping),M.push(E.numClippingPlanes),M.push(E.numClipIntersection),M.push(E.depthPacking)}function x(M,E){o.disableAll(),E.isWebGL2&&o.enable(0),E.supportsVertexTextures&&o.enable(1),E.instancing&&o.enable(2),E.instancingColor&&o.enable(3),E.map&&o.enable(4),E.matcap&&o.enable(5),E.envMap&&o.enable(6),E.lightMap&&o.enable(7),E.aoMap&&o.enable(8),E.emissiveMap&&o.enable(9),E.bumpMap&&o.enable(10),E.normalMap&&o.enable(11),E.objectSpaceNormalMap&&o.enable(12),E.tangentSpaceNormalMap&&o.enable(13),E.clearcoat&&o.enable(14),E.clearcoatMap&&o.enable(15),E.clearcoatRoughnessMap&&o.enable(16),E.clearcoatNormalMap&&o.enable(17),E.iridescence&&o.enable(18),E.iridescenceMap&&o.enable(19),E.iridescenceThicknessMap&&o.enable(20),E.displacementMap&&o.enable(21),E.specularMap&&o.enable(22),E.roughnessMap&&o.enable(23),E.metalnessMap&&o.enable(24),E.gradientMap&&o.enable(25),E.alphaMap&&o.enable(26),E.alphaTest&&o.enable(27),E.vertexColors&&o.enable(28),E.vertexAlphas&&o.enable(29),E.vertexUvs&&o.enable(30),E.vertexTangents&&o.enable(31),E.uvsVertexOnly&&o.enable(32),M.push(o.mask),o.disableAll(),E.fog&&o.enable(0),E.useFog&&o.enable(1),E.flatShading&&o.enable(2),E.logarithmicDepthBuffer&&o.enable(3),E.skinning&&o.enable(4),E.morphTargets&&o.enable(5),E.morphNormals&&o.enable(6),E.morphColors&&o.enable(7),E.premultipliedAlpha&&o.enable(8),E.shadowMapEnabled&&o.enable(9),E.physicallyCorrectLights&&o.enable(10),E.doubleSided&&o.enable(11),E.flipSided&&o.enable(12),E.useDepthPacking&&o.enable(13),E.dithering&&o.enable(14),E.specularIntensityMap&&o.enable(15),E.specularColorMap&&o.enable(16),E.transmission&&o.enable(17),E.transmissionMap&&o.enable(18),E.thicknessMap&&o.enable(19),E.sheen&&o.enable(20),E.sheenColorMap&&o.enable(21),E.sheenRoughnessMap&&o.enable(22),E.decodeVideoTexture&&o.enable(23),E.opaque&&o.enable(24),M.push(o.mask)}function y(M){let E=f[M.type],P;if(E){let R=gc[E];P=G0.clone(R.uniforms)}else P=M.uniforms;return P}function _(M,E){let P;for(let R=0,O=c.length;R<O;R++){let L=c[R];if(L.cacheKey===E){P=L,++P.usedTimes;break}}return P===void 0&&(P=new zEe(e,E,M,s),c.push(P)),P}function A(M){if(--M.usedTimes===0){let E=c.indexOf(M);c[E]=c[c.length-1],c.pop(),M.destroy()}}function S(M){l.remove(M)}function C(){l.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:y,acquireProgram:_,releaseProgram:A,releaseShaderCache:S,programs:c,dispose:C}}function WEe(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function XEe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function u6(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function h6(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,f,g,m){let v=e[t];return v===void 0?(v={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:g,group:m},e[t]=v):(v.id=h.id,v.object=h,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=h.renderOrder,v.z=g,v.group=m),t++,v}function o(h,d,p,f,g,m){let v=a(h,d,p,f,g,m);p.transmission>0?r.push(v):p.transparent===!0?n.push(v):i.push(v)}function l(h,d,p,f,g,m){let v=a(h,d,p,f,g,m);p.transmission>0?r.unshift(v):p.transparent===!0?n.unshift(v):i.unshift(v)}function c(h,d){i.length>1&&i.sort(h||XEe),r.length>1&&r.sort(d||u6),n.length>1&&n.sort(d||u6)}function u(){for(let h=t,d=e.length;h<d;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function YEe(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new h6,e.set(r,[a])):n>=s.length?(a=new h6,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function qEe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new F,color:new jt};break;case"SpotLight":i={position:new F,direction:new F,color:new jt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new F,color:new jt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new F,skyColor:new jt,groundColor:new jt};break;case"RectAreaLight":i={color:new jt,position:new F,halfWidth:new F,halfHeight:new F};break}return e[t.id]=i,i}}}function QEe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pe};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pe};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pe,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var JEe=0;function KEe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function ZEe(e,t){let i=new qEe,r=QEe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new F);let s=new F,a=new ot,o=new ot;function l(u,h){let d=0,p=0,f=0;for(let R=0;R<9;R++)n.probe[R].set(0,0,0);let g=0,m=0,v=0,x=0,y=0,_=0,A=0,S=0,C=0,M=0;u.sort(KEe);let E=h!==!0?Math.PI:1;for(let R=0,O=u.length;R<O;R++){let L=u[R],I=L.color,z=L.intensity,K=L.distance,Y=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)d+=I.r*z*E,p+=I.g*z*E,f+=I.b*z*E;else if(L.isLightProbe)for(let U=0;U<9;U++)n.probe[U].addScaledVector(L.sh.coefficients[U],z);else if(L.isDirectionalLight){let U=i.get(L);if(U.color.copy(L.color).multiplyScalar(L.intensity*E),L.castShadow){let j=L.shadow,k=r.get(L);k.shadowBias=j.bias,k.shadowNormalBias=j.normalBias,k.shadowRadius=j.radius,k.shadowMapSize=j.mapSize,n.directionalShadow[g]=k,n.directionalShadowMap[g]=Y,n.directionalShadowMatrix[g]=L.shadow.matrix,_++}n.directional[g]=U,g++}else if(L.isSpotLight){let U=i.get(L);U.position.setFromMatrixPosition(L.matrixWorld),U.color.copy(I).multiplyScalar(z*E),U.distance=K,U.coneCos=Math.cos(L.angle),U.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),U.decay=L.decay,n.spot[v]=U;let j=L.shadow;if(L.map&&(n.spotLightMap[C]=L.map,C++,j.updateMatrices(L),L.castShadow&&M++),n.spotLightMatrix[v]=j.matrix,L.castShadow){let k=r.get(L);k.shadowBias=j.bias,k.shadowNormalBias=j.normalBias,k.shadowRadius=j.radius,k.shadowMapSize=j.mapSize,n.spotShadow[v]=k,n.spotShadowMap[v]=Y,S++}v++}else if(L.isRectAreaLight){let U=i.get(L);U.color.copy(I).multiplyScalar(z),U.halfWidth.set(L.width*.5,0,0),U.halfHeight.set(0,L.height*.5,0),n.rectArea[x]=U,x++}else if(L.isPointLight){let U=i.get(L);if(U.color.copy(L.color).multiplyScalar(L.intensity*E),U.distance=L.distance,U.decay=L.decay,L.castShadow){let j=L.shadow,k=r.get(L);k.shadowBias=j.bias,k.shadowNormalBias=j.normalBias,k.shadowRadius=j.radius,k.shadowMapSize=j.mapSize,k.shadowCameraNear=j.camera.near,k.shadowCameraFar=j.camera.far,n.pointShadow[m]=k,n.pointShadowMap[m]=Y,n.pointShadowMatrix[m]=L.shadow.matrix,A++}n.point[m]=U,m++}else if(L.isHemisphereLight){let U=i.get(L);U.skyColor.copy(L.color).multiplyScalar(z*E),U.groundColor.copy(L.groundColor).multiplyScalar(z*E),n.hemi[y]=U,y++}}x>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=vt.LTC_FLOAT_1,n.rectAreaLTC2=vt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=vt.LTC_HALF_1,n.rectAreaLTC2=vt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=f;let P=n.hash;(P.directionalLength!==g||P.pointLength!==m||P.spotLength!==v||P.rectAreaLength!==x||P.hemiLength!==y||P.numDirectionalShadows!==_||P.numPointShadows!==A||P.numSpotShadows!==S||P.numSpotMaps!==C)&&(n.directional.length=g,n.spot.length=v,n.rectArea.length=x,n.point.length=m,n.hemi.length=y,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=A,n.pointShadowMap.length=A,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=A,n.spotLightMatrix.length=S+C-M,n.spotLightMap.length=C,n.numSpotLightShadowsWithMaps=M,P.directionalLength=g,P.pointLength=m,P.spotLength=v,P.rectAreaLength=x,P.hemiLength=y,P.numDirectionalShadows=_,P.numPointShadows=A,P.numSpotShadows=S,P.numSpotMaps=C,n.version=JEe++)}function c(u,h){let d=0,p=0,f=0,g=0,m=0,v=h.matrixWorldInverse;for(let x=0,y=u.length;x<y;x++){let _=u[x];if(_.isDirectionalLight){let A=n.directional[d];A.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),d++}else if(_.isSpotLight){let A=n.spot[f];A.position.setFromMatrixPosition(_.matrixWorld),A.position.applyMatrix4(v),A.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(v),f++}else if(_.isRectAreaLight){let A=n.rectArea[g];A.position.setFromMatrixPosition(_.matrixWorld),A.position.applyMatrix4(v),o.identity(),a.copy(_.matrixWorld),a.premultiply(v),o.extractRotation(a),A.halfWidth.set(_.width*.5,0,0),A.halfHeight.set(0,_.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),g++}else if(_.isPointLight){let A=n.point[p];A.position.setFromMatrixPosition(_.matrixWorld),A.position.applyMatrix4(v),p++}else if(_.isHemisphereLight){let A=n.hemi[m];A.direction.setFromMatrixPosition(_.matrixWorld),A.direction.transformDirection(v),m++}}}return{setup:l,setupView:c,state:n}}function d6(e,t){let i=new ZEe(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function $Ee(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new d6(e,t),i.set(s,[l])):a>=o.length?(l=new d6(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var b$=class extends sb{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ph,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},eCe=class extends sb{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new F,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},tCe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,iCe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function rCe(e,t,i){let r=new gU,n=new pe,s=new pe,a=new ii,o=new b$({depthPacking:a$}),l=new eCe,c={},u=i.maxTextureSize,h={[Ol]:Zn,[Zn]:Ol,[Bs]:Bs},d=new Ri({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new pe},radius:{value:4}},vertexShader:tCe,fragmentShader:iCe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Ot;f.setAttribute("position",new Wt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new cr(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=uU,this.render=function(_,A,S){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||_.length===0)return;let C=e.getRenderTarget(),M=e.getActiveCubeFace(),E=e.getActiveMipmapLevel(),P=e.state;P.setBlending(xn),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);for(let R=0,O=_.length;R<O;R++){let L=_[R],I=L.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",L,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;n.copy(I.mapSize);let z=I.getFrameExtents();if(n.multiply(z),s.copy(I.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/z.x),n.x=s.x*z.x,I.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/z.y),n.y=s.y*z.y,I.mapSize.y=s.y)),I.map===null){let Y=this.type!==L1?{minFilter:vi,magFilter:vi}:{};I.map=new Di(n.x,n.y,Y),I.map.texture.name=L.name+".shadowMap",I.camera.updateProjectionMatrix()}e.setRenderTarget(I.map),e.clear();let K=I.getViewportCount();for(let Y=0;Y<K;Y++){let U=I.getViewport(Y);a.set(s.x*U.x,s.y*U.y,s.x*U.z,s.y*U.w),P.viewport(a),I.updateMatrices(L,Y),r=I.getFrustum(),y(A,S,I.camera,L,this.type)}I.isPointLightShadow!==!0&&this.type===L1&&v(I,S),I.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(C,M,E)};function v(_,A){let S=t.update(g);d.defines.VSM_SAMPLES!==_.blurSamples&&(d.defines.VSM_SAMPLES=_.blurSamples,p.defines.VSM_SAMPLES=_.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new Di(n.x,n.y)),d.uniforms.shadow_pass.value=_.map.texture,d.uniforms.resolution.value=_.mapSize,d.uniforms.radius.value=_.radius,e.setRenderTarget(_.mapPass),e.clear(),e.renderBufferDirect(A,null,S,d,g,null),p.uniforms.shadow_pass.value=_.mapPass.texture,p.uniforms.resolution.value=_.mapSize,p.uniforms.radius.value=_.radius,e.setRenderTarget(_.map),e.clear(),e.renderBufferDirect(A,null,S,p,g,null)}function x(_,A,S,C,M,E){let P=null,R=S.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(R!==void 0)P=R;else if(P=S.isPointLight===!0?l:o,e.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0){let O=P.uuid,L=A.uuid,I=c[O];I===void 0&&(I={},c[O]=I);let z=I[L];z===void 0&&(z=P.clone(),I[L]=z),P=z}return P.visible=A.visible,P.wireframe=A.wireframe,E===L1?P.side=A.shadowSide!==null?A.shadowSide:A.side:P.side=A.shadowSide!==null?A.shadowSide:h[A.side],P.alphaMap=A.alphaMap,P.alphaTest=A.alphaTest,P.map=A.map,P.clipShadows=A.clipShadows,P.clippingPlanes=A.clippingPlanes,P.clipIntersection=A.clipIntersection,P.displacementMap=A.displacementMap,P.displacementScale=A.displacementScale,P.displacementBias=A.displacementBias,P.wireframeLinewidth=A.wireframeLinewidth,P.linewidth=A.linewidth,S.isPointLight===!0&&P.isMeshDistanceMaterial===!0&&(P.referencePosition.setFromMatrixPosition(S.matrixWorld),P.nearDistance=C,P.farDistance=M),P}function y(_,A,S,C,M){if(_.visible===!1)return;if(_.layers.test(A.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&M===L1)&&(!_.frustumCulled||r.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,_.matrixWorld);let P=t.update(_),R=_.material;if(Array.isArray(R)){let O=P.groups;for(let L=0,I=O.length;L<I;L++){let z=O[L],K=R[z.materialIndex];if(K&&K.visible){let Y=x(_,K,C,S.near,S.far,M);e.renderBufferDirect(S,null,P,Y,_,z)}}}else if(R.visible){let O=x(_,R,C,S.near,S.far,M);e.renderBufferDirect(S,null,P,O,_,null)}}let E=_.children;for(let P=0,R=E.length;P<R;P++)y(E[P],A,S,C,M)}}function nCe(e,t,i){let r=i.isWebGL2;function n(){let J=!1,be=new ii,ue=null,Ne=new ii(0,0,0,0);return{setMask:function(et){ue!==et&&!J&&(e.colorMask(et,et,et,et),ue=et)},setLocked:function(et){J=et},setClear:function(et,_t,zt,ti,ar){ar===!0&&(et*=ti,_t*=ti,zt*=ti),be.set(et,_t,zt,ti),Ne.equals(be)===!1&&(e.clearColor(et,_t,zt,ti),Ne.copy(be))},reset:function(){J=!1,ue=null,Ne.set(-1,0,0,0)}}}function s(){let J=!1,be=null,ue=null,Ne=null;return{setTest:function(et){et?he(2929):ye(2929)},setMask:function(et){be!==et&&!J&&(e.depthMask(et),be=et)},setFunc:function(et){if(ue!==et){switch(et){case Mbe:e.depthFunc(512);break;case Ebe:e.depthFunc(519);break;case Cbe:e.depthFunc(513);break;case kL:e.depthFunc(515);break;case Tbe:e.depthFunc(514);break;case Pbe:e.depthFunc(518);break;case Dbe:e.depthFunc(516);break;case Rbe:e.depthFunc(517);break;default:e.depthFunc(515)}ue=et}},setLocked:function(et){J=et},setClear:function(et){Ne!==et&&(e.clearDepth(et),Ne=et)},reset:function(){J=!1,be=null,ue=null,Ne=null}}}function a(){let J=!1,be=null,ue=null,Ne=null,et=null,_t=null,zt=null,ti=null,ar=null;return{setTest:function(Ut){J||(Ut?he(2960):ye(2960))},setMask:function(Ut){be!==Ut&&!J&&(e.stencilMask(Ut),be=Ut)},setFunc:function(Ut,Wi,Ai){(ue!==Ut||Ne!==Wi||et!==Ai)&&(e.stencilFunc(Ut,Wi,Ai),ue=Ut,Ne=Wi,et=Ai)},setOp:function(Ut,Wi,Ai){(_t!==Ut||zt!==Wi||ti!==Ai)&&(e.stencilOp(Ut,Wi,Ai),_t=Ut,zt=Wi,ti=Ai)},setLocked:function(Ut){J=Ut},setClear:function(Ut){ar!==Ut&&(e.clearStencil(Ut),ar=Ut)},reset:function(){J=!1,be=null,ue=null,Ne=null,et=null,_t=null,zt=null,ti=null,ar=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},p={},f=new WeakMap,g=[],m=null,v=!1,x=null,y=null,_=null,A=null,S=null,C=null,M=null,E=!1,P=null,R=null,O=null,L=null,I=null,z=e.getParameter(35661),K=!1,Y=0,U=e.getParameter(7938);U.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(U)[1]),K=Y>=1):U.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),K=Y>=2);let j=null,k={},q=e.getParameter(3088),W=e.getParameter(2978),te=new ii().fromArray(q),G=new ii().fromArray(W);function le(J,be,ue){let Ne=new Uint8Array(4),et=e.createTexture();e.bindTexture(J,et),e.texParameteri(J,10241,9728),e.texParameteri(J,10240,9728);for(let _t=0;_t<ue;_t++)e.texImage2D(be+_t,0,6408,1,1,0,6408,5121,Ne);return et}let Z={};Z[3553]=le(3553,3553,1),Z[34067]=le(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),he(2929),l.setFunc(kL),Re(!1),Xe(nj),he(2884),Ae(xn);function he(J){d[J]!==!0&&(e.enable(J),d[J]=!0)}function ye(J){d[J]!==!1&&(e.disable(J),d[J]=!1)}function de(J,be){return p[J]!==be?(e.bindFramebuffer(J,be),p[J]=be,r&&(J===36009&&(p[36160]=be),J===36160&&(p[36009]=be)),!0):!1}function xe(J,be){let ue=g,Ne=!1;if(J)if(ue=f.get(be),ue===void 0&&(ue=[],f.set(be,ue)),J.isWebGLMultipleRenderTargets){let et=J.texture;if(ue.length!==et.length||ue[0]!==36064){for(let _t=0,zt=et.length;_t<zt;_t++)ue[_t]=36064+_t;ue.length=et.length,Ne=!0}}else ue[0]!==36064&&(ue[0]=36064,Ne=!0);else ue[0]!==1029&&(ue[0]=1029,Ne=!0);Ne&&(i.isWebGL2?e.drawBuffers(ue):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(ue))}function me(J){return m!==J?(e.useProgram(J),m=J,!0):!1}let ee={[Hg]:32774,[fbe]:32778,[mbe]:32779};if(r)ee[lj]=32775,ee[cj]=32776;else{let J=t.get("EXT_blend_minmax");J!==null&&(ee[lj]=J.MIN_EXT,ee[cj]=J.MAX_EXT)}let we={[gbe]:0,[vbe]:1,[ybe]:768,[ZZ]:770,[Abe]:776,[_be]:774,[wbe]:772,[xbe]:769,[$Z]:771,[Sbe]:775,[bbe]:773};function Ae(J,be,ue,Ne,et,_t,zt,ti){if(J===xn){v===!0&&(ye(3042),v=!1);return}if(v===!1&&(he(3042),v=!0),J!==pbe){if(J!==x||ti!==E){if((y!==Hg||S!==Hg)&&(e.blendEquation(32774),y=Hg,S=Hg),ti)switch(J){case Bf:e.blendFuncSeparate(1,771,1,771);break;case sj:e.blendFunc(1,1);break;case aj:e.blendFuncSeparate(0,769,0,1);break;case oj:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case Bf:e.blendFuncSeparate(770,771,1,771);break;case sj:e.blendFunc(770,1);break;case aj:e.blendFuncSeparate(0,769,0,1);break;case oj:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}_=null,A=null,C=null,M=null,x=J,E=ti}return}et=et||be,_t=_t||ue,zt=zt||Ne,(be!==y||et!==S)&&(e.blendEquationSeparate(ee[be],ee[et]),y=be,S=et),(ue!==_||Ne!==A||_t!==C||zt!==M)&&(e.blendFuncSeparate(we[ue],we[Ne],we[_t],we[zt]),_=ue,A=Ne,C=_t,M=zt),x=J,E=!1}function Te(J,be){J.side===Bs?ye(2884):he(2884);let ue=J.side===Zn;be&&(ue=!ue),Re(ue),J.blending===Bf&&J.transparent===!1?Ae(xn):Ae(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.premultipliedAlpha),l.setFunc(J.depthFunc),l.setTest(J.depthTest),l.setMask(J.depthWrite),o.setMask(J.colorWrite);let Ne=J.stencilWrite;c.setTest(Ne),Ne&&(c.setMask(J.stencilWriteMask),c.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),c.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),Be(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?he(32926):ye(32926)}function Re(J){P!==J&&(J?e.frontFace(2304):e.frontFace(2305),P=J)}function Xe(J){J!==ube?(he(2884),J!==R&&(J===nj?e.cullFace(1029):J===hbe?e.cullFace(1028):e.cullFace(1032))):ye(2884),R=J}function Oe(J){J!==O&&(K&&e.lineWidth(J),O=J)}function Be(J,be,ue){J?(he(32823),(L!==be||I!==ue)&&(e.polygonOffset(be,ue),L=be,I=ue)):ye(32823)}function at(J){J?he(3089):ye(3089)}function ht(J){J===void 0&&(J=33984+z-1),j!==J&&(e.activeTexture(J),j=J)}function se(J,be,ue){ue===void 0&&(j===null?ue=33984+z-1:ue=j);let Ne=k[ue];Ne===void 0&&(Ne={type:void 0,texture:void 0},k[ue]=Ne),(Ne.type!==J||Ne.texture!==be)&&(j!==ue&&(e.activeTexture(ue),j=ue),e.bindTexture(J,be||Z[J]),Ne.type=J,Ne.texture=be)}function N(){let J=k[j];J!==void 0&&J.type!==void 0&&(e.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function H(){try{e.compressedTexImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ve(){try{e.compressedTexImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function X(){try{e.texSubImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ce(){try{e.texSubImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ve(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ye(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function _e(){try{e.texStorage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Pe(){try{e.texStorage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Qe(){try{e.texImage2D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function st(){try{e.texImage3D.apply(e,arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ct(J){te.equals(J)===!1&&(e.scissor(J.x,J.y,J.z,J.w),te.copy(J))}function tt(J){G.equals(J)===!1&&(e.viewport(J.x,J.y,J.z,J.w),G.copy(J))}function oe(J,be){let ue=h.get(be);ue===void 0&&(ue=new WeakMap,h.set(be,ue));let Ne=ue.get(J);Ne===void 0&&(Ne=e.getUniformBlockIndex(be,J.name),ue.set(J,Ne))}function je(J,be){let ue=h.get(be).get(J);u.get(be)!==ue&&(e.uniformBlockBinding(be,ue,J.__bindingPointIndex),u.set(be,ue))}function dt(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},j=null,k={},p={},f=new WeakMap,g=[],m=null,v=!1,x=null,y=null,_=null,A=null,S=null,C=null,M=null,E=!1,P=null,R=null,O=null,L=null,I=null,te.set(0,0,e.canvas.width,e.canvas.height),G.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:he,disable:ye,bindFramebuffer:de,drawBuffers:xe,useProgram:me,setBlending:Ae,setMaterial:Te,setFlipSided:Re,setCullFace:Xe,setLineWidth:Oe,setPolygonOffset:Be,setScissorTest:at,activeTexture:ht,bindTexture:se,unbindTexture:N,compressedTexImage2D:H,compressedTexImage3D:ve,texImage2D:Qe,texImage3D:st,updateUBOMapping:oe,uniformBlockBinding:je,texStorage2D:_e,texStorage3D:Pe,texSubImage2D:X,texSubImage3D:Ce,compressedTexSubImage2D:Ve,compressedTexSubImage3D:Ye,scissor:ct,viewport:tt,reset:dt}}function sCe(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,g,m=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(se,N){return v?new OffscreenCanvas(se,N):rw("canvas")}function y(se,N,H,ve){let X=1;if((se.width>ve||se.height>ve)&&(X=ve/Math.max(se.width,se.height)),X<1||N===!0)if(typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&se instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&se instanceof ImageBitmap){let Ce=N?RE:Math.floor,Ve=Ce(X*se.width),Ye=Ce(X*se.height);g===void 0&&(g=x(Ve,Ye));let _e=H?x(Ve,Ye):g;return _e.width=Ve,_e.height=Ye,_e.getContext("2d").drawImage(se,0,0,Ve,Ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+se.width+"x"+se.height+") to ("+Ve+"x"+Ye+")."),_e}else return"data"in se&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+se.width+"x"+se.height+")."),se;return se}function _(se){return XL(se.width)&&XL(se.height)}function A(se){return o?!1:se.wrapS!==xr||se.wrapT!==xr||se.minFilter!==vi&&se.minFilter!==di}function S(se,N){return se.generateMipmaps&&N&&se.minFilter!==vi&&se.minFilter!==di}function C(se){e.generateMipmap(se)}function M(se,N,H,ve,X=!1){if(o===!1)return N;if(se!==null){if(e[se]!==void 0)return e[se];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+se+"'")}let Ce=N;return N===6403&&(H===5126&&(Ce=33326),H===5131&&(Ce=33325),H===5121&&(Ce=33321)),N===33319&&(H===5126&&(Ce=33328),H===5131&&(Ce=33327),H===5121&&(Ce=33323)),N===6408&&(H===5126&&(Ce=34836),H===5131&&(Ce=34842),H===5121&&(Ce=ve===ci&&X===!1?35907:32856),H===32819&&(Ce=32854),H===32820&&(Ce=32855)),(Ce===33325||Ce===33326||Ce===33327||Ce===33328||Ce===34842||Ce===34836)&&t.get("EXT_color_buffer_float"),Ce}function E(se,N,H){return S(se,H)===!0||se.isFramebufferTexture&&se.minFilter!==vi&&se.minFilter!==di?Math.log2(Math.max(N.width,N.height))+1:se.mipmaps!==void 0&&se.mipmaps.length>0?se.mipmaps.length:se.isCompressedTexture&&Array.isArray(se.image)?N.mipmaps.length:1}function P(se){return se===vi||se===uj||se===LD?9728:9729}function R(se){let N=se.target;N.removeEventListener("dispose",R),L(N),N.isVideoTexture&&f.delete(N)}function O(se){let N=se.target;N.removeEventListener("dispose",O),z(N)}function L(se){let N=r.get(se);if(N.__webglInit===void 0)return;let H=se.source,ve=m.get(H);if(ve){let X=ve[N.__cacheKey];X.usedTimes--,X.usedTimes===0&&I(se),Object.keys(ve).length===0&&m.delete(H)}r.remove(se)}function I(se){let N=r.get(se);e.deleteTexture(N.__webglTexture);let H=se.source,ve=m.get(H);delete ve[N.__cacheKey],a.memory.textures--}function z(se){let N=se.texture,H=r.get(se),ve=r.get(N);if(ve.__webglTexture!==void 0&&(e.deleteTexture(ve.__webglTexture),a.memory.textures--),se.depthTexture&&se.depthTexture.dispose(),se.isWebGLCubeRenderTarget)for(let X=0;X<6;X++)e.deleteFramebuffer(H.__webglFramebuffer[X]),H.__webglDepthbuffer&&e.deleteRenderbuffer(H.__webglDepthbuffer[X]);else{if(e.deleteFramebuffer(H.__webglFramebuffer),H.__webglDepthbuffer&&e.deleteRenderbuffer(H.__webglDepthbuffer),H.__webglMultisampledFramebuffer&&e.deleteFramebuffer(H.__webglMultisampledFramebuffer),H.__webglColorRenderbuffer)for(let X=0;X<H.__webglColorRenderbuffer.length;X++)H.__webglColorRenderbuffer[X]&&e.deleteRenderbuffer(H.__webglColorRenderbuffer[X]);H.__webglDepthRenderbuffer&&e.deleteRenderbuffer(H.__webglDepthRenderbuffer)}if(se.isWebGLMultipleRenderTargets)for(let X=0,Ce=N.length;X<Ce;X++){let Ve=r.get(N[X]);Ve.__webglTexture&&(e.deleteTexture(Ve.__webglTexture),a.memory.textures--),r.remove(N[X])}r.remove(N),r.remove(se)}let K=0;function Y(){K=0}function U(){let se=K;return se>=l&&console.warn("THREE.WebGLTextures: Trying to use "+se+" texture units while this GPU supports only "+l),K+=1,se}function j(se){let N=[];return N.push(se.wrapS),N.push(se.wrapT),N.push(se.wrapR||0),N.push(se.magFilter),N.push(se.minFilter),N.push(se.anisotropy),N.push(se.internalFormat),N.push(se.format),N.push(se.type),N.push(se.generateMipmaps),N.push(se.premultiplyAlpha),N.push(se.flipY),N.push(se.unpackAlignment),N.push(se.encoding),N.join()}function k(se,N){let H=r.get(se);if(se.isVideoTexture&&at(se),se.isRenderTargetTexture===!1&&se.version>0&&H.__version!==se.version){let ve=se.image;if(ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ye(H,se,N);return}}i.bindTexture(3553,H.__webglTexture,33984+N)}function q(se,N){let H=r.get(se);if(se.version>0&&H.__version!==se.version){ye(H,se,N);return}i.bindTexture(35866,H.__webglTexture,33984+N)}function W(se,N){let H=r.get(se);if(se.version>0&&H.__version!==se.version){ye(H,se,N);return}i.bindTexture(32879,H.__webglTexture,33984+N)}function te(se,N){let H=r.get(se);if(se.version>0&&H.__version!==se.version){de(H,se,N);return}i.bindTexture(34067,H.__webglTexture,33984+N)}let G={[Uu]:10497,[xr]:33071,[GL]:33648},le={[vi]:9728,[uj]:9984,[LD]:9986,[di]:9729,[kbe]:9985,[h0]:9987};function Z(se,N,H){if(H?(e.texParameteri(se,10242,G[N.wrapS]),e.texParameteri(se,10243,G[N.wrapT]),(se===32879||se===35866)&&e.texParameteri(se,32882,G[N.wrapR]),e.texParameteri(se,10240,le[N.magFilter]),e.texParameteri(se,10241,le[N.minFilter])):(e.texParameteri(se,10242,33071),e.texParameteri(se,10243,33071),(se===32879||se===35866)&&e.texParameteri(se,32882,33071),(N.wrapS!==xr||N.wrapT!==xr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(se,10240,P(N.magFilter)),e.texParameteri(se,10241,P(N.minFilter)),N.minFilter!==vi&&N.minFilter!==di&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let ve=t.get("EXT_texture_filter_anisotropic");if(N.magFilter===vi||N.minFilter!==LD&&N.minFilter!==h0||N.type===Ki&&t.has("OES_texture_float_linear")===!1||o===!1&&N.type===nh&&t.has("OES_texture_half_float_linear")===!1)return;(N.anisotropy>1||r.get(N).__currentAnisotropy)&&(e.texParameterf(se,ve.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,n.getMaxAnisotropy())),r.get(N).__currentAnisotropy=N.anisotropy)}}function he(se,N){let H=!1;se.__webglInit===void 0&&(se.__webglInit=!0,N.addEventListener("dispose",R));let ve=N.source,X=m.get(ve);X===void 0&&(X={},m.set(ve,X));let Ce=j(N);if(Ce!==se.__cacheKey){X[Ce]===void 0&&(X[Ce]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,H=!0),X[Ce].usedTimes++;let Ve=X[se.__cacheKey];Ve!==void 0&&(X[se.__cacheKey].usedTimes--,Ve.usedTimes===0&&I(N)),se.__cacheKey=Ce,se.__webglTexture=X[Ce].texture}return H}function ye(se,N,H){let ve=3553;(N.isDataArrayTexture||N.isCompressedArrayTexture)&&(ve=35866),N.isData3DTexture&&(ve=32879);let X=he(se,N),Ce=N.source;i.bindTexture(ve,se.__webglTexture,33984+H);let Ve=r.get(Ce);if(Ce.version!==Ve.__version||X===!0){i.activeTexture(33984+H),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);let Ye=A(N)&&_(N.image)===!1,_e=y(N.image,Ye,!1,u);_e=ht(N,_e);let Pe=_(_e)||o,Qe=s.convert(N.format,N.encoding),st=s.convert(N.type),ct=M(N.internalFormat,Qe,st,N.encoding,N.isVideoTexture);Z(ve,N,Pe);let tt,oe=N.mipmaps,je=o&&N.isVideoTexture!==!0,dt=Ve.__version===void 0||X===!0,J=E(N,_e,Pe);if(N.isDepthTexture)ct=6402,o?N.type===Ki?ct=36012:N.type===ku?ct=33190:N.type===Ff?ct=35056:ct=33189:N.type===Ki&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),N.format===Nf&&ct===6402&&N.type!==i$&&N.type!==ku&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),N.type=ku,st=s.convert(N.type)),N.format===im&&ct===6402&&(ct=34041,N.type!==Ff&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),N.type=Ff,st=s.convert(N.type))),dt&&(je?i.texStorage2D(3553,1,ct,_e.width,_e.height):i.texImage2D(3553,0,ct,_e.width,_e.height,0,Qe,st,null));else if(N.isDataTexture)if(oe.length>0&&Pe){je&&dt&&i.texStorage2D(3553,J,ct,oe[0].width,oe[0].height);for(let be=0,ue=oe.length;be<ue;be++)tt=oe[be],je?i.texSubImage2D(3553,be,0,0,tt.width,tt.height,Qe,st,tt.data):i.texImage2D(3553,be,ct,tt.width,tt.height,0,Qe,st,tt.data);N.generateMipmaps=!1}else je?(dt&&i.texStorage2D(3553,J,ct,_e.width,_e.height),i.texSubImage2D(3553,0,0,0,_e.width,_e.height,Qe,st,_e.data)):i.texImage2D(3553,0,ct,_e.width,_e.height,0,Qe,st,_e.data);else if(N.isCompressedTexture)if(N.isCompressedArrayTexture){je&&dt&&i.texStorage3D(35866,J,ct,oe[0].width,oe[0].height,_e.depth);for(let be=0,ue=oe.length;be<ue;be++)tt=oe[be],N.format!==Er?Qe!==null?je?i.compressedTexSubImage3D(35866,be,0,0,0,tt.width,tt.height,_e.depth,Qe,tt.data,0,0):i.compressedTexImage3D(35866,be,ct,tt.width,tt.height,_e.depth,0,tt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):je?i.texSubImage3D(35866,be,0,0,0,tt.width,tt.height,_e.depth,Qe,st,tt.data):i.texImage3D(35866,be,ct,tt.width,tt.height,_e.depth,0,Qe,st,tt.data)}else{je&&dt&&i.texStorage2D(3553,J,ct,oe[0].width,oe[0].height);for(let be=0,ue=oe.length;be<ue;be++)tt=oe[be],N.format!==Er?Qe!==null?je?i.compressedTexSubImage2D(3553,be,0,0,tt.width,tt.height,Qe,tt.data):i.compressedTexImage2D(3553,be,ct,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):je?i.texSubImage2D(3553,be,0,0,tt.width,tt.height,Qe,st,tt.data):i.texImage2D(3553,be,ct,tt.width,tt.height,0,Qe,st,tt.data)}else if(N.isDataArrayTexture)je?(dt&&i.texStorage3D(35866,J,ct,_e.width,_e.height,_e.depth),i.texSubImage3D(35866,0,0,0,0,_e.width,_e.height,_e.depth,Qe,st,_e.data)):i.texImage3D(35866,0,ct,_e.width,_e.height,_e.depth,0,Qe,st,_e.data);else if(N.isData3DTexture)je?(dt&&i.texStorage3D(32879,J,ct,_e.width,_e.height,_e.depth),i.texSubImage3D(32879,0,0,0,0,_e.width,_e.height,_e.depth,Qe,st,_e.data)):i.texImage3D(32879,0,ct,_e.width,_e.height,_e.depth,0,Qe,st,_e.data);else if(N.isFramebufferTexture){if(dt)if(je)i.texStorage2D(3553,J,ct,_e.width,_e.height);else{let be=_e.width,ue=_e.height;for(let Ne=0;Ne<J;Ne++)i.texImage2D(3553,Ne,ct,be,ue,0,Qe,st,null),be>>=1,ue>>=1}}else if(oe.length>0&&Pe){je&&dt&&i.texStorage2D(3553,J,ct,oe[0].width,oe[0].height);for(let be=0,ue=oe.length;be<ue;be++)tt=oe[be],je?i.texSubImage2D(3553,be,0,0,Qe,st,tt):i.texImage2D(3553,be,ct,Qe,st,tt);N.generateMipmaps=!1}else je?(dt&&i.texStorage2D(3553,J,ct,_e.width,_e.height),i.texSubImage2D(3553,0,0,0,Qe,st,_e)):i.texImage2D(3553,0,ct,Qe,st,_e);S(N,Pe)&&C(ve),Ve.__version=Ce.version,N.onUpdate&&N.onUpdate(N)}se.__version=N.version}function de(se,N,H){if(N.image.length!==6)return;let ve=he(se,N),X=N.source;i.bindTexture(34067,se.__webglTexture,33984+H);let Ce=r.get(X);if(X.version!==Ce.__version||ve===!0){i.activeTexture(33984+H),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);let Ve=N.isCompressedTexture||N.image[0].isCompressedTexture,Ye=N.image[0]&&N.image[0].isDataTexture,_e=[];for(let be=0;be<6;be++)!Ve&&!Ye?_e[be]=y(N.image[be],!1,!0,c):_e[be]=Ye?N.image[be].image:N.image[be],_e[be]=ht(N,_e[be]);let Pe=_e[0],Qe=_(Pe)||o,st=s.convert(N.format,N.encoding),ct=s.convert(N.type),tt=M(N.internalFormat,st,ct,N.encoding),oe=o&&N.isVideoTexture!==!0,je=Ce.__version===void 0||ve===!0,dt=E(N,Pe,Qe);Z(34067,N,Qe);let J;if(Ve){oe&&je&&i.texStorage2D(34067,dt,tt,Pe.width,Pe.height);for(let be=0;be<6;be++){J=_e[be].mipmaps;for(let ue=0;ue<J.length;ue++){let Ne=J[ue];N.format!==Er?st!==null?oe?i.compressedTexSubImage2D(34069+be,ue,0,0,Ne.width,Ne.height,st,Ne.data):i.compressedTexImage2D(34069+be,ue,tt,Ne.width,Ne.height,0,Ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):oe?i.texSubImage2D(34069+be,ue,0,0,Ne.width,Ne.height,st,ct,Ne.data):i.texImage2D(34069+be,ue,tt,Ne.width,Ne.height,0,st,ct,Ne.data)}}}else{J=N.mipmaps,oe&&je&&(J.length>0&&dt++,i.texStorage2D(34067,dt,tt,_e[0].width,_e[0].height));for(let be=0;be<6;be++)if(Ye){oe?i.texSubImage2D(34069+be,0,0,0,_e[be].width,_e[be].height,st,ct,_e[be].data):i.texImage2D(34069+be,0,tt,_e[be].width,_e[be].height,0,st,ct,_e[be].data);for(let ue=0;ue<J.length;ue++){let Ne=J[ue].image[be].image;oe?i.texSubImage2D(34069+be,ue+1,0,0,Ne.width,Ne.height,st,ct,Ne.data):i.texImage2D(34069+be,ue+1,tt,Ne.width,Ne.height,0,st,ct,Ne.data)}}else{oe?i.texSubImage2D(34069+be,0,0,0,st,ct,_e[be]):i.texImage2D(34069+be,0,tt,st,ct,_e[be]);for(let ue=0;ue<J.length;ue++){let Ne=J[ue];oe?i.texSubImage2D(34069+be,ue+1,0,0,st,ct,Ne.image[be]):i.texImage2D(34069+be,ue+1,tt,st,ct,Ne.image[be])}}}S(N,Qe)&&C(34067),Ce.__version=X.version,N.onUpdate&&N.onUpdate(N)}se.__version=N.version}function xe(se,N,H,ve,X){let Ce=s.convert(H.format,H.encoding),Ve=s.convert(H.type),Ye=M(H.internalFormat,Ce,Ve,H.encoding);r.get(N).__hasExternalTextures||(X===32879||X===35866?i.texImage3D(X,0,Ye,N.width,N.height,N.depth,0,Ce,Ve,null):i.texImage2D(X,0,Ye,N.width,N.height,0,Ce,Ve,null)),i.bindFramebuffer(36160,se),Be(N)?d.framebufferTexture2DMultisampleEXT(36160,ve,X,r.get(H).__webglTexture,0,Oe(N)):(X===3553||X>=34069&&X<=34074)&&e.framebufferTexture2D(36160,ve,X,r.get(H).__webglTexture,0),i.bindFramebuffer(36160,null)}function me(se,N,H){if(e.bindRenderbuffer(36161,se),N.depthBuffer&&!N.stencilBuffer){let ve=33189;if(H||Be(N)){let X=N.depthTexture;X&&X.isDepthTexture&&(X.type===Ki?ve=36012:X.type===ku&&(ve=33190));let Ce=Oe(N);Be(N)?d.renderbufferStorageMultisampleEXT(36161,Ce,ve,N.width,N.height):e.renderbufferStorageMultisample(36161,Ce,ve,N.width,N.height)}else e.renderbufferStorage(36161,ve,N.width,N.height);e.framebufferRenderbuffer(36160,36096,36161,se)}else if(N.depthBuffer&&N.stencilBuffer){let ve=Oe(N);H&&Be(N)===!1?e.renderbufferStorageMultisample(36161,ve,35056,N.width,N.height):Be(N)?d.renderbufferStorageMultisampleEXT(36161,ve,35056,N.width,N.height):e.renderbufferStorage(36161,34041,N.width,N.height),e.framebufferRenderbuffer(36160,33306,36161,se)}else{let ve=N.isWebGLMultipleRenderTargets===!0?N.texture:[N.texture];for(let X=0;X<ve.length;X++){let Ce=ve[X],Ve=s.convert(Ce.format,Ce.encoding),Ye=s.convert(Ce.type),_e=M(Ce.internalFormat,Ve,Ye,Ce.encoding),Pe=Oe(N);H&&Be(N)===!1?e.renderbufferStorageMultisample(36161,Pe,_e,N.width,N.height):Be(N)?d.renderbufferStorageMultisampleEXT(36161,Pe,_e,N.width,N.height):e.renderbufferStorage(36161,_e,N.width,N.height)}}e.bindRenderbuffer(36161,null)}function ee(se,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,se),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),k(N.depthTexture,0);let H=r.get(N.depthTexture).__webglTexture,ve=Oe(N);if(N.depthTexture.format===Nf)Be(N)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,H,0,ve):e.framebufferTexture2D(36160,36096,3553,H,0);else if(N.depthTexture.format===im)Be(N)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,H,0,ve):e.framebufferTexture2D(36160,33306,3553,H,0);else throw new Error("Unknown depthTexture format")}function we(se){let N=r.get(se),H=se.isWebGLCubeRenderTarget===!0;if(se.depthTexture&&!N.__autoAllocateDepthBuffer){if(H)throw new Error("target.depthTexture not supported in Cube render targets");ee(N.__webglFramebuffer,se)}else if(H){N.__webglDepthbuffer=[];for(let ve=0;ve<6;ve++)i.bindFramebuffer(36160,N.__webglFramebuffer[ve]),N.__webglDepthbuffer[ve]=e.createRenderbuffer(),me(N.__webglDepthbuffer[ve],se,!1)}else i.bindFramebuffer(36160,N.__webglFramebuffer),N.__webglDepthbuffer=e.createRenderbuffer(),me(N.__webglDepthbuffer,se,!1);i.bindFramebuffer(36160,null)}function Ae(se,N,H){let ve=r.get(se);N!==void 0&&xe(ve.__webglFramebuffer,se,se.texture,36064,3553),H!==void 0&&we(se)}function Te(se){let N=se.texture,H=r.get(se),ve=r.get(N);se.addEventListener("dispose",O),se.isWebGLMultipleRenderTargets!==!0&&(ve.__webglTexture===void 0&&(ve.__webglTexture=e.createTexture()),ve.__version=N.version,a.memory.textures++);let X=se.isWebGLCubeRenderTarget===!0,Ce=se.isWebGLMultipleRenderTargets===!0,Ve=_(se)||o;if(X){H.__webglFramebuffer=[];for(let Ye=0;Ye<6;Ye++)H.__webglFramebuffer[Ye]=e.createFramebuffer()}else{if(H.__webglFramebuffer=e.createFramebuffer(),Ce)if(n.drawBuffers){let Ye=se.texture;for(let _e=0,Pe=Ye.length;_e<Pe;_e++){let Qe=r.get(Ye[_e]);Qe.__webglTexture===void 0&&(Qe.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&se.samples>0&&Be(se)===!1){let Ye=Ce?N:[N];H.__webglMultisampledFramebuffer=e.createFramebuffer(),H.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,H.__webglMultisampledFramebuffer);for(let _e=0;_e<Ye.length;_e++){let Pe=Ye[_e];H.__webglColorRenderbuffer[_e]=e.createRenderbuffer(),e.bindRenderbuffer(36161,H.__webglColorRenderbuffer[_e]);let Qe=s.convert(Pe.format,Pe.encoding),st=s.convert(Pe.type),ct=M(Pe.internalFormat,Qe,st,Pe.encoding,se.isXRRenderTarget===!0),tt=Oe(se);e.renderbufferStorageMultisample(36161,tt,ct,se.width,se.height),e.framebufferRenderbuffer(36160,36064+_e,36161,H.__webglColorRenderbuffer[_e])}e.bindRenderbuffer(36161,null),se.depthBuffer&&(H.__webglDepthRenderbuffer=e.createRenderbuffer(),me(H.__webglDepthRenderbuffer,se,!0)),i.bindFramebuffer(36160,null)}}if(X){i.bindTexture(34067,ve.__webglTexture),Z(34067,N,Ve);for(let Ye=0;Ye<6;Ye++)xe(H.__webglFramebuffer[Ye],se,N,36064,34069+Ye);S(N,Ve)&&C(34067),i.unbindTexture()}else if(Ce){let Ye=se.texture;for(let _e=0,Pe=Ye.length;_e<Pe;_e++){let Qe=Ye[_e],st=r.get(Qe);i.bindTexture(3553,st.__webglTexture),Z(3553,Qe,Ve),xe(H.__webglFramebuffer,se,Qe,36064+_e,3553),S(Qe,Ve)&&C(3553)}i.unbindTexture()}else{let Ye=3553;(se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(o?Ye=se.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Ye,ve.__webglTexture),Z(Ye,N,Ve),xe(H.__webglFramebuffer,se,N,36064,Ye),S(N,Ve)&&C(Ye),i.unbindTexture()}se.depthBuffer&&we(se)}function Re(se){let N=_(se)||o,H=se.isWebGLMultipleRenderTargets===!0?se.texture:[se.texture];for(let ve=0,X=H.length;ve<X;ve++){let Ce=H[ve];if(S(Ce,N)){let Ve=se.isWebGLCubeRenderTarget?34067:3553,Ye=r.get(Ce).__webglTexture;i.bindTexture(Ve,Ye),C(Ve),i.unbindTexture()}}}function Xe(se){if(o&&se.samples>0&&Be(se)===!1){let N=se.isWebGLMultipleRenderTargets?se.texture:[se.texture],H=se.width,ve=se.height,X=16384,Ce=[],Ve=se.stencilBuffer?33306:36096,Ye=r.get(se),_e=se.isWebGLMultipleRenderTargets===!0;if(_e)for(let Pe=0;Pe<N.length;Pe++)i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+Pe,36161,null),i.bindFramebuffer(36160,Ye.__webglFramebuffer),e.framebufferTexture2D(36009,36064+Pe,3553,null,0);i.bindFramebuffer(36008,Ye.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Ye.__webglFramebuffer);for(let Pe=0;Pe<N.length;Pe++){Ce.push(36064+Pe),se.depthBuffer&&Ce.push(Ve);let Qe=Ye.__ignoreDepthValues!==void 0?Ye.__ignoreDepthValues:!1;if(Qe===!1&&(se.depthBuffer&&(X|=256),se.stencilBuffer&&(X|=1024)),_e&&e.framebufferRenderbuffer(36008,36064,36161,Ye.__webglColorRenderbuffer[Pe]),Qe===!0&&(e.invalidateFramebuffer(36008,[Ve]),e.invalidateFramebuffer(36009,[Ve])),_e){let st=r.get(N[Pe]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,st,0)}e.blitFramebuffer(0,0,H,ve,0,0,H,ve,X,9728),p&&e.invalidateFramebuffer(36008,Ce)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),_e)for(let Pe=0;Pe<N.length;Pe++){i.bindFramebuffer(36160,Ye.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+Pe,36161,Ye.__webglColorRenderbuffer[Pe]);let Qe=r.get(N[Pe]).__webglTexture;i.bindFramebuffer(36160,Ye.__webglFramebuffer),e.framebufferTexture2D(36009,36064+Pe,3553,Qe,0)}i.bindFramebuffer(36009,Ye.__webglMultisampledFramebuffer)}}function Oe(se){return Math.min(h,se.samples)}function Be(se){let N=r.get(se);return o&&se.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&N.__useRenderToTexture!==!1}function at(se){let N=a.render.frame;f.get(se)!==N&&(f.set(se,N),se.update())}function ht(se,N){let H=se.encoding,ve=se.format,X=se.type;return se.isCompressedTexture===!0||se.isVideoTexture===!0||se.format===WL||H!==Bl&&(H===ci?o===!1?t.has("EXT_sRGB")===!0&&ve===Er?(se.format=WL,se.minFilter=di,se.generateMipmaps=!1):N=u$.sRGBToLinear(N):(ve!==Er||X!==Us)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",H)),N}this.allocateTextureUnit=U,this.resetTextureUnits=Y,this.setTexture2D=k,this.setTexture2DArray=q,this.setTexture3D=W,this.setTextureCube=te,this.rebindTextures=Ae,this.setupRenderTarget=Te,this.updateRenderTargetMipmap=Re,this.updateMultisampleRenderTarget=Xe,this.setupDepthRenderbuffer=we,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=Be}function aCe(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Us)return 5121;if(s===Hbe)return 32819;if(s===jbe)return 32820;if(s===zbe)return 5120;if(s===Vbe)return 5122;if(s===i$)return 5123;if(s===Gbe)return 5124;if(s===ku)return 5125;if(s===Ki)return 5126;if(s===nh)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===Wbe)return 6406;if(s===Er)return 6408;if(s===Xbe)return 6409;if(s===Ybe)return 6410;if(s===Nf)return 6402;if(s===im)return 34041;if(s===WL)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===bM)return 6403;if(s===qbe)return 36244;if(s===EE)return 33319;if(s===Qbe)return 33320;if(s===r$)return 36249;if(s===OD||s===BD||s===FD||s===ND)if(a===ci)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===OD)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===BD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===FD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===ND)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===OD)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===BD)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===FD)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===ND)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===hj||s===dj||s===pj||s===fj)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===hj)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===dj)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===pj)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===fj)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Jbe)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===mj||s===gj)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===mj)return a===ci?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===gj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===vj||s===yj||s===xj||s===wj||s===bj||s===_j||s===Sj||s===Aj||s===Mj||s===Ej||s===Cj||s===Tj||s===Pj||s===Dj)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===vj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===yj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===xj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===wj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===bj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===_j)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===Sj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===Aj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===Mj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===Ej)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===Cj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===Tj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===Pj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===Dj)return a===ci?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===UD)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===UD)return a===ci?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===Kbe||s===Rj||s===Ij||s===Lj)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===UD)return o.COMPRESSED_RED_RGTC1_EXT;if(s===Rj)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===Ij)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===Lj)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Ff?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var oCe=class extends Ls{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Vu=class extends Qi{constructor(){super(),this.isGroup=!0,this.type="Group"}},lCe={type:"move"},uR=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Vu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Vu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new F,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new F),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Vu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new F,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new F),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let f of e.hand.values()){let g=t.getJointPose(f,i),m=this._getHandJoint(l,f);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=g.radius),m.visible=g!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(lCe)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new Vu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},p0=class extends Br{constructor(e,t,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:Nf,c!==Nf&&c!==im)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Nf&&(i=ku),i===void 0&&c===im&&(i=Ff),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:vi,this.minFilter=o!==void 0?o:vi,this.flipY=!1,this.generateMipmaps=!1}},cCe=class extends ws{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null,f=t.getContextAttributes(),g=null,m=null,v=[],x=[],y=new Set,_=new Map,A=new Ls;A.layers.enable(1),A.viewport=new ii;let S=new Ls;S.layers.enable(2),S.viewport=new ii;let C=[A,S],M=new oCe;M.layers.enable(1),M.layers.enable(2);let E=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(q){let W=v[q];return W===void 0&&(W=new uR,v[q]=W),W.getTargetRaySpace()},this.getControllerGrip=function(q){let W=v[q];return W===void 0&&(W=new uR,v[q]=W),W.getGripSpace()},this.getHand=function(q){let W=v[q];return W===void 0&&(W=new uR,v[q]=W),W.getHandSpace()};function R(q){let W=x.indexOf(q.inputSource);if(W===-1)return;let te=v[W];te!==void 0&&te.dispatchEvent({type:q.type,data:q.inputSource})}function O(){r.removeEventListener("select",R),r.removeEventListener("selectstart",R),r.removeEventListener("selectend",R),r.removeEventListener("squeeze",R),r.removeEventListener("squeezestart",R),r.removeEventListener("squeezeend",R),r.removeEventListener("end",O),r.removeEventListener("inputsourceschange",L);for(let q=0;q<v.length;q++){let W=x[q];W!==null&&(x[q]=null,v[q].disconnect(W))}E=null,P=null,e.setRenderTarget(g),d=null,h=null,u=null,r=null,m=null,k.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(q){n=q,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(q){a=q,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(q){l=q},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(q){if(r=q,r!==null){if(g=e.getRenderTarget(),r.addEventListener("select",R),r.addEventListener("selectstart",R),r.addEventListener("selectend",R),r.addEventListener("squeeze",R),r.addEventListener("squeezestart",R),r.addEventListener("squeezeend",R),r.addEventListener("end",O),r.addEventListener("inputsourceschange",L),f.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let W={antialias:r.renderState.layers===void 0?f.antialias:!0,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,W),r.updateRenderState({baseLayer:d}),m=new Di(d.framebufferWidth,d.framebufferHeight,{format:Er,type:Us,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let W=null,te=null,G=null;f.depth&&(G=f.stencil?35056:33190,W=f.stencil?im:Nf,te=f.stencil?Ff:ku);let le={colorFormat:32856,depthFormat:G,scaleFactor:n};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(le),r.updateRenderState({layers:[h]}),m=new Di(h.textureWidth,h.textureHeight,{format:Er,type:Us,depthTexture:new p0(h.textureWidth,h.textureHeight,te,void 0,void 0,void 0,void 0,void 0,void 0,W),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});let Z=e.properties.get(m);Z.__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),k.setContext(r),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function L(q){for(let W=0;W<q.removed.length;W++){let te=q.removed[W],G=x.indexOf(te);G>=0&&(x[G]=null,v[G].disconnect(te))}for(let W=0;W<q.added.length;W++){let te=q.added[W],G=x.indexOf(te);if(G===-1){for(let Z=0;Z<v.length;Z++)if(Z>=x.length){x.push(te),G=Z;break}else if(x[Z]===null){x[Z]=te,G=Z;break}if(G===-1)break}let le=v[G];le&&le.connect(te)}}let I=new F,z=new F;function K(q,W,te){I.setFromMatrixPosition(W.matrixWorld),z.setFromMatrixPosition(te.matrixWorld);let G=I.distanceTo(z),le=W.projectionMatrix.elements,Z=te.projectionMatrix.elements,he=le[14]/(le[10]-1),ye=le[14]/(le[10]+1),de=(le[9]+1)/le[5],xe=(le[9]-1)/le[5],me=(le[8]-1)/le[0],ee=(Z[8]+1)/Z[0],we=he*me,Ae=he*ee,Te=G/(-me+ee),Re=Te*-me;W.matrixWorld.decompose(q.position,q.quaternion,q.scale),q.translateX(Re),q.translateZ(Te),q.matrixWorld.compose(q.position,q.quaternion,q.scale),q.matrixWorldInverse.copy(q.matrixWorld).invert();let Xe=he+Te,Oe=ye+Te,Be=we-Re,at=Ae+(G-Re),ht=de*ye/Oe*Xe,se=xe*ye/Oe*Xe;q.projectionMatrix.makePerspective(Be,at,ht,se,Xe,Oe)}function Y(q,W){W===null?q.matrixWorld.copy(q.matrix):q.matrixWorld.multiplyMatrices(W.matrixWorld,q.matrix),q.matrixWorldInverse.copy(q.matrixWorld).invert()}this.updateCamera=function(q){if(r===null)return;M.near=S.near=A.near=q.near,M.far=S.far=A.far=q.far,(E!==M.near||P!==M.far)&&(r.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,P=M.far);let W=q.parent,te=M.cameras;Y(M,W);for(let le=0;le<te.length;le++)Y(te[le],W);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),q.matrix.copy(M.matrix),q.matrix.decompose(q.position,q.quaternion,q.scale);let G=q.children;for(let le=0,Z=G.length;le<Z;le++)G[le].updateMatrixWorld(!0);te.length===2?K(M,A,S):M.projectionMatrix.copy(A.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(q){o=q,h!==null&&(h.fixedFoveation=q),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=q)},this.getPlanes=function(){return y};let U=null;function j(q,W){if(c=W.getViewerPose(l||s),p=W,c!==null){let te=c.views;d!==null&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));let G=!1;te.length!==M.cameras.length&&(M.cameras.length=0,G=!0);for(let le=0;le<te.length;le++){let Z=te[le],he=null;if(d!==null)he=d.getViewport(Z);else{let de=u.getViewSubImage(h,Z);he=de.viewport,le===0&&(e.setRenderTargetTextures(m,de.colorTexture,h.ignoreDepthValues?void 0:de.depthStencilTexture),e.setRenderTarget(m))}let ye=C[le];ye===void 0&&(ye=new Ls,ye.layers.enable(le),ye.viewport=new ii,C[le]=ye),ye.matrix.fromArray(Z.transform.matrix),ye.projectionMatrix.fromArray(Z.projectionMatrix),ye.viewport.set(he.x,he.y,he.width,he.height),le===0&&M.matrix.copy(ye.matrix),G===!0&&M.cameras.push(ye)}}for(let te=0;te<v.length;te++){let G=x[te],le=v[te];G!==null&&le!==void 0&&le.update(G,W,l||s)}if(U&&U(q,W),W.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:W.detectedPlanes});let te=null;for(let G of y)W.detectedPlanes.has(G)||(te===null&&(te=[]),te.push(G));if(te!==null)for(let G of te)y.delete(G),_.delete(G),i.dispatchEvent({type:"planeremoved",data:G});for(let G of W.detectedPlanes)if(!y.has(G))y.add(G),_.set(G,W.lastChangedTime),i.dispatchEvent({type:"planeadded",data:G});else{let le=_.get(G);G.lastChangedTime>le&&(_.set(G,G.lastChangedTime),i.dispatchEvent({type:"planechanged",data:G}))}}p=null}let k=new g$;k.setAnimationLoop(j),this.setAnimationLoop=function(q){U=q},this.dispose=function(){}}};function uCe(e,t){function i(g,m){m.color.getRGB(g.fogColor.value,m$(e)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function r(g,m,v,x,y){m.isMeshBasicMaterial||m.isMeshLambertMaterial?n(g,m):m.isMeshToonMaterial?(n(g,m),u(g,m)):m.isMeshPhongMaterial?(n(g,m),c(g,m)):m.isMeshStandardMaterial?(n(g,m),h(g,m),m.isMeshPhysicalMaterial&&d(g,m,y)):m.isMeshMatcapMaterial?(n(g,m),p(g,m)):m.isMeshDepthMaterial?n(g,m):m.isMeshDistanceMaterial?(n(g,m),f(g,m)):m.isMeshNormalMaterial?n(g,m):m.isLineBasicMaterial?(s(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?o(g,m,v,x):m.isSpriteMaterial?l(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===Zn&&(g.bumpScale.value*=-1)),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===Zn&&g.normalScale.value.negate()),m.specularMap&&(g.specularMap.value=m.specularMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let v=t.get(m).envMap;if(v&&(g.envMap.value=v,g.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;let _=e.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*_}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity);let x;m.map?x=m.map:m.specularMap?x=m.specularMap:m.displacementMap?x=m.displacementMap:m.normalMap?x=m.normalMap:m.bumpMap?x=m.bumpMap:m.roughnessMap?x=m.roughnessMap:m.metalnessMap?x=m.metalnessMap:m.alphaMap?x=m.alphaMap:m.emissiveMap?x=m.emissiveMap:m.clearcoatMap?x=m.clearcoatMap:m.clearcoatNormalMap?x=m.clearcoatNormalMap:m.clearcoatRoughnessMap?x=m.clearcoatRoughnessMap:m.iridescenceMap?x=m.iridescenceMap:m.iridescenceThicknessMap?x=m.iridescenceThicknessMap:m.specularIntensityMap?x=m.specularIntensityMap:m.specularColorMap?x=m.specularColorMap:m.transmissionMap?x=m.transmissionMap:m.thicknessMap?x=m.thicknessMap:m.sheenColorMap?x=m.sheenColorMap:m.sheenRoughnessMap&&(x=m.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uvTransform.value.copy(x.matrix));let y;m.aoMap?y=m.aoMap:m.lightMap&&(y=m.lightMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),g.uv2Transform.value.copy(y.matrix))}function s(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function o(g,m,v,x){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*v,g.scale.value=x*.5,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let y;m.map?y=m.map:m.alphaMap&&(y=m.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),g.uvTransform.value.copy(y.matrix))}function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let v;m.map?v=m.map:m.alphaMap&&(v=m.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),g.uvTransform.value.copy(v.matrix))}function c(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function u(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function h(g,m){g.roughness.value=m.roughness,g.metalness.value=m.metalness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap),t.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function d(g,m,v){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),g.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===Zn&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap)}function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}function f(g,m){g.referencePosition.value.copy(m.referencePosition),g.nearDistance.value=m.nearDistance,g.farDistance.value=m.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function hCe(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(x,y){let _=y.program;r.uniformBlockBinding(x,_)}function c(x,y){let _=n[x.id];_===void 0&&(f(x),_=u(x),n[x.id]=_,x.addEventListener("dispose",m));let A=y.program;r.updateUBOMapping(x,A);let S=t.render.frame;s[x.id]!==S&&(d(x),s[x.id]=S)}function u(x){let y=h();x.__bindingPointIndex=y;let _=e.createBuffer(),A=x.__size,S=x.usage;return e.bindBuffer(35345,_),e.bufferData(35345,A,S),e.bindBuffer(35345,null),e.bindBufferBase(35345,y,_),_}function h(){for(let x=0;x<o;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){let y=n[x.id],_=x.uniforms,A=x.__cache;e.bindBuffer(35345,y);for(let S=0,C=_.length;S<C;S++){let M=_[S];if(p(M,S,A)===!0){let E=M.__offset,P=Array.isArray(M.value)?M.value:[M.value],R=0;for(let O=0;O<P.length;O++){let L=P[O],I=g(L);typeof L=="number"?(M.__data[0]=L,e.bufferSubData(35345,E+R,M.__data)):L.isMatrix3?(M.__data[0]=L.elements[0],M.__data[1]=L.elements[1],M.__data[2]=L.elements[2],M.__data[3]=L.elements[0],M.__data[4]=L.elements[3],M.__data[5]=L.elements[4],M.__data[6]=L.elements[5],M.__data[7]=L.elements[0],M.__data[8]=L.elements[6],M.__data[9]=L.elements[7],M.__data[10]=L.elements[8],M.__data[11]=L.elements[0]):(L.toArray(M.__data,R),R+=I.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,E,M.__data)}}e.bindBuffer(35345,null)}function p(x,y,_){let A=x.value;if(_[y]===void 0){if(typeof A=="number")_[y]=A;else{let S=Array.isArray(A)?A:[A],C=[];for(let M=0;M<S.length;M++)C.push(S[M].clone());_[y]=C}return!0}else if(typeof A=="number"){if(_[y]!==A)return _[y]=A,!0}else{let S=Array.isArray(_[y])?_[y]:[_[y]],C=Array.isArray(A)?A:[A];for(let M=0;M<S.length;M++){let E=S[M];if(E.equals(C[M])===!1)return E.copy(C[M]),!0}}return!1}function f(x){let y=x.uniforms,_=0,A=16,S=0;for(let C=0,M=y.length;C<M;C++){let E=y[C],P={boundary:0,storage:0},R=Array.isArray(E.value)?E.value:[E.value];for(let O=0,L=R.length;O<L;O++){let I=R[O],z=g(I);P.boundary+=z.boundary,P.storage+=z.storage}if(E.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=_,C>0){S=_%A;let O=A-S;S!==0&&O-P.boundary<0&&(_+=A-S,E.__offset=_)}_+=P.storage}return S=_%A,S>0&&(_+=A-S),x.__size=_,x.__cache={},this}function g(x){let y={boundary:0,storage:0};return typeof x=="number"?(y.boundary=4,y.storage=4):x.isVector2?(y.boundary=8,y.storage=8):x.isVector3||x.isColor?(y.boundary=16,y.storage=12):x.isVector4?(y.boundary=16,y.storage=16):x.isMatrix3?(y.boundary=48,y.storage=48):x.isMatrix4?(y.boundary=64,y.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),y}function m(x){let y=x.target;y.removeEventListener("dispose",m);let _=a.indexOf(y.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[y.id]),delete n[y.id],delete s[y.id]}function v(){for(let x in n)e.deleteBuffer(n[x]);a=[],n={},s={}}return{bind:l,update:c,dispose:v}}function dCe(){let e=rw("canvas");return e.style.display="block",e}function _$(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:dCe(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Bl,this.physicallyCorrectLights=!1,this.toneMapping=Rc,this.toneMappingExposure=1;let g=this,m=!1,v=0,x=0,y=null,_=-1,A=null,S=new ii,C=new ii,M=null,E=t.width,P=t.height,R=1,O=null,L=null,I=new ii(0,0,E,P),z=new ii(0,0,E,P),K=!1,Y=new gU,U=!1,j=!1,k=null,q=new ot,W=new pe,te=new F,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function le(){return y===null?R:1}let Z=i;function he(ae,Ue){for(let Je=0;Je<ae.length;Je++){let Fe=ae[Je],Ze=t.getContext(Fe,Ue);if(Ze!==null)return Ze}return null}try{let ae={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${z0}`),t.addEventListener("webglcontextlost",ct,!1),t.addEventListener("webglcontextrestored",tt,!1),t.addEventListener("webglcontextcreationerror",oe,!1),Z===null){let Ue=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&Ue.shift(),Z=he(Ue,ae),Z===null)throw he(Ue)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Z.getShaderPrecisionFormat===void 0&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ae){throw console.error("THREE.WebGLRenderer: "+ae.message),ae}let ye,de,xe,me,ee,we,Ae,Te,Re,Xe,Oe,Be,at,ht,se,N,H,ve,X,Ce,Ve,Ye,_e,Pe;function Qe(){ye=new MMe(Z),de=new xMe(Z,ye,e),ye.init(de),Ye=new aCe(Z,ye,de),xe=new nCe(Z,ye,de),me=new TMe,ee=new WEe,we=new sCe(Z,ye,xe,ee,de,Ye,me),Ae=new bMe(g),Te=new AMe(g),Re=new N_e(Z,de),_e=new vMe(Z,ye,Re,de),Xe=new EMe(Z,Re,me,_e),Oe=new IMe(Z,Xe,Re,me),X=new RMe(Z,de,we),N=new wMe(ee),Be=new jEe(g,Ae,Te,ye,de,_e,N),at=new uCe(g,ee),ht=new YEe,se=new $Ee(ye,de),ve=new gMe(g,Ae,Te,xe,Oe,u,a),H=new rCe(g,Oe,de),Pe=new hCe(Z,me,de,xe),Ce=new yMe(Z,ye,me,de),Ve=new CMe(Z,ye,me,de),me.programs=Be.programs,g.capabilities=de,g.extensions=ye,g.properties=ee,g.renderLists=ht,g.shadowMap=H,g.state=xe,g.info=me}Qe();let st=new cCe(g,Z);this.xr=st,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){let ae=ye.get("WEBGL_lose_context");ae&&ae.loseContext()},this.forceContextRestore=function(){let ae=ye.get("WEBGL_lose_context");ae&&ae.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(ae){ae!==void 0&&(R=ae,this.setSize(E,P,!1))},this.getSize=function(ae){return ae.set(E,P)},this.setSize=function(ae,Ue,Je){if(st.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=ae,P=Ue,t.width=Math.floor(ae*R),t.height=Math.floor(Ue*R),Je!==!1&&(t.style.width=ae+"px",t.style.height=Ue+"px"),this.setViewport(0,0,ae,Ue)},this.getDrawingBufferSize=function(ae){return ae.set(E*R,P*R).floor()},this.setDrawingBufferSize=function(ae,Ue,Je){E=ae,P=Ue,R=Je,t.width=Math.floor(ae*Je),t.height=Math.floor(Ue*Je),this.setViewport(0,0,ae,Ue)},this.getCurrentViewport=function(ae){return ae.copy(S)},this.getViewport=function(ae){return ae.copy(I)},this.setViewport=function(ae,Ue,Je,Fe){ae.isVector4?I.set(ae.x,ae.y,ae.z,ae.w):I.set(ae,Ue,Je,Fe),xe.viewport(S.copy(I).multiplyScalar(R).floor())},this.getScissor=function(ae){return ae.copy(z)},this.setScissor=function(ae,Ue,Je,Fe){ae.isVector4?z.set(ae.x,ae.y,ae.z,ae.w):z.set(ae,Ue,Je,Fe),xe.scissor(C.copy(z).multiplyScalar(R).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(ae){xe.setScissorTest(K=ae)},this.setOpaqueSort=function(ae){O=ae},this.setTransparentSort=function(ae){L=ae},this.getClearColor=function(ae){return ae.copy(ve.getClearColor())},this.setClearColor=function(){ve.setClearColor.apply(ve,arguments)},this.getClearAlpha=function(){return ve.getClearAlpha()},this.setClearAlpha=function(){ve.setClearAlpha.apply(ve,arguments)},this.clear=function(ae=!0,Ue=!0,Je=!0){let Fe=0;ae&&(Fe|=16384),Ue&&(Fe|=256),Je&&(Fe|=1024),Z.clear(Fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ct,!1),t.removeEventListener("webglcontextrestored",tt,!1),t.removeEventListener("webglcontextcreationerror",oe,!1),ht.dispose(),se.dispose(),ee.dispose(),Ae.dispose(),Te.dispose(),Oe.dispose(),_e.dispose(),Pe.dispose(),Be.dispose(),st.dispose(),st.removeEventListener("sessionstart",Ne),st.removeEventListener("sessionend",et),k&&(k.dispose(),k=null),_t.stop()};function ct(ae){ae.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function tt(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let ae=me.autoReset,Ue=H.enabled,Je=H.autoUpdate,Fe=H.needsUpdate,Ze=H.type;Qe(),me.autoReset=ae,H.enabled=Ue,H.autoUpdate=Je,H.needsUpdate=Fe,H.type=Ze}function oe(ae){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ae.statusMessage)}function je(ae){let Ue=ae.target;Ue.removeEventListener("dispose",je),dt(Ue)}function dt(ae){J(ae),ee.remove(ae)}function J(ae){let Ue=ee.get(ae).programs;Ue!==void 0&&(Ue.forEach(function(Je){Be.releaseProgram(Je)}),ae.isShaderMaterial&&Be.releaseShaderCache(ae))}this.renderBufferDirect=function(ae,Ue,Je,Fe,Ze,Pt){Ue===null&&(Ue=G);let re=Ze.isMesh&&Ze.matrixWorld.determinant()<0,Me=mh(ae,Ue,Je,Fe,Ze);xe.setMaterial(Fe,re);let Ie=Je.index,Ee=1;Fe.wireframe===!0&&(Ie=Xe.getWireframeAttribute(Je),Ee=2);let ke=Je.drawRange,ut=Je.attributes.position,pt=ke.start*Ee,Dt=(ke.start+ke.count)*Ee;Pt!==null&&(pt=Math.max(pt,Pt.start*Ee),Dt=Math.min(Dt,(Pt.start+Pt.count)*Ee)),Ie!==null?(pt=Math.max(pt,0),Dt=Math.min(Dt,Ie.count)):ut!=null&&(pt=Math.max(pt,0),Dt=Math.min(Dt,ut.count));let Nt=Dt-pt;if(Nt<0||Nt===1/0)return;_e.setup(Ze,Fe,Me,Je,Ie);let ni,Tt=Ce;if(Ie!==null&&(ni=Re.get(Ie),Tt=Ve,Tt.setIndex(ni)),Ze.isMesh)Fe.wireframe===!0?(xe.setLineWidth(Fe.wireframeLinewidth*le()),Tt.setMode(1)):Tt.setMode(4);else if(Ze.isLine){let gt=Fe.linewidth;gt===void 0&&(gt=1),xe.setLineWidth(gt*le()),Ze.isLineSegments?Tt.setMode(1):Ze.isLineLoop?Tt.setMode(2):Tt.setMode(3)}else Ze.isPoints?Tt.setMode(0):Ze.isSprite&&Tt.setMode(4);if(Ze.isInstancedMesh)Tt.renderInstances(pt,Nt,Ze.count);else if(Je.isInstancedBufferGeometry){let gt=Je._maxInstanceCount!==void 0?Je._maxInstanceCount:1/0,gi=Math.min(Je.instanceCount,gt);Tt.renderInstances(pt,Nt,gi)}else Tt.render(pt,Nt)},this.compile=function(ae,Ue){function Je(Fe,Ze,Pt){Fe.transparent===!0&&Fe.side===Bs&&Fe.forceSinglePass===!1?(Fe.side=Zn,Fe.needsUpdate=!0,Ai(Fe,Ze,Pt),Fe.side=Ol,Fe.needsUpdate=!0,Ai(Fe,Ze,Pt),Fe.side=Bs):Ai(Fe,Ze,Pt)}d=se.get(ae),d.init(),f.push(d),ae.traverseVisible(function(Fe){Fe.isLight&&Fe.layers.test(Ue.layers)&&(d.pushLight(Fe),Fe.castShadow&&d.pushShadow(Fe))}),d.setupLights(g.physicallyCorrectLights),ae.traverse(function(Fe){let Ze=Fe.material;if(Ze)if(Array.isArray(Ze))for(let Pt=0;Pt<Ze.length;Pt++){let re=Ze[Pt];Je(re,ae,Fe)}else Je(Ze,ae,Fe)}),f.pop(),d=null};let be=null;function ue(ae){be&&be(ae)}function Ne(){_t.stop()}function et(){_t.start()}let _t=new g$;_t.setAnimationLoop(ue),typeof self<"u"&&_t.setContext(self),this.setAnimationLoop=function(ae){be=ae,st.setAnimationLoop(ae),ae===null?_t.stop():_t.start()},st.addEventListener("sessionstart",Ne),st.addEventListener("sessionend",et),this.render=function(ae,Ue){if(Ue!==void 0&&Ue.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;ae.matrixWorldAutoUpdate===!0&&ae.updateMatrixWorld(),Ue.parent===null&&Ue.matrixWorldAutoUpdate===!0&&Ue.updateMatrixWorld(),st.enabled===!0&&st.isPresenting===!0&&(st.cameraAutoUpdate===!0&&st.updateCamera(Ue),Ue=st.getCamera()),ae.isScene===!0&&ae.onBeforeRender(g,ae,Ue,y),d=se.get(ae,f.length),d.init(),f.push(d),q.multiplyMatrices(Ue.projectionMatrix,Ue.matrixWorldInverse),Y.setFromProjectionMatrix(q),j=this.localClippingEnabled,U=N.init(this.clippingPlanes,j),h=ht.get(ae,p.length),h.init(),p.push(h),zt(ae,Ue,0,g.sortObjects),h.finish(),g.sortObjects===!0&&h.sort(O,L),U===!0&&N.beginShadows();let Je=d.state.shadowsArray;if(H.render(Je,ae,Ue),U===!0&&N.endShadows(),this.info.autoReset===!0&&this.info.reset(),ve.render(h,ae),d.setupLights(g.physicallyCorrectLights),Ue.isArrayCamera){let Fe=Ue.cameras;for(let Ze=0,Pt=Fe.length;Ze<Pt;Ze++){let re=Fe[Ze];ti(h,ae,re,re.viewport)}}else ti(h,ae,Ue);y!==null&&(we.updateMultisampleRenderTarget(y),we.updateRenderTargetMipmap(y)),ae.isScene===!0&&ae.onAfterRender(g,ae,Ue),_e.resetDefaultState(),_=-1,A=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function zt(ae,Ue,Je,Fe){if(ae.visible===!1)return;if(ae.layers.test(Ue.layers)){if(ae.isGroup)Je=ae.renderOrder;else if(ae.isLOD)ae.autoUpdate===!0&&ae.update(Ue);else if(ae.isLight)d.pushLight(ae),ae.castShadow&&d.pushShadow(ae);else if(ae.isSprite){if(!ae.frustumCulled||Y.intersectsSprite(ae)){Fe&&te.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(q);let Pt=Oe.update(ae),re=ae.material;re.visible&&h.push(ae,Pt,re,Je,te.z,null)}}else if((ae.isMesh||ae.isLine||ae.isPoints)&&(ae.isSkinnedMesh&&ae.skeleton.frame!==me.render.frame&&(ae.skeleton.update(),ae.skeleton.frame=me.render.frame),!ae.frustumCulled||Y.intersectsObject(ae))){Fe&&te.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(q);let Pt=Oe.update(ae),re=ae.material;if(Array.isArray(re)){let Me=Pt.groups;for(let Ie=0,Ee=Me.length;Ie<Ee;Ie++){let ke=Me[Ie],ut=re[ke.materialIndex];ut&&ut.visible&&h.push(ae,Pt,ut,Je,te.z,ke)}}else re.visible&&h.push(ae,Pt,re,Je,te.z,null)}}let Ze=ae.children;for(let Pt=0,re=Ze.length;Pt<re;Pt++)zt(Ze[Pt],Ue,Je,Fe)}function ti(ae,Ue,Je,Fe){let Ze=ae.opaque,Pt=ae.transmissive,re=ae.transparent;d.setupLightsView(Je),U===!0&&N.setGlobalState(g.clippingPlanes,Je),Pt.length>0&&ar(Ze,Ue,Je),Fe&&xe.viewport(S.copy(Fe)),Ze.length>0&&Ut(Ze,Ue,Je),Pt.length>0&&Ut(Pt,Ue,Je),re.length>0&&Ut(re,Ue,Je),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}function ar(ae,Ue,Je){let Fe=de.isWebGL2;k===null&&(k=new Di(1,1,{generateMipmaps:!0,type:ye.has("EXT_color_buffer_half_float")?nh:Us,minFilter:h0,samples:Fe&&s===!0?4:0})),g.getDrawingBufferSize(W),Fe?k.setSize(W.x,W.y):k.setSize(RE(W.x),RE(W.y));let Ze=g.getRenderTarget();g.setRenderTarget(k),g.clear();let Pt=g.toneMapping;g.toneMapping=Rc,Ut(ae,Ue,Je),g.toneMapping=Pt,we.updateMultisampleRenderTarget(k),we.updateRenderTargetMipmap(k),g.setRenderTarget(Ze)}function Ut(ae,Ue,Je){let Fe=Ue.isScene===!0?Ue.overrideMaterial:null;for(let Ze=0,Pt=ae.length;Ze<Pt;Ze++){let re=ae[Ze],Me=re.object,Ie=re.geometry,Ee=Fe===null?re.material:Fe,ke=re.group;Me.layers.test(Je.layers)&&Wi(Me,Ue,Je,Ie,Ee,ke)}}function Wi(ae,Ue,Je,Fe,Ze,Pt){ae.onBeforeRender(g,Ue,Je,Fe,Ze,Pt),ae.modelViewMatrix.multiplyMatrices(Je.matrixWorldInverse,ae.matrixWorld),ae.normalMatrix.getNormalMatrix(ae.modelViewMatrix),Ze.onBeforeRender(g,Ue,Je,Fe,ae,Pt),Ze.transparent===!0&&Ze.side===Bs&&Ze.forceSinglePass===!1?(Ze.side=Zn,Ze.needsUpdate=!0,g.renderBufferDirect(Je,Ue,Fe,Ze,ae,Pt),Ze.side=Ol,Ze.needsUpdate=!0,g.renderBufferDirect(Je,Ue,Fe,Ze,ae,Pt),Ze.side=Bs):g.renderBufferDirect(Je,Ue,Fe,Ze,ae,Pt),ae.onAfterRender(g,Ue,Je,Fe,Ze,Pt)}function Ai(ae,Ue,Je){Ue.isScene!==!0&&(Ue=G);let Fe=ee.get(ae),Ze=d.state.lights,Pt=d.state.shadowsArray,re=Ze.state.version,Me=Be.getParameters(ae,Ze.state,Pt,Ue,Je),Ie=Be.getProgramCacheKey(Me),Ee=Fe.programs;Fe.environment=ae.isMeshStandardMaterial?Ue.environment:null,Fe.fog=Ue.fog,Fe.envMap=(ae.isMeshStandardMaterial?Te:Ae).get(ae.envMap||Fe.environment),Ee===void 0&&(ae.addEventListener("dispose",je),Ee=new Map,Fe.programs=Ee);let ke=Ee.get(Ie);if(ke!==void 0){if(Fe.currentProgram===ke&&Fe.lightsStateVersion===re)return Qo(ae,Me),ke}else Me.uniforms=Be.getUniforms(ae),ae.onBuild(Je,Me,g),ae.onBeforeCompile(Me,g),ke=Be.acquireProgram(Me,Ie),Ee.set(Ie,ke),Fe.uniforms=Me.uniforms;let ut=Fe.uniforms;(!ae.isShaderMaterial&&!ae.isRawShaderMaterial||ae.clipping===!0)&&(ut.clippingPlanes=N.uniform),Qo(ae,Me),Fe.needsLights=da(ae),Fe.lightsStateVersion=re,Fe.needsLights&&(ut.ambientLightColor.value=Ze.state.ambient,ut.lightProbe.value=Ze.state.probe,ut.directionalLights.value=Ze.state.directional,ut.directionalLightShadows.value=Ze.state.directionalShadow,ut.spotLights.value=Ze.state.spot,ut.spotLightShadows.value=Ze.state.spotShadow,ut.rectAreaLights.value=Ze.state.rectArea,ut.ltc_1.value=Ze.state.rectAreaLTC1,ut.ltc_2.value=Ze.state.rectAreaLTC2,ut.pointLights.value=Ze.state.point,ut.pointLightShadows.value=Ze.state.pointShadow,ut.hemisphereLights.value=Ze.state.hemi,ut.directionalShadowMap.value=Ze.state.directionalShadowMap,ut.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,ut.spotShadowMap.value=Ze.state.spotShadowMap,ut.spotLightMatrix.value=Ze.state.spotLightMatrix,ut.spotLightMap.value=Ze.state.spotLightMap,ut.pointShadowMap.value=Ze.state.pointShadowMap,ut.pointShadowMatrix.value=Ze.state.pointShadowMatrix);let pt=ke.getUniforms(),Dt=SM.seqWithValue(pt.seq,ut);return Fe.currentProgram=ke,Fe.uniformsList=Dt,ke}function Qo(ae,Ue){let Je=ee.get(ae);Je.outputEncoding=Ue.outputEncoding,Je.instancing=Ue.instancing,Je.skinning=Ue.skinning,Je.morphTargets=Ue.morphTargets,Je.morphNormals=Ue.morphNormals,Je.morphColors=Ue.morphColors,Je.morphTargetsCount=Ue.morphTargetsCount,Je.numClippingPlanes=Ue.numClippingPlanes,Je.numIntersection=Ue.numClipIntersection,Je.vertexAlphas=Ue.vertexAlphas,Je.vertexTangents=Ue.vertexTangents,Je.toneMapping=Ue.toneMapping}function mh(ae,Ue,Je,Fe,Ze){Ue.isScene!==!0&&(Ue=G),we.resetTextureUnits();let Pt=Ue.fog,re=Fe.isMeshStandardMaterial?Ue.environment:null,Me=y===null?g.outputEncoding:y.isXRRenderTarget===!0?y.texture.encoding:Bl,Ie=(Fe.isMeshStandardMaterial?Te:Ae).get(Fe.envMap||re),Ee=Fe.vertexColors===!0&&!!Je.attributes.color&&Je.attributes.color.itemSize===4,ke=!!Fe.normalMap&&!!Je.attributes.tangent,ut=!!Je.morphAttributes.position,pt=!!Je.morphAttributes.normal,Dt=!!Je.morphAttributes.color,Nt=Fe.toneMapped?g.toneMapping:Rc,ni=Je.morphAttributes.position||Je.morphAttributes.normal||Je.morphAttributes.color,Tt=ni!==void 0?ni.length:0,gt=ee.get(Fe),gi=d.state.lights;if(U===!0&&(j===!0||ae!==A)){let ie=ae===A&&Fe.id===_;N.setState(Fe,ae,ie)}let Rt=!1;Fe.version===gt.__version?(gt.needsLights&&gt.lightsStateVersion!==gi.state.version||gt.outputEncoding!==Me||Ze.isInstancedMesh&&gt.instancing===!1||!Ze.isInstancedMesh&&gt.instancing===!0||Ze.isSkinnedMesh&&gt.skinning===!1||!Ze.isSkinnedMesh&&gt.skinning===!0||gt.envMap!==Ie||Fe.fog===!0&&gt.fog!==Pt||gt.numClippingPlanes!==void 0&&(gt.numClippingPlanes!==N.numPlanes||gt.numIntersection!==N.numIntersection)||gt.vertexAlphas!==Ee||gt.vertexTangents!==ke||gt.morphTargets!==ut||gt.morphNormals!==pt||gt.morphColors!==Dt||gt.toneMapping!==Nt||de.isWebGL2===!0&&gt.morphTargetsCount!==Tt)&&(Rt=!0):(Rt=!0,gt.__version=Fe.version);let Cr=gt.currentProgram;Rt===!0&&(Cr=Ai(Fe,Ue,Ze));let qr=!1,Pi=!1,Xt=!1,Q=Cr.getUniforms(),$=gt.uniforms;if(xe.useProgram(Cr.program)&&(qr=!0,Pi=!0,Xt=!0),Fe.id!==_&&(_=Fe.id,Pi=!0),qr||A!==ae){if(Q.setValue(Z,"projectionMatrix",ae.projectionMatrix),de.logarithmicDepthBuffer&&Q.setValue(Z,"logDepthBufFC",2/(Math.log(ae.far+1)/Math.LN2)),A!==ae&&(A=ae,Pi=!0,Xt=!0),Fe.isShaderMaterial||Fe.isMeshPhongMaterial||Fe.isMeshToonMaterial||Fe.isMeshStandardMaterial||Fe.envMap){let ie=Q.map.cameraPosition;ie!==void 0&&ie.setValue(Z,te.setFromMatrixPosition(ae.matrixWorld))}(Fe.isMeshPhongMaterial||Fe.isMeshToonMaterial||Fe.isMeshLambertMaterial||Fe.isMeshBasicMaterial||Fe.isMeshStandardMaterial||Fe.isShaderMaterial)&&Q.setValue(Z,"isOrthographic",ae.isOrthographicCamera===!0),(Fe.isMeshPhongMaterial||Fe.isMeshToonMaterial||Fe.isMeshLambertMaterial||Fe.isMeshBasicMaterial||Fe.isMeshStandardMaterial||Fe.isShaderMaterial||Fe.isShadowMaterial||Ze.isSkinnedMesh)&&Q.setValue(Z,"viewMatrix",ae.matrixWorldInverse)}if(Ze.isSkinnedMesh){Q.setOptional(Z,Ze,"bindMatrix"),Q.setOptional(Z,Ze,"bindMatrixInverse");let ie=Ze.skeleton;ie&&(de.floatVertexTextures?(ie.boneTexture===null&&ie.computeBoneTexture(),Q.setValue(Z,"boneTexture",ie.boneTexture,we),Q.setValue(Z,"boneTextureSize",ie.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let ge=Je.morphAttributes;if((ge.position!==void 0||ge.normal!==void 0||ge.color!==void 0&&de.isWebGL2===!0)&&X.update(Ze,Je,Fe,Cr),(Pi||gt.receiveShadow!==Ze.receiveShadow)&&(gt.receiveShadow=Ze.receiveShadow,Q.setValue(Z,"receiveShadow",Ze.receiveShadow)),Fe.isMeshGouraudMaterial&&Fe.envMap!==null&&($.envMap.value=Ie,$.flipEnvMap.value=Ie.isCubeTexture&&Ie.isRenderTargetTexture===!1?-1:1),Pi&&(Q.setValue(Z,"toneMappingExposure",g.toneMappingExposure),gt.needsLights&&gh($,Xt),Pt&&Fe.fog===!0&&at.refreshFogUniforms($,Pt),at.refreshMaterialUniforms($,Fe,R,P,k),SM.upload(Z,gt.uniformsList,$,we)),Fe.isShaderMaterial&&Fe.uniformsNeedUpdate===!0&&(SM.upload(Z,gt.uniformsList,$,we),Fe.uniformsNeedUpdate=!1),Fe.isSpriteMaterial&&Q.setValue(Z,"center",Ze.center),Q.setValue(Z,"modelViewMatrix",Ze.modelViewMatrix),Q.setValue(Z,"normalMatrix",Ze.normalMatrix),Q.setValue(Z,"modelMatrix",Ze.matrixWorld),Ze.previousModelViewMatrix&&Q.setValue(Z,"previousModelViewMatrix",Ze.previousModelViewMatrix),ae.previousProjectionMatrix&&Q.setValue(Z,"previousProjectionMatrix",ae.previousProjectionMatrix),Fe.isShaderMaterial||Fe.isRawShaderMaterial){let ie=Fe.uniformsGroups;for(let Se=0,lt=ie.length;Se<lt;Se++)if(de.isWebGL2){let zi=ie[Se];Pe.update(zi,Cr),Pe.bind(zi,Cr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Cr}function gh(ae,Ue){ae.ambientLightColor.needsUpdate=Ue,ae.lightProbe.needsUpdate=Ue,ae.directionalLights.needsUpdate=Ue,ae.directionalLightShadows.needsUpdate=Ue,ae.pointLights.needsUpdate=Ue,ae.pointLightShadows.needsUpdate=Ue,ae.spotLights.needsUpdate=Ue,ae.spotLightShadows.needsUpdate=Ue,ae.rectAreaLights.needsUpdate=Ue,ae.hemisphereLights.needsUpdate=Ue}function da(ae){return ae.isMeshLambertMaterial||ae.isMeshToonMaterial||ae.isMeshPhongMaterial||ae.isMeshStandardMaterial||ae.isShadowMaterial||ae.isShaderMaterial&&ae.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(ae,Ue,Je){ee.get(ae.texture).__webglTexture=Ue,ee.get(ae.depthTexture).__webglTexture=Je;let Fe=ee.get(ae);Fe.__hasExternalTextures=!0,Fe.__hasExternalTextures&&(Fe.__autoAllocateDepthBuffer=Je===void 0,Fe.__autoAllocateDepthBuffer||ye.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Fe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ae,Ue){let Je=ee.get(ae);Je.__webglFramebuffer=Ue,Je.__useDefaultFramebuffer=Ue===void 0},this.setRenderTarget=function(ae,Ue=0,Je=0){y=ae,v=Ue,x=Je;let Fe=!0,Ze=null,Pt=!1,re=!1;if(ae){let Me=ee.get(ae);Me.__useDefaultFramebuffer!==void 0?(xe.bindFramebuffer(36160,null),Fe=!1):Me.__webglFramebuffer===void 0?we.setupRenderTarget(ae):Me.__hasExternalTextures&&we.rebindTextures(ae,ee.get(ae.texture).__webglTexture,ee.get(ae.depthTexture).__webglTexture);let Ie=ae.texture;(Ie.isData3DTexture||Ie.isDataArrayTexture||Ie.isCompressedArrayTexture)&&(re=!0);let Ee=ee.get(ae).__webglFramebuffer;ae.isWebGLCubeRenderTarget?(Ze=Ee[Ue],Pt=!0):de.isWebGL2&&ae.samples>0&&we.useMultisampledRTT(ae)===!1?Ze=ee.get(ae).__webglMultisampledFramebuffer:Ze=Ee,S.copy(ae.viewport),C.copy(ae.scissor),M=ae.scissorTest}else S.copy(I).multiplyScalar(R).floor(),C.copy(z).multiplyScalar(R).floor(),M=K;if(xe.bindFramebuffer(36160,Ze)&&de.drawBuffers&&Fe&&xe.drawBuffers(ae,Ze),xe.viewport(S),xe.scissor(C),xe.setScissorTest(M),Pt){let Me=ee.get(ae.texture);Z.framebufferTexture2D(36160,36064,34069+Ue,Me.__webglTexture,Je)}else if(re){let Me=ee.get(ae.texture),Ie=Ue||0;Z.framebufferTextureLayer(36160,36064,Me.__webglTexture,Je||0,Ie)}_=-1},this.readRenderTargetPixels=function(ae,Ue,Je,Fe,Ze,Pt,re){if(!(ae&&ae.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Me=ee.get(ae).__webglFramebuffer;if(ae.isWebGLCubeRenderTarget&&re!==void 0&&(Me=Me[re]),Me){xe.bindFramebuffer(36160,Me);try{let Ie=ae.texture,Ee=Ie.format,ke=Ie.type;if(Ee!==Er&&Ye.convert(Ee)!==Z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let ut=ke===nh&&(ye.has("EXT_color_buffer_half_float")||de.isWebGL2&&ye.has("EXT_color_buffer_float"));if(ke!==Us&&Ye.convert(ke)!==Z.getParameter(35738)&&!(ke===Ki&&(de.isWebGL2||ye.has("OES_texture_float")||ye.has("WEBGL_color_buffer_float")))&&!ut){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ue>=0&&Ue<=ae.width-Fe&&Je>=0&&Je<=ae.height-Ze&&Z.readPixels(Ue,Je,Fe,Ze,Ye.convert(Ee),Ye.convert(ke),Pt)}finally{let Ie=y!==null?ee.get(y).__webglFramebuffer:null;xe.bindFramebuffer(36160,Ie)}}},this.readRenderTargetPixelsAsync=async function(ae,Ue,Je,Fe,Ze,Pt,re){if(!(ae&&ae.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Me=ee.get(ae).__webglFramebuffer;if(ae.isWebGLCubeRenderTarget&&re!==void 0&&(Me=Me[re]),Me){let Ie=ae.texture,Ee=Ie.format,ke=Ie.type;if(Ue>=0&&Ue<=ae.width-Fe&&Je>=0&&Je<=ae.height-Ze){xe.bindFramebuffer(Z.FRAMEBUFFER,Me);let ut=Z.createBuffer();Z.bindBuffer(Z.PIXEL_PACK_BUFFER,ut),Z.bufferData(Z.PIXEL_PACK_BUFFER,Pt.byteLength,Z.STREAM_READ),Z.readPixels(Ue,Je,Fe,Ze,Ye.convert(Ee),Ye.convert(ke),0);let pt=y!==null?ee.get(y).__webglFramebuffer:null;xe.bindFramebuffer(Z.FRAMEBUFFER,pt);let Dt=Z.fenceSync(Z.SYNC_GPU_COMMANDS_COMPLETE,0);return Z.flush(),await v_e(Z,Dt,4),Z.bindBuffer(Z.PIXEL_PACK_BUFFER,ut),Z.getBufferSubData(Z.PIXEL_PACK_BUFFER,0,Pt),Z.deleteBuffer(ut),Z.deleteSync(Dt),Pt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ae,Ue,Je=0){let Fe=Math.pow(2,-Je),Ze=Math.floor(Ue.image.width*Fe),Pt=Math.floor(Ue.image.height*Fe);we.setTexture2D(Ue,0),Z.copyTexSubImage2D(3553,Je,0,0,ae.x,ae.y,Ze,Pt),xe.unbindTexture()},this.copyTextureToTexture=function(ae,Ue,Je,Fe=0){let Ze=Ue.image.width,Pt=Ue.image.height,re=Ye.convert(Je.format),Me=Ye.convert(Je.type);we.setTexture2D(Je,0),Z.pixelStorei(37440,Je.flipY),Z.pixelStorei(37441,Je.premultiplyAlpha),Z.pixelStorei(3317,Je.unpackAlignment),Ue.isDataTexture?Z.texSubImage2D(3553,Fe,ae.x,ae.y,Ze,Pt,re,Me,Ue.image.data):Ue.isCompressedTexture?Z.compressedTexSubImage2D(3553,Fe,ae.x,ae.y,Ue.mipmaps[0].width,Ue.mipmaps[0].height,re,Ue.mipmaps[0].data):Z.texSubImage2D(3553,Fe,ae.x,ae.y,re,Me,Ue.image),Fe===0&&Je.generateMipmaps&&Z.generateMipmap(3553),xe.unbindTexture()},this.copyTextureToTexture3D=function(ae,Ue,Je,Fe,Ze=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Pt=ae.max.x-ae.min.x+1,re=ae.max.y-ae.min.y+1,Me=ae.max.z-ae.min.z+1,Ie=Ye.convert(Fe.format),Ee=Ye.convert(Fe.type),ke;if(Fe.isData3DTexture)we.setTexture3D(Fe,0),ke=32879;else if(Fe.isDataArrayTexture)we.setTexture2DArray(Fe,0),ke=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(37440,Fe.flipY),Z.pixelStorei(37441,Fe.premultiplyAlpha),Z.pixelStorei(3317,Fe.unpackAlignment);let ut=Z.getParameter(3314),pt=Z.getParameter(32878),Dt=Z.getParameter(3316),Nt=Z.getParameter(3315),ni=Z.getParameter(32877),Tt=Je.isCompressedTexture?Je.mipmaps[0]:Je.image;Z.pixelStorei(3314,Tt.width),Z.pixelStorei(32878,Tt.height),Z.pixelStorei(3316,ae.min.x),Z.pixelStorei(3315,ae.min.y),Z.pixelStorei(32877,ae.min.z),Je.isDataTexture||Je.isData3DTexture?Z.texSubImage3D(ke,Ze,Ue.x,Ue.y,Ue.z,Pt,re,Me,Ie,Ee,Tt.data):Je.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Z.compressedTexSubImage3D(ke,Ze,Ue.x,Ue.y,Ue.z,Pt,re,Me,Ie,Tt.data)):Z.texSubImage3D(ke,Ze,Ue.x,Ue.y,Ue.z,Pt,re,Me,Ie,Ee,Tt),Z.pixelStorei(3314,ut),Z.pixelStorei(32878,pt),Z.pixelStorei(3316,Dt),Z.pixelStorei(3315,Nt),Z.pixelStorei(32877,ni),Ze===0&&Fe.generateMipmaps&&Z.generateMipmap(ke),xe.unbindTexture()},this.initRenderTarget=function(ae){ee.get(ae).__webglFramebuffer===void 0&&we.setupRenderTarget(ae)},this.initTexture=function(ae){ae.isCubeTexture?we.setTextureCube(ae,0):ae.isData3DTexture?we.setTexture3D(ae,0):ae.isDataArrayTexture||ae.isCompressedArrayTexture?we.setTexture2DArray(ae,0):we.setTexture2D(ae,0),xe.unbindTexture()},this.resetState=function(){v=0,x=0,y=null,xe.reset(),_e.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var pCe=class extends _${};pCe.prototype.isWebGL1Renderer=!0;var S$=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new jt(e),this.near=t,this.far=i}clone(){return new S$(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Ia=class extends Qi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},fCe=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=HL,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ko()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Xs=new F,qL=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Xs.fromBufferAttribute(this,t),Xs.applyMatrix4(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Xs.fromBufferAttribute(this,t),Xs.applyNormalMatrix(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Xs.fromBufferAttribute(this,t),Xs.transformDirection(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}setX(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=lr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=zu(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=zu(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=zu(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=zu(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=lr(t,this.array),i=lr(i,this.array),r=lr(r,this.array),n=lr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new Wt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new qL(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},A$=class extends Qi{constructor(){super(),this.isBone=!0,this.type="Bone"}},ia=class extends Br{constructor(e=null,t=1,i=1,r,n,s,a,o,l=vi,c=vi,u,h){super(null,s,a,o,l,c,r,n,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},p6=new ot,mCe=new ot,yU=class{constructor(e=[],t=[]){this.uuid=ko(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new ot)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new ot;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:mCe;p6.multiplyMatrices(a,t[n]),p6.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new yU(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=o$(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new ia(t,e,e,Er,Ki);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new A$),this.bones.push(s),this.boneInverses.push(new ot().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},nw=class extends Wt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},f6=new ot,m6=new ot,WS=[],gCe=new ot,t1=new cr,vCe=class extends cr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new nw(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,gCe)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(t1.geometry=this.geometry,t1.material=this.material,t1.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,f6),m6.multiplyMatrices(i,f6),t1.matrixWorld=m6,t1.raycast(e,WS);for(let s=0,a=WS.length;s<a;s++){let o=WS[s];o.instanceId=n,o.object=this,t.push(o)}WS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new nw(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},up=class extends sb{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},g6=new F,v6=new F,y6=new ot,hR=new V0,XS=new Oa,IE=class extends Qi{constructor(e=new Ot,t=new up){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)g6.fromBufferAttribute(t,r-1),v6.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=g6.distanceTo(v6);e.setAttribute("lineDistance",new xt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),XS.copy(i.boundingSphere),XS.applyMatrix4(r),XS.radius+=n,e.ray.intersectsSphere(XS)===!1)return;y6.copy(r).invert(),hR.copy(e.ray).applyMatrix4(y6);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new F,c=new F,u=new F,h=new F,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){let g=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let v=g,x=m-1;v<x;v+=d){let y=p.getX(v),_=p.getX(v+1);if(l.fromBufferAttribute(f,y),c.fromBufferAttribute(f,_),hR.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let A=e.ray.origin.distanceTo(h);A<e.near||A>e.far||t.push({distance:A,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let g=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count);for(let v=g,x=m-1;v<x;v+=d){if(l.fromBufferAttribute(f,v),c.fromBufferAttribute(f,v+1),hR.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let y=e.ray.origin.distanceTo(h);y<e.near||y>e.far||t.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},x6=new F,w6=new F,ab=class extends IE{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)x6.fromBufferAttribute(t,r),w6.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+x6.distanceTo(w6);e.setAttribute("lineDistance",new xt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},yCe=class extends Br{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:di,this.magFilter=n!==void 0?n:di,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},xCe=class extends Br{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},jc=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new pe:new F);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new F,r=[],n=[],s=[],a=new F,o=new ot;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new F)}n[0]=new F,s[0]=new F;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(pn(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(pn(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let p=1;p<=e;p++)n[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},ST=class extends jc{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new pe,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},wCe=class extends ST{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function xU(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var YS=new F,dR=new xU,pR=new xU,fR=new xU,bCe=class extends jc{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new F){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(YS.subVectors(r[0],r[1]).add(r[0]),l=YS);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(YS.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=YS),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(h),d),g=Math.pow(h.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),g<1e-4&&(g=f),dR.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,p,f,g),pR.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,p,f,g),fR.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,p,f,g)}else this.curveType==="catmullrom"&&(dR.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),pR.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),fR.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(dR.calc(o),pR.calc(o),fR.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new F().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function b6(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function _Ce(e,t){let i=1-e;return i*i*t}function SCe(e,t){return 2*(1-e)*e*t}function ACe(e,t){return e*e*t}function cx(e,t,i,r){return _Ce(e,t)+SCe(e,i)+ACe(e,r)}function MCe(e,t){let i=1-e;return i*i*i*t}function ECe(e,t){let i=1-e;return 3*i*i*e*t}function CCe(e,t){return 3*(1-e)*e*e*t}function TCe(e,t){return e*e*e*t}function ux(e,t,i,r,n){return MCe(e,t)+ECe(e,i)+CCe(e,r)+TCe(e,n)}var _l=class extends jc{constructor(e=new pe,t=new pe,i=new pe,r=new pe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new pe){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(ux(e,r.x,n.x,s.x,a.x),ux(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},AM=class extends jc{constructor(e=new F,t=new F,i=new F,r=new F){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new F){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(ux(e,r.x,n.x,s.x,a.x),ux(e,r.y,n.y,s.y,a.y),ux(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Rl=class extends jc{constructor(e=new pe,t=new pe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new pe){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new pe;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},M$=class extends jc{constructor(e=new F,t=new F){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new F){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Qd=class extends jc{constructor(e=new pe,t=new pe,i=new pe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new pe){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(cx(e,r.x,n.x,s.x),cx(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},PCe=class extends jc{constructor(e=new F,t=new F,i=new F){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new F){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(cx(e,r.x,n.x,s.x),cx(e,r.y,n.y,s.y),cx(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},wU=class extends jc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new pe){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(b6(a,o.x,l.x,c.x,u.x),b6(a,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new pe().fromArray(r))}return this}},DCe=Object.freeze({__proto__:null,ArcCurve:wCe,CatmullRomCurve3:bCe,CubicBezierCurve:_l,CubicBezierCurve3:AM,EllipseCurve:ST,LineCurve:Rl,LineCurve3:M$,QuadraticBezierCurve:Qd,QuadraticBezierCurve3:PCe,SplineCurve:wU}),E$=class extends jc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Rl(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new DCe[r.type]().fromJSON(r))}return this}},LE=class extends E${constructor(e){super(),this.type="Path",this.currentPoint=new pe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Rl(this.currentPoint.clone(),new pe(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new Qd(this.currentPoint.clone(),new pe(e,t),new pe(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new _l(this.currentPoint.clone(),new pe(e,t),new pe(i,r),new pe(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new wU(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new ST(e,t,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},C$=class extends Ot{constructor(e=[new pe(0,-.5),new pe(.5,0),new pe(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=pn(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/t,u=new F,h=new pe,d=new F,p=new F,f=new F,g=0,m=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:g=e[v+1].x-e[v].x,m=e[v+1].y-e[v].y,d.x=m*1,d.y=-g,d.z=m*0,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:g=e[v+1].x-e[v].x,m=e[v+1].y-e[v].y,d.x=m*1,d.y=-g,d.z=m*0,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){let x=i+v*c*r,y=Math.sin(x),_=Math.cos(x);for(let A=0;A<=e.length-1;A++){u.x=e[A].x*y,u.y=e[A].y,u.z=e[A].x*_,s.push(u.x,u.y,u.z),h.x=v/t,h.y=A/(e.length-1),a.push(h.x,h.y);let S=o[3*A+0]*y,C=o[3*A+1],M=o[3*A+0]*_;l.push(S,C,M)}}for(let v=0;v<t;v++)for(let x=0;x<e.length-1;x++){let y=x+v*e.length,_=y,A=y+e.length,S=y+e.length+1,C=y+1;n.push(_,A,C),n.push(S,C,A)}this.setIndex(n),this.setAttribute("position",new xt(s,3)),this.setAttribute("uv",new xt(a,2)),this.setAttribute("normal",new xt(l,3))}static fromJSON(e){return new C$(e.points,e.segments,e.phiStart,e.phiLength)}},bU=class extends Ot{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],p=0,f=[],g=i/2,m=0;v(),s===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(c),this.setAttribute("position",new xt(u,3)),this.setAttribute("normal",new xt(h,3)),this.setAttribute("uv",new xt(d,2));function v(){let y=new F,_=new F,A=0,S=(t-e)/i;for(let C=0;C<=n;C++){let M=[],E=C/n,P=E*(t-e)+e;for(let R=0;R<=r;R++){let O=R/r,L=O*o+a,I=Math.sin(L),z=Math.cos(L);_.x=P*I,_.y=-E*i+g,_.z=P*z,u.push(_.x,_.y,_.z),y.set(I,S,z).normalize(),h.push(y.x,y.y,y.z),d.push(O,1-E),M.push(p++)}f.push(M)}for(let C=0;C<r;C++)for(let M=0;M<n;M++){let E=f[M][C],P=f[M+1][C],R=f[M+1][C+1],O=f[M][C+1];c.push(E,P,O),c.push(P,R,O),A+=6}l.addGroup(m,A,0),m+=A}function x(y){let _=p,A=new pe,S=new F,C=0,M=y===!0?e:t,E=y===!0?1:-1;for(let R=1;R<=r;R++)u.push(0,g*E,0),h.push(0,E,0),d.push(.5,.5),p++;let P=p;for(let R=0;R<=r;R++){let O=R/r*o+a,L=Math.cos(O),I=Math.sin(O);S.x=M*I,S.y=g*E,S.z=M*L,u.push(S.x,S.y,S.z),h.push(0,E,0),A.x=L*.5+.5,A.y=I*.5*E+.5,d.push(A.x,A.y),p++}for(let R=0;R<r;R++){let O=_+R,L=P+R;y===!0?c.push(L,L+1,O):c.push(L+1,L,O),C+=3}l.addGroup(m,C,y===!0?1:2),m+=C}}static fromJSON(e){return new bU(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},_U=class extends bU{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new _U(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},SU=class extends Ot{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new xt(n,3)),this.setAttribute("normal",new xt(n.slice(),3)),this.setAttribute("uv",new xt(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(v){let x=new F,y=new F,_=new F;for(let A=0;A<t.length;A+=3)d(t[A+0],x),d(t[A+1],y),d(t[A+2],_),o(x,y,_,v)}function o(v,x,y,_){let A=_+1,S=[];for(let C=0;C<=A;C++){S[C]=[];let M=v.clone().lerp(y,C/A),E=x.clone().lerp(y,C/A),P=A-C;for(let R=0;R<=P;R++)R===0&&C===A?S[C][R]=M:S[C][R]=M.clone().lerp(E,R/P)}for(let C=0;C<A;C++)for(let M=0;M<2*(A-C)-1;M++){let E=Math.floor(M/2);M%2===0?(h(S[C][E+1]),h(S[C+1][E]),h(S[C][E])):(h(S[C][E+1]),h(S[C+1][E+1]),h(S[C+1][E]))}}function l(v){let x=new F;for(let y=0;y<n.length;y+=3)x.x=n[y+0],x.y=n[y+1],x.z=n[y+2],x.normalize().multiplyScalar(v),n[y+0]=x.x,n[y+1]=x.y,n[y+2]=x.z}function c(){let v=new F;for(let x=0;x<n.length;x+=3){v.x=n[x+0],v.y=n[x+1],v.z=n[x+2];let y=g(v)/2/Math.PI+.5,_=m(v)/Math.PI+.5;s.push(y,1-_)}p(),u()}function u(){for(let v=0;v<s.length;v+=6){let x=s[v+0],y=s[v+2],_=s[v+4],A=Math.max(x,y,_),S=Math.min(x,y,_);A>.9&&S<.1&&(x<.2&&(s[v+0]+=1),y<.2&&(s[v+2]+=1),_<.2&&(s[v+4]+=1))}}function h(v){n.push(v.x,v.y,v.z)}function d(v,x){let y=v*3;x.x=e[y+0],x.y=e[y+1],x.z=e[y+2]}function p(){let v=new F,x=new F,y=new F,_=new F,A=new pe,S=new pe,C=new pe;for(let M=0,E=0;M<n.length;M+=9,E+=6){v.set(n[M+0],n[M+1],n[M+2]),x.set(n[M+3],n[M+4],n[M+5]),y.set(n[M+6],n[M+7],n[M+8]),A.set(s[E+0],s[E+1]),S.set(s[E+2],s[E+3]),C.set(s[E+4],s[E+5]),_.copy(v).add(x).add(y).divideScalar(3);let P=g(_);f(A,E+0,v,P),f(S,E+2,x,P),f(C,E+4,y,P)}}function f(v,x,y,_){_<0&&v.x===1&&(s[x]=v.x-1),y.x===0&&y.z===0&&(s[x]=_/2/Math.PI+.5)}function g(v){return Math.atan2(v.z,-v.x)}function m(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(e){return new SU(e.vertices,e.indices,e.radius,e.details)}},T$=class extends SU{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new T$(e.radius,e.detail)}},OE=class extends LE{constructor(e){super(e),this.uuid=ko(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new LE().fromJSON(r))}return this}},RCe={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=P$(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=FCe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<n;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return sw(s,a,i,o,l,p,0),a}};function P$(e,t,i,r,n){let s,a;if(n===YCe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=_6(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=_6(s,e[s],e[s+1],a);return a&&AT(a,a.next)&&(ow(a),a=a.next),a}function rm(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(AT(i,i.next)||Lr(i.prev,i,i.next)===0)){if(ow(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function sw(e,t,i,r,n,s,a){if(!e)return;!a&&s&&VCe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?LCe(e,r,n,s):ICe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),ow(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=OCe(rm(e),t,i),sw(e,t,i,r,n,s,2)):a===2&&BCe(e,t,i,r,n,s):sw(rm(e),t,i,r,n,s,1);break}}}function ICe(e){let t=e.prev,i=e,r=e.next;if(Lr(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&wv(n,o,s,l,a,c,f.x,f.y)&&Lr(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function LCe(e,t,i,r){let n=e.prev,s=e,a=e.next;if(Lr(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,g=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,v=QL(p,f,t,i,r),x=QL(g,m,t,i,r),y=e.prevZ,_=e.nextZ;for(;y&&y.z>=v&&_&&_.z<=x;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==n&&y!==a&&wv(o,u,l,h,c,d,y.x,y.y)&&Lr(y.prev,y,y.next)>=0||(y=y.prevZ,_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&wv(o,u,l,h,c,d,_.x,_.y)&&Lr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==n&&y!==a&&wv(o,u,l,h,c,d,y.x,y.y)&&Lr(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&wv(o,u,l,h,c,d,_.x,_.y)&&Lr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function OCe(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!AT(n,s)&&D$(n,r,r.next,s)&&aw(n,s)&&aw(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),ow(r),ow(r.next),r=e=s),r=r.next}while(r!==e);return rm(r)}function BCe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&jCe(a,o)){let l=R$(a,o);a=rm(a,a.next),l=rm(l,l.next),sw(a,t,i,r,n,s,0),sw(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function FCe(e,t,i,r){let n=[],s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=P$(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(HCe(c));for(n.sort(NCe),s=0;s<n.length;s++)i=UCe(n[s],i);return i}function NCe(e,t){return e.x-t.x}function UCe(e,t){let i=kCe(e,t);if(!i)return t;let r=R$(i,e);return rm(r,r.next),rm(i,i.next)}function kCe(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&wv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),aw(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&zCe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function zCe(e,t){return Lr(e.prev,e,t.prev)<0&&Lr(t.next,e,e.next)<0}function VCe(e,t,i,r){let n=e;do n.z===0&&(n.z=QL(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,GCe(n)}function GCe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function QL(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function HCe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function wv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function jCe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!WCe(e,t)&&(aw(e,t)&&aw(t,e)&&XCe(e,t)&&(Lr(e.prev,e,t.prev)||Lr(e,t.prev,t))||AT(e,t)&&Lr(e.prev,e,e.next)>0&&Lr(t.prev,t,t.next)>0)}function Lr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function AT(e,t){return e.x===t.x&&e.y===t.y}function D$(e,t,i,r){let n=QS(Lr(e,t,i)),s=QS(Lr(e,t,r)),a=QS(Lr(i,r,e)),o=QS(Lr(i,r,t));return!!(n!==s&&a!==o||n===0&&qS(e,i,t)||s===0&&qS(e,r,t)||a===0&&qS(i,e,r)||o===0&&qS(i,t,r))}function qS(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function QS(e){return e>0?1:e<0?-1:0}function WCe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&D$(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function aw(e,t){return Lr(e.prev,e,e.next)<0?Lr(e,t,e.next)>=0&&Lr(e,e.prev,t)>=0:Lr(e,t,e.prev)<0||Lr(e,e.next,t)<0}function XCe(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function R$(e,t){let i=new JL(e.i,e.x,e.y),r=new JL(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function _6(e,t,i,r){let n=new JL(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ow(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function JL(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function YCe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var I$=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return I$.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];S6(e),A6(i,e);let s=e.length;t.forEach(S6);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,A6(i,t[o]);let a=RCe.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function S6(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function A6(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var L$=class extends SU{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new L$(e.radius,e.detail)}},Fv=class extends Ot{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new F,h=new F,d=[],p=[],f=[],g=[];for(let m=0;m<=i;m++){let v=[],x=m/i,y=0;m==0&&s==0?y=.5/t:m==i&&o==Math.PI&&(y=-.5/t);for(let _=0;_<=t;_++){let A=_/t;u.x=-e*Math.cos(r+A*n)*Math.sin(s+x*a),u.y=e*Math.cos(s+x*a),u.z=e*Math.sin(r+A*n)*Math.sin(s+x*a),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),g.push(A+y,1-x),v.push(l++)}c.push(v)}for(let m=0;m<i;m++)for(let v=0;v<t;v++){let x=c[m][v+1],y=c[m][v],_=c[m+1][v],A=c[m+1][v+1];(m!==0||s>0)&&d.push(x,y,A),(m!==i-1||o<Math.PI)&&d.push(y,_,A)}this.setIndex(d),this.setAttribute("position",new xt(p,3)),this.setAttribute("normal",new xt(f,3)),this.setAttribute("uv",new xt(g,2))}static fromJSON(e){return new Fv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},O$=class extends Ot{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new F,u=new F,h=new F;for(let d=0;d<=i;d++)for(let p=0;p<=r;p++){let f=p/r*n,g=d/i*Math.PI*2;u.x=(e+t*Math.cos(g))*Math.cos(f),u.y=(e+t*Math.cos(g))*Math.sin(f),u.z=t*Math.sin(g),a.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(p/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=r;p++){let f=(r+1)*d+p-1,g=(r+1)*(d-1)+p-1,m=(r+1)*(d-1)+p,v=(r+1)*d+p;s.push(f,g,v),s.push(g,m,v)}this.setIndex(s),this.setAttribute("position",new xt(a,3)),this.setAttribute("normal",new xt(o,3)),this.setAttribute("uv",new xt(l,2))}static fromJSON(e){return new O$(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},B$=class extends Ot{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new F,h=new F,d=new F,p=new F,f=new F,g=new F,m=new F;for(let x=0;x<=i;++x){let y=x/i*n*Math.PI*2;v(y,n,s,e,d),v(y+.01,n,s,e,p),g.subVectors(p,d),m.addVectors(p,d),f.crossVectors(g,m),m.crossVectors(f,g),f.normalize(),m.normalize();for(let _=0;_<=r;++_){let A=_/r*Math.PI*2,S=-t*Math.cos(A),C=t*Math.sin(A);u.x=d.x+(S*m.x+C*f.x),u.y=d.y+(S*m.y+C*f.y),u.z=d.z+(S*m.z+C*f.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(x/i),c.push(_/r)}}for(let x=1;x<=i;x++)for(let y=1;y<=r;y++){let _=(r+1)*(x-1)+(y-1),A=(r+1)*x+(y-1),S=(r+1)*x+y,C=(r+1)*(x-1)+y;a.push(_,A,C),a.push(A,S,C)}this.setIndex(a),this.setAttribute("position",new xt(o,3)),this.setAttribute("normal",new xt(l,3)),this.setAttribute("uv",new xt(c,2));function v(x,y,_,A,S){let C=Math.cos(x),M=Math.sin(x),E=_/y*x,P=Math.cos(E);S.x=A*(2+P)*.5*C,S.y=A*(2+P)*M*.5,S.z=A*Math.sin(E)*.5}}static fromJSON(e){return new B$(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},qCe=class extends Ri{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Fh(e,t,i){return F$(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function JS(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function F$(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function QCe(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function M6(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function N$(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var MT=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},JCe=class extends MT{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:vv,endingEnd:vv}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case yv:n=e,a=2*t-i;break;case PE:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case yv:s=e,o=2*i-t;break;case PE:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,g=f*p,m=-h*g+2*h*f-h*p,v=(1+h)*g+(-1.5-2*h)*f+(-.5+h)*p+1,x=(-1-d)*g+(1.5+d)*f+.5*p,y=d*g-d*f;for(let _=0;_!==a;++_)n[_]=m*s[c+_]+v*s[l+_]+x*s[o+_]+y*s[u+_];return n}},U$=class extends MT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},KCe=class extends MT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Wc=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=JS(t,this.TimeBufferType),this.values=JS(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:JS(e.times,Array),values:JS(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new KCe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new U$(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new JCe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case CE:t=this.InterpolantFactoryMethodDiscrete;break;case TE:t=this.InterpolantFactoryMethodLinear;break;case kD:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return CE;case this.InterpolantFactoryMethodLinear:return TE;case this.InterpolantFactoryMethodSmooth:return kD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Fh(i,n,s),this.values=Fh(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&F$(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Fh(this.times),t=Fh(this.values),i=this.getValueSize(),r=this.getInterpolation()===kD,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let p=0;p!==i;++p){let f=t[u+p];if(f!==t[h+p]||f!==t[d+p]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=Fh(e,0,s),this.values=Fh(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Fh(this.times,0),t=Fh(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Wc.prototype.TimeBufferType=Float32Array;Wc.prototype.ValueBufferType=Float32Array;Wc.prototype.DefaultInterpolation=TE;var j0=class extends Wc{};j0.prototype.ValueTypeName="bool";j0.prototype.ValueBufferType=Array;j0.prototype.DefaultInterpolation=CE;j0.prototype.InterpolantFactoryMethodLinear=void 0;j0.prototype.InterpolantFactoryMethodSmooth=void 0;var k$=class extends Wc{};k$.prototype.ValueTypeName="color";var BE=class extends Wc{};BE.prototype.ValueTypeName="number";var ZCe=class extends MT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let c=l+a;l!==c;l+=4)$t.slerpFlat(n,0,s,l-a,s,l,o);return n}},ob=class extends Wc{InterpolantFactoryMethodLinear(e){return new ZCe(this.times,this.values,this.getValueSize(),e)}};ob.prototype.ValueTypeName="quaternion";ob.prototype.DefaultInterpolation=TE;ob.prototype.InterpolantFactoryMethodSmooth=void 0;var W0=class extends Wc{};W0.prototype.ValueTypeName="string";W0.prototype.ValueBufferType=Array;W0.prototype.DefaultInterpolation=CE;W0.prototype.InterpolantFactoryMethodLinear=void 0;W0.prototype.InterpolantFactoryMethodSmooth=void 0;var FE=class extends Wc{};FE.prototype.ValueTypeName="vector";var KL=class{constructor(e,t=-1,i,r=dU){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=ko(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(eTe(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(Wc.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=QCe(o);o=M6(o,1,c),l=M6(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new BE(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,p){if(h.length!==0){let f=[],g=[];N$(h,f,g,d),f.length!==0&&p.push(new c(u,f,g))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(let p in h){let f=[],g=[];for(let m=0;m!==u[d].morphTargets.length;++m){let v=u[d];f.push(v.time),g.push(v.morphTarget===p?1:0)}r.push(new BE(".morphTargetInfluence["+p+"]",f,g))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(FE,h+".position",u,"pos",r),i(ob,h+".quaternion",u,"rot",r),i(FE,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function $Ce(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return BE;case"vector":case"vector2":case"vector3":case"vector4":return FE;case"color":return k$;case"quaternion":return ob;case"bool":case"boolean":return j0;case"string":return W0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function eTe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=$Ce(e.type);if(e.times===void 0){let i=[],r=[];N$(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var NE={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},z$=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},tTe=new z$,lb=class{constructor(e){this.manager=e!==void 0?e:tTe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},hu={},iTe=class extends Error{constructor(e,t){super(e),this.response=t}},ZL=class extends lb{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=NE.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(hu[e]!==void 0){hu[e].push({onLoad:t,onProgress:i,onError:r});return}hu[e]=[],hu[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=hu[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,f=0,g=new ReadableStream({start(m){v();function v(){u.read().then(({done:x,value:y})=>{if(x)m.close();else{f+=y.byteLength;let _=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let A=0,S=c.length;A<S;A++){let C=c[A];C.onProgress&&C.onProgress(_)}m.enqueue(y),v()}})}}});return new Response(g)}else throw new iTe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{NE.add(e,l);let c=hu[e];delete hu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=hu[e];if(c===void 0)throw this.manager.itemError(e),l;delete hu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},rTe=class extends lb{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=NE.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=rw("img");function o(){c(),NE.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(u){c(),r&&r(u),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},nTe=class extends lb{constructor(e){super(e)}load(e,t,i,r){let n=new Br,s=new rTe(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},cb=class extends Qi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new jt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},sTe=class extends cb{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new jt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},mR=new ot,E6=new F,C6=new F,AU=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new pe(512,512),this.map=null,this.mapPass=null,this.matrix=new ot,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new gU,this._frameExtents=new pe(1,1),this._viewportCount=1,this._viewports=[new ii(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;E6.setFromMatrixPosition(e.matrixWorld),t.position.copy(E6),C6.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(C6),t.updateMatrixWorld(),mR.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mR),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(mR)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},aTe=class extends AU{constructor(){super(new Ls(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=iw*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},oTe=class extends cb{constructor(e,t,i=0,r=Math.PI/3,n=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.target=new Qi,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new aTe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},T6=new ot,i1=new F,gR=new F,lTe=class extends AU{constructor(){super(new Ls(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new pe(4,2),this._viewportCount=6,this._viewports=[new ii(2,1,1,1),new ii(0,1,1,1),new ii(3,1,1,1),new ii(1,1,1,1),new ii(3,0,1,1),new ii(1,0,1,1)],this._cubeDirections=[new F(1,0,0),new F(-1,0,0),new F(0,0,1),new F(0,0,-1),new F(0,1,0),new F(0,-1,0)],this._cubeUps=[new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,0,1),new F(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),i1.setFromMatrixPosition(e.matrixWorld),i.position.copy(i1),gR.copy(i.position),gR.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(gR),i.updateMatrixWorld(),r.makeTranslation(-i1.x,-i1.y,-i1.z),T6.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(T6)}},cTe=class extends cb{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new lTe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},uTe=class extends AU{constructor(){super(new bT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},hTe=class extends cb{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.target=new Qi,this.shadow=new uTe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},V$=class extends Ot{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},G$=class extends lb{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new ZL(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let p=h.interleavedBuffers[d],f=n(h,p.buffer),g=ES(p.type,f),m=new fCe(g,p.stride);return m.uuid=p.uuid,t[d]=m,m}function n(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],f=new Uint32Array(p).buffer;return i[d]=f,f}let s=e.isInstancedBufferGeometry?new V$:new Ot,a=e.data.index;if(a!==void 0){let h=ES(a.type,a.array);s.setIndex(new Wt(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let f=r(e.data,d.data);p=new qL(f,d.itemSize,d.offset,d.normalized)}else{let f=ES(d.type,d.array),g=d.isInstancedBufferAttribute?nw:Wt;p=new g(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let f=0,g=d.length;f<g;f++){let m=d[f],v;if(m.isInterleavedBufferAttribute){let x=r(e.data,m.data);v=new qL(x,m.itemSize,m.offset,m.normalized)}else{let x=ES(m.type,m.array);v=new Wt(x,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),p.push(v)}s.morphAttributes[h]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let p=c[h];s.addGroup(p.start,p.count,p.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new F;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new Oa(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},dTe=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=P6(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=P6();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function P6(){return(typeof performance>"u"?Date:performance).now()}var pTe=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){$t.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;$t.multiplyQuaternionsFlat(e,s,e,t,e,i),$t.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},MU="\\[\\]\\.:\\/",fTe=new RegExp("["+MU+"]","g"),EU="[^"+MU+"]",mTe="[^"+MU.replace("\\.","")+"]",gTe=/((?:WC+[\/:])*)/.source.replace("WC",EU),vTe=/(WCOD+)?/.source.replace("WCOD",mTe),yTe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",EU),xTe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",EU),wTe=new RegExp("^"+gTe+vTe+yTe+xTe+"$"),bTe=["material","materials","bones","map"],_Te=class{constructor(e,t,i){let r=i||rr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},rr=class{constructor(e,t,i){this.path=t,this.parsedPath=i||rr.parseTrackName(t),this.node=rr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new rr.Composite(e,t,i):new rr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(fTe,"")}static parseTrackName(e){let t=wTe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);bTe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=rr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};rr.Composite=_Te;rr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};rr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};rr.prototype.GetterByBindingType=[rr.prototype._getValue_direct,rr.prototype._getValue_array,rr.prototype._getValue_arrayElement,rr.prototype._getValue_toArray];rr.prototype.SetterByBindingTypeAndVersioning=[[rr.prototype._setValue_direct,rr.prototype._setValue_direct_setNeedsUpdate,rr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[rr.prototype._setValue_array,rr.prototype._setValue_array_setNeedsUpdate,rr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[rr.prototype._setValue_arrayElement,rr.prototype._setValue_arrayElement_setNeedsUpdate,rr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[rr.prototype._setValue_fromArray,rr.prototype._setValue_fromArray_setNeedsUpdate,rr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var STe=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:vv,endingEnd:vv};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=s$,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Zbe:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case dU:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===hU;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===n$){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=yv,r.endingEnd=yv):(e?r.endingStart=this.zeroSlopeAtStart?yv:vv:r.endingStart=PE,t?r.endingEnd=this.zeroSlopeAtEnd?yv:vv:r.endingEnd=PE)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},ATe=new Float32Array(1),MTe=class extends ws{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,p=c[d];if(p!==void 0)++p.referenceCount,s[u]=p;else{if(p=s[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let f=t&&t._propertyBindings[u].binding.parsedPath;p=new pTe(rr.create(i,d,f),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new U$(new Float32Array(2),new Float32Array(2),1,ATe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?KL.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=dU),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new STe(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?KL.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},rt=class{constructor(e){this.value=e}clone(){return new rt(this.value.clone===void 0?this.value:this.value.clone())}},H$=class{constructor(e,t,i=0,r=1/0){this.ray=new V0(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new fU,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return $L(e,this,i,t),i.sort(D6),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)$L(e[r],this,i,t);return i.sort(D6),i}};function D6(e,t){return e.distance-t.distance}function $L(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)$L(n[s],t,i,!0)}}var R6=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(pn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},I6=new pe,CU=class{constructor(e=new pe(1/0,1/0),t=new pe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=I6.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return I6.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},L6=new F,KS=new F,zo=class{constructor(e=new F,t=new F){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){L6.subVectors(e,this.start),KS.subVectors(this.end,this.start);let i=KS.dot(KS),r=KS.dot(L6)/i;return t&&(r=pn(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},O6=new F,ETe=class extends Qi{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Ot,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new xt(r,3));let n=new up({fog:!1,toneMapped:!1});this.cone=new ab(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),O6.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(O6),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},CTe=class extends cr{constructor(e,t,i){let r=new Fv(t,4,2),n=new sh({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},B6=new F,ZS=new F,F6=new F,TTe=class extends Qi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Ot;r.setAttribute("position",new xt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new up({fog:!1,toneMapped:!1});this.lightPlane=new IE(r,n),this.add(this.lightPlane),r=new Ot,r.setAttribute("position",new xt([0,0,0,0,0,1],3)),this.targetLine=new IE(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),B6.setFromMatrixPosition(this.light.matrixWorld),ZS.setFromMatrixPosition(this.light.target.matrixWorld),F6.subVectors(ZS,B6),this.lightPlane.lookAt(ZS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ZS),this.targetLine.scale.z=F6.length()}},$S=new F,kr=new cp,UE=class extends ab{constructor(e){let t=new Ot,i=new up({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,f){o(p),o(f)}function o(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new xt(r,3)),t.setAttribute("color",new xt(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new jt(16755200),c=new jt(16711680),u=new jt(43775),h=new jt(16777215),d=new jt(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;kr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Kr("c",t,e,kr,0,0,-1),Kr("t",t,e,kr,0,0,1),Kr("n1",t,e,kr,-i,-r,-1),Kr("n2",t,e,kr,i,-r,-1),Kr("n3",t,e,kr,-i,r,-1),Kr("n4",t,e,kr,i,r,-1),Kr("f1",t,e,kr,-i,-r,1),Kr("f2",t,e,kr,i,-r,1),Kr("f3",t,e,kr,-i,r,1),Kr("f4",t,e,kr,i,r,1),Kr("u1",t,e,kr,i*.7,r*1.1,-1),Kr("u2",t,e,kr,-i*.7,r*1.1,-1),Kr("u3",t,e,kr,0,r*2,-1),Kr("cf1",t,e,kr,-i,0,1),Kr("cf2",t,e,kr,i,0,1),Kr("cf3",t,e,kr,0,-r,1),Kr("cf4",t,e,kr,0,r,1),Kr("cn1",t,e,kr,-i,0,-1),Kr("cn2",t,e,kr,i,0,-1),Kr("cn3",t,e,kr,0,-r,-1),Kr("cn4",t,e,kr,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Kr(e,t,i,r,n,s,a){$S.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],$S.x,$S.y,$S.z)}}var kE=class extends ab{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Ot;n.setIndex(new Wt(i,1)),n.setAttribute("position",new xt(r,3)),super(n,new up({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},PTe=class extends ab{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Ot;r.setAttribute("position",new xt(t,3)),r.setAttribute("color",new xt(i,3));let n=new up({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new jt,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Ru=DTe();function DTe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function RTe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=pn(e,-65504,65504),Ru.floatView[0]=e;let t=Ru.uint32View[0],i=t>>23&511;return Ru.baseTable[i]+((t&8388607)>>Ru.shiftTable[i])}function ITe(e){let t=e>>10;return Ru.uint32View[0]=Ru.mantissaTable[Ru.offsetTable[t]+(e&1023)]+Ru.exponentTable[t],Ru.floatView[0]}var LTe=Object.freeze({__proto__:null,fromHalfFloat:ITe,toHalfFloat:RTe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:z0}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=z0);var r1=".",TU=Symbol("target"),j$=Symbol("unsubscribe");function eO(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function OTe(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var xc=Array.isArray;function PU(e){return typeof e=="symbol"}var BTe={after:(e,t)=>xc(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>xc(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=r1),PU(t)?e+t.toString():e+t):e,initial:e=>{if(xc(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(r1);return t===-1?"":e.slice(0,t)},last:e=>{if(xc(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(r1);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(xc(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(r1);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(r1,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},To=BTe;function FTe(e){return typeof e=="object"&&typeof e.next=="function"}function NTe(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[TU].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function N6(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&PU(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var UTe=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,To.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function tO(e){return toString.call(e)==="[object Object]"}function eA(){return!0}function _g(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var W$=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),kTe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),X$={push:eA,pop:eA,shift:eA,unshift:eA,copyWithin:_g,reverse:_g,sort:_g,splice:_g,flat:_g,fill:_g},zTe=new Set([...W$,...kTe,...Object.keys(X$)]);function tA(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var Y$=["keys","values","entries"],q$=new Set(["has","toString"]),Q$={add:tA,clear:tA,delete:tA,forEach:tA},VTe=new Set([...q$,...Object.keys(Q$),...Y$]);function iA(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var GTe=new Set([...q$,"get"]),J$={set:iA,clear:iA,delete:iA,forEach:iA},HTe=new Set([...GTe,...Object.keys(J$),...Y$]),Jd=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return W$.has(e)}_shallowClone(e){let t=e;if(tO(e))t={...e};else if(xc(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(xc(r)?this._onIsChanged=X$[t]:r instanceof Set?this._onIsChanged=Q$[t]:r instanceof Map&&(this._onIsChanged=J$[t]),r):i}update(e,t,i){let r=To.after(e,this._path);if(t!=="length"){let n=this.clone;To.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],To.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},U6=class extends Jd{static isHandledMethod(e){return zTe.has(e)}},jTe=class extends Jd{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},k6=class extends Jd{static isHandledMethod(e){return VTe.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},z6=class extends Jd{static isHandledMethod(e){return HTe.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},WTe=class extends Jd{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},XTe=class extends Jd{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},jg=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return tO(e)||xc(e)||eO(e)}static isHandledMethod(e,t){return tO(e)?Jd.isHandledMethod(t):xc(e)?U6.isHandledMethod(t):e instanceof Set?k6.isHandledMethod(t):e instanceof Map?z6.isHandledMethod(t):eO(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=Jd;xc(e)?r=U6:e instanceof Date?r=jTe:e instanceof Set?r=k6:e instanceof Map?r=z6:e instanceof WeakSet?r=WTe:e instanceof WeakMap&&(r=XTe),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=jg.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},YTe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},DU=(e,t,i={})=>{i={...YTe,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new UTe(n),c=typeof i.onValidate=="function",u=new jg(c),h=(x,y,_,A,S)=>!c||u.isCloning||i.onValidate(To.concat(l.getPath(x),y),_,A,S)===!0,d=(x,y,_,A)=>{!N6(l,i,y)&&!(a&&l.isDetached(x,e))&&p(l.getPath(x),y,_,A)},p=(x,y,_,A,S)=>{u.isCloning?u.update(x,y,A):t(To.concat(x,y),_,A,S)},f=x=>x&&(x[r]||x),g=(x,y,_,A)=>OTe(x)||_==="constructor"||s&&!jg.isHandledMethod(y,_)||N6(l,i,_)||l.isGetInvariant(y,_)||a&&l.isDetached(y,e)?x:(A===void 0&&(A=l.getPath(y)),l.getProxy(x,To.concat(A,_),m,r)),m={get(x,y,_){if(PU(y)){if(y===r||y===TU)return x;if(y===j$&&!l.isUnsubscribed&&l.getPath(x).length===0)return l.unsubscribe(),x}let A=eO(x)?Reflect.get(x,y):Reflect.get(x,y,_);return g(A,x,y)},set(x,y,_,A){_=f(_);let S=x[r]||x,C=S[y];if(n(C,_)&&y in x)return!0;let M=h(x,y,_,C);return M&&l.setProperty(S,y,_,A,C)?(d(x,y,x[y],C),!0):!M},defineProperty(x,y,_){if(!l.isSameDescriptor(_,x,y)){let A=x[y];h(x,y,_.value,A)&&l.defineProperty(x,y,_,A)&&d(x,y,_.value,A)}return!0},deleteProperty(x,y){if(!Reflect.has(x,y))return!0;let _=Reflect.get(x,y),A=h(x,y,void 0,_);return A&&l.deleteProperty(x,y,_)?(d(x,y,void 0,_),!0):!A},apply(x,y,_){let A=y[r]||y;if(l.isUnsubscribed)return Reflect.apply(x,A,_);if((o===!1||o!==!0&&!o.includes(x.name))&&jg.isHandledType(A)){let S=To.initial(l.getPath(x)),C=jg.isHandledMethod(A,x.name);u.start(A,S,_);let M=Reflect.apply(x,u.preferredThisArg(x,y,A),C?_.map(R=>f(R)):_),E=u.isChanged(A,n),P=u.stop();if(jg.isHandledType(M)&&C&&(y instanceof Map&&x.name==="get"&&(S=To.concat(S,_[0])),M=l.getProxy(M,S,m)),E){let R={name:x.name,args:_,result:M},O=u.isCloning?To.initial(S):S,L=u.isCloning?To.last(S):"";h(To.get(e,O),L,A,P,R)?p(O,L,A,P,R):u.undo(A)}return(y instanceof Map||y instanceof Set)&&FTe(M)?NTe(M,x,y,S,g):M}return Reflect.apply(x,y,_)}},v=l.getProxy(e,i.pathAsArray?[]:"",m);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};DU.target=e=>e&&e[TU]||e;DU.unsubscribe=e=>e[j$]||e;var V6=DU,qTe=typeof global=="object"&&global&&global.Object===Object&&global,K$=qTe,QTe=typeof self=="object"&&self&&self.Object===Object&&self,JTe=K$||QTe||Function("return this")(),Gl=JTe,KTe=Gl.Symbol,Wo=KTe,Z$=Object.prototype,ZTe=Z$.hasOwnProperty,$Te=Z$.toString,n1=Wo?Wo.toStringTag:void 0;function e2e(e){var t=ZTe.call(e,n1),i=e[n1];try{e[n1]=void 0;var r=!0}catch{}var n=$Te.call(e);return r&&(t?e[n1]=i:delete e[n1]),n}var t2e=e2e,i2e=Object.prototype,r2e=i2e.toString;function n2e(e){return r2e.call(e)}var s2e=n2e,a2e="[object Null]",o2e="[object Undefined]",G6=Wo?Wo.toStringTag:void 0;function l2e(e){return e==null?e===void 0?o2e:a2e:G6&&G6 in Object(e)?t2e(e):s2e(e)}var wm=l2e;function c2e(e){return e!=null&&typeof e=="object"}var ah=c2e,u2e="[object Symbol]";function h2e(e){return typeof e=="symbol"||ah(e)&&wm(e)==u2e}var ub=h2e;function d2e(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var $$=d2e,p2e=Array.isArray,Vc=p2e,f2e=1/0,H6=Wo?Wo.prototype:void 0,j6=H6?H6.toString:void 0;function eee(e){if(typeof e=="string")return e;if(Vc(e))return $$(e,eee)+"";if(ub(e))return j6?j6.call(e):"";var t=e+"";return t=="0"&&1/e==-f2e?"-0":t}var m2e=eee,g2e=/\s/;function v2e(e){for(var t=e.length;t--&&g2e.test(e.charAt(t)););return t}var y2e=v2e,x2e=/^\s+/;function w2e(e){return e&&e.slice(0,y2e(e)+1).replace(x2e,"")}var b2e=w2e;function _2e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Nl=_2e,W6=0/0,S2e=/^[-+]0x[0-9a-f]+$/i,A2e=/^0b[01]+$/i,M2e=/^0o[0-7]+$/i,E2e=parseInt;function C2e(e){if(typeof e=="number")return e;if(ub(e))return W6;if(Nl(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Nl(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=b2e(e);var i=A2e.test(e);return i||M2e.test(e)?E2e(e.slice(2),i?2:8):S2e.test(e)?W6:+e}var X6=C2e;function T2e(e){return e}var tee=T2e,P2e="[object AsyncFunction]",D2e="[object Function]",R2e="[object GeneratorFunction]",I2e="[object Proxy]";function L2e(e){if(!Nl(e))return!1;var t=wm(e);return t==D2e||t==R2e||t==P2e||t==I2e}var iee=L2e,O2e=Gl["__core-js_shared__"],vR=O2e,Y6=function(){var e=/[^.]+$/.exec(vR&&vR.keys&&vR.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function B2e(e){return!!Y6&&Y6 in e}var F2e=B2e,N2e=Function.prototype,U2e=N2e.toString;function k2e(e){if(e!=null){try{return U2e.call(e)}catch{}try{return e+""}catch{}}return""}var bm=k2e,z2e=/[\\^$.*+?()[\]{}|]/g,V2e=/^\[object .+?Constructor\]$/,G2e=Function.prototype,H2e=Object.prototype,j2e=G2e.toString,W2e=H2e.hasOwnProperty,X2e=RegExp("^"+j2e.call(W2e).replace(z2e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Y2e(e){if(!Nl(e)||F2e(e))return!1;var t=iee(e)?X2e:V2e;return t.test(bm(e))}var q2e=Y2e;function Q2e(e,t){return e==null?void 0:e[t]}var J2e=Q2e;function K2e(e,t){var i=J2e(e,t);return q2e(i)?i:void 0}var _m=K2e,Z2e=_m(Gl,"WeakMap"),iO=Z2e,q6=Object.create,$2e=function(){function e(){}return function(t){if(!Nl(t))return{};if(q6)return q6(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),ePe=$2e;function tPe(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var iPe=tPe;function rPe(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var nPe=rPe,sPe=800,aPe=16,oPe=Date.now;function lPe(e){var t=0,i=0;return function(){var r=oPe(),n=aPe-(r-i);if(i=r,n>0){if(++t>=sPe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var cPe=lPe;function uPe(e){return function(){return e}}var hPe=uPe,dPe=function(){try{var e=_m(Object,"defineProperty");return e({},"",{}),e}catch{}}(),zE=dPe,pPe=zE?function(e,t){return zE(e,"toString",{configurable:!0,enumerable:!1,value:hPe(t),writable:!0})}:tee,fPe=pPe,mPe=cPe(fPe),gPe=mPe;function vPe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var yPe=vPe,xPe=9007199254740991,wPe=/^(?:0|[1-9]\d*)$/;function bPe(e,t){var i=typeof e;return t=t??xPe,!!t&&(i=="number"||i!="symbol"&&wPe.test(e))&&e>-1&&e%1==0&&e<t}var RU=bPe;function _Pe(e,t,i){t=="__proto__"&&zE?zE(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var ree=_Pe;function SPe(e,t){return e===t||e!==e&&t!==t}var IU=SPe,APe=Object.prototype,MPe=APe.hasOwnProperty;function EPe(e,t,i){var r=e[t];(!(MPe.call(e,t)&&IU(r,i))||i===void 0&&!(t in e))&&ree(e,t,i)}var LU=EPe;function CPe(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?ree(i,o,l):LU(i,o,l)}return i}var hb=CPe,Q6=Math.max;function TPe(e,t,i){return t=Q6(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=Q6(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),iPe(e,this,o)}}var PPe=TPe,DPe=9007199254740991;function RPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=DPe}var OU=RPe;function IPe(e){return e!=null&&OU(e.length)&&!iee(e)}var nee=IPe,LPe=Object.prototype;function OPe(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||LPe;return e===i}var BU=OPe;function BPe(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var FPe=BPe,NPe="[object Arguments]";function UPe(e){return ah(e)&&wm(e)==NPe}var J6=UPe,see=Object.prototype,kPe=see.hasOwnProperty,zPe=see.propertyIsEnumerable,VPe=J6(function(){return arguments}())?J6:function(e){return ah(e)&&kPe.call(e,"callee")&&!zPe.call(e,"callee")},FU=VPe;function GPe(){return!1}var HPe=GPe,aee=typeof exports=="object"&&exports&&!exports.nodeType&&exports,K6=aee&&typeof module=="object"&&module&&!module.nodeType&&module,jPe=K6&&K6.exports===aee,Z6=jPe?Gl.Buffer:void 0,WPe=Z6?Z6.isBuffer:void 0,XPe=WPe||HPe,VE=XPe,YPe="[object Arguments]",qPe="[object Array]",QPe="[object Boolean]",JPe="[object Date]",KPe="[object Error]",ZPe="[object Function]",$Pe="[object Map]",eDe="[object Number]",tDe="[object Object]",iDe="[object RegExp]",rDe="[object Set]",nDe="[object String]",sDe="[object WeakMap]",aDe="[object ArrayBuffer]",oDe="[object DataView]",lDe="[object Float32Array]",cDe="[object Float64Array]",uDe="[object Int8Array]",hDe="[object Int16Array]",dDe="[object Int32Array]",pDe="[object Uint8Array]",fDe="[object Uint8ClampedArray]",mDe="[object Uint16Array]",gDe="[object Uint32Array]",yr={};yr[lDe]=yr[cDe]=yr[uDe]=yr[hDe]=yr[dDe]=yr[pDe]=yr[fDe]=yr[mDe]=yr[gDe]=!0;yr[YPe]=yr[qPe]=yr[aDe]=yr[QPe]=yr[oDe]=yr[JPe]=yr[KPe]=yr[ZPe]=yr[$Pe]=yr[eDe]=yr[tDe]=yr[iDe]=yr[rDe]=yr[nDe]=yr[sDe]=!1;function vDe(e){return ah(e)&&OU(e.length)&&!!yr[wm(e)]}var yDe=vDe;function xDe(e){return function(t){return e(t)}}var NU=xDe,oee=typeof exports=="object"&&exports&&!exports.nodeType&&exports,hx=oee&&typeof module=="object"&&module&&!module.nodeType&&module,wDe=hx&&hx.exports===oee,yR=wDe&&K$.process,bDe=function(){try{var e=hx&&hx.require&&hx.require("util").types;return e||yR&&yR.binding&&yR.binding("util")}catch{}}(),f0=bDe,$6=f0&&f0.isTypedArray,_De=$6?NU($6):yDe,lee=_De,SDe=Object.prototype,ADe=SDe.hasOwnProperty;function MDe(e,t){var i=Vc(e),r=!i&&FU(e),n=!i&&!r&&VE(e),s=!i&&!r&&!n&&lee(e),a=i||r||n||s,o=a?FPe(e.length,String):[],l=o.length;for(var c in e)(t||ADe.call(e,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||RU(c,l)))&&o.push(c);return o}var cee=MDe;function EDe(e,t){return function(i){return e(t(i))}}var uee=EDe,CDe=uee(Object.keys,Object),TDe=CDe,PDe=Object.prototype,DDe=PDe.hasOwnProperty;function RDe(e){if(!BU(e))return TDe(e);var t=[];for(var i in Object(e))DDe.call(e,i)&&i!="constructor"&&t.push(i);return t}var IDe=RDe;function LDe(e){return nee(e)?cee(e):IDe(e)}var UU=LDe;function ODe(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var BDe=ODe,FDe=Object.prototype,NDe=FDe.hasOwnProperty;function UDe(e){if(!Nl(e))return BDe(e);var t=BU(e),i=[];for(var r in e)r=="constructor"&&(t||!NDe.call(e,r))||i.push(r);return i}var kDe=UDe;function zDe(e){return nee(e)?cee(e,!0):kDe(e)}var wf=zDe,VDe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,GDe=/^\w*$/;function HDe(e,t){if(Vc(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||ub(e)?!0:GDe.test(e)||!VDe.test(e)||t!=null&&e in Object(t)}var jDe=HDe,WDe=_m(Object,"create"),lw=WDe;function XDe(){this.__data__=lw?lw(null):{},this.size=0}var YDe=XDe;function qDe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var QDe=qDe,JDe="__lodash_hash_undefined__",KDe=Object.prototype,ZDe=KDe.hasOwnProperty;function $De(e){var t=this.__data__;if(lw){var i=t[e];return i===JDe?void 0:i}return ZDe.call(t,e)?t[e]:void 0}var eRe=$De,tRe=Object.prototype,iRe=tRe.hasOwnProperty;function rRe(e){var t=this.__data__;return lw?t[e]!==void 0:iRe.call(t,e)}var nRe=rRe,sRe="__lodash_hash_undefined__";function aRe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=lw&&t===void 0?sRe:t,this}var oRe=aRe;function X0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}X0.prototype.clear=YDe;X0.prototype.delete=QDe;X0.prototype.get=eRe;X0.prototype.has=nRe;X0.prototype.set=oRe;var eW=X0;function lRe(){this.__data__=[],this.size=0}var cRe=lRe;function uRe(e,t){for(var i=e.length;i--;)if(IU(e[i][0],t))return i;return-1}var ET=uRe,hRe=Array.prototype,dRe=hRe.splice;function pRe(e){var t=this.__data__,i=ET(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():dRe.call(t,i,1),--this.size,!0}var fRe=pRe;function mRe(e){var t=this.__data__,i=ET(t,e);return i<0?void 0:t[i][1]}var gRe=mRe;function vRe(e){return ET(this.__data__,e)>-1}var yRe=vRe;function xRe(e,t){var i=this.__data__,r=ET(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var wRe=xRe;function Y0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Y0.prototype.clear=cRe;Y0.prototype.delete=fRe;Y0.prototype.get=gRe;Y0.prototype.has=yRe;Y0.prototype.set=wRe;var CT=Y0,bRe=_m(Gl,"Map"),cw=bRe;function _Re(){this.size=0,this.__data__={hash:new eW,map:new(cw||CT),string:new eW}}var SRe=_Re;function ARe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var MRe=ARe;function ERe(e,t){var i=e.__data__;return MRe(t)?i[typeof t=="string"?"string":"hash"]:i.map}var TT=ERe;function CRe(e){var t=TT(this,e).delete(e);return this.size-=t?1:0,t}var TRe=CRe;function PRe(e){return TT(this,e).get(e)}var DRe=PRe;function RRe(e){return TT(this,e).has(e)}var IRe=RRe;function LRe(e,t){var i=TT(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var ORe=LRe;function q0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}q0.prototype.clear=SRe;q0.prototype.delete=TRe;q0.prototype.get=DRe;q0.prototype.has=IRe;q0.prototype.set=ORe;var PT=q0,BRe="Expected a function";function kU(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(BRe);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(kU.Cache||PT),i}kU.Cache=PT;var FRe=kU,NRe=500;function URe(e){var t=FRe(e,function(r){return i.size===NRe&&i.clear(),r}),i=t.cache;return t}var kRe=URe,zRe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,VRe=/\\(\\)?/g,GRe=kRe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(zRe,function(i,r,n,s){t.push(n?s.replace(VRe,"$1"):r||i)}),t}),HRe=GRe;function jRe(e){return e==null?"":m2e(e)}var WRe=jRe;function XRe(e,t){return Vc(e)?e:jDe(e,t)?[e]:HRe(WRe(e))}var Q0=XRe,YRe=1/0;function qRe(e){if(typeof e=="string"||ub(e))return e;var t=e+"";return t=="0"&&1/e==-YRe?"-0":t}var DT=qRe;function QRe(e,t){t=Q0(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[DT(t[i++])];return i&&i==r?e:void 0}var hee=QRe;function JRe(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var zU=JRe,tW=Wo?Wo.isConcatSpreadable:void 0;function KRe(e){return Vc(e)||FU(e)||!!(tW&&e&&e[tW])}var ZRe=KRe;function dee(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=ZRe),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?dee(o,t-1,i,r,n):zU(n,o):r||(n[n.length]=o)}return n}var $Re=dee;function e3e(e){var t=e==null?0:e.length;return t?$Re(e,1):[]}var t3e=e3e;function i3e(e){return gPe(PPe(e,void 0,t3e),e+"")}var pee=i3e,r3e=uee(Object.getPrototypeOf,Object),VU=r3e,n3e="[object Object]",s3e=Function.prototype,a3e=Object.prototype,fee=s3e.toString,o3e=a3e.hasOwnProperty,l3e=fee.call(Object);function c3e(e){if(!ah(e)||wm(e)!=n3e)return!1;var t=VU(e);if(t===null)return!0;var i=o3e.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&fee.call(i)==l3e}var u3e=c3e;function h3e(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var d3e=h3e;function p3e(){this.__data__=new CT,this.size=0}var f3e=p3e;function m3e(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var g3e=m3e;function v3e(e){return this.__data__.get(e)}var y3e=v3e;function x3e(e){return this.__data__.has(e)}var w3e=x3e,b3e=200;function _3e(e,t){var i=this.__data__;if(i instanceof CT){var r=i.__data__;if(!cw||r.length<b3e-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new PT(r)}return i.set(e,t),this.size=i.size,this}var S3e=_3e;function J0(e){var t=this.__data__=new CT(e);this.size=t.size}J0.prototype.clear=f3e;J0.prototype.delete=g3e;J0.prototype.get=y3e;J0.prototype.has=w3e;J0.prototype.set=S3e;var MM=J0;function A3e(e,t){return e&&hb(t,UU(t),e)}var M3e=A3e;function E3e(e,t){return e&&hb(t,wf(t),e)}var C3e=E3e,mee=typeof exports=="object"&&exports&&!exports.nodeType&&exports,iW=mee&&typeof module=="object"&&module&&!module.nodeType&&module,T3e=iW&&iW.exports===mee,rW=T3e?Gl.Buffer:void 0,nW=rW?rW.allocUnsafe:void 0;function P3e(e,t){if(t)return e.slice();var i=e.length,r=nW?nW(i):new e.constructor(i);return e.copy(r),r}var D3e=P3e;function R3e(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var I3e=R3e;function L3e(){return[]}var gee=L3e,O3e=Object.prototype,B3e=O3e.propertyIsEnumerable,sW=Object.getOwnPropertySymbols,F3e=sW?function(e){return e==null?[]:(e=Object(e),I3e(sW(e),function(t){return B3e.call(e,t)}))}:gee,GU=F3e;function N3e(e,t){return hb(e,GU(e),t)}var U3e=N3e,k3e=Object.getOwnPropertySymbols,z3e=k3e?function(e){for(var t=[];e;)zU(t,GU(e)),e=VU(e);return t}:gee,vee=z3e;function V3e(e,t){return hb(e,vee(e),t)}var G3e=V3e;function H3e(e,t,i){var r=t(e);return Vc(e)?r:zU(r,i(e))}var yee=H3e;function j3e(e){return yee(e,UU,GU)}var rO=j3e;function W3e(e){return yee(e,wf,vee)}var xee=W3e,X3e=_m(Gl,"DataView"),nO=X3e,Y3e=_m(Gl,"Promise"),sO=Y3e,q3e=_m(Gl,"Set"),aO=q3e,aW="[object Map]",Q3e="[object Object]",oW="[object Promise]",lW="[object Set]",cW="[object WeakMap]",uW="[object DataView]",J3e=bm(nO),K3e=bm(cw),Z3e=bm(sO),$3e=bm(aO),eIe=bm(iO),Jp=wm;(nO&&Jp(new nO(new ArrayBuffer(1)))!=uW||cw&&Jp(new cw)!=aW||sO&&Jp(sO.resolve())!=oW||aO&&Jp(new aO)!=lW||iO&&Jp(new iO)!=cW)&&(Jp=function(e){var t=wm(e),i=t==Q3e?e.constructor:void 0,r=i?bm(i):"";if(r)switch(r){case J3e:return uW;case K3e:return aW;case Z3e:return oW;case $3e:return lW;case eIe:return cW}return t});var uw=Jp,tIe=Object.prototype,iIe=tIe.hasOwnProperty;function rIe(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&iIe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var nIe=rIe,sIe=Gl.Uint8Array,GE=sIe;function aIe(e){var t=new e.constructor(e.byteLength);return new GE(t).set(new GE(e)),t}var HU=aIe;function oIe(e,t){var i=t?HU(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var lIe=oIe,cIe=/\w*$/;function uIe(e){var t=new e.constructor(e.source,cIe.exec(e));return t.lastIndex=e.lastIndex,t}var hIe=uIe,hW=Wo?Wo.prototype:void 0,dW=hW?hW.valueOf:void 0;function dIe(e){return dW?Object(dW.call(e)):{}}var pIe=dIe;function fIe(e,t){var i=t?HU(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var mIe=fIe,gIe="[object Boolean]",vIe="[object Date]",yIe="[object Map]",xIe="[object Number]",wIe="[object RegExp]",bIe="[object Set]",_Ie="[object String]",SIe="[object Symbol]",AIe="[object ArrayBuffer]",MIe="[object DataView]",EIe="[object Float32Array]",CIe="[object Float64Array]",TIe="[object Int8Array]",PIe="[object Int16Array]",DIe="[object Int32Array]",RIe="[object Uint8Array]",IIe="[object Uint8ClampedArray]",LIe="[object Uint16Array]",OIe="[object Uint32Array]";function BIe(e,t,i){var r=e.constructor;switch(t){case AIe:return HU(e);case gIe:case vIe:return new r(+e);case MIe:return lIe(e,i);case EIe:case CIe:case TIe:case PIe:case DIe:case RIe:case IIe:case LIe:case OIe:return mIe(e,i);case yIe:return new r;case xIe:case _Ie:return new r(e);case wIe:return hIe(e);case bIe:return new r;case SIe:return pIe(e)}}var FIe=BIe;function NIe(e){return typeof e.constructor=="function"&&!BU(e)?ePe(VU(e)):{}}var UIe=NIe,kIe="[object Map]";function zIe(e){return ah(e)&&uw(e)==kIe}var VIe=zIe,pW=f0&&f0.isMap,GIe=pW?NU(pW):VIe,HIe=GIe,jIe="[object Set]";function WIe(e){return ah(e)&&uw(e)==jIe}var XIe=WIe,fW=f0&&f0.isSet,YIe=fW?NU(fW):XIe,qIe=YIe,QIe=1,JIe=2,KIe=4,wee="[object Arguments]",ZIe="[object Array]",$Ie="[object Boolean]",eLe="[object Date]",tLe="[object Error]",bee="[object Function]",iLe="[object GeneratorFunction]",rLe="[object Map]",nLe="[object Number]",_ee="[object Object]",sLe="[object RegExp]",aLe="[object Set]",oLe="[object String]",lLe="[object Symbol]",cLe="[object WeakMap]",uLe="[object ArrayBuffer]",hLe="[object DataView]",dLe="[object Float32Array]",pLe="[object Float64Array]",fLe="[object Int8Array]",mLe="[object Int16Array]",gLe="[object Int32Array]",vLe="[object Uint8Array]",yLe="[object Uint8ClampedArray]",xLe="[object Uint16Array]",wLe="[object Uint32Array]",hr={};hr[wee]=hr[ZIe]=hr[uLe]=hr[hLe]=hr[$Ie]=hr[eLe]=hr[dLe]=hr[pLe]=hr[fLe]=hr[mLe]=hr[gLe]=hr[rLe]=hr[nLe]=hr[_ee]=hr[sLe]=hr[aLe]=hr[oLe]=hr[lLe]=hr[vLe]=hr[yLe]=hr[xLe]=hr[wLe]=!0;hr[tLe]=hr[bee]=hr[cLe]=!1;function EM(e,t,i,r,n,s){var a,o=t&QIe,l=t&JIe,c=t&KIe;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!Nl(e))return e;var u=Vc(e);if(u){if(a=nIe(e),!o)return nPe(e,a)}else{var h=uw(e),d=h==bee||h==iLe;if(VE(e))return D3e(e,o);if(h==_ee||h==wee||d&&!n){if(a=l||d?{}:UIe(e),!o)return l?G3e(e,C3e(a,e)):U3e(e,M3e(a,e))}else{if(!hr[h])return n?e:{};a=FIe(e,h,o)}}s||(s=new MM);var p=s.get(e);if(p)return p;s.set(e,a),qIe(e)?e.forEach(function(m){a.add(EM(m,t,i,m,e,s))}):HIe(e)&&e.forEach(function(m,v){a.set(v,EM(m,t,i,v,e,s))});var f=c?l?xee:rO:l?wf:UU,g=u?void 0:f(e);return yPe(g||e,function(m,v){g&&(v=m,m=e[v]),LU(a,v,EM(m,t,i,v,e,s))}),a}var See=EM,bLe=1,_Le=4;function SLe(e){return See(e,bLe|_Le)}var RT=SLe,ALe="__lodash_hash_undefined__";function MLe(e){return this.__data__.set(e,ALe),this}var ELe=MLe;function CLe(e){return this.__data__.has(e)}var TLe=CLe;function HE(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new PT;++t<i;)this.add(e[t])}HE.prototype.add=HE.prototype.push=ELe;HE.prototype.has=TLe;var PLe=HE;function DLe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var RLe=DLe;function ILe(e,t){return e.has(t)}var LLe=ILe,OLe=1,BLe=2;function FLe(e,t,i,r,n,s){var a=i&OLe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,p=i&BLe?new PLe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var f=e[h],g=t[h];if(r)var m=a?r(g,f,h,t,e,s):r(f,g,h,e,t,s);if(m!==void 0){if(m)continue;d=!1;break}if(p){if(!RLe(t,function(v,x){if(!LLe(p,x)&&(f===v||n(f,v,i,r,s)))return p.push(x)})){d=!1;break}}else if(!(f===g||n(f,g,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var Aee=FLe;function NLe(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var ULe=NLe;function kLe(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var zLe=kLe,VLe=1,GLe=2,HLe="[object Boolean]",jLe="[object Date]",WLe="[object Error]",XLe="[object Map]",YLe="[object Number]",qLe="[object RegExp]",QLe="[object Set]",JLe="[object String]",KLe="[object Symbol]",ZLe="[object ArrayBuffer]",$Le="[object DataView]",mW=Wo?Wo.prototype:void 0,xR=mW?mW.valueOf:void 0;function eOe(e,t,i,r,n,s,a){switch(i){case $Le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ZLe:return!(e.byteLength!=t.byteLength||!s(new GE(e),new GE(t)));case HLe:case jLe:case YLe:return IU(+e,+t);case WLe:return e.name==t.name&&e.message==t.message;case qLe:case JLe:return e==t+"";case XLe:var o=ULe;case QLe:var l=r&VLe;if(o||(o=zLe),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=GLe,a.set(e,t);var u=Aee(o(e),o(t),r,n,s,a);return a.delete(e),u;case KLe:if(xR)return xR.call(e)==xR.call(t)}return!1}var tOe=eOe,iOe=1,rOe=Object.prototype,nOe=rOe.hasOwnProperty;function sOe(e,t,i,r,n,s){var a=i&iOe,o=rO(e),l=o.length,c=rO(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:nOe.call(t,d)))return!1}var p=s.get(e),f=s.get(t);if(p&&f)return p==t&&f==e;var g=!0;s.set(e,t),s.set(t,e);for(var m=a;++h<l;){d=o[h];var v=e[d],x=t[d];if(r)var y=a?r(x,v,d,t,e,s):r(v,x,d,e,t,s);if(!(y===void 0?v===x||n(v,x,i,r,s):y)){g=!1;break}m||(m=d=="constructor")}if(g&&!m){var _=e.constructor,A=t.constructor;_!=A&&"constructor"in e&&"constructor"in t&&!(typeof _=="function"&&_ instanceof _&&typeof A=="function"&&A instanceof A)&&(g=!1)}return s.delete(e),s.delete(t),g}var aOe=sOe,oOe=1,gW="[object Arguments]",vW="[object Array]",rA="[object Object]",lOe=Object.prototype,yW=lOe.hasOwnProperty;function cOe(e,t,i,r,n,s){var a=Vc(e),o=Vc(t),l=a?vW:uw(e),c=o?vW:uw(t);l=l==gW?rA:l,c=c==gW?rA:c;var u=l==rA,h=c==rA,d=l==c;if(d&&VE(e)){if(!VE(t))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new MM),a||lee(e)?Aee(e,t,i,r,n,s):tOe(e,t,l,i,r,n,s);if(!(i&oOe)){var p=u&&yW.call(e,"__wrapped__"),f=h&&yW.call(t,"__wrapped__");if(p||f){var g=p?e.value():e,m=f?t.value():t;return s||(s=new MM),n(g,m,i,r,s)}}return d?(s||(s=new MM),aOe(e,t,i,r,n,s)):!1}var uOe=cOe;function Mee(e,t,i,r,n){return e===t?!0:e==null||t==null||!ah(e)&&!ah(t)?e!==e&&t!==t:uOe(e,t,i,r,Mee,n)}var hOe=Mee;function dOe(e,t){return e!=null&&t in Object(e)}var pOe=dOe;function fOe(e,t,i){t=Q0(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=DT(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&OU(n)&&RU(a,n)&&(Vc(e)||FU(e)))}var mOe=fOe;function gOe(e,t){return e!=null&&mOe(e,t,pOe)}var vOe=gOe,yOe=function(){return Gl.Date.now()},wR=yOe,xOe="Expected a function",wOe=Math.max,bOe=Math.min;function _Oe(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(xOe);t=X6(t)||0,Nl(i)&&(u=!!i.leading,h="maxWait"in i,s=h?wOe(X6(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var C=r,M=n;return r=n=void 0,c=S,a=e.apply(M,C),a}function f(S){return c=S,o=setTimeout(v,t),u?p(S):a}function g(S){var C=S-l,M=S-c,E=t-C;return h?bOe(E,s-M):E}function m(S){var C=S-l,M=S-c;return l===void 0||C>=t||C<0||h&&M>=s}function v(){var S=wR();if(m(S))return x(S);o=setTimeout(v,g(S))}function x(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function y(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:x(wR())}function A(){var S=wR(),C=m(S);if(r=arguments,n=this,l=S,C){if(o===void 0)return f(l);if(h)return clearTimeout(o),o=setTimeout(v,t),p(l)}return o===void 0&&(o=setTimeout(v,t)),a}return A.cancel=y,A.flush=_,A}var hw=_Oe;function SOe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var AOe=SOe;function MOe(e,t){return e>t}var EOe=MOe;function COe(e,t){return t.length<2?e:hee(e,d3e(t,0,-1))}var TOe=COe;function POe(e,t){return hOe(e,t)}var jU=POe;function DOe(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!ub(a):i(a,o)))var o=a,l=s}return l}var ROe=DOe;function IOe(e){return e&&e.length?ROe(e,tee,EOe):void 0}var LOe=IOe;function OOe(e,t){return t=Q0(t,e),e=TOe(e,t),e==null||delete e[DT(AOe(t))]}var BOe=OOe;function FOe(e){return u3e(e)?void 0:e}var NOe=FOe,UOe=1,kOe=2,zOe=4,VOe=pee(function(e,t){var i={};if(e==null)return i;var r=!1;t=$$(t,function(s){return s=Q0(s,e),r||(r=s.length>1),s}),hb(e,xee(e),i),r&&(i=See(i,UOe|kOe|zOe,NOe));for(var n=t.length;n--;)BOe(i,t[n]);return i}),oO=VOe;function GOe(e,t,i,r){if(!Nl(e))return e;t=Q0(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=DT(t[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=Nl(u)?u:RU(t[n+1])?[]:{})}LU(o,l,c),o=o[l]}return e}var HOe=GOe;function jOe(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=hee(e,a);i(o,a)&&HOe(s,Q0(a,e),o)}return s}var WOe=jOe;function XOe(e,t){return WOe(e,t,function(i,r){return vOe(e,r)})}var YOe=XOe,qOe=pee(function(e,t){return e==null?{}:YOe(e,t)}),Ic=qOe,QOe="Expected a function";function JOe(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(QOe);return Nl(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),hw(e,t,{leading:r,maxWait:t,trailing:n})}var KOe=JOe;function Eee(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function Xo(e,t){return Object.setPrototypeOf(e,t),e}var ZOe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),$Oe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),eBe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||IT&&"ontouchend"in document,tBe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,iBe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,rBe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},nBe=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},sBe=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},Cee=ZOe();Cee&&sBe();var IT=$Oe(),db=eBe(),aBe=tBe(),Ka=iBe(),xW=rBe(),oBe=Number(nBe());function Tee(e){return Array.isArray(e)?e:[e]}function Pee(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function nA(e){return IT?e.metaKey:e.ctrlKey}function lBe(e){return e.wheelDeltaY===0||e.deltaY===0?IT&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var Qt=[],jE={},B1={},CM={};function Dee(e){Qt.includes(e)||Qt.push(e)}function Nv(e){delete jE[e.pointerId];for(let t=0;t<Qt.length;t++)if(Qt[t].pointerId===e.pointerId){Qt.splice(t,1);break}}function cBe(){Qt.splice(0,Qt.length)}function WE(e){if(e.pointerType!=="touch")return;let t=jE[e.pointerId];t===void 0&&(t={x:0,y:0},jE[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function bR(e){let t=e.pointerId===Qt[0].pointerId?Qt[1]:Qt[0];return jE[t.pointerId]}function Ree(e){B1[e.key]=!0,CM[e.key]=CM[e.key]===void 0?1:CM[e.key]+1}function Iee(e){if(IT&&B1.Meta)for(let t in B1)B1[t]=!1;else B1[e.key]=!1;CM={}}function uBe(e){e.addEventListener("pointerdown",Dee,!0),e.addEventListener("pointerdown",WE,!0),e.addEventListener("pointermove",WE,!0),e.addEventListener("pointerup",Nv,!0),e.addEventListener("pointercancel",Nv,!0),e.addEventListener("pointerleave",Nv,!0),window.addEventListener("keydown",Ree,!0),window.addEventListener("keyup",Iee,!0)}function hBe(e){e.removeEventListener("pointerdown",Dee,!0),e.removeEventListener("pointerdown",WE,!0),e.removeEventListener("pointermove",WE,!0),e.removeEventListener("pointerup",Nv,!0),e.removeEventListener("pointercancel",Nv,!0),e.removeEventListener("pointerleave",Nv,!0),window.removeEventListener("keydown",Ree,!0),window.removeEventListener("keyup",Iee,!0)}var Lee,dBe=new Promise(e=>{Lee=e}),sA;function pBe(){if(sA)return sA;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.59/build",i=ap(()=>import("./navmesh-0b92f809.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});Lee(a)}return sA=e(),sA}var Oee,fBe=new Promise(e=>{Oee=e}),aA;function mBe(){if(aA)return aA;async function e(){let t=await ap(()=>import("./physics-dee4de67.js"),[]);await t.init(),Oee(t)}return aA=e(),aA}var Ht=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,Ht.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,Ht.prototype),{data:a,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,Ht.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function WU(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&WU(r)}return Object.freeze(e)}function gBe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var Bee=class extends Error{};function _R(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function hd(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function XU(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function vBe(){return typeof process<"u"}function Fee(e,t){for(let i of e)t(i.id,i.data)!==!0&&Fee(i.children,t)}function Nee(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)Nee(i,t)}var fs=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,fs.prototype)}deepFreeze(){let e=0;for(;e<this.length;)WU(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&Nee(i,t)}}traverse(e){Fee(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,fs.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new Bee("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=t,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:u,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>gBe(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return hd(0,i,i);{let n=r[0].fi;return hd(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return hd(a,a+i,i)}else return hd(n.fi,s.fi,i)}}},XE;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(XE||(XE={}));var Bt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Bt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)WU(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,Bt.prototype);let t=e;return vBe()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return hd(0,t,t);{let r=i[0].fi;return hd(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return hd(s,s+t,t)}else return hd(r.fi,n.fi,t)}}};function m0(e){return e&&typeof e=="object"&&e instanceof wn}var wn=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!m0(i))return null;r+=1}i=i?_R(i):new wn;for(let[o,l]of Object.entries(e.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=_R(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=_R(o);l[e.path[r-1]]=i,i=l}else{let l=new wn;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,wn.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},Bd;(e=>{function t(n,s){return dw(n,s)??n}e.apply=t;function i(n,s){return qU(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=Dn.zoomOnce(l,o[a]),l===void 0)return s;if(!m0(l))return;a+=1}if(l===void 0)return s;if(m0(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=YU([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(Bd||(Bd={}));function YU(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=dw(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=YU(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function yBe(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=dw(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function dw(e,t){if(!m0(t))return t;if(e instanceof fs){let i=YU(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Bt)return yBe(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=dw(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof wn)return qU(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=dw(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function qU(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!m0(t))return t;if(!m0(e))return Bd.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new wn;for(let n of i){let s=qU(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function xBe(e,t){let i={cur:[],result:[],len:0};return e=pw(e,t,i)??e,[e,i.result]}function YE(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function qE(e){e&&(e.len-=1)}function wBe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function Uee(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=pw(s.data,t,YE(i,a));qE(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=Uee(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function bBe(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=pw(s.data,t,YE(i,a));return qE(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function pw(e,t,i){if(e instanceof fs){let r=Uee(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof Bt)return bBe(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=pw(s,t,YE(i,a));return qE(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!XU(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=pw(a,t,YE(i,s));qE(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&wBe(i),r}else return}}var QE;(e=>{function t(i,r){let n=Dn.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(QE||(QE={}));var Jn;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}e.applySimple=i;function r(l,c){var d,p;let u=c.path;for(var h=[];;){let f;if(l instanceof wn&&c.type===0&&(f=l.runOp({...c,path:u.slice(h.length)}),f===null&&(f=void 0)),f===void 0&&h.length===u.length&&(l instanceof fs||l instanceof Bt||l instanceof Ht?f=l.runOp(c):f=XE.runOp(l,c)),f!==void 0)if(f!==null){let v=f.data;for(let x=h.length-1;x>=0;x--){let y=u[x],_=h[x];if(_ instanceof fs){if(typeof y=="number")throw new Error("illegal arg");v=_.modifyById(y,v)}else if(_ instanceof Bt){if(typeof y=="number")throw new Error("illegal arg");v=_.modifyById(y,v)}else if(_ instanceof Ht){if(typeof y=="number")throw new Error("illegal arg");v=_.modifyById(y,v)}else if(_ instanceof wn){let A={..._,[y]:v};v=Object.setPrototypeOf(A,wn.prototype)}else if(typeof _=="object")if(Array.isArray(_)){if(typeof y=="string"&&(y=parseInt(y),isNaN(y)))throw new Error("Invalid path");let A=v;v=[..._],v[y]=A}else v={..._,[y]:v};else return null}return{data:v,actual:{...f.actual,path:u},reverse:{...f.reverse,path:u}}}else return null;let g=u[h.length],m;if(l instanceof fs){if(typeof g=="number")throw new Error("");m=(d=l.get(g))==null?void 0:d.data}else if(l instanceof Bt){if(typeof g=="number")throw new Error("");m=(p=l.get(g))==null?void 0:p.data}else l!==null&&(m=l[g]);if(m!==void 0)h.push(l),l=m;else return null}}e.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function a(l,c){return n(l.path,c.path)}e.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(Jn||(Jn={}));var lO;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[p,...f]=d.path;p===u&&h.push({...d,path:f})}return h}e.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=r;function n(c,u){return[...c,...u]}e.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>Jn.subsumed(h,d))),...u]}e.compress=s;function a(c,u){return c.every(h=>u.every(d=>Jn.commutative(h,d)))}e.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],p=[];for(let f of u)try{if(f.type===3||f.type===5&&f.path[f.path.length-1]==="variables"){let g,m,v;if(f.type===3?(g=Dn.zoom(h,[...f.path,f.id]),v=Jn.apply(h,{...f,type:2})):(g=Dn.zoom(h,[...f.path,f.id,"value"]),v=Jn.apply(h,f)),v!==null){h=v.data;let[x,y]=xBe(h,{[f.id]:g});h=x;for(let _=0;_<y.length;_++){let A=y[_],S=A.pop();if(typeof S=="number"){let C=[S];for(let E=_+1;E<y.length;E++){let P=y[E],R=P[P.length-1];if(typeof R=="number"&&Dn.equal(A,P.slice(0,P.length-1)))C.push(R),y.splice(E,1);else break}let M=Dn.zoom(h,A);m=M.map((E,P)=>C.includes(P)?f.id:E),g=M,S=A.pop()}else{if(S==="alphaOverride"||S==="alpha"){g/=100;let C=g,M=Dn.zoom(h,A.slice(0,A.length-2)),E=M.layers.map(P=>P.id===A[A.length-1]?{...P,data:{...P.data,[S]:C}}:P);Object.setPrototypeOf(E,Object.getPrototypeOf(M.layers)),M.layers=E}m=f.id}d.push({type:0,path:A,props:{[S]:g}}),p.push({type:0,path:A,props:{[S]:m}})}p.push(v.reverse),d.push(v.actual)}}else{let g=Jn.apply(h,f);g!==null&&(d.push(g.actual),h=g.data,p.push(g.reverse))}}catch(g){if(g instanceof Bee)return null;throw g}return{data:h,actual:d,reverse:p.reverse()}}e.apply=l})(lO||(lO={}));var kee=Symbol(),_Be=Symbol(),LT=Symbol(),pb=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof Vee);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[LT];i&&i(),delete this._children[e]}}}},SBe=class extends pb{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,XE.runOp(this._current,e),e.path)}},ABe=class extends pb{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,Ht.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},zee={get(e,t){if(t===LT)return()=>{e._parent=null};if(t===kee)return e._current;if(t===_Be)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=OT(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},MBe={...zee,set(e,t,i){let r={type:0,props:{[t]:tn(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},EBe={...zee,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},QU=class extends pb{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[LT]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=OT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},JU=class extends pb{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[LT]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=OT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function SR(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Dn.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var Vee=class extends pb{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){SR(this.ts,t,e),SR(this.actual,i,e),SR(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function OT(e,t,i){return i instanceof fs?new QU(e,t,i):i instanceof Bt?new JU(e,t,i):i instanceof Ht?new Proxy(new ABe(e,t,i),EBe):i!==null&&typeof i=="object"?XU(i)?i:new Proxy(new SBe(e,t,i),MBe):i}function Gee(e){let t=new Vee(e);return[OT(t,"",e),t]}function fw(e,t){let[i,r]=Gee(e);return t(i),r.result()}function tn(e){return e instanceof QU||e instanceof JU?e._current:e!==null&&typeof e=="object"?e[kee]:e}var Dn;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof fs||s instanceof QU)&&typeof a=="string"||(s instanceof Bt||s instanceof JU)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(Dn||(Dn={}));function CBe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function sr(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var Hee=class{},wW=class extends Hee{constructor(e){super(),this.id=e}},bW=class extends Hee{constructor(e){super(),this.data=e}},cO;try{cO=new TextDecoder}catch{}var Ct,Fd,ze=0,Aa={},ji,dd,Po=0,wc=0,Ya,Qu,oa=[],qi,_W={useRecords:!1,mapsAsObjects:!0},jee=class{},Wee=new jee;Wee.name="MessagePack 0xC1";var g0=!1,JE=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Ct)return Kee(()=>(hO(),this?this.unpack(e,t):JE.prototype.unpack.call(_W,e,t)));Fd=t>-1?t:e.length,ze=0,wc=0,dd=null,Ya=null,Ct=e;try{qi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Ct=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof JE){if(Aa=this,this.structures)return ji=this.structures,oA();(!ji||ji.length>0)&&(ji=[])}else Aa=_W,(!ji||ji.length>0)&&(ji=[]);return oA()}unpackMultiple(e,t){let i,r=0;try{g0=!0;let n=e.length,s=this?this.unpack(e,n):FT.unpack(e,n);if(t){for(t(s);ze<n;)if(r=ze,t(oA())===!1)return}else{for(i=[s];ze<n;)r=ze,i.push(oA());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{g0=!1,hO()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function oA(){try{if(!Aa.trusted&&!g0){let t=ji.sharedLength||0;t<ji.length&&(ji.length=t)}let e=jr();if(ze==Fd)ji.restoreStructures&&SW(),ji=null,Ct=null,Qu&&(Qu=null);else if(ze>Fd){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!g0)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw ji.restoreStructures&&SW(),hO(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function SW(){for(let e in ji.restoreStructures)ji[e]=ji.restoreStructures[e];ji.restoreStructures=null}function jr(){let e=Ct[ze++];if(e<160)if(e<128){if(e<64)return e;{let t=ji[e&63]||Aa.getStructures&&Xee()[e&63];return t?(t.read||(t.read=KU(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Aa.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[qee()]=jr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(jr(),jr());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=jr();return t}else if(e<192){let t=e-160;if(wc>=ze)return dd.slice(ze-Po,(ze+=t)-Po);if(wc==0&&Fd<140){let i=t<16?ZU(t):Yee(t);if(i!=null)return i}return uO(t)}else{let t;switch(e){case 192:return null;case 193:return Ya?(t=jr(),t>0?Ya[1].slice(Ya.position1,Ya.position1+=t):Ya[0].slice(Ya.position0,Ya.position0-=t)):Wee;case 194:return!1;case 195:return!0;case 196:return AR(Ct[ze++]);case 197:return t=qi.getUint16(ze),ze+=2,AR(t);case 198:return t=qi.getUint32(ze),ze+=4,AR(t);case 199:return Fp(Ct[ze++]);case 200:return t=qi.getUint16(ze),ze+=2,Fp(t);case 201:return t=qi.getUint32(ze),ze+=4,Fp(t);case 202:if(t=qi.getFloat32(ze),Aa.useFloat32>2){let i=$U[(Ct[ze]&127)<<1|Ct[ze+1]>>7];return ze+=4,(i*t+(t>0?.5:-.5)>>0)/i}return ze+=4,t;case 203:return t=qi.getFloat64(ze),ze+=8,t;case 204:return Ct[ze++];case 205:return t=qi.getUint16(ze),ze+=2,t;case 206:return t=qi.getUint32(ze),ze+=4,t;case 207:return Aa.int64AsNumber?(t=qi.getUint32(ze)*4294967296,t+=qi.getUint32(ze+4)):t=qi.getBigUint64(ze),ze+=8,t;case 208:return qi.getInt8(ze++);case 209:return t=qi.getInt16(ze),ze+=2,t;case 210:return t=qi.getInt32(ze),ze+=4,t;case 211:return Aa.int64AsNumber?(t=qi.getInt32(ze)*4294967296,t+=qi.getUint32(ze+4)):t=qi.getBigInt64(ze),ze+=8,t;case 212:if(t=Ct[ze++],t==114)return TW(Ct[ze++]&63);{let i=oa[t];if(i)return i.read?(ze++,i.read(jr())):i.noBuffer?(ze++,i()):i(Ct.subarray(ze,++ze));throw new Error("Unknown extension "+t)}case 213:return t=Ct[ze],t==114?(ze++,TW(Ct[ze++]&63,Ct[ze++])):Fp(2);case 214:return Fp(4);case 215:return Fp(8);case 216:return Fp(16);case 217:return t=Ct[ze++],wc>=ze?dd.slice(ze-Po,(ze+=t)-Po):PBe(t);case 218:return t=qi.getUint16(ze),ze+=2,wc>=ze?dd.slice(ze-Po,(ze+=t)-Po):DBe(t);case 219:return t=qi.getUint32(ze),ze+=4,wc>=ze?dd.slice(ze-Po,(ze+=t)-Po):RBe(t);case 220:return t=qi.getUint16(ze),ze+=2,MW(t);case 221:return t=qi.getUint32(ze),ze+=4,MW(t);case 222:return t=qi.getUint16(ze),ze+=2,EW(t);case 223:return t=qi.getUint32(ze),ze+=4,EW(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var TBe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function KU(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>TBe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(jr);return e.highByte===0&&(e.read=AW(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=jr()}return r}return i.count=0,e.highByte===0?AW(t,i):i}var AW=(e,t)=>function(){let i=Ct[ze++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=ji[r]||Xee()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=KU(n,e)),n.read()};function Xee(){let e=Kee(()=>(Ct=null,Aa.getStructures()));return ji=Aa._mergeStructures(e,ji)}var uO=BT,PBe=BT,DBe=BT,RBe=BT;function BT(e){let t;if(e<16&&(t=ZU(e)))return t;if(e>64&&cO)return cO.decode(Ct.subarray(ze,ze+=e));let i=ze+e,r=[];for(t="";ze<i;){let n=Ct[ze++];if(!(n&128))r.push(n);else if((n&224)===192){let s=Ct[ze++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Ct[ze++]&63,a=Ct[ze++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Ct[ze++]&63,a=Ct[ze++]&63,o=Ct[ze++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=Wn.apply(String,r),r.length=0)}return r.length>0&&(t+=Wn.apply(String,r)),t}function MW(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=jr();return t}function EW(e){if(Aa.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[qee()]=jr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(jr(),jr());return t}}var Wn=String.fromCharCode;function Yee(e){let t=ze,i=new Array(e);for(let r=0;r<e;r++){let n=Ct[ze++];if((n&128)>0){ze=t;return}i[r]=n}return Wn.apply(String,i)}function ZU(e){if(e<4)if(e<2){if(e===0)return"";{let t=Ct[ze++];if((t&128)>1){ze-=1;return}return Wn(t)}}else{let t=Ct[ze++],i=Ct[ze++];if((t&128)>0||(i&128)>0){ze-=2;return}if(e<3)return Wn(t,i);let r=Ct[ze++];if((r&128)>0){ze-=3;return}return Wn(t,i,r)}else{let t=Ct[ze++],i=Ct[ze++],r=Ct[ze++],n=Ct[ze++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){ze-=4;return}if(e<6){if(e===4)return Wn(t,i,r,n);{let s=Ct[ze++];if((s&128)>0){ze-=5;return}return Wn(t,i,r,n,s)}}else if(e<8){let s=Ct[ze++],a=Ct[ze++];if((s&128)>0||(a&128)>0){ze-=6;return}if(e<7)return Wn(t,i,r,n,s,a);let o=Ct[ze++];if((o&128)>0){ze-=7;return}return Wn(t,i,r,n,s,a,o)}else{let s=Ct[ze++],a=Ct[ze++],o=Ct[ze++],l=Ct[ze++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){ze-=8;return}if(e<10){if(e===8)return Wn(t,i,r,n,s,a,o,l);{let c=Ct[ze++];if((c&128)>0){ze-=9;return}return Wn(t,i,r,n,s,a,o,l,c)}}else if(e<12){let c=Ct[ze++],u=Ct[ze++];if((c&128)>0||(u&128)>0){ze-=10;return}if(e<11)return Wn(t,i,r,n,s,a,o,l,c,u);let h=Ct[ze++];if((h&128)>0){ze-=11;return}return Wn(t,i,r,n,s,a,o,l,c,u,h)}else{let c=Ct[ze++],u=Ct[ze++],h=Ct[ze++],d=Ct[ze++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){ze-=12;return}if(e<14){if(e===12)return Wn(t,i,r,n,s,a,o,l,c,u,h,d);{let p=Ct[ze++];if((p&128)>0){ze-=13;return}return Wn(t,i,r,n,s,a,o,l,c,u,h,d,p)}}else{let p=Ct[ze++],f=Ct[ze++];if((p&128)>0||(f&128)>0){ze-=14;return}if(e<15)return Wn(t,i,r,n,s,a,o,l,c,u,h,d,p,f);let g=Ct[ze++];if((g&128)>0){ze-=15;return}return Wn(t,i,r,n,s,a,o,l,c,u,h,d,p,f,g)}}}}}function AR(e){return Aa.copyBuffers?Uint8Array.prototype.slice.call(Ct,ze,ze+=e):Ct.subarray(ze,ze+=e)}function Fp(e){let t=Ct[ze++];if(oa[t])return oa[t](Ct.subarray(ze,ze+=e));throw new Error("Unknown extension type "+t)}var CW=new Array(4096);function qee(){let e=Ct[ze++];if(e>=160&&e<192){if(e=e-160,wc>=ze)return dd.slice(ze-Po,(ze+=e)-Po);if(!(wc==0&&Fd<180))return uO(e)}else return ze--,jr();let t=(e<<5^(e>1?qi.getUint16(ze):e>0?Ct[ze]:0))&4095,i=CW[t],r=ze,n=ze+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=qi.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Ct[r++],s!=i[a++]){r=1879048192;break}if(r===n)return ze=r,i.string;n-=3,r=ze}for(i=[],CW[t]=i,i.bytes=e;r<n;)s=qi.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Ct[r++],i.push(s);let o=e<16?ZU(e):Yee(e);return o!=null?i.string=o:i.string=uO(e)}var TW=(e,t)=>{var i=jr();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=ji[e];return n&&n.isShared&&((ji.restoreStructures||(ji.restoreStructures=[]))[e]=n),ji[e]=i,i.read=KU(i,r),i.read()},Qee=typeof self=="object"?self:global;oa[0]=()=>{};oa[0].noBuffer=!0;oa[101]=()=>{let e=jr();return(Qee[e[0]]||Error)(e[1])};oa[105]=e=>{let t=qi.getUint32(ze-4);Qu||(Qu=new Map);let i=Ct[ze],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Qu.set(t,n);let s=jr();return n.used?Object.assign(r,s):(n.target=s,s)};oa[112]=e=>{let t=qi.getUint32(ze-4),i=Qu.get(t);return i.used=!0,i.target};oa[115]=()=>new Set(jr());var Jee=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");oa[116]=e=>{let t=e[0],i=Jee[t];if(!i)throw new Error("Could not find typed array for code "+t);return new Qee[i](Uint8Array.prototype.slice.call(e,1).buffer)};oa[120]=()=>{let e=jr();return new RegExp(e[0],e[1])};oa[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=ze;ze+=t-4,Ya=[jr(),jr()],Ya.position0=0,Ya.position1=0;let r=ze;ze=i;try{return jr()}finally{ze=r}};oa[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Kee(e){let t=Fd,i=ze,r=Po,n=wc,s=dd,a=Qu,o=Ya,l=new Uint8Array(Ct.slice(0,Fd)),c=ji,u=ji.slice(0,ji.length),h=Aa,d=g0,p=e();return Fd=t,ze=i,Po=r,wc=n,dd=s,Qu=a,Ya=o,Ct=l,g0=d,ji=c,ji.splice(0,ji.length,...u),Aa=h,qi=new DataView(Ct.buffer,Ct.byteOffset,Ct.byteLength),p}function hO(){Ct=null,Qu=null,ji=null}function IBe(e){e.unpack?oa[e.type]=e.unpack:oa[e.type]=e}var $U=new Array(147);for(let e=0;e<256;e++)$U[e]=+("1e"+Math.floor(45.15-e*.30103));var FT=new JE({useRecords:!1});FT.unpack;FT.unpackMultiple;FT.unpack;var LBe=new Float32Array(1);new Uint8Array(LBe.buffer,0,4);var TM;try{TM=new TextEncoder}catch{}var KE,ek,NT=typeof Buffer<"u",MR=NT?Buffer.allocUnsafeSlow:Uint8Array,Zee=NT?Buffer:Uint8Array,PW=NT?4294967296:2144337920,nt,Zr,We=0,$l,ec=null,OBe=/[\u0080-\uFFFF]/,s1=Symbol("record-id"),$ee=class extends JE{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=Zee.prototype.utf8Write?function(S,C,M){return nt.utf8Write(S,C,M)}:TM&&TM.encodeInto?function(S,C){return TM.encodeInto(S,nt.subarray(C)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,f=h+64,g=h+d+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],v=0,x=0;this.pack=this.encode=function(S,C){if(nt||(nt=new MR(8192),Zr=new DataView(nt.buffer,0,8192),We=0),$l=nt.length-10,$l-We<2048?(nt=new MR(nt.length),Zr=new DataView(nt.buffer,0,nt.length),$l=nt.length-10,We=0):We=We+7&2147483640,t=We,s=l.structuredClone?new Map:null,l.bundleStrings?(ec=["",""],nt[We++]=214,nt[We++]=98,ec.position=We-t,We+=4):ec=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let M=i.sharedLength||0;if(M>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let E=0;E<M;E++){let P=i[E];if(!P)continue;let R,O=i.transitions;for(let L=0,I=P.length;L<I;L++){let z=P[L];R=O[z],R||(R=O[z]=Object.create(null)),O=R}O[s1]=E+64}a=M}c||(i.nextId=M+64)}r&&(r=!1),n=i||[];try{if(y(S),ec){Zr.setUint32(ec.position+t,We-ec.position-t);let M=ec;ec=null,y(M[0]),y(M[1])}if(l.offset=We,s&&s.idsToInsert){We+=s.idsToInsert.length*6,We>$l&&A(We),l.offset=We;let M=FBe(nt.subarray(t,We),s.idsToInsert);return s=null,M}return C&NBe?(nt.start=t,nt.end=We,nt):nt.subarray(t,We)}finally{if(i){if(x<10&&x++,v>1e4)i.transitions=null,x=0,v=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let M=0,E=m.length;M<E;M++)m[M][s1]=0;m=[]}if(r&&l.saveStructures){let M=i.sharedLength||h;i.length>M&&(i=i.slice(0,M));let E=nt.subarray(t,We);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(S)):(a=M,E)}}C&UBe&&(We=t)}};let y=S=>{We>$l&&(nt=A(We));var C=typeof S,M;if(C==="string"){let E=S.length;if(ec&&E>=8&&E<4096){let O=OBe.test(S);ec[O?0:1]+=S,nt[We++]=193,y(O?-E:E);return}let P;E<32?P=1:E<256?P=2:E<65536?P=3:P=5;let R=E*3;if(We+R>$l&&(nt=A(We+R)),E<64||!o){let O,L,I,z=We+P;for(O=0;O<E;O++)L=S.charCodeAt(O),L<128?nt[z++]=L:L<2048?(nt[z++]=L>>6|192,nt[z++]=L&63|128):(L&64512)===55296&&((I=S.charCodeAt(O+1))&64512)===56320?(L=65536+((L&1023)<<10)+(I&1023),O++,nt[z++]=L>>18|240,nt[z++]=L>>12&63|128,nt[z++]=L>>6&63|128,nt[z++]=L&63|128):(nt[z++]=L>>12|224,nt[z++]=L>>6&63|128,nt[z++]=L&63|128);M=z-We-P}else M=o(S,We+P,R);M<32?nt[We++]=160|M:M<256?(P<2&&nt.copyWithin(We+2,We+1,We+1+M),nt[We++]=217,nt[We++]=M):M<65536?(P<3&&nt.copyWithin(We+3,We+2,We+2+M),nt[We++]=218,nt[We++]=M>>8,nt[We++]=M&255):(P<5&&nt.copyWithin(We+5,We+3,We+3+M),nt[We++]=219,Zr.setUint32(We,M),We+=4),We+=M}else if(C==="number")if(S>>>0===S)S<64?nt[We++]=S:S<256?(nt[We++]=204,nt[We++]=S):S<65536?(nt[We++]=205,nt[We++]=S>>8,nt[We++]=S&255):(nt[We++]=206,Zr.setUint32(We,S),We+=4);else if(S>>0===S)S>=-32?nt[We++]=256+S:S>=-128?(nt[We++]=208,nt[We++]=S+256):S>=-32768?(nt[We++]=209,Zr.setInt16(We,S),We+=2):(nt[We++]=210,Zr.setInt32(We,S),We+=4);else{let E;if((E=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){nt[We++]=202,Zr.setFloat32(We,S);let P;if(E<4||(P=S*$U[(nt[We]&127)<<1|nt[We+1]>>7])>>0===P){We+=4;return}else We--}nt[We++]=203,Zr.setFloat64(We,S),We+=8}else if(C==="object")if(!S)nt[We++]=192;else{if(s){let P=s.get(S);if(P){if(!P.id){let R=s.idsToInsert||(s.idsToInsert=[]);P.id=R.push(P)}nt[We++]=214,nt[We++]=112,Zr.setUint32(We,P.id),We+=4;return}else s.set(S,{offset:We-t})}let E=S.constructor;if(E===Object)_(S,!0);else if(E===Array){M=S.length,M<16?nt[We++]=144|M:M<65536?(nt[We++]=220,nt[We++]=M>>8,nt[We++]=M&255):(nt[We++]=221,Zr.setUint32(We,M),We+=4);for(let P=0;P<M;P++)y(S[P])}else if(E===Map){M=S.size,M<16?nt[We++]=128|M:M<65536?(nt[We++]=222,nt[We++]=M>>8,nt[We++]=M&255):(nt[We++]=223,Zr.setUint32(We,M),We+=4);for(let[P,R]of S)y(P),y(R)}else{for(let P=0,R=KE.length;P<R;P++){let O=ek[P];if(S instanceof O){let L=KE[P];if(L.write){L.type&&(nt[We++]=212,nt[We++]=L.type,nt[We++]=0),y(L.write.call(this,S));return}let I=nt,z=Zr,K=We;nt=null;let Y;try{Y=L.pack.call(this,S,U=>(nt=I,I=null,We+=U,We>$l&&A(We),{target:nt,targetView:Zr,position:We-U}),y)}finally{I&&(nt=I,Zr=z,We=K,$l=nt.length-10)}Y&&(Y.length+We>$l&&A(Y.length+We),We=BBe(Y,nt,We,L.type));return}}_(S,!S.hasOwnProperty)}}else if(C==="boolean")nt[We++]=S?195:194;else if(C==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))nt[We++]=211,Zr.setBigInt64(We,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)nt[We++]=207,Zr.setBigUint64(We,S);else if(this.largeBigIntToFloat)nt[We++]=203,Zr.setFloat64(We,Number(S));else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");We+=8}else if(C==="undefined")this.encodeUndefinedAsNil?nt[We++]=192:(nt[We++]=212,nt[We++]=0,nt[We++]=0);else if(C==="function")y(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+C)},_=this.useRecords===!1?this.variableMapSize?S=>{let C=Object.keys(S),M=C.length;M<16?nt[We++]=128|M:M<65536?(nt[We++]=222,nt[We++]=M>>8,nt[We++]=M&255):(nt[We++]=223,Zr.setUint32(We,M),We+=4);let E;for(let P=0;P<M;P++)y(E=C[P]),y(S[E])}:(S,C)=>{nt[We++]=222;let M=We-t;We+=2;let E=0;for(let P in S)(C||S.hasOwnProperty(P))&&(y(P),y(S[P]),E++);nt[M+++t]=E>>8,nt[M+t]=E&255}:S=>{let C=Object.keys(S),M,E=n.transitions||(n.transitions=Object.create(null)),P=0;for(let O=0,L=C.length;O<L;O++){let I=C[O];M=E[I],M||(M=E[I]=Object.create(null),P++),E=M}let R=E[s1];if(R)R>=96&&p?(nt[We++]=((R-=96)&31)+96,nt[We++]=R>>5):nt[We++]=R;else{R=n.nextId,R||(R=64),R<f&&this.shouldShareStructure&&!this.shouldShareStructure(C)?(R=n.nextOwnId,R<g||(R=f),n.nextOwnId=R+1):(R>=g&&(R=f),n.nextId=R+1);let O=C.highByte=R>=96&&p?R-96>>5:-1;E[s1]=R,n[R-64]=C,R<f?(C.isShared=!0,n.sharedLength=R-63,r=!0,O>=0?(nt[We++]=(R&31)+96,nt[We++]=O):nt[We++]=R):(O>=0?(nt[We++]=213,nt[We++]=114,nt[We++]=(R&31)+96,nt[We++]=O):(nt[We++]=212,nt[We++]=114,nt[We++]=R),P&&(v+=x*P),m.length>=d&&(m.shift()[s1]=0),m.push(E),y(C))}for(let O=0,L=C.length;O<L;O++)y(S[C[O]])},A=S=>{let C;if(S>16777216){if(S-t>PW)throw new Error("Packed buffer would be larger than maximum buffer size");C=Math.min(PW,Math.round(Math.max((S-t)*(S>67108864?1.25:2),4194304)/4096)*4096)}else C=(Math.max(S-t<<2,nt.length-1)>>12)+1<<12;let M=new MR(C);return Zr=new DataView(M.buffer,0,C),nt.copy?nt.copy(M,0,t,S):M.set(nt.slice(t,S)),We-=t,t=0,$l=M.length-10,nt=M}}useBuffer(e){nt=e,Zr=new DataView(nt.buffer,nt.byteOffset,nt.byteLength),We=0}};ek=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,jee];KE=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?DW(e,16,t):RW(NT?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==Zee&&this.structuredClone?DW(e,Jee.indexOf(i.name),t):RW(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function DW(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function RW(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function BBe(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function FBe(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function K0(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");ek.unshift(e.Class),KE.unshift(e)}IBe(e)}var ete=new $ee({useRecords:!1});ete.pack;ete.pack;var NBe=512,UBe=1024,IW=new $ee({structuredClone:!0});K0({Class:Ht.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Ht.prototype),e}});K0({Class:Bt.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Bt.prototype),e}});K0({Class:fs.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,fs.prototype),e}});K0({Class:wW.prototype.constructor,type:4,write(e){return e.id},read(e){return new wW(e)}});K0({Class:bW.prototype.constructor,type:5,write(e){return e.data},read(e){return new bW(e)}});K0({Class:wn.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,wn.prototype),e}});function kBe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function dO(e){if(XU(e))return e;if(Array.isArray(e))return e.map(dO);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=dO(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var pO;(e=>{function t(n){return IW.pack(n)}e.serialize=t;function i(n){return IW.unpack(n)}e.deserialize=i;function r(n){return kBe(t(dO(n))).toString()}e.checksum=r})(pO||(pO={}));var LW;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(LW||(LW={}));function OW(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var Ds={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},BW;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new Bt}:{type:r,disabled:!1,key:void 0,actions:new Bt}}e.defaultData=i})(BW||(BW={}));var ZE;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(ZE||(ZE={}));var fO;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:ZE.propertyDefaultData(n),rOperand:{...ZE.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(fO||(fO={}));var FW;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(FW||(FW={}));var NW;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new Bt,outActions:new Bt,condition:fO.distanceDefaultData(r)}}e.defaultData=i})(NW||(NW={}));var UW;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new Bt,drop:new Bt}})(UW||(UW={}));var mO;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new Bt})(mO||(mO={}));var gO;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(gO||(gO={}));var kW;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new Bt}}e.defaultData=i})(kW||(kW={}));var zW;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new Bt}}e.defaultData=i})(zW||(zW={}));var VW;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new Bt}}e.defaultData=i})(VW||(VW={}));var GW;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new Bt}}e.defaultData=i})(GW||(GW={}));var HW;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new Bt,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(HW||(HW={}));var vO;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new Bt},o={size:"tablet",operator:"<",actions:new Bt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new Bt},c=new Bt;return c.push({id:St.generateUUID(),fi:0,data:a},{id:St.generateUUID(),fi:1,data:o},{id:St.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new Bt}}e.defaultBreakpointData=s})(vO||(vO={}));var yO;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new Bt,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(yO||(yO={}));var jW;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new Bt,errorActions:new Bt,userAPIId:""}}e.defaultData=i})(jW||(jW={}));var WW;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new Bt,userWebhookId:""}}e.defaultData=i})(WW||(WW={}));var XW;(e=>{function t(r){return r.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new Bt,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(XW||(XW={}));var YW;(e=>{function t(r){return r.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new Bt}}e.defaultData=i})(YW||(YW={}));var Z0="personal camera",dx="a218fcc3-276b-49b9-b485-49037fd14f5f",zBe=2960946,io=5526619,Gu;(e=>{function t(f,g){return f[0]===g[0]&&f[1]===g[1]}e.isEqual=t;function i(f,g,m){return[f[0]+(g[0]-f[0])*m,f[1]+(g[1]-f[1])*m]}e.lerp=i;function r(f,g){return[f[0]+g[0],f[1]+g[1]]}e.add=r;function n(f,g){return[f[0]-g[0],f[1]-g[1]]}e.sub=n;function s(f,g){return[f[0]*g[0],f[1]*g[1]]}e.multiply=s;function a(f,g){return[f[0]/g[0],f[1]/g[1]]}e.divide=a;function o(f,g){return Math.pow(g[0]-f[0],2)+Math.pow(g[1]-f[1],2)}e.distanceSquared=o;function l(f,g){return Math.sqrt(o(f,g))}e.distance=l;function c(f,g){return f[0]*g[0]+f[1]*g[1]}e.dot=c;function u(f,g){return[f[0]*g,f[1]*g]}e.scalarMultiply=u;function h(f,g,m){let v=e.sub(g,f),x=e.sub(m,f),y=e.dot(v,x)/e.dot(v,v),_=e.scalarMultiply(v,y);return e.add(f,_)}e.projectionOnto=h;function d(f,g,m){return l(f,h(f,g,m))}e.projectionOntoDistance=d;function p(f,g){return[(f[0]+g[0])*.5,(f[1]+g[1])*.5]}e.center=p})(Gu||(Gu={}));var kf;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(kf||(kf={}));var $E;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})($E||($E={}));var qW;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(qW||(qW={}));var v0;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}e.applyMatrix4=r})(v0||(v0={}));var hs;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(hs||(hs={}));var er;(e=>{e.white={...hs.white,a:1},e.transparent={...hs.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...hs.fromHex(l),a:c}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function n(l,c){return hs.equals(l,c)&&l.a===c.a}e.equals=n;function s(l,c){return hs.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=a;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(er||(er={}));var xO;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(xO||(xO={}));var QW;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(QW||(QW={}));var JW;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(JW||(JW={}));var $h;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))($h||($h={}));function KW(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var nm;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(nm||(nm={}));var y0;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}e.getZoom=t})(y0||(y0={}));var pd;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(tte.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;ite.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;rte.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;nte.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;ste.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;ate.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(pd||(pd={}));var wO;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(wO||(wO={}));var tte=["count"],ite=["radius","start","end","position","scale","rotation"],rte=["position","scale","rotation"],nte=["count","size"],ste=["count","position","scale","rotation"],ate=["strength","scale","rotation","position","movement","seed","freqScale"],bO;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(bO||(bO={}));var _O;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:er.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:er.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:er.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(_O||(_O={}));var eC;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(eC||(eC={}));var x0;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(x0||(x0={}));var SO;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(SO||(SO={}));var AO;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(AO||(AO={}));var MO;(e=>e.defaultData={...AO.defaultData,...SO.defaultData})(MO||(MO={}));var ZW;(e=>{function t(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}e.getMaterialData=t})(ZW||(ZW={}));var tC;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(tC||(tC={}));var $W;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})($W||($W={}));function VBe(e){return e.type!=="displace"}var e8;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(e8||(e8={}));var ote=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],GBe=["wrapping","image","video","name","minFilter","magFilter"],Xn;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,a){return s==="light"&&a?r(a):n(s)}e.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:tC.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:hs.fromHex(io)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...hs.fromHex(6710886),a:1},colorB:{...hs.fromHex(6710886),a:1},colorC:{...hs.fromHex(16777215),a:1},colorD:{...hs.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:er.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:er.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:er.fromHexAndA(0,1),contourColor:er.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...hs.fromHex(0),a:1},colorB:{...hs.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Xn||(Xn={}));var Kn;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,f])=>{h+=`${p}${f}`,Array.isArray(f)?f.forEach(g=>h+=`${g}`):typeof f=="object"?Object.values(f).forEach(g=>{typeof g=="number"?h+=`${g.toFixed(4)}`:h+=`${g}`}):h+=`${f}`})}),h}e.getHash=i;function r(){return{layers:new Bt}}e.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=n;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",d="layer2"){let p=new Bt;return p.push({fi:0,data:Xn.defaultData("light",u),id:h}),p.push({fi:1,data:Xn.defaultData("color"),id:d}),{layers:p}}e.defaultTwoLayerData=a;function o(u){let h=Xn.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new Bt;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...Xn.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...Xn.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",p="layer2"){let f=Xn.defaultData("texture");Object.assign(f.texture,{image:u});let g=new Bt;return g.push({fi:0,data:f,id:d}),g.push({fi:1,data:Xn.defaultData("light",h),id:p}),{layers:g}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",p="layer2"){let f=Xn.defaultData("video");Object.assign(f.texture,{video:u});let g=new Bt;return g.push({fi:0,data:f,id:d}),g.push({fi:1,data:Xn.defaultData("light",h),id:p}),{layers:g}}e.defaultTwoLayerVideoTextureData=c})(Kn||(Kn={}));var iC;(e=>{function t(){return{points:new Bt,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(iC||(iC={}));var rC;(e=>{function t(){return{points:new Bt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(rC||(rC={}));var lte={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},EO;(e=>{function t(i,r){let n={...i};return ute.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(EO||(EO={}));var cte={shape:lte,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},ute=["depth","offset","angle","twist","startScale","endScale"],nC;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(nC||(nC={}));var CO;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,EO.merge(n.extrusion,r.extrusion))),n}e.merge=t})(CO||(CO={}));var rd;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:rC.defaultData(),extrusion:cte};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:iC.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(rd||(rd={}));var ER=["width","height","depth"],TO;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:hs.white,near:.1,far:2e3})(TO||(TO={}));var sC;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(sC||(sC={}));var PO;(e=>e.defaultData={softShadowQuality:"low"})(PO||(PO={}));var DO;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(DO||(DO={}));var RO;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(RO||(RO={}));var w0;(e=>e.defaultData={usePhysics:!1,gravity:-10})(w0||(w0={}));var IO;(e=>e.defaultData={playCamera:Z0,gameControlObject:null})(IO||(IO={}));var LO;(e=>e.defaultData={backgroundColor:er.fromHexAndA(zBe,1),postprocessing:sC.defaultData,fog:TO.defaultData,globalPhysics:w0.defaultData,ambient:DO.defaultData,ao:RO.defaultData,shadow:PO.defaultData,publish:IO.defaultData})(LO||(LO={}));var OO;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(OO||(OO={}));var t8;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(t8||(t8={}));var b0;(e=>{e.identity={...xO.identity,hiddenMatrix:v0.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return Eee({position:kf.isEqual(n.position,s.position)?void 0:s.position,rotation:kf.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:kf.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:v0.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(b0||(b0={}));var Rn;(e=>e.defaultData={states:new Bt,events:new Bt,visible:!0,raycastLock:!1,physics:x0.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...b0.identity,cloner:null})(Rn||(Rn={}));var BO;(e=>e.defaultData={type:"Empty",...Rn.defaultData})(BO||(BO={}));var i8;(e=>e.defaultData={type:"ParticleCollider",...OO.defaultData,...Rn.defaultData})(i8||(i8={}));var r8;(e=>e.defaultData={type:"Component",...Rn.defaultData})(r8||(r8={}));var n8;(e=>e.defaultData={type:"Particle",...Rn.defaultData,...eC.defaultData})(n8||(n8={}));var nd;(e=>e.defaultData={type:"Mesh",...Rn.defaultData,...MO.defaultData})(nd||(nd={}));var mw;(e=>e.defaultData={...Rn.defaultData,...b0.identity,position:[0,0,y0.DefaultTargetOffset],...y0.defaultData})(mw||(mw={}));var FO;(e=>{function t(i){return{...Rn.defaultData,..._O.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(FO||(FO={}));var aC;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(aC||(aC={}));var fd;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...Rn.defaultData,...n,component:r,overrides:new wn,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=b0.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(fd||(fd={}));var _0;(e=>{e.defaultData={type:"Page",...Rn.defaultData,physics:{...x0.defaultData,fusedBody:!1},...LO.defaultData,camera:mw.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(_0||(_0={}));var NO;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:v0.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:x0.defaultData,states:new Bt,events:new Bt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...y0.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Rn.defaultData,...nd.defaultData,geometry:rd.defaultData("RectangleGeometry"),material:Kn.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Rn.defaultData,...nd.defaultData,geometry:rd.defaultData("BooleanGeometry"),material:Kn.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...Rn.defaultData,...nd.defaultData,geometry:rd.defaultData("ShapeBlendGeometry"),material:Kn.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Rn.defaultData,...nd.defaultData,geometry:rd.defaultData("TextGeometry"),material:Kn.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...Rn.defaultData,...nd.defaultData,geometry:rd.defaultData("InputGeometry"),material:Kn.defaultTwoLayerData("phong","layer1","layer2")}))(NO||(NO={}));var bf;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new wn}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new wn})))):nm.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=fw(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&Xn.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=fw(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[p,f]of Object.entries(d.layers)){let g=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(p);g&&Xn.patch(g,f)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[p,f]of Object.entries(d.layers)){let{texture:g,...m}=f;if(g!==void 0&&Object.keys(g).length>0){let v={path:[...h,"layers",p,"texture"],props:g,type:0};l.push(v)}if(Object.keys(m).length>0){let v={path:[...h,"layers",p],props:m,type:0};l.push(v)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...wO.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[p,f]of Object.entries(d))u(["materials",p],f);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function n(s,a){var l,c,u,h,d,p;if(a===void 0)return s;let o={...s};if(Object.assign(o,b0.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),nm.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let f=a;((d=f.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(o.targetOffset=f.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:CO.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:pd.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:pd.merge(o.cloner,a.cloner)});else if(bO.is(s.type)){let f=a;f.intensity!==void 0&&(o.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?o.color=f.color:o.color=hs.clone(f.color))}return o}e.patch=n})(bf||(bf={}));var oC;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(oC||(oC={}));var md;(e=>e.defaultData={orbitControls:oC.defaultData,playPage:dx,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(md||(md={}));var UO;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(UO||(UO={}));var kO;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(kO||(kO={}));var _f;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...UO.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:kO.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(_f||(_f={}));var gw;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=uC.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(gw||(gw={}));var Sf;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:FO.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=NO.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new fs;return l.push({fi:1,id:dx,data:{..._0.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:md.defaultData,styles:_f.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new fs,publish:md.defaultData,styles:_f.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:md.defaultData,styles:_f.defaultData()}},e.emptyData=function(){return{objects:new fs,publish:{...md.defaultData},styles:_f.defaultData()}};function i(n){return{...e.defaultData,objects:Xo(n,fs.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(Sf||(Sf={}));var px;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(px||(px={}));var zO;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new Bt}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(zO||(zO={}));var s8;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new Bt,queries:new Bt,autoStart:!0}))(s8||(s8={}));var ms;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(ms||(ms={}));var VO;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(VO||(VO={}));var a8;(e=>e.all=[...VO.all,"components"])(a8||(a8={}));var o8;(e=>{function t(){return{images:new Ht,videos:new Ht,colors:new Ht,audios:new Ht,particles:new Ht,fonts:new Ht,materials:new Ht,components:new Ht,variables:new Ht,userAPIs:new Ht,userWebhooks:new Ht}}e.defaultData=t})(o8||(o8={}));var oh;(e=>{function t(){return{images:new Ht,videos:new Ht,colors:new Ht,audios:new Ht,particles:new Ht,fonts:new Ht,materials:new Ht,components:new Ht,variables:new Ht,userAPIs:new Ht,userWebhooks:new Ht}}e.defaultData=t})(oh||(oh={}));var Do;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Xo(a,Ht.prototype)}e.defaultColors=t;function i(){return Xo({},Ht.prototype)}e.defaultImages=i;function r(){return{catelogs:new Ht,materials:new Ht,images:new Ht,videos:new Ht,colors:new Ht,audios:new Ht,particles:new Ht,fonts:new Ht,variables:new Bt,userAPIs:new Ht,userWebhooks:new Ht,lib:oh.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(Do||(Do={}));var lC;(e=>e.list=["idle","move","jump","run"])(lC||(lC={}));var cC;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new Bt,move:new Bt,jump:new Bt,run:new Bt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:er.fromHexAndA(3728051,1)}}))(cC||(cC={}));function l8(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Ic(tn(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...tn(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function sd(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function ad(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=Kn.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Kn.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Kn.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==wn.prototype&&t(n.material)})})}function HBe(e){Object.assign(e.scene.publish,{orbitControls:{...oC.defaultData,...tn(e.scene.publish.orbitControls)}})}function jBe(e){Object.assign(e.scene.publish.settings,{video:{...md.defaultData.settings.video,...tn(e.scene.publish.settings.video)}})}function WBe(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((ote.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(GBe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function XBe(e){e.scene.publish.withBackground=!0}function YBe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function qBe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function QBe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function JBe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=tn(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=tn(i).booleanExclude!==!0)}})}function KBe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function ZBe(e){function t(r){Object.setPrototypeOf(r,wn.prototype),r.texture&&Object.setPrototypeOf(r.texture,wn.prototype)}function i(r){Object.setPrototypeOf(r,wn.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=tn(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=tn(l).layers;i(c),l.layers=c}})})}function c8(e){e.layers===void 0&&Object.assign(e,Kn.defaultTwoLayerData("lambert"))}function CR(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...tn(t),colors:i,steps:r};Object.assign(t,n)}})}function $Be(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function u8(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&CR(r)}):"material"in i&&typeof i.material!="string"&&CR(i.material)}),Object.values(e.shared.materials).forEach(t=>CR(t))}function eFe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function tFe(e){e.shared.audios=Xo({},Ht.prototype)}function iFe(e){e.shared.videos=Xo({},Ht.prototype)}function rFe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function nFe(e){Object.entries(tn(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(tn(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function sFe(e){e.scene.publish.settings.web.preload=!1}function h8(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function d8(e){e.layers&&e.layers.forEach(t=>{VBe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function aFe(e){e.shared.fonts=Xo({},Ht.prototype)}function oFe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function lFe(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Kn.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=oFe(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...Rn.defaultData,...nd.defaultData,flatShading:!1,wireframe:!1,geometry:{...rd.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:tn(n.states),events:tn(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=tn(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function cFe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new Bt,move:new Bt,jump:new Bt}});else{let s=new Bt;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:St.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,Ic(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Bt({fi:0,id:St.generateUUID(),data:c},{fi:1,id:St.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete n.targets)}})})}function uFe(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new Bt,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...Ic(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...Ic(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:St.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function p8(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=Xn.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function f8(e){sd(e,p8),ad(e,p8)}function hFe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function dFe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function pFe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Kn.defaultTwoLayerData("phong"))})}function fFe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function mFe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function gFe(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function vFe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function yFe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function xFe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function wFe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=cC.defaultDataThirdPerson.navmesh)})})}function bFe(e){e.scene.styles||(e.scene.styles=_f.defaultData())}function m8(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function _Fe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),ad(e,m8),sd(e,m8)}function SFe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new Bt})})})}function AFe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function g8(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function MFe(e,t){if(t<1&&(ad(e,l8),sd(e,l8),e.schema=1),t<2&&(HBe(e),e.schema=2),t<3&&(WBe(e),e.schema=3),t<4&&(XBe(e),e.schema=4),t<5&&(YBe(e),e.schema=5),t<6&&(qBe(e),e.schema=6),t<7&&(QBe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(u8(e),e.schema=9),t<10&&($Be(e),e.schema=10),t<11&&(eFe(e),e.schema=11),t<12&&(u8(e),e.schema=12),t<13&&(tFe(e),e.schema=13),t<14&&(rFe(e),e.schema=14),t<15&&(nFe(e),e.schema=15),t<16&&(sFe(e),e.schema=16),t<17&&(ad(e,h8),sd(e,h8),e.schema=17),t<18&&(ad(e,c8),sd(e,c8),e.schema=18),t<19&&(jBe(e),e.schema=19),t<20&&(aFe(e),lFe(e),e.schema=20),t<21&&(cFe(e),uFe(e),e.schema=21),t<22&&(f8(e),e.schema=22),t<23&&(hFe(e),e.schema=23),t<24&&(dFe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(iFe(e),t<25&&(e.schema=25)),t<26&&(JBe(e),e.schema=26),t<27&&(KBe(e),e.schema=27),t<28&&(f8(e),e.schema=28),t<29&&(ZBe(e),e.schema=29),t<30&&(pFe(e),e.schema=30),t<31&&(fFe(e),e.schema=31),t<33&&(mFe(e),e.schema=33),t<34&&(gFe(e),e.schema=34),t<35&&(vFe(e),e.schema=35),t<36&&(yFe(e),e.schema=36),t<37&&(xFe(e),e.schema=37),t<38&&(ad(e,d8),sd(e,d8),e.schema=38),t<39&&(wFe(e),e.schema=39),t<40&&(bFe(e),e.schema=40),t<41&&(_Fe(e),e.schema=41),t<42&&(SFe(e),e.schema=42),t<43&&(AFe(e),e.schema=43),t<99){ad(e,g8),sd(e,g8),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=Z0);let i=tn(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=dx,r.insertBefore(null,null,[{id:dx,data:{..._0.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Ic(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Ic(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...w0.defaultData,...Ic(e.scene.environment,"usePhysics","gravity")},camera:tn(e.scene.ownerCamera)??_0.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==Sf.TRASH_CAN_ID&&r.move(dx,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,x0.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function v8(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function EFe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function CFe(e){var t;Array.isArray(tn(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var Wg=180/Math.PI;function y8(e){e.rotation=e.rotation.slice(0,3).map(t=>t*Wg)}function hte(e){var i,r;y8(e),e.type==="Page"&&y8(e.camera),(i=e.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*Wg))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*Wg),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*Wg),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=Wg,t.extrusion.twist*=Wg),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(tn(e.events))&&((r=e.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function TFe(e){e.shared.variables=Xo({},Ht.prototype)}function PFe(e){let t=tn(e.shared.variables);e.shared.variables=Xo(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),Bt.prototype)}var Eu=115;function dte(e,t){t(e.data);for(let i of e.children)dte(i,t)}function DFe(e){let t=e.schema??104;t!==Eu&&t<105&&(dte(e.asset,hte),e.schema=105)}function RFe(e){e.shared.particles=Xo({},Ht.prototype),e.shared.lib&&(e.shared.lib.particles=oh.defaultData().particles)}function IFe(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function LFe(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function OFe(e){e.scene.objects.traverse((t,i)=>{var r;Array.isArray(tn(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,u,h,d,p,f,g,m;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(v=>{v.type==="Transition"&&(v.runMode=s??"Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(v=>{(v.type==="Transition"||v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(v=>{var x;(x=n.gameActions[v])==null||x.forEach(y=>{y.type==="Transition"&&(y.runMode="Repeat"),y.type==="Animation"&&(y.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(v=>{(v.type==="Transition"||v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Toggle")}),(h=(u=n.dragDropActions)==null?void 0:u.drop)==null||h.forEach(v=>{(v.type==="Transition"||v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(v=>{var x;(x=v.actions)==null||x.forEach(y=>{(y.type==="Transition"||y.type==="Animation"||y.type==="SwitchCamera")&&(y.runMode="Toggle")})})):n.type==="Start"?(p=n.actions)==null||p.forEach(v=>{v.type==="Transition"&&(v.runMode="Once"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(f=n.actions)==null||f.forEach(v=>{v.type==="Transition"&&(v.runMode="Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(g=n.inActions)==null||g.forEach(v=>{v.type==="Transition"&&(v.runMode="Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}),(m=n.outActions)==null||m.forEach(v=>{v.type==="Transition"&&(v.runMode="Repeat"),(v.type==="Animation"||v.type==="SwitchCamera")&&(v.runMode="Normal")}))}))})}function BFe(e){e.shared.userAPIs=Xo({},Ht.prototype),e.shared.userWebhooks=Xo({},Ht.prototype),e.shared.lib&&(e.shared.lib.userAPIs=oh.defaultData().userAPIs,e.shared.lib.userWebhooks=oh.defaultData().userWebhooks)}function pte(e){let t=e.schema??0;if(t!==Eu){console.warn("updating from ",t,"to ",Eu),MFe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=md.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(ad(e,v8),sd(e,v8),e.schema=101),t<102&&(EFe(e),e.schema=102),t<104&&(e.shared.catelogs=new Ht,e.shared.lib=oh.defaultData(),e.schema=104),t<105&&(TFe(e),e.scene.objects.traverse((i,r)=>{hte(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))DFe(i);t<106&&(PFe(e),e.schema=106),t<107&&(e.shared.lib.variables=oh.defaultData().variables,e.schema=107),t<109&&(RFe(e),e.schema=109),t<110&&(IFe(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{CFe(r)}),e.schema=111),t<112&&(LFe(e),e.schema=112),t<113&&(OFe(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(BFe(e),e.schema=115)}}var uC;(e=>{e.defaultData={schema:Eu,scene:Sf.defaultData,frames:new Ht().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",px.defaultData),shared:{...Do.emptyData(),colors:Do.defaultColors()}},e.emptyDataForImports=function(){let s=Sf.emptyDataWithPage();return{schema:Eu,scene:s,frames:new Ht().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",px.defaultData),shared:{...Do.emptyData(),colors:Do.defaultColors(),images:Do.defaultImages()}}},e.emptyData=function(){return{schema:Eu,scene:Sf.emptyDataWithPage(),frames:new Ht().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",px.defaultData),shared:Do.emptyData()}},e.clipboard2dData=function(){return{schema:Eu,scene:Sf.emptyData(),frames:new Ht,shared:Do.emptyData()}},e.collabHelper={...lO,updateSchema(s){return(s.schema??0)<Eu?fw(s,pte):(s.schema??0)-Eu}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:oh.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}e.hasSensitiveData=n})(uC||(uC={}));var GO;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(GO||(GO={}));var x8;(e=>{function t(i){return!0}e.is=t})(x8||(x8={}));var hC;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}e.merge=t;function i(r,n){return Eee({position:Gu.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:Gu.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&Gu.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(hC||(hC={}));var HO;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(HO||(HO={}));var w8;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(w8||(w8={}));var dC;(e=>e.defaultData={opacity:1,fill:{color:er.fromHexAndA(io,1),enabled:!0},stroke:{color:er.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:er.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:er.from0to1([0,0,0,1]),enabled:!1,spread:0}})(dC||(dC={}));var Af;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,hC.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(Af||(Af={}));var vw;(e=>e.defaultData={...hC.defaultData,...HO.defaultData,states:new Bt,events:new Bt,visible:!0,raycastLock:!1})(vw||(vw={}));var S0;(e=>e.defaultData={...vw.defaultData,...dC.defaultData})(S0||(S0={}));var pC;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(pC||(pC={}));var jO;(e=>e.defaultData={...S0.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(jO||(jO={}));var yw;(e=>e.defaultData={...S0.defaultData,...pC.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(yw||(yw={}));var WO;(e=>e.defaultData={...S0.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(WO||(WO={}));var XO;(e=>e.defaultData={...S0.defaultData,type:"path2d",path:"",name:"Path"})(XO||(XO={}));var b8;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(b8||(b8={}));var fC;(e=>e.defaultData={...vw.defaultData,name:"Group",type:"group2d"})(fC||(fC={}));var YO;(e=>e.defaultData=()=>({...vw.defaultData,...pC.defaultData,...dC.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:er.fromHexAndA(4737101,1),enabled:!0},stroke:{color:er.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(YO||(YO={}));var zf;(e=>{function t(a){switch(a){case"rectangle2d":return{...yw.defaultData};case"ellipse2d":return{...jO.defaultData};case"text2d":return{...WO.defaultData};case"vector2d":return{...yw.defaultData};case"path2d":return{...XO.defaultData};case"frame2d":return{...YO.defaultData()};case"group2d":return{...fC.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(zf||(zf={}));var qO;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new fs},e.emptyData=function(){return{type:"scene2d",objects:new fs}}))(qO||(qO={}));function Mf(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new Ot,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(t){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)h.push(p.getX(f)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=_8(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let g=0;g<a[u].length;++g)p.push(a[u][g][d]);let f=_8(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(f)}}return l}function _8(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new Wt(s,i,r)}var FFe=Math.pow(2,-24),lA=class{constructor(){}};function bc(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function S8(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function A8(e,t){t.set(e)}function M8(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function cA(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function a1(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function NFe(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new Wt(n,1));for(let s=0;s<i;s++)n[s]=s}}function UFe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function TR(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,g=-1/0,m=-1/0,v=n!==null;for(let x=t*6,y=(t+i)*6;x<y;x+=6){let _=e[x+0],A=e[x+1],S=_-A,C=_+A;S<s&&(s=S),C>l&&(l=C),v&&_<h&&(h=_),v&&_>f&&(f=_);let M=e[x+2],E=e[x+3],P=M-E,R=M+E;P<a&&(a=P),R>c&&(c=R),v&&M<d&&(d=M),v&&M>g&&(g=M);let O=e[x+4],L=e[x+5],I=O-L,z=O+L;I<o&&(o=I),z>u&&(u=z),v&&O<p&&(p=O),v&&O>m&&(m=O)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,v&&(n[0]=h,n[1]=d,n[2]=p,n[3]=f,n[4]=g,n[5]=m)}function kFe(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<n&&(n=d),d>o&&(o=d);let p=e[u+2];p<s&&(s=p),p>l&&(l=p);let f=e[u+4];f<a&&(a=f),f>c&&(c=f)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function zFe(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[a*3+c],e[a*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[a*6+c*2+0],t[a*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[a*6+c*2+1],t[a*6+c*2+1]=d}s++,a--}else return s}}var vu=32,VFe=(e,t)=>e.candidate-t.candidate,Nh=new Array(vu).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),uA=new Float32Array(6);function GFe(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=S8(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=S8(e),a!==-1&&(o=HFe(i,r,n,a));else if(s===2){let l=a1(e),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/vu;if(n<vu/4){let g=[...Nh];g.length=n;let m=0;for(let x=u;x<h;x+=6,m++){let y=g[m];y.candidate=i[x+2*d],y.count=0;let{bounds:_,leftCacheBounds:A,rightCacheBounds:S}=y;for(let C=0;C<3;C++)S[C]=1/0,S[C+3]=-1/0,A[C]=1/0,A[C+3]=-1/0,_[C]=1/0,_[C+3]=-1/0;cA(x,i,_)}g.sort(VFe);let v=n;for(let x=0;x<v;x++){let y=g[x];for(;x+1<v&&g[x+1].candidate===y.candidate;)g.splice(x+1,1),v--}for(let x=u;x<h;x+=6){let y=i[x+2*d];for(let _=0;_<v;_++){let A=g[_];y>=A.candidate?cA(x,i,A.rightCacheBounds):(cA(x,i,A.leftCacheBounds),A.count++)}}for(let x=0;x<v;x++){let y=g[x],_=y.count,A=n-y.count,S=y.leftCacheBounds,C=y.rightCacheBounds,M=0;_!==0&&(M=a1(S)/l);let E=0;A!==0&&(E=a1(C)/l);let P=1+1.25*(M*_+E*A);P<c&&(a=d,c=P,o=y.candidate)}}else{for(let v=0;v<vu;v++){let x=Nh[v];x.count=0,x.candidate=p+f+v*f;let y=x.bounds;for(let _=0;_<3;_++)y[_]=1/0,y[_+3]=-1/0}for(let v=u;v<h;v+=6){let x=~~((i[v+2*d]-p)/f);x>=vu&&(x=vu-1);let y=Nh[x];y.count++,cA(v,i,y.bounds)}let g=Nh[vu-1];A8(g.bounds,g.rightCacheBounds);for(let v=vu-2;v>=0;v--){let x=Nh[v],y=Nh[v+1];M8(x.bounds,y.rightCacheBounds,x.rightCacheBounds)}let m=0;for(let v=0;v<vu-1;v++){let x=Nh[v],y=x.count,_=x.bounds,A=Nh[v+1].rightCacheBounds;y!==0&&(m===0?A8(_,uA):M8(_,uA,uA)),m+=y;let S=0,C=0;m!==0&&(S=a1(uA)/l);let M=n-m;M!==0&&(C=a1(A)/l);let E=1+1.25*(S*m+C*M);E<c&&(a=d,c=E,o=x.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function HFe(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function jFe(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,p=h*6,f,g,m;a?(f=r[d+0],g=r[d+1],m=r[d+2]):(f=r[d+0]*c+l,g=r[d+1]*c+l,m=r[d+2]*c+l);for(let v=0;v<3;v++){let x,y,_;a?(x=i[u[v]](f),y=i[u[v]](g),_=i[u[v]](m)):(x=o[f+v],y=o[g+v],_=o[m+v]);let A=x;y<A&&(A=y),_<A&&(A=_);let S=x;y>S&&(S=y),_>S&&(S=_);let C=(S-A)/2,M=v*2;s[p+M+0]=A+C,s[p+M+1]=C+(Math.abs(A)+C)*FFe,A<t[v]&&(t[v]=A),S>t[v+3]&&(t[v+3]=S)}}return s}function WFe(e,t){function i(v){d&&d(v/p)}function r(v,x,y,_=null,A=0){if(!f&&A>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),y<=u||A>=l)return i(x+y),v.offset=x,v.count=y,v;let S=GFe(v.boundingData,_,a,x,y,h);if(S.axis===-1)return i(x+y),v.offset=x,v.count=y,v;let C=zFe(o,a,x,y,S);if(C===x||C===x+y)i(x+y),v.offset=x,v.count=y;else{v.splitAxis=S.axis;let M=new lA,E=x,P=C-x;v.left=M,M.boundingData=new Float32Array(6),TR(a,E,P,M.boundingData,s),r(M,E,P,s,A+1);let R=new lA,O=C,L=y-P;v.right=R,R.boundingData=new Float32Array(6),TR(a,O,L,R.boundingData,s),r(R,O,L,s,A+1)}return v}NFe(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=jFe(e,n),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,g=[],m=UFe(e);if(m.length===1){let v=m[0],x=new lA;x.boundingData=n,kFe(a,v.offset,v.count,s),r(x,v.offset,v.count,s),g.push(x)}else for(let v of m){let x=new lA;x.boundingData=new Float32Array(6),TR(a,v.offset,v.count,x.boundingData,s),r(x,v.offset,v.count,s),g.push(x)}return g}function XFe(e,t){let i=WFe(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),p=new o(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),c(0,h),a.push(p)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,p=u/2,f=!!h.count,g=h.boundingData;for(let m=0;m<6;m++)r[d+m]=g[m];if(f){let m=h.offset,v=h.count;return n[d+6]=m,s[p+14]=v,s[p+15]=65535,u+32}else{let m=h.left,v=h.right,x=h.splitAxis,y;if(y=c(u+32,m),y/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=y/4,y=c(y,v),n[d+7]=x,y}}}var lh=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};lh.prototype.setFromBox=function(){let e=new F;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*c+n.z*(1-c);let u=t.dot(e);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var YFe=function(){let e=new F,t=new F,i=new F;return function(r,n,s){let a=r.start,o=e,l=n.start,c=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),p=i.dot(o),f=o.dot(o)*d-h*h,g,m;f!==0?g=(u*h-p*d)/f:g=0,m=(u+g*h)/d,s.x=g,s.y=m}}(),tk=function(){let e=new pe,t=new F,i=new F;return function(r,n,s,a){YFe(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=t,d=i;if(r.closestPointToPoint(u,!0,t),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),qFe=function(){let e=new F,t=new F,i=new ba,r=new zo;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),QFe=1e-15;function Sg(e){return Math.abs(e)<QFe}var ch=class extends ps{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new F),this.satBounds=new Array(4).fill().map(()=>new lh),this.points=[this.a,this.b,this.c],this.sphere=new Oa,this.plane=new ba,this.needsUpdate=!0}intersectsSphere(e){return qFe(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,r);let d=n[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};ch.prototype.closestPointToSegment=function(){let e=new F,t=new F,i=new zo;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),tk(i,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();ch.prototype.intersectsTriangle=function(){let e=new ch,t=new Array(3),i=new Array(3),r=new lh,n=new lh,s=new F,a=new F,o=new F,l=new F,c=new zo,u=new zo,h=new zo;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let g=this.plane,m=d.plane;if(Math.abs(g.normal.dot(m.normal))>1-1e-10){let v=this.satBounds,x=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let A=0;A<4;A++){let S=v[A],C=x[A];if(r.setFromPoints(C,i),S.isSeparated(r))return!1}let y=d.satBounds,_=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let A=0;A<4;A++){let S=y[A],C=_[A];if(r.setFromPoints(C,t),S.isSeparated(r))return!1}for(let A=0;A<4;A++){let S=x[A];for(let C=0;C<4;C++){let M=_[C];if(s.crossVectors(S,M),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let v=this.points,x=!1,y=0;for(let L=0;L<3;L++){let I=v[L],z=v[(L+1)%3];c.start.copy(I),c.end.copy(z),c.delta(a);let K=x?u.start:u.end,Y=Sg(m.distanceToPoint(I));if(Sg(m.normal.dot(a))&&Y){u.copy(c),y=2;break}if((m.intersectLine(c,K)||Y)&&!Sg(K.distanceTo(z))){if(y++,x)break;x=!0}}if(y===1&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(y!==2)return!1;let _=d.points,A=!1,S=0;for(let L=0;L<3;L++){let I=_[L],z=_[(L+1)%3];c.start.copy(I),c.end.copy(z),c.delta(o);let K=A?h.start:h.end,Y=Sg(g.distanceToPoint(I));if(Sg(g.normal.dot(o))&&Y){h.copy(c),S=2;break}if((g.intersectLine(c,K)||Y)&&!Sg(K.distanceTo(z))){if(S++,A)break;A=!0}}if(S===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(S!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let L=h.start;h.start=h.end,h.end=L}let C=u.start.dot(a),M=u.end.dot(a),E=h.start.dot(a),P=h.end.dot(a),R=M<E,O=C<P;return C!==P&&E!==M&&R===O?!1:(p&&(l.subVectors(u.start,h.start),l.dot(a)>0?p.start.copy(u.start):p.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?p.end.copy(u.end):p.end.copy(h.end)),!0)}}}();ch.prototype.distanceToPoint=function(){let e=new F;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();ch.prototype.distanceToTriangle=function(){let e=new F,t=new F,i=["a","b","c"],r=new zo,n=new zo;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],p=s[d];this.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<c&&(c=h,a&&a.copy(e),o&&o.copy(p));let f=this[d];s.closestPointToPoint(f,e),h=f.distanceToSquared(e),h<c&&(c=h,a&&a.copy(f),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let p=0;p<3;p++){let f=i[p],g=i[(p+1)%3];n.set(s[f],s[g]),tk(r,n,e,t);let m=e.distanceToSquared(t);m<c&&(c=m,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var Gc=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new ot,this.invMatrix=new ot,this.points=new Array(8).fill().map(()=>new F),this.satAxes=new Array(3).fill().map(()=>new F),this.satBounds=new Array(3).fill().map(()=>new lh),this.alignedSatBounds=new Array(3).fill().map(()=>new lh),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Gc.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Gc.prototype.intersectsBox=function(){let e=new lh;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();Gc.prototype.intersectsTriangle=function(){let e=new ch,t=new Array(3),i=new lh,r=new lh,n=new F;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],p=o[h];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],p=c[h];if(i.setFromPoints(p,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let f=c[p];if(n.crossVectors(d,f),i.setFromPoints(n,t),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}}();Gc.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Gc.prototype.distanceToPoint=function(){let e=new F;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Gc.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new zo),i=new Array(12).fill().map(()=>new zo),r=new F,n=new F;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,p=1/0;for(let g=0;g<8;g++){let m=d[g];n.copy(m).clamp(u,h);let v=m.distanceToSquared(n);if(v<p&&(p=v,o&&o.copy(m),l&&l.copy(n),v<c))return Math.sqrt(v)}let f=0;for(let g=0;g<3;g++)for(let m=0;m<=1;m++)for(let v=0;v<=1;v++){let x=(g+1)%3,y=(g+2)%3,_=m<<x|v<<y,A=1<<g|m<<x|v<<y,S=d[_],C=d[A];t[f].set(S,C);let M=e[g],E=e[x],P=e[y],R=i[f],O=R.start,L=R.end;O[M]=u[M],O[E]=m?u[E]:h[E],O[P]=v?u[P]:h[E],L[M]=h[M],L[E]=m?u[E]:h[E],L[P]=v?u[P]:h[E],f++}for(let g=0;g<=1;g++)for(let m=0;m<=1;m++)for(let v=0;v<=1;v++){n.x=g?h.x:u.x,n.y=m?h.y:u.y,n.z=v?h.z:u.z,this.closestPointToPoint(n,r);let x=n.distanceToSquared(r);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(n),x<c))return Math.sqrt(x)}for(let g=0;g<12;g++){let m=t[g];for(let v=0;v<12;v++){let x=i[v];tk(m,x,r,n);let y=r.distanceToSquared(n);if(y<p&&(p=y,o&&o.copy(r),l&&l.copy(n),y<c))return Math.sqrt(y)}}return Math.sqrt(p)}}();var Ag=new F,Mg=new F,Eg=new F,hA=new pe,dA=new pe,pA=new pe,E8=new F,C8=new F,T8=new F,fA=new F;function JFe(e,t,i,r,n,s){let a;return s===Zn?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==Bs,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function KFe(e,t,i,r,n,s,a,o,l){Ag.fromBufferAttribute(t,s),Mg.fromBufferAttribute(t,a),Eg.fromBufferAttribute(t,o);let c=JFe(e,Ag,Mg,Eg,fA,l);if(c){r&&(hA.fromBufferAttribute(r,s),dA.fromBufferAttribute(r,a),pA.fromBufferAttribute(r,o),c.uv=ps.getInterpolation(fA,Ag,Mg,Eg,hA,dA,pA,new pe)),n&&(hA.fromBufferAttribute(n,s),dA.fromBufferAttribute(n,a),pA.fromBufferAttribute(n,o),c.uv1=ps.getInterpolation(fA,Ag,Mg,Eg,hA,dA,pA,new pe)),i&&(E8.fromBufferAttribute(i,s),C8.fromBufferAttribute(i,a),T8.fromBufferAttribute(i,o),c.normal=ps.getInterpolation(fA,Ag,Mg,Eg,E8,C8,T8,new F),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new F,materialIndex:0};ps.getNormal(Ag,Mg,Eg,u.normal),c.face=u,c.faceIndex=s}return c}function fte(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,p=KFe(i,c,u,h,d,a,o,l,t);return p?(p.faceIndex=r,n&&n.push(p),p):null}function ZFe(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)fte(e,t,i,a,s)}function $Fe(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=fte(e,t,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function vc(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function P8(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(vc(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var mte=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function od(e,t){return t[e+15]===65535}function Uv(e,t){return t[e+6]}function xw(e,t){return t[e+14]}function ww(e){return e+8}function bw(e,t){return t[e+6]}function eNe(e,t){return t[e+7]}var bv=new nn,mC=new F,tNe=["x","y","z"];function QO(e,t,i,r,n){let s=e*2,a=$0,o=Nd,l=Ud;if(od(s,o)){let c=Uv(e,l),u=xw(s,o);ZFe(t,i,r,c,u,n)}else{let c=ww(e);gC(c,a,r,mC)&&QO(c,t,i,r,n);let u=bw(e,l);gC(u,a,r,mC)&&QO(u,t,i,r,n)}}function JO(e,t,i,r){let n=e*2,s=$0,a=Nd,o=Ud;if(od(n,a)){let l=Uv(e,o),c=xw(n,a);return $Fe(t,i,r,l,c)}else{let l=eNe(e,o),c=tNe[l],u=r.direction[c]>=0,h,d;u?(h=ww(e),d=bw(e,o)):(h=bw(e,o),d=ww(e));let p=gC(h,s,r,mC)?JO(h,t,i,r):null;if(p){let g=p.point[c];if(u?g<=s[d+l]:g>=s[d+l+3])return p}let f=gC(d,s,r,mC)?JO(d,t,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var iNe=function(){let e,t,i=[],r=new mte(()=>new nn);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(x){let y=x*2,_=Nd,A=Ud;for(;!od(y,_);)x=ww(x),y=x*2;return Uv(x,A)}function p(x){let y=x*2,_=Nd,A=Ud;for(;!od(y,_);)x=bw(x,A),y=x*2;return Uv(x,A)+xw(y,_)}let f=s*2,g=$0,m=Nd,v=Ud;if(od(f,m)){let x=Uv(s,v),y=xw(f,m);return bc(s,g,e),l(x,y,!1,h,u+s,e)}else{let x=ww(s),y=bw(s,v),_=x,A=y,S,C,M,E;if(c&&(M=e,E=t,bc(_,g,M),bc(A,g,E),S=c(M),C=c(E),C<S)){_=y,A=x;let K=S;S=C,C=K,M=E}M||(M=e,bc(_,g,M));let P=od(_*2,m),R=o(M,P,S,h+1,u+_),O;if(R===2){let K=d(_),Y=p(_)-K;O=l(K,Y,!0,h+1,u+_,M)}else O=R&&n(_,a,o,l,c,u,h+1);if(O)return!0;E=t,bc(A,g,E);let L=od(A*2,m),I=o(E,L,C,h+1,u+A),z;if(I===2){let K=d(A),Y=p(A)-K;z=l(K,Y,!0,h+1,u+A,E)}else z=I&&n(A,a,o,l,c,u,h+1);return!!z}}}(),rNe=function(){let e=new ch,t=new ch,i=new ot,r=new Gc,n=new Gc;return function s(a,o,l,c,u=null){let h=a*2,d=$0,p=Nd,f=Ud;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),od(h,p)){let g=o,m=g.index,v=g.attributes.position,x=l.index,y=l.attributes.position,_=Uv(a,f),A=xw(h,p);if(i.copy(c).invert(),l.boundsTree)return bc(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:S=>n.intersectsBox(S),intersectsTriangle:S=>{S.a.applyMatrix4(c),S.b.applyMatrix4(c),S.c.applyMatrix4(c),S.needsUpdate=!0;for(let C=_*3,M=(A+_)*3;C<M;C+=3)if(vc(t,C,m,v),t.needsUpdate=!0,S.intersectsTriangle(t))return!0;return!1}});for(let S=_*3,C=A+_*3;S<C;S+=3){vc(e,S,m,v),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let M=0,E=x.count;M<E;M+=3)if(vc(t,M,x,y),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let g=a+8,m=f[a+6];return bc(g,d,bv),!!(u.intersectsBox(bv)&&s(g,o,l,c,u)||(bc(m,d,bv),u.intersectsBox(bv)&&s(m,o,l,c,u)))}}}();function gC(e,t,i,r){return bc(e,t,bv),i.intersectBox(bv,r)}var KO=[],PM,$0,Nd,Ud;function F1(e){PM&&KO.push(PM),PM=e,$0=new Float32Array(e),Nd=new Uint16Array(e),Ud=new Uint32Array(e)}function mA(){PM=null,$0=null,Nd=null,Ud=null,KO.length&&F1(KO.pop())}var PR=Symbol("skip tree generation"),DR=new nn,RR=new nn,Cg=new ot,Np=new Gc,o1=new Gc,l1=new F,gA=new F,nNe=new F,sNe=new F,aNe=new F,D8=new nn,tc=new mte(()=>new ch),fx=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),fx.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),fx.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new fx(t,{...i,[PR]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new Wt(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[PR]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[PR]||(this._roots=XFe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new nn))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,p=!1){let f=h*2;if(a[f+15]===65535){let g=s[h+6],m=a[f+14],v=1/0,x=1/0,y=1/0,_=-1/0,A=-1/0,S=-1/0;for(let C=3*g,M=3*(g+m);C<M;C++){let E=i[C],P=r.getX(E),R=r.getY(E),O=r.getZ(E);P<v&&(v=P),P>_&&(_=P),R<x&&(x=R),R>A&&(A=R),O<y&&(y=O),O>S&&(S=O)}return o[h+0]!==v||o[h+1]!==x||o[h+2]!==y||o[h+3]!==_||o[h+4]!==A||o[h+5]!==S?(o[h+0]=v,o[h+1]=x,o[h+2]=y,o[h+3]=_,o[h+4]=A,o[h+5]=S,!0):!1}else{let g=h+8,m=s[h+6],v=g+d,x=m+d,y=p,_=!1,A=!1;e?y||(_=e.has(v),A=e.has(x),y=!_&&!A):(_=!0,A=!0);let S=y||_,C=y||A,M=!1;S&&(M=u(g,d,y));let E=!1;C&&(E=u(m,d,y));let P=M||E;if(P)for(let R=0;R<3;R++){let O=g+R,L=m+R,I=o[O],z=o[O+3],K=o[L],Y=o[L+3];o[h+R]=I<K?I:K,o[h+R+3]=z>Y?z:Y}return P}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];e(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];e(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=Ol){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=a?t[o[c].materialIndex].side:l,d=n.length;if(F1(i[c]),QO(0,r,h,e,n),mA(),a){let p=o[c].materialIndex;for(let f=d,g=n.length;f<g;f++)n[f].face.materialIndex=p}}return n}raycastFirst(e,t=Ol){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;F1(i[c]);let d=JO(0,r,h,e);mA(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(F1(n),r=rNe(0,i,e,t),mA(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,p,f,g)=>{let m=p*3;return h(d,m,m+1,m+2,f,g)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=tc.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,p,f,g,m)=>h(d,p,f,g,m)?!0:P8(d,p,r,l,f,g,n)}else o||(l?o=(h,d,p,f)=>P8(h,d,r,l,p,f,n):o=(h,d,p)=>p);let c=!1,u=0;for(let h of this._roots){if(F1(h),c=iNe(0,r,a,o,s,u),mA(),c)break;u+=h.byteLength}return tc.releasePrimitive(n),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Cg.copy(t).invert();let c=tc.getPrimitive(),u=tc.getPrimitive();if(n){let d=function(p,f,g,m,v,x,y,_){for(let A=g,S=g+m;A<S;A++){vc(u,A*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let C=p,M=p+f;C<M;C++)if(vc(c,C*3,s,a),c.needsUpdate=!0,n(c,u,C,A,v,x,y,_))return!0}return!1};if(r){let p=r;r=function(f,g,m,v,x,y,_,A){return p(f,g,m,v,x,y,_,A)?!0:d(f,g,m,v,x,y,_,A)}}else r=d}e.getBoundingBox(RR),RR.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>RR.intersectsBox(d),intersectsRange:(d,p,f,g,m,v)=>(DR.copy(v),DR.applyMatrix4(Cg),e.shapecast({intersectsBounds:x=>DR.intersectsBox(x),intersectsRange:(x,y,_,A,S)=>r(d,p,x,y,g,m,A,S)}))});return tc.releasePrimitive(c),tc.releasePrimitive(u),h}intersectsBox(e,t){return Np.set(e.min,e.max,t),Np.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Np.intersectsBox(i),intersectsTriangle:i=>Np.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),Np.set(e.boundingBox.min,e.boundingBox.max,t),Np.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=tc.getPrimitive(),d=tc.getPrimitive(),p=gA,f=nNe,g=null,m=null;r&&(g=sNe,m=aNe);let v=1/0,x=null,y=null;return Cg.copy(t).invert(),o1.matrix.copy(Cg),this.shapecast({boundsTraverseOrder:_=>Np.distanceToBox(_),intersectsBounds:(_,A,S)=>S<v&&S<s?(A&&(o1.min.copy(_.min),o1.max.copy(_.max),o1.needsUpdate=!0),!0):!1,intersectsRange:(_,A)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:S=>o1.distanceToBox(S),intersectsBounds:(S,C,M)=>M<v&&M<s,intersectsRange:(S,C)=>{for(let M=S*3,E=(S+C)*3;M<E;M+=3){vc(d,M,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let P=_*3,R=(_+A)*3;P<R;P+=3){vc(h,P,l,o),h.needsUpdate=!0;let O=h.distanceToTriangle(d,p,g);if(O<v&&(f.copy(p),m&&m.copy(g),v=O,x=P/3,y=M/3),O<n)return!0}}}});{let S=u?u.count:c.count;for(let C=0,M=S;C<M;C+=3){vc(d,C,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let E=_*3,P=(_+A)*3;E<P;E+=3){vc(h,E,l,o),h.needsUpdate=!0;let R=h.distanceToTriangle(d,p,g);if(R<v&&(f.copy(p),m&&m.copy(g),v=R,x=E/3,y=C/3),R<n)return!0}}}}}),tc.releasePrimitive(h),tc.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=x,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(Cg),f.applyMatrix4(Cg),r.distance=f.sub(r.point).length(),r.faceIndex=y),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(l1.copy(e).clamp(c.min,c.max),l1.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,l1);let h=e.distanceToSquared(l1);return h<a&&(gA.copy(l1),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(gA):t.point=gA.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{bc(0,new Float32Array(t),D8),e.union(D8)}),e}},ZO=lp(sbe()),oNe=.5*(Math.sqrt(3)-1),c1=(3-Math.sqrt(3))/6,lNe=1/3,ic=1/6,mx=e=>Math.floor(e)|0,R8=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),IR=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function cNe(e=Math.random){let t=gte(e),i=new Float64Array(t).map(n=>R8[n%12*2]),r=new Float64Array(t).map(n=>R8[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*oNe,u=mx(n+c),h=mx(s+c),d=(u+h)*c1,p=u-d,f=h-d,g=n-p,m=s-f,v,x;g>m?(v=1,x=0):(v=0,x=1);let y=g-v+c1,_=m-x+c1,A=g-1+2*c1,S=m-1+2*c1,C=u&255,M=h&255,E=.5-g*g-m*m;if(E>=0){let O=C+t[M],L=i[O],I=r[O];E*=E,a=E*E*(L*g+I*m)}let P=.5-y*y-_*_;if(P>=0){let O=C+v+t[M+x],L=i[O],I=r[O];P*=P,o=P*P*(L*y+I*_)}let R=.5-A*A-S*S;if(R>=0){let O=C+1+t[M+1],L=i[O],I=r[O];R*=R,l=R*R*(L*A+I*S)}return 70*(a+o+l)}}function uNe(e=Math.random){let t=gte(e),i=new Float64Array(t).map(s=>IR[s%12*3]),r=new Float64Array(t).map(s=>IR[s%12*3+1]),n=new Float64Array(t).map(s=>IR[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*lNe,p=mx(s+d),f=mx(a+d),g=mx(o+d),m=(p+f+g)*ic,v=p-m,x=f-m,y=g-m,_=s-v,A=a-x,S=o-y,C,M,E,P,R,O;_>=A?A>=S?(C=1,M=0,E=0,P=1,R=1,O=0):_>=S?(C=1,M=0,E=0,P=1,R=0,O=1):(C=0,M=0,E=1,P=1,R=0,O=1):A<S?(C=0,M=0,E=1,P=0,R=1,O=1):_<S?(C=0,M=1,E=0,P=0,R=1,O=1):(C=0,M=1,E=0,P=1,R=1,O=0);let L=_-C+ic,I=A-M+ic,z=S-E+ic,K=_-P+2*ic,Y=A-R+2*ic,U=S-O+2*ic,j=_-1+3*ic,k=A-1+3*ic,q=S-1+3*ic,W=p&255,te=f&255,G=g&255,le=.6-_*_-A*A-S*S;if(le<0)l=0;else{let de=W+t[te+t[G]];le*=le,l=le*le*(i[de]*_+r[de]*A+n[de]*S)}let Z=.6-L*L-I*I-z*z;if(Z<0)c=0;else{let de=W+C+t[te+M+t[G+E]];Z*=Z,c=Z*Z*(i[de]*L+r[de]*I+n[de]*z)}let he=.6-K*K-Y*Y-U*U;if(he<0)u=0;else{let de=W+P+t[te+R+t[G+O]];he*=he,u=he*he*(i[de]*K+r[de]*Y+n[de]*U)}let ye=.6-j*j-k*k-q*q;if(ye<0)h=0;else{let de=W+1+t[te+1+t[G+1]];ye*=ye,h=ye*ye*(i[de]*j+r[de]*k+n[de]*q)}return 32*(l+c+u+h)}}function gte(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var ol=new ps,hNe=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;ol.a.fromBufferAttribute(e,r),ol.b.fromBufferAttribute(e,r+1),ol.c.fromBufferAttribute(e,r+2),n*=ol.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),ol.a.fromBufferAttribute(this.positionAttribute,e*3),ol.b.fromBufferAttribute(this.positionAttribute,e*3+1),ol.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(ol.a,r).addScaledVector(ol.b,n).addScaledVector(ol.c,1-(r+n)),ol.getNormal(i),this}},dNe=lp(JZ()),pNe=new ot,fNe=new ot,mNe=new ot,sm;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(sm||(sm={}));var ik=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new ot,this.copyPreviousMatrix=!0,this.hiddenMatrix=new ot,this.matrixWorldRigid=new ot,this.shearScale=new ot,this.shearScaleInv=new ot}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof Qi&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)sm.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)sm.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,dNe.SVD)(i),a=pNe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=fNe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=mNe.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new ot().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof ot?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},gNe=class extends ik(Qi){},vNe=e=>e.type==="Mesh",gs=class extends gNe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new gs(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return vNe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},rf=new F,nf=new F,kv=new ot,vte=[new F(-1,1,1),new F(-1,-1,1),new F(1,-1,1),new F(1,1,1),new F(-1,1,-1),new F(-1,-1,-1),new F(1,-1,-1),new F(1,1,-1)],yNe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],xNe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],I8=(e,t,i)=>{e.updateEntityBoxSize(rf,nf),kv.copy(t).multiply(e.matrixWorld),nf.x===0&&nf.y===0&&nf.z===0?i.push(new F(rf.x,rf.y,rf.z).applyMatrix4(kv)):vte.forEach(r=>{i.push(r.clone().multiply(nf).add(rf).applyMatrix4(kv))})},L8=class extends nn{constructor(){super(...arguments),this.matrix=new ot,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new ot().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new F);return}I8(n,t,r)}}):I8(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(kv.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(nf).multiplyScalar(.5),this.getCenter(rf),kv.copy(this.matrix).setPosition(rf),this.vertices=vte.map(e=>e.clone().multiply(nf).applyMatrix4(kv))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=yNe.map(([e,t])=>new zo(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new F))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=xNe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},gd={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},wNe=class extends E${constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},$O=.001;function eB(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=$O}function LR(e,t){let i=new F(...e.position),r=new F(...e.controlNext.position),n=new F(...t.controlPrevious.position),s=new F(...t.position);return eB(i,r,s)&&eB(i,n,s)}function yte(e){let t=e.points.map(u=>new F(...u.data.position)),i=[e.points[0]],r=new F(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)eB(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new F(...h.position),p=new F(...h.controlPrevious.position),f=new F(...h.controlNext.position),g={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:f};if(h.roundness===0||!e.isClosed&&(u===0||u===a-1)){o[u]={...g,removedLength:0};continue}let m=n&&u==0?a-1:u-1,v=n&&u==a-1?0:u+1,x=i[m].data,y=i[v].data,_=new F(...x.position),A=new F(...y.position),S=_.clone().sub(d).normalize(),C=A.clone().sub(d).normalize();Object.assign(g,{prevDir:S,nextDir:C});let M=LR(x,h),E=LR(h,y);if(!M||!E)o[u]={...g,removedLength:0};else{let P=S.clone().add(C).normalize(),R=P.clone().cross(S).length()/S.dot(P);o[u]={...g,tan:R,removedLength:h.roundness/R}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],f=o[d];if(p.removedLength!==0||f.removedLength!==0){let g=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,g/2),f.removedLength=Math.min(f.removedLength,g/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],f=o[d],g=null;if(!LR(i[h].data,i[d].data))p.position.distanceTo(f.position)>$O&&(g=new AM(p.position,p.controlNext,f.controlPrevious,f.position));else{let m=p.position.clone(),v=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&m.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),m.distanceTo(v)>$O&&(g=new AM(m,m.clone().lerp(v,.3),v.clone().lerp(m,.3),v))}l[2*u+1]=g}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),f=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),g=h.tan*h.removedLength,m=h.prevDir.clone().add(h.nextDir).normalize(),v=p.clone().lerp(f,.5),x=p.distanceTo(f)/2,y=m.clone().multiplyScalar(Math.sqrt(Math.pow(g,2)-Math.pow(x,2))).add(v),_=m.clone().multiplyScalar(-g).add(y),A=d.distanceTo(_)/d.distanceTo(v),S=h.prevDir.clone().multiplyScalar(A*d.distanceTo(p)).add(d),C=S.clone().lerp(_,2),M=p.clone().lerp(S,4/3),E=f.clone().lerp(C,4/3);l[2*u]=new AM(p,M,E,f)}let c=new wNe;return l.forEach(u=>{u&&c.add(u)}),c}var Ei;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Ei||(Ei={}));var Cu=e=>Ei.is(e),bNe={type:"completeState",isfromEntity:!0},_Ne=["x","y","z"],OR=new F,SNe=new F().set(0,1,0),rk=e=>class extends ik(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new L8,this._recursiveBBox=new L8,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Ei.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Ei.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Ei.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)bf.toOps(this.data,n.data).forEach(s=>{let a=QE.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=bf.patch(this.data,n),bf.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Cu(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Ei.is(i[r]))return i[r];if(Ei.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Ei.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Cu(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Ei.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Cu(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Cu(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Cu(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Cu(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*St.RAD2DEG,this.rotation.y*St.RAD2DEG,this.rotation.z*St.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return oO(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,t,_Ne[s]]))??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(OR.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(St.DEG2RAD),this.rotation.setFromVector3(OR),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??v0.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Ei.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Ei.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return oO(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=sr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Dn.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Dn.removeOverridden(t.path,t.props,l);a={...t,props:c}}}if(this.updateByPatchedOpBase(a,bf.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),sr(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(Bd.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=Dn.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[p,f]of Object.entries(t.props))f===void 0&&(d===t.props&&(d={...t.props}),d[p]=h[p]);t={...t,props:d}}u.overrideData=aC.resolve(i.overrides,l),u.updateByOp(t,Jn.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of fd.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of fd.rootOverrideProps)if(sr(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=Bd.filterOp(c.overrideData,l);u&&c.updateByOp(u,Jn.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=Bd.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=Jn.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!nm.is(t.props.type)&&gd.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){gd.changeEntityProptotype(this,i,r);for(let n of this.children)Ei.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){var n;if(t.path.length===0&&t.type===0?this.updateState(t.props,r):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,r),t.path[0]==="morphTargetInfluences"&&t.type===0){let s=(n=i.morphTargetInfluences.get(t.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",s]))}if(sr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),sr(t.path,["cloner"])!==null){let s=Jn.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,g,m,v,x;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((g=this._updatedPathSnapping)==null?void 0:g.slide)??this.dataPatched.pathSnapping.slide??0,n=((m=this._updatedPathSnapping)==null?void 0:m.offset)??this.dataPatched.pathSnapping.offset??0,s=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=yte(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?(x=this.parent)==null?void 0:x.matrixWorld:new ot;a.updateMatrixWorld();let d=new ot().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let y=new ot().extractRotation(a.matrixWorld),_=l.getTangentAt(c).applyMatrix4(y).add(u),A=new ot().lookAt(u,_,SNe),S=OR.setFromEuler(new Pn().setFromRotationMatrix(A)).multiplyScalar(St.RAD2DEG);p={...p,rotation:S.toArray()}}this.updateTransformState(p),this.traverseEntity(y=>{y._cameraType&&y.dispatchEvent(bNe)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof gd.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new gd.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},xte=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var l,c;let i=(l=e.parameters)==null?void 0:l.radiusTop,r=(c=e.parameters)==null?void 0:c.radiusBottom,n=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);n.thetaLength=St.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let u=Math.max(a,o)*2;n.width=u,n.depth=u}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:p}=e.parameters,f;return l===0?(f=new Ot,f.setAttribute("position",new xt([],3))):h||p?f=new wte(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,p):f=new bU(c,u,r,n,s,a,o,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function Uh(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function O8(e){return new pe(e.y,-e.x)}var wte=class extends Ot{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let p=[],f=[],g=[],m=[],v=0,x=i/2,y=new F,_=new F;d&&e==0&&(e=l),d&&t==0&&(t=c);let A=new pe(e,x),S=new pe(t,-x),C=null,M=null,E=null,P=null,R=A.clone().sub(S),O=0,L=0,I=0;h>0&&(O=Math.min(e,t)*(1-h),L=e-O,I=t-O);let z=A.clone();z.x-=O;let K=Math.PI-R.angle(),Y=R.angle(),U=Math.tan(Y/2),j=Math.tan(K/2),k=U+j,q=h?k:j,W=h?k:U;if(l=Math.min(l,(e-L)/q,R.length()/k),c=Math.min(c,(t-I)/W,R.length()/k),l>0){let ye=l/U;C=A.clone().sub(new pe(ye,l)),h&&(E=C.clone(),E.x-=O-k*l),A.sub(R.clone().setLength(ye))}if(c>0){let ye=c/j;M=S.clone().sub(new pe(ye,-c)),S.add(R.clone().setLength(ye)),h&&(P=M.clone(),P.x-=O-k*c,z.sub(R.clone().setLength(ye)))}R=A.clone().sub(S);let te=R.length()<.5,G=[];for(let ye=0;ye<=r;ye++){let de=[],xe=ye/r,me=xe*o+a,ee=new pe(Math.sin(me),Math.cos(me));P&&M?(le(de,xe,ee,K,c,P,-1,!0),le(de,xe,ee,Y,c,M,-1,!1)):M?(Z(de,ee,M.x,0,-1),le(de,xe,ee,Y,c,M,-1,!1)):s||Z(de,ee,t,I,-1);let we=O8(R).normalize();if(Uh(we,ee,y),!te)for(let Ae=0;Ae<=n;Ae++){let Te=Ae/n,Re=R.clone().multiplyScalar(Te).add(S);Uh(Re,ee,_),f.push(_.x,_.y,_.z),g.push(y.x,y.y,y.z),m.push(xe,.5+_.y/i),de.push(v++)}if(E&&C?(le(de,xe,ee,K,l,C,1,!1),le(de,xe,ee,Y,l,E,1,!0)):C?(le(de,xe,ee,K,l,C,1,!1),Z(de,ee,C.x,0,1)):s||Z(de,ee,e,L,1),h&&!te){let Ae=O8(R).multiplyScalar(-1).normalize();Uh(Ae,ee,y);for(let Te=0;Te<=n;Te++){let Re=Te/n,Xe=R.clone().multiplyScalar(-Re).add(z);Uh(Xe,ee,_),f.push(_.x,_.y,_.z),g.push(y.x,y.y,y.z),m.push(xe,.5+_.y/i),de.push(v++)}}h&&!s&&de.push(de[0]),G.push(de)}for(let ye=0;ye<G.length-1;ye++)for(let de=0;de<G[0].length-1;de++){if(s&&h&&de==n)continue;let xe=G[ye][de],me=G[ye+1][de],ee=G[ye+1][de+1],we=G[ye][de+1],Ae=f[ee*3+0],Te=f[ee*3+2];p.push(xe,me,we),(Ae!=0||Te!=0)&&p.push(me,ee,we)}o<Math.PI*2&&(he(-1,G[0],a),he(1,G[G.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new xt(f,3)),this.setAttribute("normal",new xt(g,3)),this.setAttribute("uv",new xt(m,2));function le(ye,de,xe,me,ee,we,Ae,Te){for(let Re=0;Re<u+1;Re++){let Xe=Re/u,Oe=Ae<0?Xe:1-Xe;Te&&(Oe-=1),Oe*=me;let Be=new pe(Math.sin(Oe),Math.cos(Oe)*Ae),at=Be.clone().multiplyScalar(ee).add(we);Uh(at,xe,_),f.push(_.x,_.y,_.z),Uh(Be,xe,y),g.push(y.x,y.y,y.z),m.push(de,.5+_.y/i),ye.push(v++)}}function Z(ye,de,xe,me,ee){let we=new F,Ae=new pe,Te=[xe,me];ee<0&&Te.reverse();for(let Re of Te)Ae.set(Re,x*ee),Uh(Ae,de,we),f.push(we.x,we.y,we.z),g.push(0,ee,0),m.push(.5,.5),ye.push(v++)}function he(ye,de,xe){let me=new pe(Math.sin(xe),Math.cos(xe)),ee=new pe(-Math.cos(xe),Math.sin(xe)),we=new F,Ae=ye<0?(Xe,Oe,Be)=>p.push(Xe,Oe,Be):(Xe,Oe,Be)=>p.push(Xe,Be,Oe),Te=new pe((e+t+L+I)/4,0);Uh(Te,me,we),f.push(we.x,we.y,we.z),g.push(ee.x,0,ee.y),m.push(.5,.5);let Re=v++;for(let Xe of de){let Oe=f.slice(Xe*3,Xe*3+3);f.push(...Oe),g.push(ee.x,0,ee.y);let Be=m.slice(Xe*2,Xe*2+2);m.push(...Be),v++}for(let Xe=Re+1;Xe<v-1;Xe++)Ae(Re,Xe,Xe+1);Ae(Re,v-1,Re+1)}}},ANe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=St.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new Ot,d.setAttribute("position",new xt([],3))):c>0||u>0||l<360?d=new wte(0,t/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new _U(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},MNe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o===0?c=new Fl(t,i,r,n,s,a):c=new ENe(t,i,r,n,s,a,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},BR=Math.PI/2,ENe=class extends Ot{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],u=[],h=[],d=0;p("z","y","x",-1,-1,i,t,e,s,n),p("z","y","x",1,-1,i,t,-e,s,n),p("x","z","y",1,1,e,i,t,r,s),p("x","z","y",1,-1,e,i,-t,r,s),p("x","y","z",1,-1,e,t,i,r,n),p("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(f("z","y","x",-1,-1,1,i,t,e,s),f("z","y","x",1,-1,-1,i,t,e,s),f("z","y","x",-1,1,-1,i,t,e,s),f("z","y","x",1,1,1,i,t,e,s),f("x","y","z",-1,-1,-1,e,t,i,r),f("x","y","z",1,-1,1,e,t,i,r),f("x","y","z",-1,1,1,e,t,i,r),f("x","y","z",1,1,-1,e,t,i,r),f("y","x","z",-1,-1,1,t,e,i,n),f("y","x","z",1,-1,-1,t,e,i,n),f("y","x","z",1,1,1,t,e,i,n),f("y","x","z",-1,1,-1,t,e,i,n),g(1,1,1),g(-1,1,1),g(1,-1,1),g(-1,-1,1),g(1,1,-1),g(-1,1,-1),g(1,-1,-1),g(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new xt(c,3)),this.setAttribute("normal",new xt(u,3)),this.setAttribute("uv",new xt(h,2));function p(m,v,x,y,_,A,S,C,M,E){let P=(A-2*a)/M,R=(S-2*a)/E,O=A/2-a,L=S/2-a,I=C/2,z=M+1,K=E+1,Y=0,U=new F;for(let j=0;j<K;j++){let k=j*R-L;for(let q=0;q<z;q++){let W=q*P-O;U[m]=W*y,U[v]=k*_,U[x]=I,c.push(U.x,U.y,U.z),U[m]=0,U[v]=0,U[x]=C>0?1:-1,u.push(U.x,U.y,U.z),h.push(q/M),h.push(1-j/E),Y+=1}}for(let j=0;j<E;j++)for(let k=0;k<M;k++){let q=d+k+z*j,W=d+k+z*(j+1),te=d+(k+1)+z*(j+1),G=d+(k+1)+z*j;l.push(q,W,G),l.push(W,te,G)}d+=Y}function f(m,v,x,y,_,A,S,C,M,E){let P=(S-2*a)/E,R=S/2-a,O=C/2-a,L=M/2,I=E+1,z=0,K=new F,Y=new F;for(let U=0;U<o+1;U++){let j=U/o*BR,k=Math.sin(j)*a,q=(1-Math.cos(j))*a,W=Math.sin(j),te=Math.cos(j);K[v]=(O+k)*_,K[x]=(L-q)*A,Y[m]=0,Y[v]=W*Math.sign(K[v]),Y[x]=te*Math.sign(K[x]);for(let G=0;G<I;G++){let le=G*P-R;K[m]=le*y,c.push(K.x,K.y,K.z),u.push(Y.x,Y.y,Y.z),h.push(G/E),h.push(0),z+=1}}for(let U=0;U<o;U++)for(let j=0;j<E;j++){let k=d+j+I*U,q=d+j+I*(U+1),W=d+(j+1)+I*(U+1),te=d+(j+1)+I*U;l.push(k,q,te),l.push(q,W,te)}d+=z}function g(m,v,x){let y=new F,_=new F(e/2,t/2,i/2);_.subScalar(a);let A=[],S=m*v*x>0?(M,E,P)=>l.push(M,E,P):(M,E,P)=>l.push(M,P,E);for(let M=0;M<=o;M++){let E=[],P=BR*(1-M/o),R=Math.cos(P),O=Math.sin(P),L=0;for(let I=0;I<=M;I++){let z=Math.cos(L),K=Math.sin(L);y.x=R*z,y.y=O,y.z=R*K;let Y=_.clone().addScaledVector(y,a);c.push(m*Y.x,v*Y.y,x*Y.z),u.push(m*y.x,v*y.y,x*y.z),h.push(0,0),E.push(d++),L+=BR/M}A.push(E)}let C=A.length-1;for(let M=0;M<C;M++){let E=A[M],P=A[M+1],R=E.length-1;S(E[0],P[1],P[0]);for(let O=1;O<=R;O++)S(E[O-1],E[O],P[O]),S(E[O],P[O+1],P[O])}}}},nk=class extends Ot{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new xt(a,3)),this.setAttribute("normal",new xt(l,3)),this.setAttribute("uv",new xt(o,2));return;function c(){var Y;n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new F,p=d.clone(),f=new ps,g=n*r,m=r-g,v=s+1,x=new F,y=(U,j)=>x.subVectors(U,j).normalize(),_=(U,j)=>Array(U).fill(void 0).map(j),A=_(e.length/3,(U,j)=>new F().fromArray(e,j*3).setLength(r)),S=[],C=1e6;for(let U=0;U<A.length;U++){let j=A[U],k=[],q,W,te,G=1e10,le=-1;for(;(le=t.indexOf(U,le+1))!=-1;){let de=le-le%3;q=t[de+(le+1)%3],W=t[de+(le+2)%3],te=j.distanceToSquared(A[q]),G=Math.min(G,te),k.push([q,W,te])}G+=1e-6;let Z=[],he=0,ye=k.length;for(let de=0;de<ye;de++){[q,W,te]=k[he];let xe=((Y=S[q])==null?void 0:Y.includes(U))==!0;te<=G&&Z.push(q+ +xe*C),he=k.findIndex(me=>me[0]==W)}S.push(Z)}let M=[];{let U=0,j=0,k,q,W=h==3;for(let te=0;te<=s;te++){k=te*(te+1)/2,q=(te+1)*(te+2)/2;for(let G=0;G<s-te;G++)[U,j]=[k+G+te+2,q+G+te+3],M.push(k,q,...W?[j,k]:[U,q],j,U),[k,q]=[U,j];M.push(k,q,k+s+2)}}let E=d.clone(),P=d.clone(),R=d.clone(),O=d.clone(),L=d.clone(),I=[],z=_(A.length,()=>_(h,()=>d.clone()));for(let U=0;U<A.length;U++){d.copy(A[U]).normalize(),E.copy(d).multiplyScalar(m);let j=S[U];for(let Z=0;Z<j.length;Z++){let he=j[Z],ye=j[(Z+1)%h];f.setFromPointsAndIndices(A,U,he%C,ye%C),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(E,z[U][Z])}let k=[],q=[],W=[],te=new F;s==0&&[...z[U]].reduce((Z,he)=>Z.add(he),te).multiplyScalar(1/h);for(let Z=0;Z<h;Z++){let he=[],ye=(Z-1+h)%h,de=z[U][ye],xe=z[U][Z];d.copy(de).sub(E),p.copy(xe).sub(E);let me=E.angleTo(d),ee=d.angleTo(p),we=Math.cos(me)*g;s==0?P.copy(te):P.copy(E).setLength(m+we),q.push(we);let Ae=[P,de,xe];for(let Te=0;Te<2;Te++){let Re=Ae[Te],Xe=Ae[Te+1];O.subVectors(Re,E),L.subVectors(Xe,E),R.crossVectors(O,L).normalize();for(let Oe=0;Oe<v;Oe++){let Be=[me,ee][Te]*Oe/v;d.copy(O).applyAxisAngle(R,Be).add(E),k.push(d.clone()),Te&&(y(d,E),he.push([Oe==0?Re:d.clone(),x.clone()]))}Te&&(y(Xe,E),he.push([Xe,x.clone()]))}W.push(he)}I.push(W);let G=2*v,le=2;for(let Z=0;Z<h;Z++){let he=G*Z,ye=G*((Z+1)%h),de=[k[he]];for(let me=1;me<v;me++){O=k[he+me],L=k[ye+me],de.push(O);for(let ee=1,we=me-le+1;ee<=we;ee++)d.lerpVectors(O,L,ee/(we+1)),d.sub(E).setLength(q[Z]).add(E),de.push(d.clone());de.push(L)}for(let me=0;me<v;me++)de.push(k[me+v+he]);de.push(k[ye+v]);let xe=M.map(me=>de[me]);a.push(...xe.map(me=>[me.x,me.y,me.z]).flat()),l.push(...xe.map(me=>(y(me,E),[x.x,x.y,x.z])).flat())}}let K=[];for(let U=0;U<S.length;U++)for(let j=0;j<h;j++){let k=S[U][j];if(k<C){let q=S[k].findIndex(G=>G%C==U),W=I[U][j],te=I[k][q];for(let G=0;G<v;G++){let le=W[G],Z=te[v-G],he=W[G+1],ye=te[v-(G+1)];[le,Z,he,he,Z,ye].forEach(de=>{a.push(de[0].x,de[0].y,de[0].z),l.push(de[1].x,de[1].y,de[1].z)})}K.push(W[0][0],te[v][0],W[v][0],te[0][0])}}for(;K.length;){let U,j,k,q;[U,j]=K.splice(0,2);let W=[U];for(;U!=j;)W.push(j),k=K.indexOf(j),q=k%2,j=K.splice(k-q,2)[1-q];x.subVectors(W[0],W[1]).cross(d.subVectors(W[0],W[2])).normalize();let te=x.dot(W[0])<0;te&&x.negate();for(let G=1;G<=W.length-2;G++)[W[G+ +te],W[G+1-+te],W[0]].forEach(le=>{a.push(le.x,le.y,le.z),l.push(x.x,x.y,x.z)})}}function u(){let h=new F;for(let S=0;S<a.length;S+=3){h.x=a[S+0],h.y=a[S+1],h.z=a[S+2];let C=_(h)/2/Math.PI+.5,M=A(h)/Math.PI+.5;o.push(C,1-M)}let d=new F,p=new F,f=new F,g=new F,m=new pe,v=new pe,x=new pe,y=(S,C,M,E)=>{E<0&&S.x===1&&(o[C]=S.x-1),M.x===0&&M.z===0&&(o[C]=E/2/Math.PI+.5)};for(let S=0,C=0;S<a.length;S+=9,C+=6){d.set(a[S+0],a[S+1],a[S+2]),p.set(a[S+3],a[S+4],a[S+5]),f.set(a[S+6],a[S+7],a[S+8]),m.set(o[C+0],o[C+1]),v.set(o[C+2],o[C+3]),x.set(o[C+4],o[C+5]),g.copy(d).add(p).add(f).divideScalar(3);let M=_(g);y(m,C+0,d,M),y(v,C+2,p,M),y(x,C+4,f,M)}for(let S=0;S<o.length;S+=6){let C=o[S+0],M=o[S+2],E=o[S+4],P=Math.max(C,M,E),R=Math.min(C,M,E);P>.9&&R<.1&&(C<.2&&(o[S+0]+=1),M<.2&&(o[S+2]+=1),E<.2&&(o[S+4]+=1))}function _(S){return Math.atan2(S.z,-S.x)}function A(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}}static fromJSON(e){return new nk(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},CNe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new bte(t*.5,s,a):new T$(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},bte=class extends nk{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new bte(e.radius,e.corner,e.cornerSides)}},u1=1e-12,sk=class{constructor(e){this.position=new pe,this.startPosition=new pe,this.uuid=St.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new sk(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},tB=class extends sk{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new tB(this.parent).copy(this)}},zv=class extends sk{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new tB(this),new tB(this))}static create(e,t){let i=new zv(e,new pe(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new zv(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new pe,t=new pe){let[i,r]=this.computeTangents();return i&&r&&(B8(i,e),B8(r,t)),[e,t]}computeTangent(e=new pe){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new pe){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function B8(e,t=new pe){let i=e.length();return t.set(-e.y/i,e.x/i)}var ak=e=>e,ey=new pe,UT=new pe,TNe=new pe,PNe=new pe,DNe=new pe,RNe=new pe,_te=new F,Ste=new F;function INe(e){let t=new pe;t.addVectors(e.v0,ey.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new pe;return i.addVectors(e.v2,UT.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new _l(e.v0,t,i,e.v2)}function N1(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function LNe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function ONe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Ate(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function BNe(e,t,i){return N8(e,t)&&N8(t,i)&&iB(e.position,t.position,i.position)}function iB(e,t,i){return ey.copy(t).sub(e).cross(UT.copy(i).sub(e))===0}function FNe(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function NNe(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function UNe(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return Ate(t,e,i)>Math.PI&&(u*=-1),N1(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(t.x-h*o,t.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function F8(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function N8(e,t){return iB(e.position,e.controls[1].position,t.position)&&iB(e.position,t.controls[0].position,t.position)}function kNe(e,t,i,r,n=.5){let s=ey.subVectors(t,e).multiplyScalar(n).add(e),a=UT.subVectors(i,t).multiplyScalar(n).add(t),o=TNe.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=PNe.subVectors(a,s).multiplyScalar(n).add(s),u=DNe.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=RNe.subVectors(u,c).multiplyScalar(n).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function zNe(e,t,i=12,r=!0){let n=Ste.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=ak(t[o]),c=ey,u=Vf(l,i);for(let h=0;h<=u;h++)if(l instanceof _l||l instanceof Qd||l instanceof Rl){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&ONe(s,n))continue;s===void 0&&(s=_te),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function VNe(e,t,i,r=12,n=!0){let s=Ste.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=ak(t[l]),h=ey,d=Vf(u,r);o.push(d);for(let p=0;p<=d;p++)if(u instanceof _l||u instanceof Qd||u instanceof Rl){if(u.getPoint(p/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=_te:(e.setXYZ(a,c.x,c.y,c.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function U8(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=Vf(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=Vf(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Vf(e[0].roundedCurveCorner,t)*.5),r}function Vf(e,t=12){return e&&e instanceof ST?t*2:e&&(e instanceof Rl||e instanceof M$)?1:e&&e instanceof wU?t*e.points.length:t}function GNe(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=ak(t[a]),l=Vf(o,i),c=ey;for(let u=0;u<=l;u++)if(o instanceof _l||o instanceof Qd||o instanceof Rl){if(o.getPoint(u/l,c),n!==void 0&&LNe(n,c,u1))continue;n===void 0&&(n=UT),n.copy(c),e.push(c.x,c.y),s++}}return N1(e[0],e[e.length-2],u1)&&N1(e[1],e[e.length-1],u1)&&(e.pop(),e.pop()),r&&s>1&&!(N1(e[s-1],e[1],u1)&&N1(e[s-2],e[0],u1))&&(e.push(e[0],e[1]),s++),e}var FR=new pe,HNe=new pe,jNe=new pe,WNe=new pe,XNe=new pe,YNe=new pe,Xr=class extends OE{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new ba(new F(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=St.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Xr;return r.isClosed=e.isClosed,r.points=e.points.map(n=>zv.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>Xr.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=FR.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=St.generateUUID()){let r;e instanceof pe?r=e:r=new pe(e,t);let n=new zv(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return zNe(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=U8(this.points,e,!1),this.roundedCurveDivisions=U8(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return VNe(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),GNe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=Vf(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(F8(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(FR.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){F8(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&BNe(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,p=c.getLength(),f=u.getLength(),g=Math.min(o,p*.499),m=Math.min(o,f*.499),v=Math.min(g,m),x=1-v/p,y=v/f,_=c.getPointAt(x,FR),A=u.getPointAt(y,HNe);this._subSplitCurve(c,h,x,_,void 0),this._subSplitCurve(u,d,y,void 0,A);let S;if(this.useCubicForRoundedCorners){let C=Ate(_,n.position,A)/2,M=Math.tan(C)*_.distanceTo(n.position),[E,P]=FNe(_,A,M,jNe,WNe),R=NNe(E,P,n.position),[O,L]=UNe(R,_,A,M,XNe,YNe);S=new _l(_.clone(),O.clone(),L.clone(),A.clone())}else S=new Qd(_.clone(),n.position.clone(),A.clone());n.roundedCurveCorner=S,this.roundedCurves.splice(i+t,0,S),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof Rl)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=kNe(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new Xr(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],c=e.points[n+4],u=e.points[n+5],h=e.points[n+6],d=new zv(St.generateUUID(),new pe(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new Xr;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(n,s)=>{s instanceof _l&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof Qd&&(n[a]=INe(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof _l?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof Rl&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof _l?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Rl&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(e.curves),e instanceof OE&&(this.shapeHoles=e.holes.map(n=>{let s=new Xr;return s.fromShape(n),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},rB=Math.PI*2;function NR({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function qNe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function k8(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function QNe(e,t,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),f=u*h-u*p-h*d;f<0&&(f=0),f/=u*p+h*d,f=Math.sqrt(f)*(l===c?-1:1);let g=f*n/s*o,m=f*-s/n*a,v=g+(e+i)/2,x=m+(t+r)/2,y=(a-g)/n,_=(o-m)/s,A=(-a-g)/n,S=(-o-m)/s,C=k8(1,0,y,_),M=k8(y,_,A,S);return!c&&M>0&&(M-=rB),c&&M<0&&(M+=rB),{centerx:v,centery:x,ang1:C,ang2:M}}function JNe({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=QNe(e,t,i,r,n,s,c,u,a,o),{ang1:p,ang2:f}=d,{centerx:g,centery:m}=d,v=Math.abs(f)/(rB/4);Math.abs(1-v)<1e-7&&(v=1);let x=Math.max(Math.ceil(v),1);f/=x;for(let y=0;y<x;y++)l.push(qNe(p,f)),p+=f;return l.map(y=>{let{x:_,y:A}=NR(y[0],n,s,g,m),{x:S,y:C}=NR(y[1],n,s,g,m),{x:M,y:E}=NR(y[2],n,s,g,m);return{x1:_,y1:A,x2:S,y2:C,x:M,y:E}})}var $i;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})($i||($i={}));var mn;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(mn||(mn={}));function Zt(e,t){if(!e)throw t||"Assertion Failed!"}var Gt=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){Zt(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){Zt(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){Zt(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){Zt(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),h1=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),vA=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Xg=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),z8=function(){function e(){var t=new Xg,i=new h1,r=new vA(0),n=new vA(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new vA(0),r=new vA(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;Zt(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;Zt(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new Xg,i=new Xg,r=new h1,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new Xg;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new h1;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new h1;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new Xg;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new h1;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&Gt.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&Gt.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=t,s=t;(n=s.next)!==t;s=n){Zt(n.prev===s),l=n.anEdge;do Zt(l.Sym!==l),Zt(l.Sym.Sym===l),Zt(l.Lnext.Onext.Sym===l),Zt(l.Onext.Sym.Lnext===l),Zt(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(Zt(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Zt(a.prev===o),l=a.anEdge;do Zt(l.Sym!==l),Zt(l.Sym.Sym===l),Zt(l.Lnext.Onext.Sym===l),Zt(l.Onext.Sym.Lnext===l),Zt(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Zt(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)Zt(l.Sym.next===c.Sym),Zt(l.Sym!==l),Zt(l.Sym.Sym===l),Zt(l.Org!==null),Zt(l.Dst!==null),Zt(l.Lnext.Onext.Sym===l),Zt(l.Onext.Sym.Lnext===l);Zt(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),V8=function(){function e(){this.handle=null}return e}(),G8=function(){function e(){this.key=null,this.node=0}return e}(),KNe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new V8,this.handles[r]=new G8;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,Zt(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new V8;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new G8}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;Zt(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),UR=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),H8=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),ZNe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new H8,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new H8;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),$Ne=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?Gt.vertLeq(s.Org,a.Org)?Gt.edgeSign(a.Dst,s.Org,a.Org)<=0:Gt.edgeSign(s.Dst,a.Org,s.Org)>=0:Gt.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return Gt.edgeSign(s.Dst,n,s.Org)>=0;var o=Gt.edgeEval(s.Dst,n,s.Org),l=Gt.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&Zt(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){Zt(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new UR;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case $i.ODD:return(i&1)!==0;case $i.NONZERO:return i!==0;case $i.POSITIVE:return i>0;case $i.NEGATIVE:return i<0;case $i.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do Zt(Gt.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,Zt(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=Gt.vertL1dist(i,t),s=Gt.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(Gt.vertLeq(n.Org,s.Org)){if(Gt.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;Gt.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(Gt.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(Zt(!Gt.vertEq(n.Dst,s.Dst)),Gt.vertLeq(n.Dst,s.Dst)){if(Gt.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(Gt.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new Xg,p,f;if(Zt(!Gt.vertEq(c,l)),Zt(Gt.edgeSign(l,t.event,a)<=0),Zt(Gt.edgeSign(c,t.event,o)>=0),Zt(a!==t.event&&o!==t.event),Zt(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(Gt.vertLeq(a,o)){if(Gt.edgeSign(c,a,o)>0)return!1}else if(Gt.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),Gt.intersect(l,a,c,o,d),Zt(Math.min(a.t,l.t)<=d.t),Zt(d.t<=Math.max(o.t,c.t)),Zt(Math.min(c.s,l.s)<=d.s),Zt(d.s<=Math.max(o.s,a.s)),Gt.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=Gt.vertLeq(a,o)?a:o,Gt.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),Gt.vertEq(d,a)||Gt.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!Gt.vertEq(l,t.event)&&Gt.edgeSign(l,t.event,d)>=0||!Gt.vertEq(c,t.event)&&Gt.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,f,!0),!0):(Gt.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),Gt.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),Gt.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),Gt.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}Gt.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,Gt.vertEq(n.Org,r)){Zt(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!Gt.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}Zt(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Zt(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),Gt.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,c=new UR;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,Gt.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=Gt.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);Zt(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new UR,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new ZNe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(Zt(i.fixUpperEdge),Zt(++r===1)),Zt(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,Gt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new KNe(s,Gt.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,Zt(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!Gt.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),eUe=function(){function e(){this.mesh=new z8,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=$i.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],g=this.mesh.vHead;i=g.next;for(var m=0;m<3;++m)s=i.coords[m],c[m]=s,f[m]=i,l[m]=s,p[m]=i;for(i=g.next;i!==g;i=i.next)for(var v=0;v<3;++v)s=i.coords[v],s<c[v]&&(c[v]=s,f[v]=i),s>l[v]&&(l[v]=s,p[v]=i);var x=0;if(l[1]-c[1]>l[0]-c[0]&&(x=1),l[2]-c[2]>l[x]-c[x]&&(x=2),c[x]>=l[x]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=f[x],n=p[x],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=g.next;i!==g;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;Gt.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Gt.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(Gt.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Gt.edgeGoesLeft(n.Lnext)||Gt.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Gt.edgeGoesRight(r.Lprev)||Gt.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===mn.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===mn.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new z8),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=$i.ODD),i===void 0&&(i=mn.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),$Ne.computeInterior(this,a);var o=this.mesh;return i===mn.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===mn.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function vd(e){var t=e.windingRule,i=t===void 0?$i.ODD:t,r=e.elementType,n=r===void 0?mn.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,p=e.strict,f=p===void 0?!0:p,g=e.debug,m=g===void 0?!1:g;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new eUe;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var x=0;x<d.length;x++)v.addContour(l||2,d[x]);return v.tesselate(i,n,a,l,u,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:m?v.mesh:void 0}}}$i.ODD;$i.NONZERO;$i.POSITIVE;$i.NEGATIVE;$i.ABS_GEQ_TWO;mn.POLYGONS;mn.CONNECTED_POLYGONS;mn.BOUNDARY_CONTOURS;var nB=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*nB.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity}  ${e}`);let i=e*nB.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},Mte=nB;Mte.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var tUe=class{constructor(e=[],t=(i,r)=>i<r?-1:i>r?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,s=t[n];if(i(r,s)>=0)break;t[e]=s,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],n)>=0)break;t[e]=t[s],e=s}t[e]=n}};function iUe(e,t,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[x,y]of e[0])x<n&&(n=x),y<s&&(s=y),x>a&&(a=x),y>o&&(o=y);let l=a-n,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let x=[n,s];return x.distance=0,x.distance}let h=new tUe([],(x,y)=>y.max-x.max),d=nUe(e),p=new vC(n+l/2,s+c/2,0,e);p.d>d.d&&(d=p);let f=2;function g(x,y,_){let A=new vC(x,y,_,e);if(f++,A.max>d.d+i&&h.push(A),A.d>d.d&&(d=A,r&&console.log(`found best ${Math.round(1e4*A.d)/1e4} after ${f} probes`),d.d>t))return t}let m=u/2;for(let x=n;x<a;x+=u)for(let y=s;y<o;y+=u)g(x+m,y+m,m);for(;h.length;){let{max:x,x:y,y:_,h:A}=h.pop();if(x-d.d<=i)break;m=A/2,g(y-m,_-m,m),g(y+m,_-m,m),g(y-m,_+m,m),g(y+m,_+m,m)}r&&console.log(`num probes: ${f}
best distance: ${d.d}`);let v=[d.x,d.y];return v.distance=d.d,v.distance}function vC(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=rUe(e,t,r),this.max=this.d+this.h*Math.SQRT2}function rUe(e,t,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>t!=u[1]>t&&e<(u[0]-c[0])*(t-c[1])/(u[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,sUe(e,t,c,u))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function nUe(e){let t=0,i=0,r=0,n=e[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,t+=h*3}let s=new vC(i/t,r/t,0,e);return t===0||s.d<0?new vC(n[0][0],n[0][1],0,e):s}function sUe(e,t,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((e-n)*a+(t-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=e-n,o=t-s,a*a+o*o}var ok={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},Ete={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},Cte={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},kR=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),lk=class extends Ot{constructor(e,t,i=0,r=12,n=3,s=$i.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(E=>{let P=E.extractShapePointsToFlatArray([],r),R=[];for(let O=P.length-1;O>=1;O-=2){let L=P[O-1],I=P[O-0];R.push(L,I)}return R}),c=[],u=[];for(let E=0;E<o.length;E+=2)u.push([o[E],o[E+1]]);c.push(u);for(let E=0;E<l.length;E++){let P=l[E],R=[];for(let O=0;O<P.length;O+=2)R.push([P[O],P[O+1]]);c.push(R)}let h;e.isText?h=new CU().setFromPoints(e.points.map(E=>E.position)).getSize(new pe).length()*.1:c[0].length===0?h=i:i>0?h=iUe(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(n));let d;try{d=vd({windingRule:s,elementType:mn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=ok}let p;try{p=vd({windingRule:$i.ODD,elementType:mn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=Ete}if(!d)throw new Error("error generating geometry");let f=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let E=0;E<p.elements.length;E++){let P=p.elements[E],R=E%2===0?d.vertexCount:0;d.elements.push(P+R)}for(let E=0;E<p.vertexIndices.length;E++){let P=p.vertexIndices[E],R=d.vertexCount;d.vertexIndices.push(P+R)}for(let E=0;E<p.vertices.length;E++){let P=p.vertices[E];d.vertices.push(P)}}let g=1/0,m=-1/0,v=1/0,x=-1/0;for(let E=0,P=d.vertexCount;E<P;E++){let R=E*2,O=d.vertices[R+0],L=d.vertices[R+1];O<g&&(g=O),O>m&&(m=O),L<v&&(v=L),L>x&&(x=L)}this._minX=g,this._minY=v,this._width=m-g,this._height=x-v,this._buffer=new Mte(this._computeBufferEstimatedSize(d));let y=[],_=[];for(let E=d.elementCount-1;E>=0;E--){let P=E>=f,R=E*2,O=d.elements[R+0],L=d.elements[R+1],I=O+L,z={start:O,count:L,normals:[],continuous:[],concave:[]},K=O,Y=I-1,U=O+1,j=this._shape.roundedCurves.length;do{let G=K-O,le=d.vertices[Y*2+0],Z=d.vertices[Y*2+1],he=d.vertices[K*2+0],ye=d.vertices[K*2+1],de=d.vertices[U*2+0],xe=d.vertices[U*2+1],me=he-le,ee=ye-Z,we=Math.sqrt(me*me+ee*ee);me/=we,ee/=we;let Ae=he-de,Te=ye-xe,Re=Math.sqrt(Ae*Ae+Te*Te);Ae/=Re,Te/=Re,z.normals[G*2+0]=-Te,z.normals[G*2+1]=Ae,z.concave[G]=me*Te-ee*Ae>0;let Xe=d.vertexIndices[K];if(Array.isArray(Xe))z.continuous[G]=!1;else{let[Oe,Be]=this._shape.getCurveIndexFromVertexId(Xe-1,!0);if(Be>0&&Be<1)z.continuous[G]=!0;else{let at=Be===1?Oe+1:Oe-1;at=(at+j)%j;let ht=Be===1?0:1,se=this._shape.roundedCurves[Oe].getTangent(Be),N=this._shape.roundedCurves[at].getTangent(ht);z.continuous[G]=se.dot(N)>.95}}P&&(z.normals[G*2+0]*=-1,z.normals[G*2+1]*=-1),[Y,K,U]=[K,U,U+1],U>=I&&(U-=L)}while(U!==O+1);let k=[];k.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(O*2,I*2),vertexCount:L,vertexIndices:new Array(L).fill(!0).map((G,le)=>[le,le]),elements:[0,L],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(O*2,I*2)});let q=0;for(let G=1;G<=this._bevelSegments;G++){let le=G/this._bevelSegments*Math.PI/2,Z=(1-Math.cos(le))*this._bevel,he=[],ye=[],de=0;for(let me=0;me<L;me++){let ee=me*2,we=(me-1+L)%L*2,Ae=d.vertices[z.start*2+ee+0],Te=d.vertices[z.start*2+ee+1],Re=-z.normals[we+0]*Z,Xe=-z.normals[we+1]*Z,Oe=-z.normals[ee+0]*Z,Be=-z.normals[ee+1]*Z;if(z.concave[me]||!z.concave[me]&&P){let at=Math.atan2(Xe,Re),ht=Math.atan2(Be,Oe);ht>at&&(ht-=Math.PI*2);let se=ht-at;if(z.continuous[me]||P){let N=at+se/2,H=Math.cos(N)*Z,ve=Math.sin(N)*Z;he[2*de+0]=Ae+H*(P?-1:1),he[2*de+1]=Te+ve*(P?-1:1),ye[de]=me,de++}else{let N=Math.max(1,Math.floor(r/4*Math.abs(se)/Math.PI));for(let H=0;H<=N;H++){let ve=at+se*(H/N),X=Math.cos(ve)*Z,Ce=Math.sin(ve)*Z;he[2*de+0]=Ae+X,he[2*de+1]=Te+Ce,ye[de]=me,de++}}}else he[2*de+0]=Ae+Re,he[2*de+1]=Te+Xe,ye[de]=me,de++,he[2*de+0]=Ae,he[2*de+1]=Te,ye[de]=me,de++,he[2*de+0]=Ae+Oe,he[2*de+1]=Te+Be,ye[de]=me,de++}let xe=vd({windingRule:$i.POSITIVE,elementType:mn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[he],edgeCreateCallback:me=>{let ee=me.Org.idx,we=ye[ee],Ae=ye[(ee+1)%ye.length];me.idx=[we,Ae],me.Sym.idx=[Ae,we]},vertexIdCallback:me=>{let ee=me.Lprev.idx;return[ee?ee[1]:0,me.idx?me.idx[0]:0]}});if(!xe)throw console.log("Error"),new Error(`error generating bevel geometry for ${G}'th loop`);if(!xe.vertexCount){let me=(G-1)/this._bevelSegments*Math.PI/2;q=(1-Math.sin(me))*this._bevel;break}for(let me=0;me<xe.vertexIndices.length;me++){let[ee,we]=xe.vertexIndices[me];if(ee===we)continue;let Ae=we;we<ee&&(Ae+=L);for(let Te=ee;Te<Ae;Te++){let Re=Te%L,Xe=(Te+1)%L;if(!z.continuous[Re]||!z.continuous[Xe]){xe.vertexIndices[me]=[ee,Re],xe.vertexIndices.splice(me+1,0,[Xe,we]),xe.vertices.splice((me+1)*2,0,xe.vertices[me*2],xe.vertices[me*2+1]);break}}}k.push({bevelI:G,angle:le,size:Z,boundary:xe,reverseMap:ye,insetPoints:he})}let W=(G,le,Z)=>{let he=0,ye=G.boundary.vertexIndices.length;for(;he<ye&&Z(G.boundary.vertexIndices[le]);)le=(le+1)%ye,he++;return he},te=y.length;for(let G=1;G<k.length;G++){let le=k[G-1],Z=k[G],he=le.boundary.vertexIndices.length,ye=Z.boundary.vertexIndices.length;if(!he||!ye)break;let de=z.concave.length,xe=0,me=kR(xe,L);for(;!le.boundary.vertexIndices.filter(me).length||!Z.boundary.vertexIndices.filter(me).length;)xe++,me=kR(xe,L);let ee=le.boundary.vertexIndices.findIndex(me),we=Z.boundary.vertexIndices.findIndex(me);do ee=(ee+1)%he;while(me(le.boundary.vertexIndices[ee]));do we=(we+1)%ye;while(me(Z.boundary.vertexIndices[we]));xe=(xe+1)%L;let Ae=xe,Te=0,Re=this._buildBevelVert(z,le,(ee-1+he)%he,void 0,Te),Xe=this._buildBevelVert(z,Z,(we-1+ye)%ye,void 0,Te),Oe=Re,Be=Xe,at,ht,se=!1;do{Te=(xe||de)/de,me=kR(xe,L);let N=W(le,ee,me),H=W(Z,we,me),ve=se;if(se=!1,N&&!H){for(let X=0;X<N;X++)at=this._buildBevelVert(z,le,(ee+X)%he,X/(N-1),Te),y.push(Oe.topN,at.topP,Be.topN),a===!1&&y.push(at.bottomP,Oe.bottomN,Be.bottomN),Oe=at;se=!0}else if(!N&&H)for(let X=0;X<H;X++)ht=this._buildBevelVert(z,Z,(we+X)%ye,X/(H-1),Te),y.push(Be.topN,Oe.topP,ht.topP),a===!1&&y.push(Oe.bottomP,Be.bottomN,ht.bottomP),Be=ht;else if(N&&H)if(at=this._buildBevelVert(z,le,ee,0,Te),ht=this._buildBevelVert(z,Z,we,0,Te),ve?(y.push(Oe.topN,ht.topP,Be.topN),y.push(Oe.topN,at.topP,ht.topP),a===!1&&(y.push(ht.bottomP,Oe.bottomN,Be.bottomN),y.push(ht.bottomP,at.bottomP,Oe.bottomN))):(y.push(Be.topN,Oe.topN,at.topP),y.push(Be.topN,at.topP,ht.topP),a===!1&&(y.push(at.bottomP,Oe.bottomN,Be.bottomN),y.push(at.bottomP,Be.bottomN,ht.bottomP))),Oe=at,Be=ht,N===H)for(let X=1;X<N;X++)at=this._buildBevelVert(z,le,(ee+X)%he,X/(N-1),Te),ht=this._buildBevelVert(z,Z,(we+X)%ye,X/(H-1),Te),y.push(Oe.topN,at.topP,Be.topN),y.push(Be.topN,at.topP,ht.topP),a===!1&&(y.push(at.bottomP,Oe.bottomN,Be.bottomN),y.push(at.bottomP,Be.bottomN,ht.bottomP)),Oe=at,Be=ht;else if(N>H){let X=N/H,Ce=0;for(let Ve=1;Ve<N;Ve++)at=this._buildBevelVert(z,le,(ee+Ve)%he,Ve/(N-1),Te),y.push(Oe.topN,at.topP,Be.topN),a===!1&&y.push(at.bottomP,Oe.bottomN,Be.bottomN),Oe=at,Ve>(Ce+1)*X&&(Ce++,ht=this._buildBevelVert(z,Z,(we+Ce)%ye,Ce/(H-1),Te),y.push(Be.topN,at.topP,ht.topP),a===!1&&y.push(at.bottomP,Be.bottomN,ht.bottomP),Be=ht)}else{let X=H/N,Ce=0;for(let Ve=1;Ve<H;Ve++)ht=this._buildBevelVert(z,Z,(we+Ve)%ye,Ve/(H-1),Te),y.push(Be.topN,at.topP,ht.topP),a===!1&&y.push(at.bottomP,Be.bottomN,ht.bottomP),Be=ht,Ve>(Ce+1)*X&&(Ce++,at=this._buildBevelVert(z,le,(ee+Ce)%he,Ce/(N-1),Te),y.push(Oe.topN,at.topP,Be.topN),a===!1&&y.push(at.bottomP,Oe.bottomN,Be.bottomN),Oe=at)}ee=(ee+N)%he,we=(we+H)%ye,xe=(xe+1)%de}while(xe!==Ae)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(k,z,y),P){let G=[];for(let le=y.length-1;le>=te+2;le-=3){let Z=y[le-2],he=y[le-1],ye=y[le-0];G.push(ye,he,Z)}y.splice(te,y.length-te,...G)}if(P){let G=[];for(let le=k[k.length-1].boundary.vertices.length-1;le>=1;le-=2){let Z=k[k.length-1].boundary.vertices[le-1],he=k[k.length-1].boundary.vertices[le-0];G.push(Z,he)}_.push(G)}if(!P){let G=k[k.length-1],le;try{le=vd({windingRule:k.length>1?$i.POSITIVE:$i.ODD,elementType:mn.POLYGONS,vertexSize:2,strict:!0,contours:[G.insetPoints,..._]})}catch{le=Cte}if(!le)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let Z=0;Z<le.elementCount*3;Z+=3){let he=this._buildSurfaceVert(le,le.elements[Z+0],q),ye=this._buildSurfaceVert(le,le.elements[Z+1],q),de=this._buildSurfaceVert(le,le.elements[Z+2],q);y.push(he.top,ye.top,de.top),a===!1&&y.push(de.bottom,ye.bottom,he.bottom)}}this.vertexCache={}}this._buffer.shrink();let A=new Wt(Uint32Array.from(y),1),S=new Wt(this._buffer.positions,3),C=new Wt(this._buffer.normals,3),M=new Wt(this._buffer.uvs,2);S.needsUpdate=!0,C.needsUpdate=!0,M.needsUpdate=!0,A.needsUpdate=!0,this.setAttribute("position",S),this.setAttribute("normal",C),this.setAttribute("uv",M),this.setIndex(A)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=a,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=i*2,g=l*2,m=c*2,v=t.boundary.vertices[f+0],x=t.boundary.vertices[f+1],y=(1-p)*this._bevel,_=(v-this._minX)/this._width,A=(x-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(_=n),A=1);let S=e.normals[g+0],C=e.normals[g+1],M=e.normals[m+0],E=e.normals[m+1];if(h){let I=M-S,z=E-C;S=S+I*(1-r),C=C+z*(1-r);let K=Math.sqrt(S*S+C*C);S/=K,C/=K}let P=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),R=P*3,O=P*2,L={i,fi:l,topP:P+0,topN:P+0,bottomP:P+1,bottomN:P+1,pathBevelUCoord:n};return this._buffer.positions[R+0]=v,this._buffer.positions[R+1]=x,this._buffer.positions[R+2]=(this.forPathBevel?this._bevel:this._depth)-y,this._buffer.normals[R+0]=S*d,this._buffer.normals[R+1]=C*d,this._buffer.normals[R+2]=p,this._buffer.uvs[O+0]=_,this._buffer.uvs[O+1]=A,this.forPathBevel===!1&&(this._buffer.positions[R+3]=v,this._buffer.positions[R+4]=x,this._buffer.positions[R+5]=y,this._buffer.normals[R+3]=S*d,this._buffer.normals[R+4]=C*d,this._buffer.normals[R+5]=-p,this._buffer.uvs[O+2]=A,this._buffer.uvs[O+3]=_),u||(this.forPathBevel?(P+=1,R+=3,O+=2):(P+=2,R+=6,O+=4),L.topP=P+0,L.bottomP=P+1,this._buffer.positions[R+0]=v,this._buffer.positions[R+1]=x,this._buffer.positions[R+2]=(this.forPathBevel?this._bevel:this._depth)-y,this._buffer.normals[R+0]=M*d,this._buffer.normals[R+1]=E*d,this._buffer.normals[R+2]=p,this._buffer.uvs[O+0]=_,this._buffer.uvs[O+1]=A,this.forPathBevel===!1&&(this._buffer.positions[R+3]=v,this._buffer.positions[R+4]=x,this._buffer.positions[R+5]=y,this._buffer.normals[R+3]=M*d,this._buffer.normals[R+4]=E*d,this._buffer.normals[R+5]=-p,this._buffer.uvs[O+2]=A,this._buffer.uvs[O+3]=_)),this.vertexCache[s]=L,L}clone(){let e=new lk(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=RT(this.userData),e}},Tte=class extends Ot{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=$i.ODD,this.elementType=mn.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:$i.ODD,elementType:mn.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,p=r.length/2;d<p;d++){let f=d*2,g=r[f+0],m=r[f+1];if(l!==void 0&&g!==l&&(a=!1),c!==void 0&&m!==c&&(o=!1),l=g,c=m,!a&&!o)break}if(!a&&!o)try{s=vd({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=ok}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Wt(new Float32Array(u*3),3),this._normalAttribute=new Wt(new Float32Array(u*3),3),this._uvAttribute=new Wt(new Float32Array(u*2),2),this._indexAttribute=new Wt(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,f=1/0,g=-1/0;for(let x=0,y=u;x<y;x++){let _=x*2,A=s.vertices[_+0],S=s.vertices[_+1];A<d&&(d=A),A>p&&(p=A),S<f&&(f=S),S>g&&(g=S)}let m=p-d,v=g-f;for(let x=0,y=u;x<y;x++){let _=x*2,A=s.vertices[_+0],S=s.vertices[_+1],C=(A-d)/m,M=(S-f)/v;this._positionAttribute.setXYZ(x,A,S,0),this._normalAttribute.setXYZ(x,0,0,1),this._uvAttribute.setXY(x,C,M)}for(let x=0,y=h;x<y;x++){let _=x*3,A=s.elements[_+0],S=s.elements[_+1],C=s.elements[_+2];this._indexAttribute.setX(_+0,A),this._indexAttribute.setX(_+1,S),this._indexAttribute.setX(_+2,C)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new Tte(this._shape,this._curveSegments);return e.userData=RT(this.userData),e}},Pte=class extends lk{constructor(e,t,i=0,r=12,n=3,s=$i.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new Pte(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=RT(this.userData),e}},Sm=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:$i.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof Xr?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new Xr(r,n).fromJSON(a),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new Xr(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new Tte(e.shape,n,{windingRule:a}):o=new Pte(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},Dte=Math.PI*2,ck=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=St.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Xr?e.shape:new Xr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=aUe(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let p;return n===0?(p=new Ot,p.setAttribute("position",new xt([],3))):p=Sm.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function aUe(e,t,i,r,n,s){if(r>=Dte)return n>30||n%4===0?(lUe(e,t,i,s),Math.round(n/4)):j8(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=JNe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?oUe(e,a.x,a.y,c,n,t,i,s):j8(e,r,n,t,i,s)}function oUe(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(Vv(t,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=e.points[c],p=Vv(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),e.addPoint(p)}return o>0?Rte(e,s,a,o):e.addPoint(Vv(0,0)),l}function j8(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;e.addPoint(Vv(c,u))}return t<Dte?s>0?Rte(e,r,n,s):e.addPoint(Vv(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&Ite(e,r,n,s)),1}function lUe(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(yA(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(yA(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(yA(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(yA(n,s-i,n+o,s-i,n-o,s-i)),r>0&&Ite(e,t,i,r)}function Vv(e,t){return new zv(St.generateUUID(),new pe(e,t))}function yA(e,t,i,r,n,s){let a=Vv(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function Rte(e,t,i,r){Lte(e,t,i,r).forEach(n=>e.addPoint(n))}function Ite(e,t,i,r){let n=Lte(e,t,i,r),s=new Xr;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function Lte(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new pe(n/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=St.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var cUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new Ote(!1,t,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},zR=new Bv([0,0,0],1),Ote=class extends Ot{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let p=()=>new F,f=new F,g=p(),m=p(),v=p(),x,y,_,A,S,C,M,E,P=p(),R=p(),O=p(),L=p(),I=p(),z=p(),K=p(),Y=p(),U=i-2*o+.001,j=U/s,k=Math.ceil(a*s),q=k+1,W=U/k,te=-U/2,G=c+1,le=2*Math.PI/c,Z=Math.PI/2/h,he=.01,ye=Math.min((1-u/100)*o,o-he),de=o-ye,xe=0,me=2,ee=h*me+me,we=G*ee/me,Ae=we+G*q,Te=Math.max(0,G*(q+ee)),[Re,Xe,Oe]=[3,3,2].map(_e=>Array(Te*_e).fill(0)),Be=[],at=n-o;function ht(_e,Pe){let Qe=Math.PI/2;C=Pe*W,E=2*Math.PI*(C%j)/j+Qe,C+=te,M=Math.sin(E)*at,S=Math.cos(E)*at,e?_e.set(S,M,C):_e.set(S,C,M)}ht(f,-1e-10),ht(g,0),P.copy(f),ht(f,1);let se=f.distanceTo(g),N=d?0:de+ye,H=se*k+2*N,ve=ye,X=H-N;for(let _e=0;_e<=k;_e++){ht(m,_e),Y.subVectors(m,P).normalize(),P.copy(m),z.copy(m).setComponent(+e+1,0).normalize(),K.crossVectors(Y,z).normalize();let Pe=_e===0,Qe=_e===k,st=Pe?3*Math.PI/2:Z,ct=Pe?ve:X,tt=Pe?G:Ae,oe=Pe?0:Te-G,je=Y.clone().multiplyScalar(Pe?-de:de).add(m),dt=Y.clone().multiplyScalar(Pe?-1:1).normalize();for(let J=0;J<G;J++){let be=J*le;if(R.addVectors(f.copy(z).multiplyScalar(o*Math.cos(be)),g.copy(K).multiplyScalar(o*Math.sin(be))),O.copy(R).normalize(),Pe||Qe){d||(xe=oe+J,[0,1,2].forEach(ue=>{Re[xe*3+ue]=je.getComponent(ue),Xe[xe*3+ue]=dt.getComponent(ue)}),Oe[xe*2]=+Qe,Oe[xe*2+1]=J/c),g.copy(O).multiplyScalar(ye),v.addVectors(m,g);for(let ue=0;ue<h;ue++){let Ne=ue*Z+st;L.addVectors(f.copy(Y).multiplyScalar(de*Math.sin(Ne)),g.copy(O).multiplyScalar(de*Math.cos(Ne))),I.copy(L).normalize(),g.addVectors(v,L),L.normalize(),xe=tt+ue*G+J,[0,1,2].forEach(_t=>{Re[xe*3+_t]=g.getComponent(_t),Xe[xe*3+_t]=I.getComponent(_t)});let et=+Pe+Math.sin(Ne);Oe[xe*2]=(ct+de*et)/H,Oe[xe*2+1]=J/c}}g.addVectors(m,R),xe=we+_e*G+J,[0,1,2].forEach(ue=>{Re[xe*3+ue]=g.getComponent(ue),Xe[xe*3+ue]=O.getComponent(ue)}),Oe[xe*2]=(N+_e*se)/H,Oe[xe*2+1]=J/c}}let Ce=q+2*h+me,[Ve,Ye]=[+d,Ce-1];for(let _e=Ve;_e<=Ye-1;_e++){let Pe=d&&_e===Ye-1;for(let Qe=0;Qe<G-1;Qe++)x=_e*G+Qe,y=x+1,_=(Pe?Qe:x)+G,A=(Pe?Qe+1:y)+G,_e===0?Be.push(y,A,_):_e===Ce-2?Be.push(x,y,_):Be.push(x,y,_,y,A,_)}this.setIndex(Be),this.setAttribute("position",new xt(Re,3)),this.setAttribute("normal",new xt(Xe,3)),this.setAttribute("uv",new xt(Oe,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,zR.array=r,zR.count=r.length,zR}},uUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new Bte(t*.5,s,a):new L$(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},Bte=class extends nk{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new Bte(e.radius,e.corner,e.cornerSides)}},hUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new OE;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new C$(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},rc=new ot,VR=new Qi,xA=new F,yC=class extends ws{constructor(){super(),this.uuid=St.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new gn().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return rc.makeRotationX(e),this.applyMatrix4(rc),this}rotateY(e){return rc.makeRotationY(e),this.applyMatrix4(rc),this}rotateZ(e){return rc.makeRotationZ(e),this.applyMatrix4(rc),this}translate(e,t,i){return rc.makeTranslation(e,t,i),this.applyMatrix4(rc),this}scale(e,t,i){return rc.makeScale(e,t,i),this.applyMatrix4(rc),this}lookAt(e){return VR.lookAt(e),VR.updateMatrix(),this.applyMatrix4(VR.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)t.vertices.push(new F().fromBufferAttribute(n,h)),a!==void 0&&t.colors.push(new jt().fromBufferAttribute(a,h));function c(h,d,p,f){let g=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],m=s===void 0?[]:[new F().fromBufferAttribute(s,h),new F().fromBufferAttribute(s,d),new F().fromBufferAttribute(s,p)],v=new sB(h,d,p,m,g,f);t.faces.push(v),o!==void 0&&t.faceVertexUvs[0].push([new pe().fromBufferAttribute(o,h),new pe().fromBufferAttribute(o,d),new pe().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new pe().fromBufferAttribute(l,h),new pe().fromBufferAttribute(l,d),new pe().fromBufferAttribute(l,p)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],p=d.start,f=d.count;for(let g=p,m=p+f;g<m;g+=3)i!==void 0?c(i.getX(g),i.getX(g+1),i.getX(g+2),d.materialIndex):c(g,g+1,g+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xA).negate(),this.translate(xA.x,xA.y,xA.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new ot;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new F,t=new F;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new F;if(e){let i=new F,r=new F;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new yC;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new F,c={a:new F,b:new F,c:new F};n.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new nn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Oa),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new gn().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let p=a[h].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],f,g,m=p.vertexNormals,v=p.vertexColors,x=new sB(p.a+n,p.b+n,p.c+n);x.normal.copy(p.normal),r!==void 0&&x.normal.applyMatrix3(r).normalize();for(let y=0,_=m.length;y<_;y++)f=m[y].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),x.vertexNormals.push(f);x.color.copy(p.color);for(let y=0,_=v.length;y<_;y++)g=v[y],x.vertexColors.push(g.clone());x.materialIndex=p.materialIndex+i,o.push(x)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,g=p.length;f<g;f++){let m=p[f],v=[];for(let x=0,y=m.length;x<y;x++)v.push(m[x].clone());this.faceVertexUvs[h].push(v)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new F(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],g=!0,m=!1,v=this.faceVertexUvs[0][p]!==void 0,x=f.normal.length()>0,y=f.vertexNormals.length>0,_=f.color.r!==1||f.color.g!==1||f.color.b!==1,A=f.vertexColors.length>0,S=0;if(S=c(S,0,0),S=c(S,1,g),S=c(S,2,m),S=c(S,3,v),S=c(S,4,x),S=c(S,5,y),S=c(S,6,_),S=c(S,7,A),i.push(S),i.push(f.a,f.b,f.c),i.push(f.materialIndex),v){let C=this.faceVertexUvs[0][p];i.push(d(C[0]),d(C[1]),d(C[2]))}if(x&&i.push(u(f.normal)),y){let C=f.vertexNormals;i.push(u(C[0]),u(C[1]),u(C[2]))}if(_&&i.push(h(f.color)),A){let C=f.vertexColors;i.push(h(C[0]),h(C[1]),h(C[2]))}}function c(p,f,g){return g?p|1<<f:p&~(1<<f)}function u(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return n[f]!==void 0||(n[f]=r.length/3,r.push(p.x,p.y,p.z)),n[f]}function h(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return a[f]!==void 0||(a[f]=s.length,s.push(p.getHex())),a[f]}function d(p){let f=p.x.toString()+p.y.toString();return l[f]!==void 0||(l[f]=o.length/2,o.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new yC().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,g=p.length;f<g;f++){let m=p[f],v=[];for(let x=0,y=m.length;x<y;x++){let _=m[x];v.push(_.clone())}this.faceVertexUvs[h].push(v)}}let n=e.morphTargets;for(let h=0,d=n.length;h<d;h++){let p={};if(p.name=n[h].name,n[h].vertices!==void 0){p.vertices=[];for(let f=0,g=n[h].vertices.length;f<g;f++)p.vertices.push(n[h].vertices[f].clone())}if(n[h].normals!==void 0){p.normals=[];for(let f=0,g=n[h].normals.length;f<g;f++)p.normals.push(n[h].normals[f].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,g=s[h].vertexNormals.length;f<g;f++){let m=s[h].vertexNormals[f],v={};v.a=m.a.clone(),v.b=m.b.clone(),v.c=m.c.clone(),p.vertexNormals.push(v)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let f=0,g=s[h].faceNormals.length;f<g;f++)p.faceNormals.push(s[h].faceNormals[f].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new dUe().fromGeometry(this),t=new Ot,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",wA.call(new Wt(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",wA.call(new Wt(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",W8.call(new Wt(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",X8.call(new Wt(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",X8.call(new Wt(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new xt(l.data.length*3,3);c.name=l.name,n.push(wA.call(c,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new xt(e.skinIndices.length*4,4);t.setAttribute("skinIndex",Y8.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new xt(e.skinWeights.length*4,4);t.setAttribute("skinWeight",Y8.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Ot,i=e.geometry;if(e.isPoints||e.isLine){let r=new xt(i.vertices.length*3,3),n=new xt(i.colors.length*3,3);if(t.setAttribute("position",wA.call(r,i.vertices)),t.setAttribute("color",W8.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new xt(i.lineDistances.length,1);t.setAttribute("lineDistance",pUe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};yC.prototype.isGeometry=!0;var dUe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let m=0;m<o;m++)l[m]={name:a[m].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let m=0;m<u;m++)h[m]={name:c[m].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,g=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let m=0;m<t.length;m++){let v=t[m];this.vertices.push(i[v.a],i[v.b],i[v.c]);let x=v.vertexNormals;if(x.length===3)this.normals.push(x[0],x[1],x[2]);else{let _=v.normal;this.normals.push(_,_,_)}let y=v.vertexColors;if(y.length===3)this.colors.push(y[0],y[1],y[2]);else{let _=v.color;this.colors.push(_,_,_)}if(n===!0){let _=r[0][m];_!==void 0?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new pe,new pe,new pe))}if(s===!0){let _=r[1][m];_!==void 0?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new pe,new pe,new pe))}for(let _=0;_<o;_++){let A=a[_].vertices;l[_].data.push(A[v.a],A[v.b],A[v.c])}for(let _=0;_<u;_++){let A=c[_].vertexNormals[m];h[_].data.push(A.a,A.b,A.c)}f&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},sB=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new F,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new jt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function pUe(e){return this.array.set(e),this}function W8(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new jt),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function X8(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new pe),t[i++]=s.x,t[i++]=s.y}return this}function wA(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new F),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function Y8(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new ii),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var fUe=["a","b","c"];function mUe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function GR(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function HR(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[e].edges.push(c),s[t].edges.push(c)}function gUe(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],HR(a.a,a.b,e,r,a,i),HR(a.b,a.c,e,r,a,i),HR(a.c,a.a,e,r,a,i)}function bA(e,t,i,r,n){e.push(new sB(t,i,r,void 0,void 0,n))}function Tg(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function _A(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var vUe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Ot?e=new yC().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new F,i,r,n,s,a,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;gUe(o,l,h,d);let p=[],f,g,m,v,x,y,_;for(let he of Array.from(d.keys())){for(g=d.get(he),m=new F,x=3/8,y=1/8,_=g.faces.length,_!=2&&(x=.5,y=0,_!=1),m.addVectors(g.a,g.b).multiplyScalar(x),t.set(0,0,0),s=0;s<_;s++){for(v=g.faces[s],a=0;a<3&&(f=o[mUe(v,fUe[a])],!(f!==g.a&&f!==g.b));a++);f&&t.add(f)}t.multiplyScalar(y),m.add(t),g.newEdge=p.length,p.push(m)}let A,S,C,M,E,P,R,O=[];for(r=0,n=o.length;r<n;r++){for(P=o[r],E=h[r].edges,i=E.length,i==3?A=3/16:i>3&&(A=3/(8*i)),S=1-i*Number(A),C=A,i<=2&&(i==2?(S=3/4,C=1/8):i==1||i==0),R=P.clone().multiplyScalar(S),t.set(0,0,0),s=0;s<i;s++)M=E[s],f=M.a!==P?M.a:M.b,t.add(f);t.multiplyScalar(Number(C)),R.add(t),O.push(R)}let L=O.concat(p),I=O.length,z,K,Y,U=[],j=[],k,q,W,te,G=new pe,le=new pe,Z=new pe;for(r=0,n=l.length;r<n;r++)v=l[r],z=Number(GR(v.a,v.b,d).newEdge)+I,K=Number(GR(v.b,v.c,d).newEdge)+I,Y=Number(GR(v.c,v.a,d).newEdge)+I,bA(U,z,K,Y,v.materialIndex),bA(U,v.a,z,Y,v.materialIndex),bA(U,v.b,K,z,v.materialIndex),bA(U,v.c,Y,K,v.materialIndex),u&&(k=c[r],q=k[0],W=k[1],te=k[2],G.set(Tg(q.x,W.x),Tg(q.y,W.y)),le.set(Tg(W.x,te.x),Tg(W.y,te.y)),Z.set(Tg(q.x,te.x),Tg(q.y,te.y)),_A(j,G,le,Z),_A(j,q,G,Z),_A(j,W,le,G),_A(j,te,Z,le));e.vertices=L,e.faces=U,u&&(e.faceVertexUvs[0]=j)}},An=new F,yUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Ot().copy(new Fl(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(An),r={width:An.x,height:An.y,depth:An.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new Ot().copy(new Fl(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(An)):An.set(a.width,a.height,a.depth),(t!==An.x||i!==An.y||r!==An.z)&&s.scale(An.x===0?1:t/An.x,An.y===0?1:i/An.y,An.z===0?1:r/An.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new vUe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new G$(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(An);let s=100/An.x;Object.assign(n.parameters,{width:100,height:An.y*s,depth:An.z*s}),t(this.build(n))})}},Fte=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Xr?e.shape:new Xr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,p=2*Math.PI/r;for(let g=0;g<r;g++){let m=p*g,v=h+Math.sin(m)*c,x=d+Math.cos(m)*u;l.addPoint(l.createPoint(v,x))}l.isClosed=!0;for(let g=0,m=l.points.length;g<m;g++)l.points[g].roundness=n;l.roundness=n,l.update();let f=Sm.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},xUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new bUe(t*.5,i,n,s,a,o,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function d1(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function jR(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function wUe(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var bUe=class extends Ot{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),g=2*Math.PI/i,m=(i-2)*Math.PI/i,v=Math.PI-m,x=new F(0,-d,0),y=new F(0,d,0),_=new pe(e,-d),A=new pe(f,-d),S=new pe(0,y.y).sub(A),C=new pe(0,y.y).sub(_),M=new pe(S.y,-S.x).normalize(),E=new pe(C.y,-C.x).normalize(),P=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-S.angle())/2)-1e-8;s=Math.min(s,P);let R;{let Y=new F(M.x,M.y,0),U=new F(Math.cos(g)*Y.x,Y.y,Math.sin(g)*Y.x);R=Y.angleTo(U)}let O=s/Math.tan((Math.PI-S.angle())/2),L=s/Math.tan((Math.PI-R)/2),I=new F;if(!n){l.push(x.x,x.y,x.z),c.push(0,-1,0),u.push(0,0);let Y=h++,U=[],j=_.clone(),k=O/Math.cos(Math.PI/i);j.x-=k;for(let q=0;q<i;q++){let W=q/i*Math.PI*2+p,te=new pe(Math.sin(W),Math.cos(W));d1(j,te,I),l.push(I.x,I.y,I.z),c.push(0,-1,0),u.push(0,0),U.push(h++)}for(let q=0;q<U.length;q++)o.push(U[q],Y,U[(q+1)%U.length])}{let Y=new F,U=new F,j=new F,k=new F,q=new F,W=new F;for(let te=0;te<i;te++){let G=te/i*Math.PI*2+p,le=(te+.5)/i*Math.PI*2+p,Z=(te+1)/i*Math.PI*2+p,he=new pe(Math.sin(G),Math.cos(G)),ye=new pe(Math.sin(le),Math.cos(le)),de=new pe(Math.sin(Z),Math.cos(Z));d1(_,he,U),d1(_,de,j),d1(M,ye,Y),jR(y,U,j,L,L,k),l.push(k.x,k.y,k.z),jR(U,y,j,L,O,q),l.push(q.x,q.y,q.z),jR(j,U,y,O,L,W),l.push(W.x,W.y,W.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),u.push(0,0),u.push(0,0);let xe=h++,me=h++,ee=h++;if(o.push(xe,me,ee),s>0){{let Te=U.clone().add(j).multiplyScalar(.5),Re=y.clone().sub(Te).normalize(),Xe=x.clone().sub(Te).normalize().add(Re).normalize().multiplyScalar(-1),Oe=W.clone().sub(q);z(Te,Oe,Xe,S.angle())}let we,Ae;{let Te=new F;d1(E,de,Te);let Re=W.clone().add(k).multiplyScalar(.5);Re=wUe(Re,j,y);let Xe=W.clone().sub(k);[we,Ae]=z(Re,Xe,Te,R,k.y)}{let Te=we,Re=Te.clone().setY(0).normalize(),Xe=new F(0,-1,0),Oe=Re.clone().cross(Xe);K(Te,Re,Xe,Oe)}{let Te=S.angle(),Re=Math.PI-Te,Xe=y.clone();Xe.y-=s/Math.sin(Te-Math.PI/2);let Oe=new F,Be=[];for(let ht=0;ht<a;ht++){let se=[],N=Math.PI/2-Re*ht/a,H=Math.cos(N),ve=Math.sin(N),X=le;for(let Ce=0;Ce<=ht;Ce++){let Ve=Math.cos(X),Ye=Math.sin(X);Y.x=H*Ye,Y.y=ve,Y.z=H*Ve,Oe.copy(Xe).addScaledVector(Y,s),l.push(Oe.x,Oe.y,Oe.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),se.push(h++),X+=Math.PI*2/ht/i}Be.push(se)}Ae.reverse(),Be.push(Ae);let at=Be.length-1;for(let ht=0;ht<at;ht++){let se=Be[ht],N=Be[ht+1],H=se.length-1;o.push(N[1],se[0],N[0]);for(let ve=1;ve<=H;ve++)o.push(se[ve],se[ve-1],N[ve]),o.push(N[ve+1],se[ve],N[ve])}}}}}this.setIndex(o),this.setAttribute("position",new xt(l,3)),this.setAttribute("normal",new xt(c,3)),this.setAttribute("uv",new xt(u,2));function z(Y,U,j,k,q){let W=-k/2,te=(Math.PI-k)/2,G=U.clone().normalize().cross(j);Y.addScaledVector(j,-s/Math.sin(te));let le=new F,Z=new F,he=1,ye=h,de=[];for(let xe=0;xe<=a;xe++){let me=W+xe/a*k;Z.set(0,0,0),Z.addScaledVector(G,Math.sin(me)),Z.addScaledVector(j,Math.cos(me));for(let ee=0;ee<=he;ee++){let we=ee/he-.5;if(le.copy(Y),le.addScaledVector(U,we),le.addScaledVector(Z,s),q!=null){let Ae=Math.max(0,le.y-q);le.addScaledVector(U,-Ae/U.y)}l.push(le.x,le.y,le.z),c.push(Z.x,Z.y,Z.z),u.push(0,0),ee===0&&de.push(h),h++}}for(let xe=0;xe<a;xe++)for(let me=0;me<he;me++){let ee=ye+me+(he+1)*xe,we=ee+(he+1),Ae=we+1,Te=ee+1;o.push(ee,we,Te),o.push(we,Ae,Te)}return[Y.clone().addScaledVector(U,.5),de]}function K(Y,U,j,k){let q=Math.PI/2,W=C.angle()-q,te=[],G=new F,le=new F;for(let he=0;he<=a;he++){let ye=[],de=he/a;for(let xe=0;xe<=he;xe++){let me=((he?xe/he:0)-.5)*v,ee=Math.cos(me),we=Math.sin(me),Ae=Math.atan(Math.tan(W)*ee),Te=(q+Ae)*de,Re=Math.cos(Te),Xe=Math.sin(Te);G.set(0,0,0),G.addScaledVector(U,Xe*ee),G.addScaledVector(j,Re),G.addScaledVector(k,Xe*we),le.copy(Y).addScaledVector(G,s),l.push(le.x,le.y,le.z),c.push(G.x,G.y,G.z),u.push(0,0),ye.push(h++)}te.push(ye)}let Z=te.length-1;for(let he=0;he<Z;he++){let ye=te[he],de=te[he+1],xe=ye.length-1;o.push(ye[0],de[1],de[0]);for(let me=1;me<=xe;me++)o.push(ye[me-1],ye[me],de[me]),o.push(ye[me],de[me+1],de[me])}}}},uk=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Xr?e.shape:new Xr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(_,A,S){return A>i&&S>r?Math.min(_*i/A,_*r/S):A>i?_*i/A:S>r?_*r/S:_}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let f=u.x,g=h.x,m=h.y,v=u.y;t.addPoint(t.createPoint(f,m)),t.addPoint(t.createPoint(g,m)),t.addPoint(t.createPoint(g,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let x=!0;for(let _=0,A=t.points.length;_<A;_++)t.points[_].roundness=p[_],_>0&&p[_]!==p[_-1]&&(x=!1);x&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let y=Sm.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(y,{userData:{...e,type:"RectangleGeometry"}})}},_Ue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=St.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new Ot,u.setAttribute("position",new xt([],3))):u=new Fv(.5*t,n,s,a,o,l,c*St.DEG2RAD),u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},SUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new zc(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},AUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new MUe(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},MUe=class extends Ot{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(he=0,ye=0,de=0)=>new F(he,ye,de),p=d(),f=d(),[g,m,v]=[t/2,e/2,i/2],x=-m,y=+m,[_,A,S]=[d(x,-g,+v),d(x,-g,-v),d(x,+g,-v)],C=(he,ye=!1)=>Math.sin(he-Math.PI/(1+ +ye)),M=(he,ye=!1)=>Math.cos(he-Math.PI/(1+ +ye));S.y=Math.sin(r)*t-g;let E=Math.cos(r)*t-v,P=_.z-c;r<=h?(S.z=Math.min(E,P),S.z==P&&(S.y-=(E-P)/Math.tan(h-r))):A.z=Math.min(A.z-E-v,_.z-c),p.subVectors(_,A),f.subVectors(S,A);let R=Math.min(p.length(),f.length())*n/100,O=R*Math.tan(r/2),L=R/Math.cos(r/2),I=p.clone().normalize().add(f.normalize()).setLength(L).add(A);p.set(0,C(r,!0),M(r,!0)),u.push([S,p.clone()]);let z=(Math.PI-r)/s;for(let he=0;he<=s;he++){let ye=h+r+he*z;p.set(0,Math.sin(ye)*O,Math.cos(ye)*O),p.add(I),f.set(0,C(ye),M(ye)),u.push([p.clone(),f.clone()])}u.push([_,d(0,1,0)]);let K=Math.sin(z/2)*O*2,Y=u.length-1,U=u[0][0].distanceTo(u[1][0]),j=u[Y-1][0].distanceTo(u[Y][0]),k=U+K*s+j;u[0].push(1);for(let he=0;he<=s;he++)u[he+1].push(1-(U+he*K)/k);u[Y].push(0);let[q,W,te]=u[0],G,le,Z;for(let he=1;he<u.length;he++)[G,le,Z]=u[he],a.push(x,q.y,q.z,x,G.y,G.z,y,q.y,q.z,y,q.y,q.z,x,G.y,G.z,y,G.y,G.z),o.push(0,W.y,W.z,0,le.y,le.z,0,W.y,W.z,0,W.y,W.z,0,le.y,le.z,0,le.y,le.z),l.push(0,te,0,Z,1,te,1,te,0,Z,1,Z),[q,W,te]=[G,le,Z];this.setAttribute("position",new xt(a,3)),this.setAttribute("normal",new xt(o,3)),this.setAttribute("uv",new xt(l,2))}},Nte=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Xr?e.shape:new Xr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,p=0,f=0,g=a*Math.PI/360/n,m=Math.PI/2*3*-1,v=h*r/100,x=d*r/100;if(n===3&&r===50){g=2*Math.PI/n;for(let _=0;_<n;_++){let A=g*_,S=p+Math.sin(A)*h,C=f+Math.cos(A)*d;u.addPoint(u.createPoint(S,C))}}else for(let _=0;_<n;_++){let A=p+Math.cos(m)*h,S=f+Math.sin(m)*d;u.addPoint(u.createPoint(A,S)),m+=g,A=p+Math.cos(m)*v,S=f+Math.sin(m)*x,u.addPoint(u.createPoint(A,S)),m+=g}u.isClosed=!0;for(let _=0,A=u.points.length;_<A;_++)u.points[_].roundness=s;u.roundness=s,u.update();let y=Sm.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(y,{userData:{...e,type:"StarGeometry"}})}},EUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new zc(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},CUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=TUe(t,i,r,t*.5,a,s,0,0,n,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function TUe(e,t,i,r,n,s,a,o,l,c,u){[t,i]=[i,t],a=t/2;let h=St.clamp(n/360,0,1);if(h===0){let d=new Ot;return d.setAttribute("position",new xt([],3)),d}return h===1&&(c=0),new Ote(!0,e,t,i,r,h,s,a,o,l,c,u)}var PUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new B$(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},DUe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Xr?e.shape:new Xr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=Sm.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function RUe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function IUe(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function LUe(e,t,i){let r,n,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),c=i*(1-o*t),u=i*(1-(1-o)*t);switch(a%6){case 0:r=i,n=u,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=c,s=i;break;case 4:r=u,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function OUe(e,t,i){e/=255,t/=255,i/=255;let r=Math.max(e,t,i),n=Math.min(e,t,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function BUe(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function FUe(e,t,i){return(e<<16)+(t<<8)+i}function NUe(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function UUe(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var kUe={parseRgba:IUe,hsvToRgb:LUe,rgbToHsv:OUe,hexToRgb:BUe,rgbToHex:FUe,rgbToHexString:NUe,hexStringToRgb:UUe},zUe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},VUe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},Ke=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Ke.version}static addUnaryOp(e){return Ke.max_unop_len=Math.max(e.length,Ke.max_unop_len),Ke.unary_ops[e]=1,Ke}static addBinaryOp(e,t,i){return Ke.max_binop_len=Math.max(e.length,Ke.max_binop_len),Ke.binary_ops[e]=t,i?Ke.right_associative.add(e):Ke.right_associative.delete(e),Ke}static addIdentifierChar(e){return Ke.additional_identifier_chars.add(e),Ke}static addLiteral(e,t){return Ke.literals[e]=t,Ke}static removeUnaryOp(e){return delete Ke.unary_ops[e],e.length===Ke.max_unop_len&&(Ke.max_unop_len=Ke.getMaxKeyLen(Ke.unary_ops)),Ke}static removeAllUnaryOps(){return Ke.unary_ops={},Ke.max_unop_len=0,Ke}static removeIdentifierChar(e){return Ke.additional_identifier_chars.delete(e),Ke}static removeBinaryOp(e){return delete Ke.binary_ops[e],e.length===Ke.max_binop_len&&(Ke.max_binop_len=Ke.getMaxKeyLen(Ke.binary_ops)),Ke.right_associative.delete(e),Ke}static removeAllBinaryOps(){return Ke.binary_ops={},Ke.max_binop_len=0,Ke}static removeLiteral(e){return delete Ke.literals[e],Ke}static removeAllLiterals(){return Ke.literals={},Ke}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new Ke(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return Ke.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!Ke.binary_ops[String.fromCharCode(e)]||Ke.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return Ke.isIdentifierStart(e)||Ke.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(Ke.hooks[e]){let i={context:this,node:t};return Ke.hooks.run(e,i),i.node}return t}searchHook(e){if(Ke.hooks[e]){let t={context:this};return Ke.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===Ke.SPACE_CODE||e===Ke.TAB_CODE||e===Ke.LF_CODE||e===Ke.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:Ke.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===Ke.SEMCOL_CODE||i===Ke.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())t.push(r);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,Ke.max_binop_len),t=e.length;for(;t>0;){if(Ke.binary_ops.hasOwnProperty(e)&&(!Ke.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Ke.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(n={value:t,prec:Ke.binaryPrecedence(t),right_a:Ke.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),r=[s,n,a];t=this.gobbleBinaryOp();){if(i=Ke.binaryPrecedence(t),i===0){this.index-=t.length;break}n={value:t,prec:i,right_a:Ke.right_associative.has(t)},l=t;let c=u=>n.right_a&&u.right_a?i>u.prec:i<=u.prec;for(;r.length>2&&c(r[r.length-2]);)a=r.pop(),t=r.pop().value,s=r.pop(),e={type:Ke.BINARY_EXP,operator:t,left:s,right:a},r.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),r.push(n,e)}for(o=r.length-1,e=r[o];o>1;)e={type:Ke.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(e=this.code,Ke.isDecimalDigit(e)||e===Ke.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===Ke.SQUOTE_CODE||e===Ke.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(e===Ke.OBRACK_CODE)r=this.gobbleArray();else{for(t=this.expr.substr(this.index,Ke.max_unop_len),i=t.length;i>0;){if(Ke.unary_ops.hasOwnProperty(t)&&(!Ke.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Ke.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Ke.UNARY_EXP,operator:t,argument:n,prefix:!0})}t=t.substr(0,--i)}Ke.isIdentifierStart(e)?(r=this.gobbleIdentifier(),Ke.literals.hasOwnProperty(r.name)?r={type:Ke.LITERAL,value:Ke.literals[r.name],raw:r.name}:r.name===Ke.this_str&&(r={type:Ke.THIS_EXP})):e===Ke.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===Ke.PERIOD_CODE||t===Ke.OBRACK_CODE||t===Ke.OPAREN_CODE||t===Ke.QUMARK_CODE;){let i;if(t===Ke.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Ke.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===Ke.OBRACK_CODE?(e={type:Ke.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==Ke.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===Ke.OPAREN_CODE?e={type:Ke.CALL_EXP,arguments:this.gobbleArguments(Ke.CPAREN_CODE),callee:e}:(t===Ke.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:Ke.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;Ke.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===Ke.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);Ke.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));Ke.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);Ke.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,Ke.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===Ke.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===Ke.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Ke.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=n}else e+=n}return r||this.throwError('Unclosed quote after "'+e+'"'),{type:Ke.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(Ke.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,Ke.isIdentifierPart(e));)this.index++;return{type:Ke.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===e){i=!0,this.index++,e===Ke.CPAREN_CODE&&r&&r>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(n===Ke.COMMA_CODE){if(this.index++,r++,r!==t.length){if(e===Ke.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===Ke.CBRACK_CODE)for(let s=t.length;s<r;s++)t.push(null)}}else if(t.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===Ke.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(Ke.CPAREN_CODE);if(this.code===Ke.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:Ke.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Ke.ARRAY_EXP,elements:this.gobbleArguments(Ke.CBRACK_CODE)}}},GUe=new zUe;Object.assign(Ke,{hooks:GUe,plugins:new VUe(Ke),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Ke.max_unop_len=Ke.getMaxKeyLen(Ke.unary_ops);Ke.max_binop_len=Ke.getMaxKeyLen(Ke.binary_ops);var A0=e=>new Ke(e).parse(),HUe=Object.getOwnPropertyNames(Ke);HUe.forEach(e=>{A0[e]===void 0&&e!=="prototype"&&(A0[e]=Ke[e])});A0.Jsep=Ke;var jUe="ConditionalExpression",WUe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:jUe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};A0.plugins.register(WUe);function kT(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var Ute=class{constructor(e,t,i){var r;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=kT(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await JUe(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=t==null?void 0:t.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=hw(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?hw(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Dn.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Dn.zoom(this.result,e):this.result;if(QUe(t))return Object.entries(t);if(qUe(t))return t.map((i,r)=>[r.toString(),i]);throw YUe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function XUe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function YUe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function qUe(e){return Array.isArray(e)}function QUe(e){return typeof e=="object"&&e!==null}async function JUe(e,t,i=new AbortController){var l,c,u,h;let r,n=e.url,s=((l=e.proxy)==null?void 0:l.enabled)??!1,a;if(((c=e.integration)==null?void 0:c.type)==="OpenAI"){let d=U1(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),p=e.integration.behavior===""?[]:U1(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${p}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let d;a!==void 0?d=a:e.method==="POST"&&e.body&&(d=U1(JSON.parse(e.body),t)),d!==void 0&&(n+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((u=e.integration)==null?void 0:u.type)==="OpenAI"?r=a:e.method==="POST"&&e.body&&(r=U1(JSON.parse(e.body),t));let o=await fetch(n,{method:s?"GET":e.method,headers:s?void 0:XUe(e),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((h=e.integration)==null?void 0:h.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var kte=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return kte(i,t)}return ms.isBoolean(e)?ms.getDisplayedValue(e).toLowerCase():ms.getDisplayedValue(e)},U1=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+U1(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return kte(n,t)}}return""}).join(""),KUe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],ZUe=["0","1","2","3","4","5","6","7","8","9","."],$Ue=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function eke(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}A0.addBinaryOp("^",11,!0);function zte(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=t.getUserAPI(c);if(u!==void 0&&u instanceof Ute){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=t.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(t.scene.data.objects.traverse((u,h)=>{var p;let d=(p=h.events)==null?void 0:p.find(f=>f.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(u!==void 0){r+=u;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=ms.getDisplayedValue(c);i==="number"&&ms.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&ms.isBoolean(c)?u=c?"true":"false":i==="boolean"&&ms.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!eke(o.name)&&!ZUe.includes(o.name)&&!KUe.includes(o.name)&&!$Ue.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=A0(r)}catch(a){console.error(r,a);return}let s;try{s=Bi(n)}catch(a){console.error(r,n,a)}return s}function Bi(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(Bi(e.left)===Bi(e.right));case"!=":return+(Bi(e.left)!==Bi(e.right));case">":return+(Bi(e.left)>Bi(e.right));case">=":return+(Bi(e.left)>=Bi(e.right));case"<":return+(Bi(e.left)<Bi(e.right));case"<=":return+(Bi(e.left)<=Bi(e.right));case"+":return Bi(e.left)+Bi(e.right);case"-":return Bi(e.left)-Bi(e.right);case"*":return Bi(e.left)*Bi(e.right);case"/":return Bi(e.left)/Bi(e.right);case"%":return Bi(e.left)%Bi(e.right);case"&&":return Bi(e.left)&&Bi(e.right);case"||":return Bi(e.left)||Bi(e.right);case"^":return Math.pow(Bi(e.left),Bi(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-Bi(e.argument);case"!":return+!Bi(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=Bi(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=Bi(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(Bi))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var tke=new ot,ike=new ot;function rke(e,t,i){let r=[new F,new F,new F],n=[new F,new F,new F];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=St.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new ot().makeBasis(r[0],r[1],r[2])}var nke=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??ck.create({parameters:lte}).userData.shape;return{path:e.path??rC.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...cte,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new ske(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Ot,{userData:{...e,type:"PathGeometry"}})}},ske=class extends Ot{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!RUe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let Y=0;Y<o;Y++){let U=this.inputs.path.isClosed?(Y+s)%e.length:Math.min(Y+s,e.length-1);l.push(e[U].clone()),c.push(t[U].clone())}let u=(Y,U,j)=>{l[Y]=l[Y].clone().lerp(l[U],j),c[Y]=rke(c[Y],c[U],j)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let p=0,f=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,u(l.length-1,l.length-2,1-p)),i===0){let Y=l.length-1;l[Y].copy(l[0]),c[Y].copy(c[0])}this._applyPathModifiers(c,h,p);let{bevel:g,bevelSides:m}=this.inputs.parameters.extrusion,v=g>0?this.inputs.parameters.extrusion.capType:"flat",x=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(x=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:y,infos:_,vertices:A}=this._computeShapePoints(x),S=0,C;v==="round"&&(C=new lk(this.inputs.shapeData,2*g,g,x,m,void 0,!0),S=C.getAttribute("position").count);let M=0,E=0;_.sort((Y,U)=>Y.start-U.start),_.forEach(Y=>{Y.verticesStart=M,Y.verticesCount=Y.continuous.reduce((U,j,k)=>U+(k===0||!j?2:1),0),E+=Y.verticesCount,M=E});let P=E*o,R,O=0;if(this._isOpenEnded()&&v==="flat"){try{R=vd({windingRule:$i.ODD,elementType:mn.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:y})}catch{R=Cte}O=R.vertexCount}let L=P+2*O+S*2,I=P+2*O,z={positions:new Float32Array(L*3),normals:new Float32Array(L*3),uvs:new Float32Array(L*2)},K=[];if(_.forEach(Y=>{this._extrudeRegion(Y,A,c,l,z,K,this._isGeometryClosed()&&!this._isOpenEnded())}),R&&(this._closeEnd(R,P,K,z,c[0],l[0],!1),this._closeEnd(R,P+O,K,z,c[c.length-1],l[l.length-1],!0)),C){z.positions.set(C.getAttribute("position").array,I*3),z.normals.set(C.getAttribute("normal").array,I*3),z.uvs.set(C.getAttribute("uv").array,I*2);for(let k=I;k<I+S;k++)z.uvs[k*2+1]=1e-4;let Y=K.length;K.push(...C.getIndex().array.map(k=>k+I)),I+=S,z.positions.set(C.getAttribute("position").array,I*3),z.normals.set(C.getAttribute("normal").array,I*3),z.uvs.set(C.getAttribute("uv").array,I*2);let U=K.length;K.push(...C.getIndex().array.map(k=>k+I)),this.setAttribute("position",new Wt(z.positions,3)),this.setAttribute("normal",new Wt(z.normals,3)),this.setAttribute("uv",new Wt(z.uvs,2)),this.setIndex(K);let j=tke;j.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(j,I,L),j.copy(c[0]).setPosition(l[0]).multiply(ike.makeScale(1,1,-1)),this.applyMatrix4OnRange(j,I-S,I),this.reverseIndicesOnRange(Y,U)}else this.setAttribute("position",new Wt(z.positions,3)),this.setAttribute("normal",new Wt(z.normals,3)),this.setAttribute("uv",new Wt(z.uvs,2)),this.setIndex(K)}_extractPathPoints(){let e=yte(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new F,s=new F,a=new F,o=new F,l=new F(0,1,0);for(let f=0;f<i;f++){let g=e[f],m;f===0?m=r?e[e.length-2]:g.clone().multiplyScalar(2).sub(e[1]):m=e[f-1];let v;f===i-1?v=r?e[1]:g.clone().multiplyScalar(2).sub(e[f-1]):v=e[f+1];let x=g.clone().sub(m).normalize(),y=v.clone().sub(g).normalize(),_=x.clone().add(y).normalize();a.copy(_),f===0&&(_.equals(l)||_.clone().negate().equals(l))&&l.set(0,0,1);let A=l.clone().cross(_).normalize(),S=_.clone().cross(A).normalize();l.copy(S),o.copy(A),f===0&&(n.copy(S),s.copy(_));let C=new ot().makeBasis(A,S,_);t.push(C)}let c=r?s:a,u=r?n:new F(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let p=u.clone().cross(h);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let g=new ot().makeRotationZ(d*f/t.length);t[f].multiply(g)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new ot,c=new ot;return e.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(St.lerp(n,n+s,d)*St.DEG2RAD);let p=St.lerp(a,o,d);c.makeScale(p,p,p),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=$i.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],f=u[d-0];h.push(p,f)}return h}),s;try{s=vd({windingRule:t,elementType:mn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=ok}let a;try{a=vd({windingRule:$i.ODD,elementType:mn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=Ete}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],p=s.elements[h+1],f=d+p,g={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(g);let m=d,v=f-1,x=d+1,y=i.roundedCurves.length;do{let _=m-d;s.vertices[v*2+0],s.vertices[v*2+1];let A=s.vertices[m*2+0],S=s.vertices[m*2+1],C=s.vertices[x*2+0],M=s.vertices[x*2+1],E=A-C,P=S-M,R=Math.sqrt(E*E+P*P);E/=R,P/=R,g.normals[_*2+0]=-P,g.normals[_*2+1]=E;let O=s.vertexIndices[m];if(Array.isArray(O))g.continuous[_]=!1;else{let[L,I]=i.getCurveIndexFromVertexId(O-1,!0);if(I>0&&I<1)g.continuous[_]=!0;else{let z=I===1?L+1:L-1;z=(z+y)%y;let K=I===1?0:1,Y=i.roundedCurves[L].getTangent(I),U=i.roundedCurves[z].getTangent(K);g.continuous[_]=Y.dot(U)>.95}}u&&(g.normals[_*2+0]*=-1,g.normals[_*2+1]*=-1),[v,m,x]=[m,x,x+1],x>=f&&(x-=p)}while(x!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new F,l=new F,c=new F,u=new F,h=new pe;i.forEach((p,f)=>{let g=r[f],m=e.verticesStart*i.length+e.verticesCount*f;for(let v=0;v<e.count;v++){let x=(e.start+v)*2;if(o.set(t[x+0],t[x+1],0),c.copy(o).applyMatrix4(p).add(g),e.continuous[v])u.set(e.normals[v*2+0],e.normals[v*2+1],0);else{let y=v===0?(e.start+e.count-1)*2:x-2;l.set(t[y+0],t[y+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),h.set(v===0?1:v/e.count,f/(i.length-1)),this._insertVertex(n,m,c,u,h),m++,!e.continuous[v]||v===0){if(v===0)u.set(e.normals[v*2+0],e.normals[v*2+1],0),h.set(0,f/(i.length-1));else{let y=v===e.count-1?e.start*2:x+2;l.set(t[y+0],t[y+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(n,m,c,u,h),m++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,g=e.verticesStart*i.length+e.verticesCount*(p+1),m=0;for(let v=0;v<e.count;v++){(!e.continuous[v]||v===0)&&m++;let x=v===e.count-1?0:m+1,y=f+m,_=f+x,A=g+x,S=g+m;e.isHole?s.push(y,A,_,y,S,A):s.push(y,_,A,y,A,S),m++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new F(0,0,a?-1:1).applyMatrix4(n),c=new F,u=new pe;for(let d=0;d<o;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,f=h[p+0]+t,g=h[p+(a?1:2)]+t,m=h[p+(a?2:1)]+t;i.push(f,g,m)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new gn().getNormalMatrix(e).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,p=c.itemSize;for(let f=t*p,g=i*p;f<g;f+=p){if(f===t)debugger;s=h[f+0],a=h[f+1],o=h[f+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[f+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[f+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[f+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[f+0],a=d[f+1],o=d[f+2],d[f+0]=n[0]*s+n[3]*a+n[6]*o,d[f+1]=n[1]*s+n[4]*a+n[7]*o,d[f+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function Vte(){let e=new Ot;return e.setAttribute("position",new Wt(new Float32Array([]),3)),e.setIndex(new Wt(new Uint16Array([]),1)),e}var ake=Vte().attributes,oke=12,lke=1,aB=class extends Ot{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,ake),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=ms.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=cke(e,t,u),{shapes:d,charWidths:p,charCoords:f}=t.generateShapes(h,e),g=(typeof i=="number"?i:1)*.5,m=(typeof r=="number"?r:1)*.5,v=d.map(_=>new Xr().fromShape(_,!0));this.vectorShapes=v;let x=v.map(_=>Sm.create({shape:_,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?$i.NONZERO:$i.ODD,subdivisions:this.isLowResolution&&n>0?lke:oke}})),y=x.length?Mf(x):Vte();y.translate(-g,m,0),this.dispose(),this.wrappedText=h,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach(([_,A])=>{this.setAttribute(_,A)}),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=Xo(new Ot,aB.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function cke(e,t,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var Gte,Hte=new Promise(e=>{Gte=e}),q8=!1,SA;function uke(){if(q8)return;if(SA)return SA;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.59/build",i=ap(()=>import("./process-0cd968c5.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});Gte(a),q8=!0}return SA=e(),SA}var hke=["font"];function _w(e,t,i,r){var c,u;let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let h of a){let d=s;for(let p of h)d=d[p];for(n in d){let p=d[n];KW(p)&&!hke.includes(n)&&(d[n]=t.getVariable(p,[r.uuid,"geometry",...h,n]),KW(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=Xr.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new G$().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new $s(s,i);return h.data=e,h}else{if(s.type==="TextGeometry")return new aB(s,t);if(s.type==="InputGeometry")return new aB(s,t);if(s.type==="UIGeometry")return uk.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=$8(o)}catch(h){console.error(h)}if(!l){let h=Xr.createFromState(iC.defaultData(),100,100);o.shape=h,l=$8(o)}return l}var dke=new ot;function oB(e,t,i,r){let n=e.position.array,s=e.normal.array,a=dke.makeScale(t,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=t,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var AA=new nn,Pg=new F,Yt;Hte.then(e=>{Yt=e});var Q8=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),J8=new Uint32Array([0,1,2,3]),K8=new Uint8Array([4]),$s=class extends Ot{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=kf.div(t,i);this.subdividedGeometry&&oB(this.subdividedGeometry.attributes,...r),this.originalGeometry&&oB(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(Pg.fromArray(r));let s=Pg.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=$s.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Fl(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&($s.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Oa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;AA.setFromBufferAttribute(t),AA.getCenter(i),e.boundingSphere.radius=i.distanceTo(AA.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),AA.getSize(Pg);let r={width:Pg.x,height:Pg.y,depth:Pg.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(Yt.free_bvh(t),Yt.free_subdivision_surface(t));try{n=$s.allocate(e,r)}catch(l){console.error(l,e),n=$s.allocate({positionWASM:Q8,indexWASM:J8,verticesPerFaceWASM:K8},r)}if(Yt.set_destination_refinement_level(n,0),s=$s.buildLevel(n,!0,o),e.subdivisions>0)try{Yt.set_destination_refinement_level(n,e.subdivisions),a=$s.buildLevel(n,!1,o)}catch{try{Yt.set_destination_refinement_level(n,e.subdivisions-1),a=$s.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:_w(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=zT(r.getAttribute("position"),n));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=jte(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var y;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=Q8,r=J8,n=K8);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,f=Yt._malloc(d),g=new Float32Array(Yt.HEAPF32.buffer,f,u),m=new Uint32Array(Yt.HEAPU32.buffer,f+p,h);g.set(i,0),g.set(s,i.length),g.set(a,i.length+s.length),m.set(r,0),m.set(n,r.length);let v;(y=e==null?void 0:e.scaleBaked)!=null&&y.some(_=>_!==1)&&(v=new ot().makeScale(...e.scaleBaked)),t&&(v?v.premultiply(t):v=t);let x=v?Yt.alloc_subdivision_surface2(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,v.elements):Yt.alloc_subdivision_surface(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return Yt._free(f),x}static buildLevel(e,t,i,r,n){let s=n?Yt.get_mesh_data2(e,t?Yt.Level.CONTROL:Yt.Level.REFINED,i,n.elements):Yt.get_mesh_data(e,t?Yt.Level.CONTROL:Yt.Level.REFINED,i),a=8,o=Yt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,4+4),c=0,u=Yt.HEAPU32[o[c]>>2],h=Yt.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Yt.HEAPU32[o[c]>>2],p=Yt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=Yt.HEAPU32[o[c]>>2],g=Yt.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let m=Yt.HEAPU32[o[c]>>2],v=Yt.HEAPU32.subarray(m>>2,(m>>2)+l[c]);if(c++,r===void 0){let x=new Ot;if(x.setIndex(new Bv(v,1)),x.setAttribute("position",new xt(h,3)),x.setAttribute("normal",new xt(p,3)),t){x.setAttribute("faceMap",new Bv(g,1));let y=new Float32Array(p.length/3*4).fill(0);x.setAttribute("color",new Wt(y,4))}return Yt.free_mesh_data(s),x.userData.type="SubdivGeometry",x}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Yt.free_mesh_data(s)}static freeSubdivPointer(e){Yt.free_bvh(e),Yt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=Yt.get_wireframe_data_for_base_level(e),n=4,s=Yt.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,2+2),o=0,l=Yt.HEAPU32[s[o]>>2],c=Yt.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=Yt.HEAPU32[s[o]>>2],h=Yt.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(t===void 0){let d=new Ot;d.setAttribute("position",new xt(c,3));let p=new Float32Array(c.length);for(let f=0,g=c.length;f<g;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new Wt(p,3)),d.setIndex(new Bv(h,1)),Yt.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,Yt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||Yt.set_destination_refinement_level(e,t);let n=i?Yt.get_topological_data2(e,r?Yt.Level.CONTROL:Yt.Level.REFINED,i.elements):Yt.get_topological_data(e,r?Yt.Level.CONTROL:Yt.Level.REFINED),s=6,a=Yt.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,3+3),l=0,c=Yt.HEAPU32[a[l]>>2],u=new Float32Array(Yt.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=Yt.HEAPU32[a[l]>>2],d=new Uint32Array(Yt.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=Yt.HEAPU32[a[l]>>2],f=new Uint8Array(Yt.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return Yt.free_topological_data(n),{positions:u,indices:d,verticesPerFace:f}}},Z8=["getX","getY","getZ"];function zT(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[Z8[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[Z8[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var MA=new F,WR=new F,XR=new F,YR=new F;function jte(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,f)=>Math.floor(f/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){MA.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),WR.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),XR.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),YR.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),WR.sub(MA).normalize(),XR.sub(MA).normalize(),YR.sub(MA).normalize();let l=WR.cross(XR).dot(YR);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var _u={};rbe(_u,{calcBoolean:()=>vke,calcBooleanTopological:()=>gke,freeMeshSet:()=>bke,getMeshSet:()=>yke,hasOpenEdges:()=>xke,transformMeshSet:()=>wke});var Wte,pke=new Promise(e=>{Wte=e}),EA;function fke(){if(EA)return EA;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.59/build",i=ap(()=>import("./boolean-f0a11cc6.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});Wte(a)}return EA=e(),EA}var Mi,Gv;pke.then(e=>Mi=e);function mke(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=zT(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:c}=jte(s,a,e);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function Xte(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=Mi._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(Mi.HEAPU32.buffer,s,t):new Float32Array(Mi.HEAPF32.buffer,s,t)).set(e,0),s}function Yte(e){switch(e){case 0:return Mi.OP.UNION;case 1:return Mi.OP.INTERSECTION;case 2:return Mi.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function gke(e,t){Gv===void 0&&(Gv=Mi.init_csg());let i=Xte(e),r=Mi.csg_calc_topological(Gv,i,e.length,Yte(t));Mi._free(i);let n=6,s=Mi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,3+3),o=0,l=Mi.HEAPU32[s[o]>>2],c=new Float32Array(Mi.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=Mi.HEAPU32[s[o]>>2],h=new Uint32Array(Mi.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=Mi.HEAPU32[s[o]>>2],p=new Uint8Array(Mi.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Mi.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:p}}function vke(e,t,i,r){Gv===void 0&&(Gv=Mi.init_csg());let n=Xte(e),s=Mi.csg_calc(Gv,n,e.length,r,Yte(t));Mi._free(n);let a=5,o=Mi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,2+3),c=0,u=Mi.HEAPU32[o[c]>>2],h=Mi.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Mi.HEAPU32[o[c]>>2],p=Mi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new xt(h,3)),i.setAttribute("normal",new xt(p,3));let g=Mi.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Oa),i.boundingSphere.center.set(g[0],g[1],g[2]),i.boundingSphere.radius=(g[3]**2+g[4]**2+g[5]**2)**.5,i.userData.parameters={width:g[3]*2,height:g[4]*2,depth:g[5]*2},Mi.free_mesh_data(s),f}function yke(e,t,i){if(Mi===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let m=e.userData;s=m.verticesPerFace.length,r=m.positions,n=Array(m.verticesPerFace.reduce((v,x)=>v+x,0)+s);for(let v=0,x=0,y=0;v<m.verticesPerFace.length;v++){n[y++]=m.verticesPerFace[v];for(let _=0;_<m.verticesPerFace[v];_++)n[y++]=m.indices[x++]}}else({positions:r,faceIndices:n,nFaces:s}=mke(e,t,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Mi._malloc(u),p=new Float32Array(Mi.HEAPF32.buffer,d,l),f=new Uint32Array(Mi.HEAPU32.buffer,d+h,c);p.set(r,0),f.set(n,0);let g=Mi.get_csg_mesh(d,a,d+h,o,s);return Mi._free(d),g}function xke(e){return Mi.has_open_edges(e)}function wke(e,t){Mi.transform_csg_mesh(e,t.elements)}function bke(e){Mi.free_csg_mesh(e)}var _ke={ConeGeometry:ANe,CubeGeometry:MNe,CylinderGeometry:xte,DodecahedronGeometry:CNe,EllipseGeometry:ck,HelixGeometry:cUe,IcosahedronGeometry:uUe,LatheGeometry:hUe,NonParametricGeometry:yUe,PolygonGeometry:Fte,PyramidGeometry:xUe,RectangleGeometry:uk,SphereGeometry:_Ue,PlaneGeometry:SUe,BackdropGeometry:AUe,StarGeometry:Nte,TextFrameGeometry:EUe,TorusGeometry:CUe,TorusKnotGeometry:PUe,TriangleGeometry:DUe,PathGeometry:nke,VectorGeometry:Sm},$8=e=>_ke[e.type].create(e);function Dg(e){return e!==null&&"booleanOp"in e}var qte=class extends rk(cr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new ot}updateVisible(e){super.updateVisible(e),this.visible=!Dg(this.parent)&&this.visible,Dg(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(_u.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Dg(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof qte&&(e.freeBooleanPointer(),Dg(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&Dg(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),Dg(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},CA=new nn;function hk(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),p=e.getY(h),f=e.getZ(h);d<s&&(s=d),p<a&&(a=p),f<o&&(o=f),d>l&&(l=d),p>c&&(c=p),f>u&&(u=f)}CA.min.set(s,a,o),CA.max.set(l,c,u),CA.getCenter(r),CA.getSize(n).multiplyScalar(.5)}var Ske=new Ot,Ake=new sh,la=class extends qte{constructor(e,t){super(Ske,Ake),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?hk(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},ed=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},ed.uuidContext===null)throw new Error("plz startContext");ed.uuidContext===ed.globalContext?this.uuid="_gid"+ed.uuidContext.nodeContextUuid++:this.uuid="_uid"+ed.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===ed.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},Tn=ed;Tn.globalContext={nodeContextUuid:0},Tn.uuidContext=ed.globalContext;var e9=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},Mke=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Ma=new Mke,ir=class extends Tn{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=St.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},Ba=class extends ir{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},cs=class extends Ba{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof pe?e:new pe(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},Eo=class extends Ba{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof F?e:new F(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},ys=class extends jt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Su=class extends Ba{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof ys?e:new ys(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},Eke=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,t9=/[a-z_0-9]+/gi,yt=class extends ir{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=t9.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,p=h;if(this.keywords[h]||this.useKeywords&&d&&Ma.containsKeyword(h)){let f=this.keywords[h];if(!f){let g=Ma.getKeywordData(h);g.cache&&(f=e.keywords[h]),f=f||Ma.getKeyword(h,e),g.cache&&(e.keywords[h]=f)}p=f.build(e)}h!==p&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+p+o.substring(u.index+h.length+a),a+=p.length-h.length),this.getIncludeByName(p)===void 0&&Ma.contains(p)&&e.include(Ma.get(p))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=Eke.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(t9);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},Cke=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Qte=class extends ir{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||Qte.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=Cke.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},Yi=Qte;Yi.PI="PI",Yi.PI2="PI2",Yi.RECIPROCAL_PI="RECIPROCAL_PI",Yi.RECIPROCAL_PI2="RECIPROCAL_PI2",Yi.LOG2="LOG2",Yi.EPSILON="EPSILON";var Tke=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),Pke=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Jte=class extends ir{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=Tke.exec(e);if(t){let i=t[2],r;for(;r=Pke.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},dk=class extends ir{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};Ma.addKeyword("uv",function(){return new dk});Ma.addKeyword("uv2",function(){return new dk(1)});var Yg=class extends ir{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Yg.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Bl:return["Linear"];case ci:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=Yg.Nodes[this.method],s=e.include(n);if(s===Yg.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Yg.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Yg.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Ac=Yg;Ac.Nodes={LinearToLinear:new yt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new yt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new yt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Ac.LINEAR_TO_LINEAR="LinearToLinear",Ac.SRGB_TO_LINEAR="sRGBToLinear",Ac.LINEAR_TO_SRGB="LinearTosRGB";var dr=class extends yt{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},Iu=class extends Ba{constructor(e=new Br,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new dk,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Ac(new dr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Mt=class extends Ba{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},i9=class extends ir{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},Kte=class extends ir{constructor(e,t,i=Kte.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},ya=Kte;ya.ADD="+",ya.SUB="-",ya.MUL="*",ya.DIV="/";var Ji=class extends ir{constructor(e,t=Ji.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Ji.MIX:case Ji.CLAMP:case Ji.REFRACT:case Ji.SMOOTHSTEP:case Ji.FACEFORWARD:return 3;case Ji.MIN:case Ji.MAX:case Ji.MOD:case Ji.STEP:case Ji.REFLECT:case Ji.DISTANCE:case Ji.DOT:case Ji.CROSS:case Ji.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Ji.LENGTH:case Ji.DISTANCE:case Ji.DOT:return"f";case Ji.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case Ji.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Ji.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Ji.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Ji.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case Ji.MIN:case Ji.MAX:case Ji.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case Ji.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case Ji.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},oi=Ji;oi.RAD="radians",oi.DEG="degrees",oi.EXP="exp",oi.EXP2="exp2",oi.LOG="log",oi.LOG2="log2",oi.SQRT="sqrt",oi.INV_SQRT="inversesqrt",oi.FLOOR="floor",oi.CEIL="ceil",oi.NORMALIZE="normalize",oi.FRACT="fract",oi.SATURATE="saturate",oi.SIN="sin",oi.COS="cos",oi.TAN="tan",oi.ASIN="asin",oi.ACOS="acos",oi.ARCTAN="atan",oi.ABS="abs",oi.SIGN="sign",oi.LENGTH="length",oi.NEGATE="negate",oi.INVERT="invert",oi.MIN="min",oi.MAX="max",oi.MOD="mod",oi.STEP="step",oi.REFLECT="reflect",oi.DISTANCE="distance",oi.DOT="dot",oi.CROSS="cross",oi.POW="pow",oi.MIX="mix",oi.CLAMP="clamp",oi.REFRACT="refract",oi.SMOOTHSTEP="smoothstep",oi.FACEFORWARD="faceforward";var k1=class extends ir{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new i9(k1.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Ac(new dr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Ac(new dr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Ac(new dr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Ac(new dr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new dr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new dr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new dr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new dr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new dr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new i9(k1.Nodes.roughnessToMip,[r]),s=new oi(n,k1.Nodes.m0,k1.Nodes.cubeUV_maxMipLevel,oi.CLAMP),a=new oi(s,oi.FLOOR),o=new oi(s,oi.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new ya(a,new Mt(1).setReadonly(!0),ya.ADD)),u=new oi(l,c,o,oi.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},lB=k1;lB.Nodes=function(){let e=new Jte(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Yi("float cubeUV_maxMipLevel 8.0",!0),i=new Yi("float cubeUV_minMipLevel 4.0",!0),r=new Yi("float cubeUV_maxTileSize 256.0",!0),n=new Yi("float cubeUV_minTileSize 16.0",!0),s=new yt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new yt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new yt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new Yi("float r0 1.0",!0),c=new Yi("float v0 0.339",!0),u=new Yi("float m0 -2.0",!0),h=new Yi("float r1 0.8",!0),d=new Yi("float v1 0.276",!0),p=new Yi("float m1 -1.0",!0),f=new Yi("float r4 0.4",!0),g=new Yi("float v4 0.046",!0),m=new Yi("float m4 2.0",!0),v=new Yi("float r5 0.305",!0),x=new Yi("float v5 0.016",!0),y=new Yi("float m5 3.0",!0),_=new Yi("float r6 0.21",!0),A=new Yi("float v6 0.0038",!0),S=new Yi("float m6 4.0",!0),C=[l,c,u,h,d,p,f,g,m,v,x,y,_,A,S],M=new yt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,C);return{bilinearCubeUV:o,roughnessToMip:M,m0:u,cubeUV_maxMipLevel:t}}();var qg=class extends ir{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??qg.VIEW}getShared(){return this.scope===qg.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case qg.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case qg.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case qg.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},Ca=qg;Ca.LOCAL="local",Ca.WORLD="world",Ca.VIEW="view",Ca.NORMAL="normal";Ma.addKeyword("viewNormal",function(){return new Ca(Ca.VIEW)});Ma.addKeyword("localNormal",function(){return new Ca(Ca.NORMAL)});Ma.addKeyword("worldNormal",function(){return new Ca(Ca.WORLD)});var yu=class extends ir{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??yu.LOCAL}getType(){switch(this.scope){case yu.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case yu.LOCAL:case yu.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case yu.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case yu.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case yu.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case yu.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},Sl=yu;Sl.LOCAL="local",Sl.WORLD="world",Sl.VIEW="view",Sl.PROJECTION="projection";Ma.addKeyword("position",function(){return new Sl});Ma.addKeyword("worldPosition",function(){return new Sl(Sl.WORLD)});Ma.addKeyword("viewPosition",function(){return new Sl(Sl.VIEW)});var hc=class extends ir{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??hc.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case hc.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case hc.VECTOR:{let n=new Ca(Ca.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new Sl(Sl.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case hc.CUBE:{let n=new hc(hc.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case hc.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new hc(hc.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Hv=hc;Hv.CUBE="cube",Hv.SPHERE="sphere",Hv.VECTOR="vector";var Dke=class extends ir{constructor(e=new Iu,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new lB(this.value,t??new Hv(Hv.VECTOR),i),this.irradianceNode=new lB(this.value,new Ca(Ca.WORLD),new Mt(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},Rke=class extends Ba{constructor(e=new mU,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Hv,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Ac(new dr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},Ike=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,Lke=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,Oke=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,Bke=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,Fke=`
layout(location = 1) out vec4 gVelocity;
`,Nke=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,r9=["x","y","z","w"],Uke=["float","vec2","vec3","vec4"],kke={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},zke={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Zte=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(Ike),this.addFragmentParsCode(Lke),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(Oke),this.addFragmentFinalCode(Bke)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof Tn?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new e9({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new e9({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?Ma.get(e):e,this.context.include===!1)return e.name;e instanceof yt?r=this.includes.functions:e instanceof Yi?r=this.includes.consts:e instanceof Jte&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof yt&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return Uke[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case em:case tm:return new Rke(i);case nb:return new Dke(new Iu(i));default:return new Iu(i)}else{if(i.isVector2)return new cs(i);if(i.isVector3)return new Eo(i);if(i.isVector4)return new Su(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return kke[e]||e}getFormatByType(e){return zke[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return r9[e]}getIndexByElement(e){return r9.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Bl,t===Bl&&this.context.gamma&&(t=ci),t}},Yr=class extends Ba{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof ys?e:new ys(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},nr=class extends Ba{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},ea=class extends Ba{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Kp=class extends Ba{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},pk=class extends Ba{},Vke=class extends pk{constructor(e){super("v3"),this.image=e,this._value=new F}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},cB=class extends pk{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},$te=class extends Ba{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new gn}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Hc=class extends Ba{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new ot}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function n9(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new gn().makeRotation(r*St.DEG2RAD))}var Gke=class extends $te{constructor(e,t,i=0){super(new gn),this.repeat=e,this.offset=t,this.rotation=i,n9(this.value,e,t,i)}updateMatrix(){n9(this.value,this.repeat,this.offset,this.rotation)}},Zp=class extends Ba{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof ii?new Array(e).fill(t):new Array(e).fill(new ii(0))}},s9=class extends ir{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},eie=class extends ir{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(eie.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},uB=eie;uB.Nodes=function(){return{customColor:new yt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var tie=class extends ir{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(tie.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},iie=tie;iie.Nodes=function(){return{customNormal:new yt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var z1=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(z1.Nodes.cylindrical);break;case 2:r=e.include(z1.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new yt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(z1.Nodes.triplanar);break;default:r=e.include(z1.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},fk=z1;fk.Nodes=function(){let e=new yt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new yt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new yt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new yt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var V1=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new yt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[V1.Nodes.vectorLinearWorldSpaceDepth,V1.Nodes.vectorLinearObjectSpaceDepth,V1.Nodes.vectorSphericalObjectSpaceDepth,V1.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},rie=V1;rie.Nodes=function(){let e=new yt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new yt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new yt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new yt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var Hke=class extends ir{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new yt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},nie=class extends ir{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(nie.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},sie=nie;sie.Nodes=function(){return{gradient:new yt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var aie=class extends ir{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(aie.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},oie=aie;oie.Nodes=function(){return{matcap:new yt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var _a=function(){let e=new yt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new yt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Yi("float F3 0.3333333"),t.keywords.G3=new Yi("float G3 0.1666667");let i=new yt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new Yi("float F3 0.3333333"),i.keywords.G3=new Yi("float G3 0.1666667");let r=new yt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),n=new yt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new yt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new yt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new yt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new yt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new yt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new yt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new Yi("int NUM_OCTAVES 5");let h=new yt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new yt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),p=new yt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),f=new yt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),g=new yt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new yt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),v=new yt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),x=new yt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),y=new yt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[p,f,g,m,v,x]);return{simplexFast:t,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:u,perlin:d,voronoi:y}}(),lie=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,g,m,v,x){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=p,this.highCut=f,this.lowCut=g,this.smoothness=m,this.seed=v,this.quality=x,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new yt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[_a.simplexFast,_a.simplexFractal,_a.simplexAshima,_a.fbm,_a.perlin,_a.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};lie.numOctaves=5;var cie=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(cie.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},uie=cie;uie.Nodes=function(){let e=new yt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new yt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var xu=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,g,m,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=g,this.isMask=v,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new yt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new yt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new yt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,xu.DrawFunctions.circle,xu.DrawFunctions.ring,xu.DrawFunctions.polygon,xu.DrawFunctions.cross,xu.DrawFunctions.diamond,xu.DrawFunctions.checkerboard,xu.DrawFunctions.line,xu.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},hie=xu;hie.DrawFunctions=function(){let e=new yt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new yt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new yt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new yt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new yt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new yt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new yt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new yt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new yt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new yt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var die=class extends ir{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(die.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pie=die;pie.Nodes=function(){let e=new yt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[_a.simplexFast]);return{rainbow:new yt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}}();var fie=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(fie.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mie=fie;mie.Nodes=function(){let e=new yt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new yt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new yt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new yt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new yt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new yt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[_a.simplexFast,e,i,n])}}();var jke=function(){return{textureBicubic:new yt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function Wke(e,t){return e>=t?new pe(t/e,1):new pe(1,e/t)}var gie=class extends ir{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,qt.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(gie.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},vie=gie;vie.Nodes=function(){let e=new yt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new yt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new yt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new yt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[jke.textureBicubic,i,e]),n=new yt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new yt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var hB=(e=>(e.NOISE="noise",e.MAP="map",e))(hB||{}),yie=class extends ir{constructor(e,t,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new nr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(hB)[this.displacementTypeIndex.value]==="map"&&(this.mat=new $te(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(hB)[this.displacementTypeIndex.value]){case"map":{i=e.include(yie.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new yt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new yt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[_a.simplexPrecise,_a.simplexFractal,_a.simplexAshima,_a.fbm,_a.perlin,_a.voronoi]),l=new yt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},xie=yie;xie.Nodes=function(){let e=new yt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new yt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new yt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var qt={normalRenderTarget:new Iu,normalRenderTargetDepth:new Iu,transmissionRenderTarget:new Iu,aspectRatio:new cs,transmissionSize:new cs(2048,2048),transmissionRenderTargetDepth:new Iu,aoRenderTarget:new Iu,aoEnabled:new ea,pixelRatioNode:new Mt(1),resolution:new cs,penumbraSize:new Kp(5,.5),frameIndex:new nr(0),transmissionLod:new nr(2)};for(let e of Object.values(qt))e.isRenderGlobal=!0;var wie={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.59/build/ui.wasm"},mk=class extends Tn{constructor(){super("basic"),this.nodeType="Basic",this.color=new Yr(io),this.shadingAlpha=new Mt(1),this.shadingBlend=new nr(0),this.previousModelViewMatrix=new Hc,this.previouseProjectionMatrix=new Hc}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(G0.merge([vt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new Yr(io)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},Xke=class extends Tn{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Yr(io),this.emissive=new Yr(0),this.emissiveIntensity=new Mt(1),this.previousModelViewMatrix=new Hc,this.previouseProjectionMatrix=new Hc,this.shadingAlpha=new Mt(1),this.shadingBlend=new nr(0),this.occlusion=new ea(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(G0.merge([vt.fog,vt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled}),this.color===void 0&&(this.color=new Yr(io)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},M0=function(){let e=new yt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new yt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),Yke=class extends Tn{constructor(){super("phong"),this.nodeType="Phong",this.color=new Yr(io),this.specular=new Yr(1118481),this.shininess=new Mt(30),this.previousModelViewMatrix=new Hc,this.previouseProjectionMatrix=new Hc,this.shadingAlpha=new Mt(1),this.shadingBlend=new nr(0),this.occlusion=new ea(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(G0.merge([vt.fog,vt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled}),this.color===void 0&&(this.color=new Yr(io)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(M0.dHdxy),e.include(M0.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${m}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},qke=class extends Tn{constructor(){super("standard"),this.nodeType="Standard",this.color=new Yr(io),this.roughness=new Mt(.3),this.metalness=new Mt(0),this.reflectivity=new Mt(.5),this.previousModelViewMatrix=new Hc,this.previouseProjectionMatrix=new Hc,this.shadingAlpha=new Mt(1),this.shadingBlend=new nr(0),this.occlusion=new ea(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(G0.merge([vt.fog,vt.lights])),vt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new Yr(io)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(M0.dHdxy),e.include(M0.perturbNormalArb);let g=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",x="";this.bumpMap.projection.value===4?x=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${g.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${g.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${g.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:x=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${g.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${x}
					`)}if(p.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let g=this.roughnessMap.texture.flow(e,"t"),m=this.roughnessMap.flow(e,"v3"),v="";this.roughnessMap.projection.value===4?v=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${g.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${g.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${g.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:v=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${g.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};

					const float roughnessScale = 1.0;

					${v}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");u&&p.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},Qke=class extends Tn{constructor(){super("toon"),this.nodeType="Toon",this.color=new Yr(io),this.specular=new Yr(1118481),this.shininess=new Mt(30),this.previousModelViewMatrix=new Hc,this.previouseProjectionMatrix=new Hc,this.shadingAlpha=new Mt(1),this.shadingBlend=new nr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({resolution:qt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(G0.merge([vt.fog,vt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:qt.penumbraSize}),e.mergeUniform({frameIndex:qt.frameIndex}),e.mergeUniform({aoMap:qt.aoRenderTarget}),e.mergeUniform({aoEnabled:qt.aoEnabled}),this.color===void 0&&(this.color=new Yr(io)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(M0.dHdxy),e.include(M0.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${f});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${f});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${f});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${f});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${g}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},Jke=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},Kke=class extends Jke{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},qR;function Zke(e){return typeof e=="string"?e:(qR||(qR=new Kke),qR.load(e))}var $ke=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},eze=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},bie=class extends $ke{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=Zke(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){var n,s;let r=(s=(n=this._cache[e])==null?void 0:n[t])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new yCe(this.img,void 0,e,e):a=new Br(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},ld=class extends bie{};function tze(e,t){var i=sze(t);return i.formatToParts?rze(i,e):nze(i,e)}var ize={year:0,month:1,day:2,hour:3,minute:4,second:5};function rze(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=ize[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function nze(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var QR={};function sze(e){if(!QR[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="06/25/2014 00:00:00";QR[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return QR[e]}function _ie(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var a9=36e5,aze=6e4,JR={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Sie(e,t,i){var r,n;if(!e||(r=JR.timezoneZ.exec(e),r))return 0;var s;if(r=JR.timezoneHH.exec(e),r)return s=parseInt(r[1],10),o9(s)?-(s*a9):NaN;if(r=JR.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return o9(s,a)?(n=Math.abs(s)*a9+a*aze,s>0?-n:n):NaN}if(cze(e)){t=new Date(t||Date.now());var o=i?t:oze(t),l=dB(o,e),c=i?l:lze(t,l,e);return-c}return NaN}function oze(e){return _ie(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function dB(e,t){var i=tze(e,t),r=_ie(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function lze(e,t,i){var r=e.getTime(),n=r-t,s=dB(new Date(n),i);if(t===s)return t;n-=s-t;var a=dB(new Date(n),i);return s===a?s:Math.max(s,a)}function o9(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var l9={};function cze(e){if(l9[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),l9[e]=!0,!0}catch{return!1}}var uze=lp(abe(),1),c9=lp(obe(),1),hze=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,dze=hze,KR=36e5,u9=6e4,pze=2,ta={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:dze};function fze(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i=t||{},r=i.additionalDigits==null?pze:(0,uze.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=mze(e),s=gze(n.date,r),a=s.year,o=s.restDateString,l=vze(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=yze(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=Sie(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,c9.default)(new Date(c+u)),h=(0,c9.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function mze(e){var t={},i=ta.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=ta.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=ta.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function gze(e,t){var i=ta.YYY[t],r=ta.YYYYY[t],n;if(n=ta.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=ta.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function vze(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=ta.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,d9(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=ta.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return bze(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=ta.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return d9(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=ta.Www.exec(e),i)return s=parseInt(i[1],10)-1,p9(t,s)?h9(t,s):new Date(NaN);if(i=ta.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return p9(t,s,l)?h9(t,s,l):new Date(NaN)}return null}function yze(e){var t,i,r;if(t=ta.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),ZR(i)?i%24*KR:NaN;if(t=ta.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),ZR(i,r)?i%24*KR+r*u9:NaN;if(t=ta.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return ZR(i,r,n)?i%24*KR+r*u9+n*1e3:NaN}return null}function h9(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var xze=[31,28,31,30,31,30,31,31,30,31,30,31],wze=[31,29,31,30,31,30,31,31,30,31,30,31];function Aie(e){return e%400===0||e%4===0&&e%100!==0}function d9(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=Aie(e);if(r&&i>wze[t]||!r&&i>xze[t])return!1}return!0}function bze(e,t){if(t<1)return!1;var i=Aie(e);return!(i&&t>366||!i&&t>365)}function p9(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function ZR(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function _ze(e,t,i){var r=fze(e,i),n=Sie(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function ra(e,t){return t.color(e)}function f9(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=_ze(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function Sze(e,t){switch(e.type){case"fresnel":return Eze(e,t);case"gradient":return Cze(e,t);case"depth":return Tze(e,t);case"normal":return Pze(e,t);case"noise":return Dze(e,t);case"rainbow":return Rze(e,t);case"toon":return Ize(e,t);case"outline":return Lze(e,t);case"transmission":return Oze(e,t);case"color":return Mze(e,t);case"pattern":return Bze(e,t)}}function Aze(e){return{type:e.type}}function Hl(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...Aze(e),alpha:s,mode:r,isMask:n}}function Mze(e,t){return{...Hl(e,t),color:ra(e.color,t)}}function Eze(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...Hl(e,t),color:ra(a,t),bias:i,scale:r,intensity:n,factor:s}}function Cze(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...Hl(e,t),gradientType:i,smooth:r,colors:n.map(c=>new ii(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new pe(...o),morph:new pe(...l),angle:a}}function Tze(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...Hl(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new F(...o),direction:l?new F(...l):new F(1,0,0),colors:c.map(d=>d!==void 0?new ii(d[0],d[1],d[2],d[3]):new ii(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function Pze(e,t){let{cnormal:i}=e;return{...Hl(e,t),cnormal:new F(i[0],i[1],i[2])}}function Dze(e,t){return{...Hl(e,t),scale:e.scale,move:e.move,fA:new pe(...e.fA),fB:new pe(...e.fB),size:new F(...e.size),distortion:new pe(...e.distortion),colorA:ra(e.colorA,t),colorB:ra(e.colorB,t),colorC:ra(e.colorC,t),colorD:ra(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function Rze(e,t){return{...Hl(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new F(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new F(...e.offset)}}function Ize(e,t){return{...Hl(e,t),positioning:e.positioning,colors:e.colors.map(i=>new ii(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new F(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:ra(e.shadowColor,t),offset:new F(...e.offset)}}function Lze(e,t){return{...Hl(e,t),outlineColor:ra(e.outlineColor,t),contourColor:ra(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new F(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function Oze(e,t){return{...Hl(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function Bze(e,t){return{...Hl(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new pe(...e.offset),colorA:ra(e.colorA,t),colorB:ra(e.colorB,t),frequency:new pe(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new pe(...e.vertical),horizontal:new pe(...e.horizontal),sides:e.sides}}var xC=class extends ys{},Fze={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},Nze={depth:["colors"]};function Uze(e,t,i){var s,a;if(t==="isMask")return!0;let r=Fze[e.type],n=Nze[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function Mie(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof ld||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof ld||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*St.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function kze(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(Cie(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof pk))switch(n=n||Uze(i,s,a),o.constructor){case Yr:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof xC?o.value=new ys(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Su:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof xC?o.value=new ys(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case cs:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Eo:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Iu:{Mie(a,t,i);break}case Zp:{o.value=a.map(l=>new ii(...l));break}default:{o.value=a;break}}}return n}var am=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,fb=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)Cie(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return fc.createLightLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new cB(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Vke(n),o=new Gke(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Mt(i.crop?1:0),c=new nr(i.projection??0),u=new nr(["x","y","z"].indexOf(i.axis)??0),h=new nr(i.side??0),d=new cs(i.size?new pe(i.size[0],i.size[1]):new pe(100,100)),p=new Mt(i.blending??0),f=new Mt(am(i.alpha,r)),g=new nr(i.mode??0),m=new ea(i.isMask??!1),v=new fk(s,a,l,c,u,h,d,p,o,f,g,m),x=new dr(v.calpha,"f");return new zr(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:p,mat:o,alpha:f,mode:g,isMask:m},v,g,x,m,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new cB(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Mt(am(i.alpha,r)),o=new nr(i.mode??0),l=new ea(i.isMask??!1),c=new Mt((i.texture.rotation??0)*St.DEG2RAD),u=new oie(s,a,o,l,c),h=new dr(u.calpha,"f");return new zr(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new Eo(new F(...i.offset)),s=new Mt(i.scale??10),a=new Mt(i.intensity??8),o=new Mt(i.movement??1),l=new nr(i.noiseType??0),c=new nr(i.voronoiStyle??0),u=new Mt(i.smoothness??.5),h=new Mt(i.seed??0),d=new Mt(i.highCut??1),p=new Mt(i.lowCut??0),f=new nr(i.quality??1),g=new xie(a,o,n,c,u,h,d,p,f,s,l);return new Eie(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:p,quality:f},g,r)}else throw new Error;else return Gze(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):kze(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?Mie(r.props,i.shared,this):!0;return!1}dispose(){if(zze(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof ld||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},zr=class extends fb{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},Eie=class extends fb{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},fc=class extends fb{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLightLayer(e,t,i,r){let n,s=new Mt(am(i.alpha,r)),a=new nr(i.mode),o=new Mt(i.bumpMapIntensity),l=new Mt(am(i.alphaOverride,r)),c;if(!i.visible)n=new mk,c={};else if(i.category==="lambert"){n=new Xke;let u=new Yr(r.color(i.emissive)??0),h=new ea(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new Qke;let u=new Mt(i.shininess??30),h=new Yr(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new qke;let u=new Mt(i.roughness??.3),h=new Mt(i.metalness??0),d=new Mt(i.reflectivity??.5),p=new ea(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:p},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=p}else{n=new Yke;let u=new Mt(i.shininess??30),h=new Yr(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new ea(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new Mt(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new fc(e,t,i,n,c,r)}get category(){return this.node.category}};function zze(e){let t=e instanceof fb?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function xo(e){return{alpha:new Mt(e.alpha??1),mode:new nr(e.mode??0),isMask:new ea(e.isMask??!1)}}function Vze(e,t,i,r,n){switch(e.type){case"color":{let s=new Yr(r.color??io),a=xo(r),o=new uB(s,a.alpha),l=new dr(o.calpha,"f");return new zr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new Yr(r.color??16777215),a=new Mt(r.bias??.1),o=new Mt(r.scale??1),l=new Mt(r.intensity??2),c=new Mt(r.factor??1),u=xo(r),h=new Hke(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new dr(h.calpha,"f");return new zr(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new Mt(r.filmThickness??30),a=new Mt(r.movement??0),o=new Eo(r.wavelengths??new F(0,0,0)),l=new Mt(r.noiseStrength??0),c=new Mt(r.noiseScale??1),u=new Eo(r.offset??new F(0,0,0)),h=xo(r),d=new pie(s,a,o,l,c,u,h.alpha,h.isMask),p=new dr(d.calpha,"f");return new zr(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,p,h.isMask,n)}case"transmission":{let s=new Mt(r.thickness??10),a=new Mt(r.ior??1.5),o=new Mt(r.roughness??.5),l=qt.transmissionSize,c=qt.transmissionRenderTarget,u=qt.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new cs(d/h,1):new cs(1,h/d),f=xo(r),g=new vie(s,a,o,l,c,u,p,f.alpha),m=new dr(g.calpha,"f");return new zr(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:p,...f},g,f.mode,m,f.isMask,n)}case"toon":{let s=new nr(r.positioning??0),a;r.colors?a=new Zp(r.colors.length,r.colors):(a=new Zp(10,new ii(0,0,0,1)),a.value[1]=new ii(1,1,1,1));let o;r.steps?o=new Kp(r.steps.length,r.steps):(o=new Kp(10,1),o.value[0]=0);let l=new Eo(r.source??new F(0,0,0)),c=new ea(r.isWorldSpace??!0),u=new Mt(r.noiseStrength??0),h=new Mt(r.noiseScale??1),d=new Su(r.shadowColor),p=new Eo(r.offset??new F(0,0,0)),f=xo(r),g=new mie(s,a,o,l,c,u,h,d,p,f.alpha),m=new dr(g.calpha,"f");return new zr(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:p,...f},g,f.mode,m,f.isMask,n)}case"outline":{let s=new Yr(r.outlineColor??16777215),a=new Yr(r.contourColor??16777215),o=new Mt(r.outlineWidth??.1),l=new Mt(r.contourWidth??.1),c=new Mt(r.outlineThreshold??.1),u=new Mt(r.contourThreshold??.1),h=new Mt(r.outlineSmoothing??.1),d=new Mt(r.contourFrequency??.1),p=new Eo(r.contourDirection??new F(0,1,0)),f=new ea(r.positionalLines??!1),g=new ea(r.compensation??!0),m=qt.normalRenderTarget,v=qt.normalRenderTargetDepth,x=qt.pixelRatioNode,y=qt.resolution,_=xo(r),A=new uie(s,a,o,l,c,u,h,d,p,f,g,y,m,v,x,_.alpha),S=new dr(A.calpha,"f");return new zr(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:g,..._},A,_.mode,S,_.isMask,n)}case"depth":{let s=new nr(r.gradientType??0),a=new ea(r.smooth??!1),o=new Mt(r.near??50),l=new Mt(r.far??200),c=new Mt(r.isVector??1),u=new Mt(r.isWorldSpace??0),h=new Eo(r.origin??new F),d=new Eo(r.direction??new F),p;r.colors?p=new Zp(r.colors.length,r.colors):(p=new Zp(2,new ii(0,0,0,1)),p.value[1]=new ii(1,1,1,1));let f;r.steps?f=new Kp(r.steps.length,r.steps):(f=new Kp(2,1),f.value[0]=0);let g=xo(r),m=new rie(s,a,o,l,c,u,h,d,p,f,g.alpha,g.isMask),v=new dr(m.calpha,"f");return new zr(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:p,steps:f,...g},m,g.mode,v,g.isMask,n)}case"noise":{let s=new Mt(r.scale??1),a=new Eo(r.size??new F(100,100,100)),o=new Mt(r.move??1),l=new cs(r.fA??new pe(1.7,9.2)),c=new cs(r.fB??new pe(8.3,2.8)),u=new cs(r.distortion??new pe(1,1)),h=new Su(r.colorA),d=new Su(r.colorB),p=new Su(r.colorC),f=new Su(r.colorD),g=new nr(r.noiseType??0),m=new nr(r.voronoiStyle??0),v=new Mt(r.highCut??1),x=new Mt(r.lowCut??0),y=new Mt(r.smoothness??.5),_=new Mt(r.seed??.5),A=new nr(r.quality??1),S=xo(r),C=new lie(s,a,o,l,c,u,h,d,p,f,S.alpha,g,S.isMask,m,v,x,y,_,A),M=new dr(C.calpha,"f");return new zr(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:p,colorD:f,noiseType:g,...S,voronoiStyle:m,highCut:v,lowCut:x,smoothness:y,seed:_,quality:A},C,S.mode,M,S.isMask,n)}case"normal":{let s=new Eo(r.cnormal??new F(1,1,1)),a=xo(r),o=new iie(s,a.alpha),l=new dr(o.calpha,"f");return new zr(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new nr(r.gradientType??0),a=new ea(r.smooth??!1),o;r.colors?o=new Zp(r.colors.length,r.colors):(o=new Zp(10,new ii(0,0,0,1)),o.value[1]=new ii(1,1,1,1));let l;r.steps?l=new Kp(r.steps.length,r.steps):(l=new Kp(10,1),l.value[0]=0);let c=new cs(r.offset??new pe(0,0)),u=new cs(r.morph??new pe(0,0)),h=new Mt(r.angle??0),d=xo(r),p=new sie(s,a,o,l,c,u,h,d.alpha,d.isMask),f=new dr(p.calpha,"f");return new zr(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},p,d.mode,f,d.isMask,n)}case"pattern":{let s=new nr(r.style??0),a=new nr(r.projection??0),o=new nr(["x","y","z"].indexOf(r.axis)??0),l=new Mt(r.blending??0),c=new cs(r.offset??new pe(0,0)),u=new Su(r.colorA),h=new Su(r.colorB),d=new cs(r.frequency??new pe(10,10)),p=new Mt(r.size??.5),f=new Mt(r.variation??0),g=new Mt(r.smoothness??.5),m=new Mt(r.zigzag??0),v=new Mt(r.rotation??0),x=new cs(r.vertical??new pe(0,1)),y=new cs(r.horizontal??new pe(0,1)),_=new nr(r.sides??6),A=xo(r),S=new hie(s,a,o,l,c,u,h,d,p,f,g,m,v,x,y,_,A.alpha,A.isMask),C=new dr(S.calpha,"f");return new zr(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:p,variation:f,smoothness:g,zigzag:m,rotation:v,vertical:x,horizontal:y,sides:_,...A},S,A.mode,C,A.isMask,n)}default:{let s=new Yr(1,0,0,1),a=xo(r),o=new uB(s,a.alpha),l=new dr(o.calpha,"f");return new zr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function Gze(e,t,i,r){let n=Sze(i,r);return Vze(i,e,t,n,r)}function Cie(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=am(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function _v(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,c=t.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var Kd=class extends Ri{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},Hze=class extends Kd{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,r){return this.root.getFlavor(e,t,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},gk=class extends Kd{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,Tn.startContext(this),this.reset0(e,t),Tn.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,r){let n=i?6:(e?3:0)+t;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new Hze(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){Tn.startContext(this),(this.data!==e||i)&&this.reset0(e,t),Tn.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??Kn.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>fb.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=_v(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=_v(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=_v(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(n,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof fc),this.lightLayer===void 0&&(this.lightLayer=new fc(0,"",{...Xn.defaultData("light","phong"),visible:!1},new mk,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof fc);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof zr&&s.color instanceof fk&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(Tn.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=_v(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:am(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:am(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);Tn.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof zr?t.color.mask=void 0:t instanceof fc&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof zr&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof fc?r.node.mask=new ya(t.color,t.alpha,ya.MUL):r instanceof zr&&(r.isMask.value||(r.color.mask=new ya(t.color,t.alpha,ya.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof zr),t=this.layers.findIndex(i=>i instanceof fc);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof zr){if(n.isMask.value)continue;i=new s9(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new dr("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof fc);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof zr){if(r.isMask.value)continue;e=new s9(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof Eie);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new ya(t,e[i].position,ya.ADD),t=new ya(t,new Mt(.5).setReadonly(!0),ya.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Zte;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof zr){let t=e.params.texture;if(t instanceof cB&&!t.image.loaded)return!1}return!0}};Object.defineProperties(Kd.prototype,{properties:{get:function(){return this.fragment.properties}}});var pB=class extends gk{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},m9=new Map;function jze(e){if(typeof e=="string")return e;let t=m9.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},m9.set(e,t)),t.url}var Tie,Wze=new Promise(e=>{Tie=e}),g9=!1,TA;function Xze(){if(g9)return;if(TA)return TA;async function e(){await ap(()=>import("./howler-6f14ec81.js").then(t=>t.h),[]),Tie(window!==void 0?window:global),g9=!0}return TA=e(),TA}var Pie;Wze.then(e=>Pie=e);function Yze(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),t=t||n.some(a=>a.data.type==="Audio")})}),t}var G1=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:jze(e),format:"wav"},this.sound=new Pie.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},qze=class{constructor(){this.type="ShapePath",this.color=new jt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new LE,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,g,m){let v=p.x,x=f.x,y=g.x,_=m.x,A=p.y,S=f.y,C=g.y,M=m.y,E=(_-y)*(A-C)-(M-C)*(v-y),P=(x-v)*(A-C)-(S-A)*(v-y),R=(M-C)*(x-v)-(_-y)*(S-A),O=E/R,L=P/R;if(R===0&&E!==0||O<=0||O>=1||L<0||L>1)return null;if(E===0&&R===0){for(let I=0;I<2;I++)if(r(I===0?g:m,p,f),t.loc===e.ORIGIN){let z=I===0?g:m;return{x:z.x,y:z.y,t:t.t}}else if(t.loc===e.BETWEEN){let z=+(v+t.t*(x-v)).toPrecision(10),K=+(A+t.t*(S-A)).toPrecision(10);return{x:z,y:K,t:t.t}}return null}else{for(let K=0;K<2;K++)if(r(K===0?g:m,p,f),t.loc===e.ORIGIN){let Y=K===0?g:m;return{x:Y.x,y:Y.y,t:t.t}}let I=+(v+O*(x-v)).toPrecision(10),z=+(A+O*(S-A)).toPrecision(10);return{x:I,y:z,t:O}}}function r(p,f,g){let m=g.x-f.x,v=g.y-f.y,x=p.x-f.x,y=p.y-f.y,_=m*y-x*v;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===g.x&&p.y===g.y){t.loc=e.DESTINATION,t.t=1;return}if(_<-Number.EPSILON){t.loc=e.LEFT;return}if(_>Number.EPSILON){t.loc=e.RIGHT;return}if(m*x<0||v*y<0){t.loc=e.BEHIND;return}if(Math.sqrt(m*m+v*v)<Math.sqrt(x*x+y*y)){t.loc=e.BEYOND;return}let A;m!==0?A=x/m:A=y/v,t.loc=e.BETWEEN,t.t=A}function n(p,f){let g=[],m=[];for(let v=1;v<p.length;v++){let x=p[v-1],y=p[v];for(let _=1;_<f.length;_++){let A=f[_-1],S=f[_],C=i(x,y,A,S);C!==null&&g.find(M=>M.t<=C.t+Number.EPSILON&&M.t>=C.t-Number.EPSILON)===void 0&&(g.push(C),m.push(new pe(C.x,C.y)))}}return m}function s(p,f,g){let m=new pe;f.getCenter(m);let v=[];return g.forEach(x=>{x.boundingBox.containsPoint(m)&&n(p,x.points).forEach(y=>{v.push({identifier:x.identifier,isCW:x.isCW,point:y})})}),v.sort((x,y)=>x.point.x-y.point.x),v}function a(p,f,g,m,v){(v==null||v==="")&&(v="nonzero");let x=new pe;p.boundingBox.getCenter(x);let y=[new pe(g,x.y),new pe(m,x.y)],_=s(y,p.boundingBox,f);_.sort((P,R)=>P.point.x-R.point.x);let A=[],S=[];_.forEach(P=>{P.identifier===p.identifier?A.push(P):S.push(P)});let C=A[0].point.x,M=[],E=0;for(;E<S.length&&S[E].point.x<C;)M.length>0&&M[M.length-1]===S[E].identifier?M.pop():M.push(S[E].identifier),E++;if(M.push(p.identifier),v==="evenodd"){let P=M.length%2===0,R=M[M.length-2];return{identifier:p.identifier,isHole:P,for:R}}else if(v==="nonzero"){let P=!0,R=null,O=null;for(let L=0;L<M.length;L++){let I=M[L];f[I]&&(P?(O=f[I].isCW,P=!1,R=I):O!==f[I].isCW&&(O=f[I].isCW,P=!0))}return{identifier:p.identifier,isHole:P,for:R}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let f=p.getPoints(),g=-999999999,m=999999999,v=-999999999,x=999999999;for(let y=0;y<f.length;y++){let _=f[y];_.y>g&&(g=_.y),_.y<m&&(m=_.y),_.x>v&&(v=_.x),_.x<x&&(x=_.x)}c<=v&&(c=v+1),l>=x&&(l=x-1),f.length&&u.push({curves:p.curves,points:f,isCW:I$.isClockWise(f),identifier:o++,boundingBox:new CU(new pe(x,m),new pe(v,g))})});let h=u.map(p=>{var f;return a(p,u,l,c,(f=this.userData)==null?void 0:f.style.fillRule)}),d=[];return u.forEach(p=>{let f=h[p.identifier];if(f&&!f.isHole){let g=new OE;g.curves=p.curves,h.filter(m=>(m==null?void 0:m.isHole)&&m.for===p.identifier).forEach(m=>{if(m){let v=u[m.identifier],x=new LE;x.curves=v.curves,g.holes.push(x)}}),d.push(g)}}),d}},Die=!1,Rie,v9=new Promise(e=>{Rie=e}),y9=!1,PA;function Qze(){if(Die=!0,y9)return;if(PA)return PA;async function e(){let t=await ap(()=>import("./opentype-fc28cde9.js"),[]);Rie(t),y9=!0}return PA=e(),PA}var Jze=class{async load(e,t,i=()=>{}){let{load:r}=await v9;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await v9;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function Kze(e){return await(await fetch(e)).arrayBuffer()}var Zze=new Jze;async function x9(e){let t,i,r=!1;if(e.url?(t=await Kze(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(Die){let n=await Zze.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function $ze(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var e4e=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=x9(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=x9(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if($ze(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,p="",f=[h.state.glyphIndex],g=[],m=!1;for(;!m;)a++,p=t.charAt(a),d+=p,f.push(e.charToGlyphIndex(p)),g=e.stringToGlyphs(d),g.length===1&&g[0].index===c&&(m=!0),a>t.length&&(m=!0);s.push({char:u,index:c,replacements:f,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(v=>this.getTextWidth(v,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),d=[],p=e.map(v=>[]),f=e.map(v=>[]),g;for(let v=0;v<e.length;v++){let x=e[v],y={features:{liga:!0}},_=[];try{_=i.stringToGlyphs(x,y)}catch(S){console.warn(S)}u=this.getLineInitialOffsetX(s[v],a,t.horizontalAlign,x,o);let A=[];try{A=this.reverseLigaturesTable(i,x,_)}catch(S){console.warn(S)}c=this.computeSpaceWidthForLine(e,v,t);for(let S=0;S<_.length;S++){let C=_[S],M=C.index===0?`
`:C.unicode?String.fromCharCode(C.unicode):void 0,E=A[S],P=0,R=0;S===0&&t.horizontalAlign===2&&C.leftSideBearing!==void 0&&(R=-C.leftSideBearing*r),g&&(P=i.getKerningValue(C,g)*r),u+=R+P;let O=0;if(M===`
`)O=l;else if(M===" ")O=c;else{let L=this.createPath(C,r,u,h,t);L&&(O=L.offsetX-(P+R),d.push(L.path))}if(E.replacements.length===1)f[v].push([u,h]),p[v].push(O);else{let L=E.replacements.map(Y=>(i.glyphs.get(Y).advanceWidth??0)*r),I=L.reduce((Y,U)=>Y+=U,0),z=L.map(Y=>Y/I),K=u;for(let Y=0;Y<z.length;Y++){let U=O*z[Y];f[v].push([K,h]),p[v].push(U),K+=U}}u+=O,g=C}h-=n}let m=[];for(let v=0,x=d.length;v<x;v++)m.push(...d[v].toShapes());return{shapes:m,charWidths:p,lineWidths:s,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new qze,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=t4e(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function t4e(e){if(e.length){let t=e[0];if(t instanceof Rl)return t.v1;if(t instanceof _l||t instanceof Qd)return t.v0}}var i4e=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},w9=class extends i4e{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=_w(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},r4e={markNeedsUpdateRendererDirty:()=>{}},DM=1e3,b9=512*DM;function n4e(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var s4e="https://hooks.spline.design",a4e=`${s4e}/events?hashFile=`,o4e=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=kT(),this.reconnectWaitFor=DM,this._onError=i=>{var r,n,s;(r=this.eventSource)==null||r.removeEventListener("message",this._onMessage),(n=this.eventSource)==null||n.removeEventListener("error",this._onError),(s=this.eventSource)==null||s.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=DM,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=DM,this._connected=!1},this._onMessage=i=>{let r=i.data,n;try{n=JSON.parse(r)}catch(s){console.error("Error parsing webhook message",s)}if(n){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{n[a.name]!==void 0&&n4e(n[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=n[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(a4e+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,t,i,r;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(t=this.eventSource)==null||t.removeEventListener("error",this._onError),(i=this.eventSource)==null||i.removeEventListener("open",this._onConnected),(r=this.eventSource)==null||r.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>b9&&(this.reconnectWaitFor=b9),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var t;if(this.getParametersKeys().includes(e)){if(this.result)return(t=this.result)==null?void 0:t[e];for(let i of this.userWebhook.parametersSchemas)if(i.data.name===e)return zO.defaultParameterValueByType(i.data.type)}}},l4e=globalThis.atob,c4e=globalThis.btoa,jv=class{static floatTo16BitPCM(e){let t=new ArrayBuffer(e.length*2),i=new DataView(t),r=0;for(let n=0;n<e.length;n++,r+=2){let s=Math.max(-1,Math.min(1,e[n]));i.setInt16(r,s<0?s*32768:s*32767,!0)}return t}static base64ToArrayBuffer(e){let t=l4e(e),i=t.length,r=new Uint8Array(i);for(let n=0;n<i;n++)r[n]=t.charCodeAt(n);return r.buffer}static arrayBufferToBase64(e){e instanceof Float32Array?e=this.floatTo16BitPCM(e):e instanceof Int16Array&&(e=e.buffer);let t="",i=new Uint8Array(e),r=32768;for(let n=0;n<i.length;n+=r){let s=i.subarray(n,n+r);t+=String.fromCharCode.apply(null,s)}return c4e(t)}static mergeInt16Arrays(e,t){if(e instanceof ArrayBuffer&&(e=new Int16Array(e)),t instanceof ArrayBuffer&&(t=new Int16Array(t)),!(e instanceof Int16Array)||!(t instanceof Int16Array))throw new Error("Both items must be Int16Array");let i=new Int16Array(e.length+t.length);for(let r=0;r<e.length;r++)i[r]=e[r];for(let r=0;r<t.length;r++)i[e.length+r]=t[r];return i}static generateId(e,t=21){let i="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",r=Array(t-e.length).fill(0).map(n=>i[Math.floor(Math.random()*i.length)]).join("");return`${e}${r}`}},u4e=e=>new Promise(t=>setTimeout(()=>t(),e)),Iie=class{constructor(){this.eventHandlers={},this.nextEventHandlers={}}clearEventHandlers(){return this.eventHandlers={},this.nextEventHandlers={},!0}on(e,t){return this.eventHandlers[e]=this.eventHandlers[e]||[],this.eventHandlers[e].push(t),t}onNext(e,t){return this.nextEventHandlers[e]=this.nextEventHandlers[e]||[],this.nextEventHandlers[e].push(t),t}off(e,t){let i=this.eventHandlers[e]||[];if(t){let r=i.indexOf(t);if(r===-1)throw new Error(`Could not turn off specified event listener for "${e}": not found as a listener`);i.splice(r,1)}else delete this.eventHandlers[e];return!0}offNext(e,t){let i=this.nextEventHandlers[e]||[];if(t){let r=i.indexOf(t);if(r===-1)throw new Error(`Could not turn off specified next event listener for "${e}": not found as a listener`);i.splice(r,1)}else delete this.nextEventHandlers[e];return!0}async waitForNext(e,t=null){let i=Date.now(),r;for(this.onNext(e,n=>r=n);!r;){if(t&&Date.now()-i>t)return null;await u4e(1)}return r}dispatch(e,t){let i=[].concat(this.eventHandlers[e]||[]);for(let n of i)n(t);let r=[].concat(this.nextEventHandlers[e]||[]);for(let n of r)n(t);return delete this.nextEventHandlers[e],!0}},h4e=class extends Iie{constructor({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:i,debug:r}={}){if(super(),this.defaultUrl="wss://api.openai.com/v1/realtime",this.url=e||this.defaultUrl,this.apiKey=t||null,this.debug=!!r,this.ws=null,globalThis.document&&this.apiKey&&!i)throw new Error('Can not provide API key in the browser without "dangerouslyAllowAPIKeyInBrowser" set to true')}isConnected(){return!!this.ws}log(...e){let t=[`[Websocket/${new Date().toISOString()}]`].concat(e).map(i=>typeof i=="object"&&i!==null?JSON.stringify(i,null,2):i);return this.debug&&console.log(...t),!0}async connect({model:e}={model:"gpt-4o-realtime-preview-2024-10-01"}){if(!this.apiKey&&this.url===this.defaultUrl&&console.warn(`No apiKey provided for connection to "${this.url}"`),this.isConnected())throw new Error("Already connected");if(globalThis.document){this.apiKey&&console.warn("Warning: Connecting using API key in the browser, this is not recommended");let t=globalThis.WebSocket,i=new t(`${this.url}${e?`?model=${e}`:""}`,["realtime",`openai-insecure-api-key.${this.apiKey}`,"openai-beta.realtime-v1"]);return i.addEventListener("message",r=>{let n=JSON.parse(r.data);this.receive(n.type,n)}),new Promise((r,n)=>{let s=()=>{this.disconnect(i),n(new Error(`Could not connect to "${this.url}"`))};i.addEventListener("error",s),i.addEventListener("open",()=>{this.log(`Connected to "${this.url}"`),i.removeEventListener("error",s),i.addEventListener("error",()=>{this.disconnect(i),this.log(`Error, disconnected from "${this.url}"`),this.dispatch("close",{error:!0})}),i.addEventListener("close",()=>{this.disconnect(i),this.log(`Disconnected from "${this.url}"`),this.dispatch("close",{error:!1})}),this.ws=i,r(!0)})})}}disconnect(e){if(!e||this.ws===e)return this.ws&&this.ws.close(),this.ws=null,!0}receive(e,t){return this.log("received:",e,t),this.dispatch(`server.${e}`,t),this.dispatch("server.*",t),!0}send(e,t){if(!this.isConnected())throw new Error("RealtimeAPI is not connected");if(t=t||{},typeof t!="object")throw new Error("data must be an object");let i={event_id:jv.generateId("evt_"),type:e,...t};return this.dispatch(`client.${e}`,i),this.dispatch("client.*",i),this.log("sent:",e,i),this.ws.send(JSON.stringify(i)),!0}},d4e=class{constructor(){xf(this,"defaultFrequency",24e3),xf(this,"EventProcessors",{"conversation.item.created":e=>{let{item:t}=e,i=JSON.parse(JSON.stringify(t));if(this.itemLookup[i.id]||(this.itemLookup[i.id]=i,this.items.push(i)),i.formatted={},i.formatted.audio=new Int16Array(0),i.formatted.text="",i.formatted.transcript="",this.queuedSpeechItems[i.id]&&(i.formatted.audio=this.queuedSpeechItems[i.id].audio,delete this.queuedSpeechItems[i.id]),i.content){let r=i.content.filter(n=>["text","input_text"].includes(n.type));for(let n of r)i.formatted.text+=n.text}return this.queuedTranscriptItems[i.id]&&(i.formatted.transcript=this.queuedTranscriptItems.transcript,delete this.queuedTranscriptItems[i.id]),i.type==="message"?i.role==="user"?(i.status="completed",this.queuedInputAudio&&(i.formatted.audio=this.queuedInputAudio,this.queuedInputAudio=null)):i.status="in_progress":i.type==="function_call"?(i.formatted.tool={type:"function",name:i.name,call_id:i.call_id,arguments:""},i.status="in_progress"):i.type==="function_call_output"&&(i.status="completed",i.formatted.output=i.output),{item:i,delta:null}},"conversation.item.truncated":e=>{let{item_id:t,audio_end_ms:i}=e,r=this.itemLookup[t];if(!r)throw new Error(`item.truncated: Item "${t}" not found`);let n=Math.floor(i*this.defaultFrequency/1e3);return r.formatted.transcript="",r.formatted.audio=r.formatted.audio.slice(0,n),{item:r,delta:null}},"conversation.item.deleted":e=>{let{item_id:t}=e,i=this.itemLookup[t];if(!i)throw new Error(`item.deleted: Item "${t}" not found`);delete this.itemLookup[i.id];let r=this.items.indexOf(i);return r>-1&&this.items.splice(r,1),{item:i,delta:null}},"conversation.item.input_audio_transcription.completed":e=>{let{item_id:t,content_index:i,transcript:r}=e,n=this.itemLookup[t],s=r||" ";return n?(n.content[i].transcript=r,n.formatted.transcript=s,{item:n,delta:{transcript:r}}):(this.queuedTranscriptItems[t]={transcript:s},{item:null,delta:null})},"input_audio_buffer.speech_started":e=>{let{item_id:t,audio_start_ms:i}=e;return this.queuedSpeechItems[t]={audio_start_ms:i},{item:null,delta:null}},"input_audio_buffer.speech_stopped":(e,t)=>{let{item_id:i,audio_end_ms:r}=e;this.queuedSpeechItems[i]||(this.queuedSpeechItems[i]={audio_start_ms:r});let n=this.queuedSpeechItems[i];if(n.audio_end_ms=r,t){let s=Math.floor(n.audio_start_ms*this.defaultFrequency/1e3),a=Math.floor(n.audio_end_ms*this.defaultFrequency/1e3);n.audio=t.slice(s,a)}return{item:null,delta:null}},"response.created":e=>{let{response:t}=e;return this.responseLookup[t.id]||(this.responseLookup[t.id]=t,this.responses.push(t)),{item:null,delta:null}},"response.output_item.added":e=>{let{response_id:t,item:i}=e,r=this.responseLookup[t];if(!r)throw new Error(`response.output_item.added: Response "${t}" not found`);return r.output.push(i.id),{item:null,delta:null}},"response.output_item.done":e=>{let{item:t}=e;if(!t)throw new Error('response.output_item.done: Missing "item"');let i=this.itemLookup[t.id];if(!i)throw new Error(`response.output_item.done: Item "${t.id}" not found`);return i.status=t.status,{item:i,delta:null}},"response.content_part.added":e=>{let{item_id:t,part:i}=e,r=this.itemLookup[t];if(!r)throw new Error(`response.content_part.added: Item "${t}" not found`);return r.content.push(i),{item:r,delta:null}},"response.audio_transcript.delta":e=>{let{item_id:t,content_index:i,delta:r}=e,n=this.itemLookup[t];if(!n)throw new Error(`response.audio_transcript.delta: Item "${t}" not found`);return n.content[i].transcript+=r,n.formatted.transcript+=r,{item:n,delta:{transcript:r}}},"response.audio.delta":e=>{let{item_id:t,content_index:i,delta:r}=e,n=this.itemLookup[t];if(!n)throw new Error(`response.audio.delta: Item "${t}" not found`);let s=jv.base64ToArrayBuffer(r),a=new Int16Array(s);return n.formatted.audio=jv.mergeInt16Arrays(n.formatted.audio,a),{item:n,delta:{audio:a}}},"response.text.delta":e=>{let{item_id:t,content_index:i,delta:r}=e,n=this.itemLookup[t];if(!n)throw new Error(`response.text.delta: Item "${t}" not found`);return n.content[i].text+=r,n.formatted.text+=r,{item:n,delta:{text:r}}},"response.function_call_arguments.delta":e=>{let{item_id:t,delta:i}=e,r=this.itemLookup[t];if(!r)throw new Error(`response.function_call_arguments.delta: Item "${t}" not found`);return r.arguments+=i,r.formatted.tool.arguments+=i,{item:r,delta:{arguments:i}}}}),this.clear()}clear(){return this.itemLookup={},this.items=[],this.responseLookup={},this.responses=[],this.queuedSpeechItems={},this.queuedTranscriptItems={},this.queuedInputAudio=null,!0}queueInputAudio(e){return this.queuedInputAudio=e,e}processEvent(e,...t){if(!e.event_id)throw console.error(e),new Error('Missing "event_id" on event');if(!e.type)throw console.error(e),new Error('Missing "type" on event');let i=this.EventProcessors[e.type];if(!i)throw new Error(`Missing conversation event processor for "${e.type}"`);return i.call(this,e,...t)}getItem(e){return this.itemLookup[e]||null}getItems(){return this.items.slice()}},_9=class extends Iie{constructor({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:i,debug:r}={}){super(),this.defaultSessionConfig={modalities:["text","audio"],instructions:"",voice:"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:null,turn_detection:null,tools:[],tool_choice:"auto",temperature:.8,max_response_output_tokens:4096},this.sessionConfig={},this.transcriptionModels=[{model:"whisper-1"}],this.defaultServerVadConfig={type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:200},this.realtime=new h4e({url:e,apiKey:t,dangerouslyAllowAPIKeyInBrowser:i,debug:r}),this.conversation=new d4e,this._resetConfig(),this._addAPIEventHandlers()}_resetConfig(){return this.sessionCreated=!1,this.tools={},this.sessionConfig=JSON.parse(JSON.stringify(this.defaultSessionConfig)),this.inputAudioBuffer=new Int16Array(0),!0}_addAPIEventHandlers(){this.realtime.on("client.*",r=>{let n={time:new Date().toISOString(),source:"client",event:r};this.dispatch("realtime.event",n)}),this.realtime.on("server.*",r=>{let n={time:new Date().toISOString(),source:"server",event:r};this.dispatch("realtime.event",n)}),this.realtime.on("server.session.created",()=>this.sessionCreated=!0);let e=(r,...n)=>{let{item:s,delta:a}=this.conversation.processEvent(r,...n);return{item:s,delta:a}},t=(r,...n)=>{let{item:s,delta:a}=e(r,...n);return s&&this.dispatch("conversation.updated",{item:s,delta:a}),{item:s,delta:a}},i=async r=>{try{let n=JSON.parse(r.arguments),s=this.tools[r.name];if(!s)throw new Error(`Tool "${r.name}" has not been added`);let a=await s.handler(n);this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:r.call_id,output:JSON.stringify(a)}})}catch(n){this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:r.call_id,output:JSON.stringify({error:n.message})}})}this.createResponse()};return this.realtime.on("server.response.created",e),this.realtime.on("server.response.output_item.added",e),this.realtime.on("server.response.content_part.added",e),this.realtime.on("server.input_audio_buffer.speech_started",r=>{e(r),this.dispatch("conversation.interrupted")}),this.realtime.on("server.input_audio_buffer.speech_stopped",r=>e(r,this.inputAudioBuffer)),this.realtime.on("server.conversation.item.created",r=>{let{item:n}=t(r);this.dispatch("conversation.item.appended",{item:n}),n.status==="completed"&&this.dispatch("conversation.item.completed",{item:n})}),this.realtime.on("server.conversation.item.truncated",t),this.realtime.on("server.conversation.item.deleted",t),this.realtime.on("server.conversation.item.input_audio_transcription.completed",t),this.realtime.on("server.response.audio_transcript.delta",t),this.realtime.on("server.response.audio.delta",t),this.realtime.on("server.response.text.delta",t),this.realtime.on("server.response.function_call_arguments.delta",t),this.realtime.on("server.response.output_item.done",async r=>{let{item:n}=t(r);n.status==="completed"&&this.dispatch("conversation.item.completed",{item:n}),n.formatted.tool&&i(n.formatted.tool)}),!0}isConnected(){return this.realtime.isConnected()}reset(){return this.disconnect(),this.clearEventHandlers(),this.realtime.clearEventHandlers(),this._resetConfig(),this._addAPIEventHandlers(),!0}async connect(){if(this.isConnected())throw new Error("Already connected, use .disconnect() first");return await this.realtime.connect(),this.updateSession(),!0}async waitForSessionCreated(){if(!this.isConnected())throw new Error("Not connected, use .connect() first");for(;!this.sessionCreated;)await new Promise(e=>setTimeout(()=>e(),1));return!0}disconnect(){this.sessionCreated=!1,this.realtime.isConnected()&&this.realtime.disconnect(),this.conversation.clear()}getTurnDetectionType(){var e;return((e=this.sessionConfig.turn_detection)==null?void 0:e.type)||null}addTool(e,t){if(!(e!=null&&e.name))throw new Error("Missing tool name in definition");let i=e==null?void 0:e.name;if(this.tools[i])throw new Error(`Tool "${i}" already added. Please use .removeTool("${i}") before trying to add again.`);if(typeof t!="function")throw new Error(`Tool "${i}" handler must be a function`);return this.tools[i]={definition:e,handler:t},this.updateSession(),this.tools[i]}removeTool(e){if(!this.tools[e])throw new Error(`Tool "${e}" does not exist, can not be removed.`);return delete this.tools[e],!0}deleteItem(e){return this.realtime.send("conversation.item.delete",{item_id:e}),!0}updateSession({modalities:e=void 0,instructions:t=void 0,voice:i=void 0,input_audio_format:r=void 0,output_audio_format:n=void 0,input_audio_transcription:s=void 0,turn_detection:a=void 0,tools:o=void 0,tool_choice:l=void 0,temperature:c=void 0,max_response_output_tokens:u=void 0}={}){e!==void 0&&(this.sessionConfig.modalities=e),t!==void 0&&(this.sessionConfig.instructions=t),i!==void 0&&(this.sessionConfig.voice=i),r!==void 0&&(this.sessionConfig.input_audio_format=r),n!==void 0&&(this.sessionConfig.output_audio_format=n),s!==void 0&&(this.sessionConfig.input_audio_transcription=s),a!==void 0&&(this.sessionConfig.turn_detection=a),o!==void 0&&(this.sessionConfig.tools=o),l!==void 0&&(this.sessionConfig.tool_choice=l),c!==void 0&&(this.sessionConfig.temperature=c),u!==void 0&&(this.sessionConfig.max_response_output_tokens=u);let h=[].concat((o||[]).map(p=>{let f={type:"function",...p};if(this.tools[f==null?void 0:f.name])throw new Error(`Tool "${f==null?void 0:f.name}" has already been defined`);return f}),Object.keys(this.tools).map(p=>({type:"function",...this.tools[p].definition}))),d={...this.sessionConfig};return d.tools=h,this.realtime.isConnected()&&this.realtime.send("session.update",{session:d}),!0}sendUserMessageContent(e=[]){if(e.length){for(let t of e)t.type==="input_audio"&&(t.audio instanceof ArrayBuffer||t.audio instanceof Int16Array)&&(t.audio=jv.arrayBufferToBase64(t.audio));this.realtime.send("conversation.item.create",{item:{type:"message",role:"user",content:e}})}return this.createResponse(),!0}appendInputAudio(e){return e.byteLength>0&&(this.realtime.send("input_audio_buffer.append",{audio:jv.arrayBufferToBase64(e)}),this.inputAudioBuffer=jv.mergeInt16Arrays(this.inputAudioBuffer,e)),!0}createResponse(){return this.getTurnDetectionType()===null&&this.inputAudioBuffer.byteLength>0&&(this.realtime.send("input_audio_buffer.commit"),this.conversation.queueInputAudio(this.inputAudioBuffer),this.inputAudioBuffer=new Int16Array(0)),this.realtime.send("response.create"),!0}cancelResponse(e,t=0){if(e){if(e){let i=this.conversation.getItem(e);if(!i)throw new Error(`Could not find item "${e}"`);if(i.type!=="message")throw new Error('Can only cancelResponse messages with type "message"');if(i.role!=="assistant")throw new Error('Can only cancelResponse messages with role "assistant"');this.realtime.send("response.cancel");let r=i.content.findIndex(n=>n.type==="audio");if(r===-1)throw new Error("Could not find audio on item to cancel");return this.realtime.send("conversation.item.truncate",{item_id:e,content_index:r,audio_end_ms:Math.floor(t/this.conversation.defaultFrequency*1e3)}),{item:i}}}else return this.realtime.send("response.cancel"),{item:null}}async waitForNextItem(){let e=await this.waitForNext("conversation.item.appended"),{item:t}=e;return{item:t}}async waitForNextCompletedItem(){let e=await this.waitForNext("conversation.item.completed"),{item:t}=e;return{item:t}}},p4e=`
class AudioProcessor extends AudioWorkletProcessor {

  constructor() {
    super();
    this.port.onmessage = this.receive.bind(this);
    this.initialize();
  }

  initialize() {
    this.foundAudio = false;
    this.recording = false;
    this.chunks = [];
  }

  /**
   * Concatenates sampled chunks into channels
   * Format is chunk[Left[], Right[]]
   */
  readChannelData(chunks, channel = -1, maxChannels = 9) {
    let channelLimit;
    if (channel !== -1) {
      if (chunks[0] && chunks[0].length - 1 < channel) {
        throw new Error(
          \`Channel \${channel} out of range: max \${chunks[0].length}\`
        );
      }
      channelLimit = channel + 1;
    } else {
      channel = 0;
      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);
    }
    const channels = [];
    for (let n = channel; n < channelLimit; n++) {
      const length = chunks.reduce((sum, chunk) => {
        return sum + chunk[n].length;
      }, 0);
      const buffers = chunks.map((chunk) => chunk[n]);
      const result = new Float32Array(length);
      let offset = 0;
      for (let i = 0; i < buffers.length; i++) {
        result.set(buffers[i], offset);
        offset += buffers[i].length;
      }
      channels[n] = result;
    }
    return channels;
  }

  /**
   * Combines parallel audio data into correct format,
   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]
   */
  formatAudioData(channels) {
    if (channels.length === 1) {
      // Simple case is only one channel
      const float32Array = channels[0].slice();
      const meanValues = channels[0].slice();
      return { float32Array, meanValues };
    } else {
      const float32Array = new Float32Array(
        channels[0].length * channels.length
      );
      const meanValues = new Float32Array(channels[0].length);
      for (let i = 0; i < channels[0].length; i++) {
        const offset = i * channels.length;
        let meanValue = 0;
        for (let n = 0; n < channels.length; n++) {
          float32Array[offset + n] = channels[n][i];
          meanValue += channels[n][i];
        }
        meanValues[i] = meanValue / channels.length;
      }
      return { float32Array, meanValues };
    }
  }

  /**
   * Converts 32-bit float data to 16-bit integers
   */
  floatTo16BitPCM(float32Array) {
    const buffer = new ArrayBuffer(float32Array.length * 2);
    const view = new DataView(buffer);
    let offset = 0;
    for (let i = 0; i < float32Array.length; i++, offset += 2) {
      let s = Math.max(-1, Math.min(1, float32Array[i]));
      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    }
    return buffer;
  }

  /**
   * Retrieves the most recent amplitude values from the audio stream
   * @param {number} channel
   */
  getValues(channel = -1) {
    const channels = this.readChannelData(this.chunks, channel);
    const { meanValues } = this.formatAudioData(channels);
    return { meanValues, channels };
  }

  /**
   * Exports chunks as an audio/wav file
   */
  export() {
    const channels = this.readChannelData(this.chunks);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const audioData = this.floatTo16BitPCM(float32Array);
    return {
      meanValues: meanValues,
      audio: {
        bitsPerSample: 16,
        channels: channels,
        data: audioData,
      },
    };
  }

  receive(e) {
    const { event, id } = e.data;
    let receiptData = {};
    switch (event) {
      case 'start':
        this.recording = true;
        break;
      case 'stop':
        this.recording = false;
        break;
      case 'clear':
        this.initialize();
        break;
      case 'export':
        receiptData = this.export();
        break;
      case 'read':
        receiptData = this.getValues();
        break;
      default:
        break;
    }
    // Always send back receipt
    this.port.postMessage({ event: 'receipt', id, data: receiptData });
  }

  sendChunk(chunk) {
    const channels = this.readChannelData([chunk]);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const rawAudioData = this.floatTo16BitPCM(float32Array);
    const monoAudioData = this.floatTo16BitPCM(meanValues);
    this.port.postMessage({
      event: 'chunk',
      data: {
        mono: monoAudioData,
        raw: rawAudioData,
      },
    });
  }

  process(inputList, outputList, parameters) {
    // Copy input to output (e.g. speakers)
    // Note that this creates choppy sounds with Mac products
    const sourceLimit = Math.min(inputList.length, outputList.length);
    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {
      const input = inputList[inputNum];
      const output = outputList[inputNum];
      const channelCount = Math.min(input.length, output.length);
      for (let channelNum = 0; channelNum < channelCount; channelNum++) {
        input[channelNum].forEach((sample, i) => {
          output[channelNum][i] = sample;
        });
      }
    }
    const inputs = inputList[0];
    // There's latency at the beginning of a stream before recording starts
    // Make sure we actually receive audio data before we start storing chunks
    let sliceIndex = 0;
    if (!this.foundAudio) {
      for (const channel of inputs) {
        sliceIndex = 0; // reset for each channel
        if (this.foundAudio) {
          break;
        }
        if (channel) {
          for (const value of channel) {
            if (value !== 0) {
              // find only one non-zero entry in any channel
              this.foundAudio = true;
              break;
            } else {
              sliceIndex++;
            }
          }
        }
      }
    }
    if (inputs && inputs[0] && this.foundAudio && this.recording) {
      // We need to copy the TypedArray, because the \`process\`
      // internals will reuse the same buffer to hold each input
      const chunk = inputs.map((input) => input.slice(sliceIndex));
      this.chunks.push(chunk);
      this.sendChunk(chunk);
    }
    return true;
  }
}

registerProcessor('audio_processor', AudioProcessor);
`,f4e=new Blob([p4e],{type:"application/javascript"}),m4e=URL.createObjectURL(f4e),g4e=m4e,S9=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],v4e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],kd=[],vk=[];for(let e=1;e<=8;e++)for(let t=0;t<S9.length;t++){let i=S9[t];kd.push(i/Math.pow(2,8-e)),vk.push(v4e[t]+e)}var wC=[32,2e3],A9=kd.filter((e,t)=>kd[t]>wC[0]&&kd[t]<wC[1]),y4e=vk.filter((e,t)=>kd[t]>wC[0]&&kd[t]<wC[1]),yk=class{static getFrequencies(e,t,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,c,u;if(r==="music"||r==="voice"){let d=r==="voice"?A9:kd,p=Array(d.length).fill(n);for(let f=0;f<i.length;f++){let g=f*o,m=i[f];for(let v=d.length-1;v>=0;v--)if(g>d[v]){p[v]=Math.max(p[v],m);break}}l=p,c=r==="voice"?A9:kd,u=r==="voice"?y4e:vk}else l=Array.from(i),c=l.map((d,p)=>o*p),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}constructor(e,t=null){if(this.fftResults=[],t){let{length:i,sampleRate:r}=t,n=new OfflineAudioContext({length:i,sampleRate:r}),s=n.createBufferSource();s.buffer=t;let a=n.createAnalyser();a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a);let o=1/60,l=i/r,c=u=>{let h=o*u;h<l&&n.suspend(h).then(()=>{let d=new Float32Array(a.frequencyBinCount);a.getFloatFrequencyData(d),this.fftResults.push(d),c(u+1)}),u===1?n.startRendering():n.resume()};s.start(0),c(1),this.audio=e,this.context=n,this.analyser=a,this.sampleRate=r,this.audioBuffer=t}else{let i=new AudioContext,r=i.createMediaElementSource(e),n=i.createAnalyser();n.fftSize=8192,n.smoothingTimeConstant=.1,r.connect(n),n.connect(i.destination),this.audio=e,this.context=i,this.analyser=n,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(e="frequency",t=-100,i=-30){let r=null;if(this.audioBuffer&&this.fftResults.length){let n=this.audio.currentTime/this.audio.duration,s=Math.min(n*this.fftResults.length|0,this.fftResults.length-1);r=this.fftResults[s]}return yk.getFrequencies(this.analyser,this.sampleRate,r,e,t,i)}async resumeIfSuspended(){return this.context.state==="suspended"&&await this.context.resume(),!0}},Rg=class{static floatTo16BitPCM(e){let t=new ArrayBuffer(e.length*2),i=new DataView(t),r=0;for(let n=0;n<e.length;n++,r+=2){let s=Math.max(-1,Math.min(1,e[n]));i.setInt16(r,s<0?s*32768:s*32767,!0)}return t}static mergeBuffers(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer}_packData(e,t){return[new Uint8Array([t,t>>8]),new Uint8Array([t,t>>8,t>>16,t>>24])][e]}pack(e,t){if(t!=null&&t.bitsPerSample)if(t!=null&&t.channels){if(!(t!=null&&t.data))throw new Error('Missing "data"')}else throw new Error('Missing "channels"');else throw new Error('Missing "bitsPerSample"');let{bitsPerSample:i,channels:r,data:n}=t,s=["RIFF",this._packData(1,4+(8+24)+(8+8)),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,r.length),this._packData(1,e),this._packData(1,e*r.length*i/8),this._packData(0,r.length*i/8),this._packData(0,i),"data",this._packData(1,r[0].length*r.length*i/8),n],a=new Blob(s,{type:"audio/mpeg"}),o=URL.createObjectURL(a);return{blob:a,url:o,channelCount:r.length,sampleRate:e,duration:n.byteLength/(r.length*e*2)}}},M9=class{constructor({sampleRate:e=44100,outputToSpeakers:t=!1,debug:i=!1}={}){this.scriptSrc=g4e,this.sampleRate=e,this.outputToSpeakers=t,this.debug=!!i,this._deviceChangeCallback=null,this._devices=[],this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(e,t=44100,i=-1){let r=new AudioContext({sampleRate:t}),n,s;if(e instanceof Blob){if(i!==-1)throw new Error('Can not specify "fromSampleRate" when reading from Blob');s=e,n=await s.arrayBuffer()}else if(e instanceof ArrayBuffer){if(i!==-1)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');n=e,s=new Blob([n],{type:"audio/wav"})}else{let c,u;if(e instanceof Int16Array){u=e,c=new Float32Array(e.length);for(let d=0;d<e.length;d++)c[d]=e[d]/32768}else if(e instanceof Float32Array)c=e;else if(e instanceof Array)c=new Float32Array(e);else throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');if(i===-1)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(i<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');u||(u=Rg.floatTo16BitPCM(c));let h={bitsPerSample:16,channels:[c],data:u};s=new Rg().pack(i,h).blob,n=await s.arrayBuffer()}let a=await r.decodeAudioData(n),o=a.getChannelData(0),l=URL.createObjectURL(s);return{blob:s,url:l,values:o,audioBuffer:a}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e,t={},i=null){if(i=i||this.processor,!i)throw new Error("Can not send events without recording first");let r={event:e,id:this._lastEventId++,data:t};i.port.postMessage(r);let n=new Date().valueOf();for(;!this.eventReceipts[r.id];){if(new Date().valueOf()-n>this.eventTimeout)throw new Error(`Timeout waiting for "${e}" event`);await new Promise(a=>setTimeout(()=>a(!0),1))}let s=this.eventReceipts[r.id];return delete this.eventReceipts[r.id],s}listenForDeviceChange(e){if(e===null&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(e!==null){let t=0,i=[],r=s=>s.map(a=>a.deviceId).sort().join(","),n=async()=>{let s=++t,a=await this.listDevices();s===t&&r(i)!==r(a)&&(i=a,e(a.slice()))};navigator.mediaDevices.addEventListener("devicechange",n),n(),this._deviceChangeCallback=n}return!0}async requestPermission(){let e=await navigator.permissions.query({name:"microphone"});if(e.state==="denied")window.alert("You must grant microphone access to use this feature.");else if(e.state==="prompt")try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop())}catch{window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");await this.requestPermission();let e=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput"),t=e.findIndex(r=>r.deviceId==="default"),i=[];if(t!==-1){let r=e.splice(t,1)[0],n=e.findIndex(s=>s.groupId===r.groupId);n!==-1&&(r=e.splice(n,1)[0]),r.default=!0,i.push(r)}return i.concat(e)}async begin(e){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");try{let a={audio:!0};e&&(a.audio={deviceId:{exact:e}}),this.stream=await navigator.mediaDevices.getUserMedia(a)}catch{throw new Error("Could not start media stream")}let t=new AudioContext({sampleRate:this.sampleRate}),i=t.createMediaStreamSource(this.stream);try{await t.audioWorklet.addModule(this.scriptSrc)}catch(a){throw console.error(a),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let r=new AudioWorkletNode(t,"audio_processor");r.port.onmessage=a=>{let{event:o,id:l,data:c}=a.data;if(o==="receipt")this.eventReceipts[l]=c;else if(o==="chunk")if(this._chunkProcessorSize){let u=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:Rg.mergeBuffers(u.raw,c.raw),mono:Rg.mergeBuffers(u.mono,c.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(c)};let n=i.connect(r),s=t.createAnalyser();return s.fftSize=8192,s.smoothingTimeConstant=.1,n.connect(s),this.outputToSpeakers&&(console.warn(`Warning: Output to speakers may affect sound quality,
especially due to system audio feedback preventative measures.
use only for debugging`),s.connect(t.destination)),this.source=i,this.node=n,this.analyser=s,this.processor=r,!0}getFrequencies(e="frequency",t=-100,i=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return yk.getFrequencies(this.analyser,this.sampleRate,null,e,t,i)}async pause(){if(this.processor){if(!this.recording)throw new Error("Already paused: please call .record() first")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(e=()=>{},t=8192){if(this.processor){if(this.recording)throw new Error("Already recording: please call .pause() first");if(typeof e!="function")throw new Error("chunkProcessor must be a function")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessor=e,this._chunkProcessorSize=t,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(e=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");let t=await this._event("export");return new Rg().pack(this.sampleRate,t.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");let e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach(i=>i.stop()),this.log("Exporting ...");let t=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,new Rg().pack(this.sampleRate,t.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}},x4e=`
class StreamProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.hasStarted = false;
    this.hasInterrupted = false;
    this.outputBuffers = [];
    this.bufferLength = 128;
    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };
    this.writeOffset = 0;
    this.trackSampleOffsets = {};
    this.port.onmessage = (event) => {
      if (event.data) {
        const payload = event.data;
        if (payload.event === 'write') {
          const int16Array = payload.buffer;
          const float32Array = new Float32Array(int16Array.length);
          for (let i = 0; i < int16Array.length; i++) {
            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32
          }
          this.writeData(float32Array, payload.trackId);
        } else if (
          payload.event === 'offset' ||
          payload.event === 'interrupt'
        ) {
          const requestId = payload.requestId;
          const trackId = this.write.trackId;
          const offset = this.trackSampleOffsets[trackId] || 0;
          this.port.postMessage({
            event: 'offset',
            requestId,
            trackId,
            offset,
          });
          if (payload.event === 'interrupt') {
            this.hasInterrupted = true;
          }
        } else {
          throw new Error(\`Unhandled event "\${payload.event}"\`);
        }
      }
    };
  }

  writeData(float32Array, trackId = null) {
    let { buffer } = this.write;
    let offset = this.writeOffset;
    for (let i = 0; i < float32Array.length; i++) {
      buffer[offset++] = float32Array[i];
      if (offset >= buffer.length) {
        this.outputBuffers.push(this.write);
        this.write = { buffer: new Float32Array(this.bufferLength), trackId };
        buffer = this.write.buffer;
        offset = 0;
      }
    }
    this.writeOffset = offset;
    return true;
  }

  process(inputs, outputs, parameters) {
    const output = outputs[0];
    const outputChannelData = output[0];
    const outputBuffers = this.outputBuffers;
    if (this.hasInterrupted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else if (outputBuffers.length) {
      this.hasStarted = true;
      const { buffer, trackId } = outputBuffers.shift();
      for (let i = 0; i < outputChannelData.length; i++) {
        outputChannelData[i] = buffer[i] || 0;
      }
      if (trackId) {
        this.trackSampleOffsets[trackId] =
          this.trackSampleOffsets[trackId] || 0;
        this.trackSampleOffsets[trackId] += buffer.length;
      }
      return true;
    } else if (this.hasStarted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else {
      return true;
    }
  }
}

registerProcessor('stream_processor', StreamProcessor);
`,w4e=new Blob([x4e],{type:"application/javascript"}),b4e=URL.createObjectURL(w4e),_4e=b4e,S4e=class{constructor({sampleRate:e=44100}={}){this.scriptSrc=_4e,this.sampleRate=e,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),this.context.state==="suspended"&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(t){throw console.error(t),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let e=this.context.createAnalyser();return e.fftSize=8192,e.smoothingTimeConstant=.1,this.analyser=e,!0}getFrequencies(e="frequency",t=-100,i=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return yk.getFrequencies(this.analyser,this.sampleRate,null,e,t,i)}_start(){let e=new AudioWorkletNode(this.context,"stream_processor");return e.connect(this.context.destination),e.port.onmessage=t=>{let{event:i}=t.data;if(i==="stop")e.disconnect(),this.stream=null;else if(i==="offset"){let{requestId:r,trackId:n,offset:s}=t.data,a=s/this.sampleRate;this.trackSampleOffsets[r]={trackId:n,offset:s,currentTime:a}}},this.analyser.disconnect(),e.connect(this.analyser),this.stream=e,!0}add16BitPCM(e,t="default"){if(typeof t!="string")throw new Error("trackId must be a string");if(this.interruptedTrackIds[t])return;this.stream||this._start();let i;if(e instanceof Int16Array)i=e;else if(e instanceof ArrayBuffer)i=new Int16Array(e);else throw new Error("argument must be Int16Array or ArrayBuffer");return this.stream.port.postMessage({event:"write",buffer:i,trackId:t}),i}async getTrackSampleOffset(e=!1){if(!this.stream)return null;let t=crypto.randomUUID();this.stream.port.postMessage({event:e?"interrupt":"offset",requestId:t});let i;for(;!i;)i=this.trackSampleOffsets[t],await new Promise(n=>setTimeout(()=>n(),1));let{trackId:r}=i;return e&&r&&(this.interruptedTrackIds[r]=!0),i}async interrupt(){return this.getTrackSampleOffset(!0)}},E9=()=>"https://relayserver.spline.design/",C9=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.items=[],this.isConnected=!1,this.rafId=0,this.emitter=kT(),this.voice=0,this.frequencies=new Float32Array([0]),this.onRealTimeEvent=({time:r,source:n,event:s})=>{n==="server"&&s.type==="spline.ready"?this.onSessionCreated(s):n==="server"&&s.type==="session.created"&&(this.client.createResponse(),this.client.on("realtime.event",this.onRealTimeEvent))},this.onSessionCreated=async r=>{let n=Object.values(this.client.tools).map(s=>({type:"function",...s.definition}));this.client.realtime.send("spline.tools",{tools:n}),this.client.realtime.send("spline.connect",{}),await this.wavRecorder.record(s=>this.client.isConnected()&&this.client.appendInputAudio(s.mono))},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected){let r=this.wavStreamPlayer.analyser?this.wavStreamPlayer.getFrequencies("voice"):{values:new Float32Array([0])},n=r.values.reduce((s,a)=>s+a,0)/r.values.length;this.voice=n,this.frequencies=r.values,this.emitter.emit("voice",{value:n,frequencies:r.values})}},this.client=new _9({url:E9()+"?uuidfile="+e.integration.hash}),this.wavRecorder=new M9({sampleRate:24e3}),this.wavStreamPlayer=new S4e({sampleRate:24e3})}update(e){this.data=e,this.client=new _9({url:E9()+"?uuidfile="+e.integration.hash})}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:r}=i,{r:n,g:s,b:a}=kUe.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}connect(){if(this.isConnected)return;this.isConnected=!0,this.client.updateSession({turn_detection:{type:"server_vad"}}),this.client.addTool({name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let e=this.shared.getVariablesNames().join(", ");this.client.addTool({name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.client.addTool({name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.client.addTool({name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.client.on("error",n=>console.error(n)),this.client.on("conversation.interrupted",async()=>{let n=await this.wavStreamPlayer.interrupt();if(n!=null&&n.trackId){let{trackId:s,offset:a}=n;await this.client.cancelResponse(s,a)}}),this.client.on("conversation.updated",async({item:n,delta:s})=>{var o;let a=this.client.conversation.getItems();if(s!=null&&s.audio&&this.wavStreamPlayer.add16BitPCM(s.audio,n.id),n.status==="completed"&&((o=n.formatted.audio)==null?void 0:o.length)){let l=await M9.decode(n.formatted.audio,24e3,24e3);n.formatted.file=l}this.items=a}),this.animate()}disconnect(){cancelAnimationFrame(this.rafId),this.voice=0,this.isConnected=!1}async start(){try{await this.wavRecorder.end()}catch{}await this.wavRecorder.begin(),this.client.on("realtime.event",this.onRealTimeEvent),await this.wavStreamPlayer.connect(),await this.client.connect()}async stop(){try{this.client.off("realtime.event",this.onRealTimeEvent)}catch(e){console.error(e)}this.client.disconnect(),await this.wavRecorder.end(),await this.wavStreamPlayer.interrupt()}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,r)=>i+r,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function fB(e){return"variable_"+e}var A4e=class extends eze{constructor(e){super(),this.shared=e}create(e){return new bie(e,this.shared)}},xk=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new w9(!0),this.geometryCache2=new w9(!1),this.imageHolderCache=new A4e(this),this.thisContext={scene:r4e,shared:this},this.deletedMaterial=new pB(Kn.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new ld(GO.emptyImage,this),this.deletedVideo=new ld(tC.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new pB(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new gk(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new ld(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new ld(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new ld(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new xC(t.r,t.g,t.b,t.a):this.colors[e]=new xC(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new ys(0,0,0,0))}else return"a"in e?new ys(e.r,e.g,e.b,e.a):new ys(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof G1)return t;{let i=new G1({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof G1&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new e4e(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof G1&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(fB(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(fB(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*St.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Ei.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,n;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=St.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>Dn.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var r;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(Jn.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let n=t.userAPIs[e.path[1]];if(n){let s=e.type===0&&e.props.debounce===void 0,a=this.getUserAPI(e.path[1]);a instanceof C9?a.update(n):a==null||a.update(n,this,s)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let n=t.userWebhooks[e.path[1]];n&&((r=this.getUserWebhook(e.path[1]))==null||r.update(n))}}else e.path[0]==="lib"&&this.updateLibByOp(Jn.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){var i,r;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===e?(this.openAIRealtime.update(t),!0):((r=t.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new C9(t,e,this),!1):(this.userAPIs[e]=new Ute(e,t,this),!1)}getUserAPI(e){var t;return((t=this.openAIRealtime)==null?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new o4e(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new xk(Do.emptyData());var ty=class extends la{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),CBe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(sr(e.path,["material"])&&this.material instanceof Kd)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(Jn.drop(e,1),t.material,i);else if(sr(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(Jn.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var n,s;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=e.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),(((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&Tee(this.material).forEach(e=>{e instanceof Kd&&(e instanceof pB||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},T9=new F,P9=new ii,D9=new ii,M4e=new F,R9=new ot,vn=class extends ty{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new ot().fromArray(t.bindMatrix),this.bindMatrixInverse=new ot)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Ot&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof xk){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return nC.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return nC.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),sr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Jn.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=_w(c,t,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&oB(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=_w(n,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof $s&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,t.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[e];i!==void 0&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new ii,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;P9.fromBufferAttribute(r.attributes.skinIndex,e),D9.fromBufferAttribute(r.attributes.skinWeight,e),T9.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=D9.getComponent(n);if(s!==0){let a=P9.getComponent(n);R9.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(M4e.copy(T9).applyMatrix4(R9),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function E4e(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new F(n[l],n[l+1],n[l+2]);t.has(c)?(a=t.get(c))==null||a.normals.push(u):t.set(c,{normals:[u],result:new F})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new xt(s,3))}function C4e(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new F;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new xt(i,3))}function wk(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof Kd)||e.material.getLayersOfType("outline").length===0)return;e instanceof vn&&e.is2DAndNoDepth?C4e(e):E4e(e)}function bk(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[St.seededRandom(r),St.seededRandom(r+1e4),St.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new Wt(i,3))}var nc=new nn,p1=new F;function T4e(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Sw=class extends vn{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new ot,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=$s.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,wk(this),bk(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){$s.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&$s.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=$s.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=$s.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,la.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Oa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;nc.setFromBufferAttribute(t),nc.getCenter(i),e.boundingSphere.radius=i.distanceTo(nc.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),nc.getSize(p1),this.hasNonUniformScale&&p1.divide(this.scale);let r={width:p1.x,height:p1.y,depth:p1.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;nc.min.set(e[0],e[2],e[4]),nc.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(nc.min.applyMatrix4(this.shearScaleInv),nc.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Oa);let i=t.boundingSphere.center;nc.getCenter(i),t.boundingSphere.radius=i.distanceTo(nc.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&($s.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},I9=-1,P4e=1,D4e={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},R4e={polygon_center:0,edge:1,vertex:2},DA=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,li=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-I9)*(i-r)/(P4e-I9)+r},I4e=new F,RA=new F,L4e=new F,O4e=new F;function Wv(e,t){let i=L4e.fromArray(e),r=O4e.fromArray(t);RA.copy(r).sub(i);let n=RA.length();return RA.normalize().multiplyScalar(n*.5),I4e.copy(i).add(RA).toArray()}var Lo=new ps,IA=new F,bC=new F,sf=new F;function B4e(e){let t=[];for(let i=0;i<=e.index.count;i++)if(IA.fromArray(e.index.array,i*3),Lo.setFromAttributeAndIndices(e.attributes.position,IA.x,IA.y,IA.z),Lo.getNormal(bC),Lo.getMidpoint(sf),!(isNaN(sf.x)||isNaN(sf.y)||isNaN(sf.z))){let{a:r,b:n,c:s}=Lo,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=Wv(a,o),p=Wv(o,l),f=Wv(l,a),g=[c,u,h],m=Math.max(...g),v=g.filter(_=>Math.round(_)===Math.round(m)).length>1,x=[],y=Lo.getMidpoint(sf).toArray();m===c&&!v&&(x=[p,f,f],y=d),m===u&&!v&&(x=[d,f,f],y=p),m===h&&!v&&(x=[d,p,p],y=f),v&&(x=[d,p,f]),t.push({vertices:[a,o,l],faceCenters:x,midpoint:y,norm:Lo.getNormal(bC).toArray()})}return t}function F4e(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Lo.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Lo.getNormal(bC),Lo.getMidpoint(sf);let n=Lo.a.toArray(),s=Lo.b.toArray(),a=Lo.c.toArray();t.push({vertices:[n,s,a],faceCenters:[Wv(n,s),Wv(s,a),Wv(a,n)],midpoint:sf.toArray(),norm:bC.toArray()})}return t}var N4e=4,U4e=.5,$R=e=>.5*(1-Math.cos(e*Math.PI)),k4e=class{constructor(){this.perlin=new Array(4095+1)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let m=0;m<4095+1;m++)this.perlin[m]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,c,u,h=0,d=.5,p,f,g;for(let m=0;m<N4e;m++){let v=r+(n<<4)+(s<<8);c=$R(a),u=$R(o),p=this.perlin[v&4095],p+=c*(this.perlin[v+1&4095]-p),f=this.perlin[v+16&4095],f+=c*(this.perlin[v+16+1&4095]-f),p+=u*(f-p),v+=256,f=this.perlin[v&4095],f+=c*(this.perlin[v+1&4095]-f),g=this.perlin[v+16&4095],g+=c*(this.perlin[v+16+1&4095]-g),f+=u*(g-f),p+=$R(l)*(f-p),h+=p*d,d*=U4e,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4095+1);for(let i=0;i<4095+1;i++)this.perlin[i]=t.rand()}},z4e=k4e,L9=new F,O9=new ot,B9=new V0;function F9(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(t=!0)}),t}var _k=class extends vn{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(O9.copy(i).invert(),B9.copy(e.ray).applyMatrix4(O9),B9.intersectBox(this.singleBBox,L9))){let r=L9.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},Ys=1e-4,sc,Lie,Oie,Bie,N9=new F,U9=new F;Hte.then(e=>{sc=e,Lie=[sc.get_face_center,sc.get_edge_midpoint,sc.get_vertex_position],Oie=[sc.get_face_normal,sc.get_edge_normal,sc.get_vertex_normal],Bie=[sc.face_count,sc.edge_count,sc.vertex_count]});var V4e=new ot,G4e=new ot,kh=new F,LA=new F,f1=new F,e3=new F,H4e=new F,j4e=new F,W4e=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new z4e,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):t?this.noise=uNe((0,ZO.default)(e.seed)):this.noise=cNe((0,ZO.default)(e.seed))}},No=class extends ik(Qi){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof gs&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof gs&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)t=0;else if(e===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,n=t-i.length;r<n;++r){let s=new gs(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-t;r<n;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let n=new gs(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[i])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new W4e(e,t)),this.random}_updateRadial(e){let t=e.radial,i=t.start*St.DEG2RAD,r=t.end*St.DEG2RAD,n=i-r,s=new Pn(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new F(0,0,1);break;case"y":a=new F(0,1,0);break;default:case"x":a=new F(1,0,0);break}let o=e.randomnessObject??pd.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=DA(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,p=l.noise(d,d,d),f=u+1;h.scale.x=t.scale[0]+c(f,li(p,o.scale[0]))||Ys,h.scale.y=t.scale[1]+c(f,li(p,o.scale[1]))||Ys,h.scale.z=t.scale[2]+c(f,li(p,o.scale[2]))||Ys,h.position.setScalar(0);let g=n/e.count*u-i;switch(t.axis){case"x":h.rotation.set(0,g,0);break;case"y":h.rotation.set(0,0,g);break;case"z":h.rotation.set(g,0,0);break}h.translateOnAxis(a,t.radius),h.position.x+=t.position[0]+c(f,li(p,o.position[0])),h.position.y+=t.position[1]+c(f,li(p,o.position[1])),h.position.z+=t.position[2]+c(f,li(p,o.position[2]));let m=c(f,li(p,o.rotation[0])),v=c(f,li(p,o.rotation[1])),x=c(f,li(p,o.rotation[2]));t.alignment===!0?(h.rotation.x+=s.x+m,h.rotation.y+=s.y+v,h.rotation.z+=s.z+x):h.rotation.set(s.x+m,s.y+v,s.z+x)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new Pn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??pd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=DA(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),u=a+1,h=s(u,li(c,r.rotation[0])),d=s(u,li(c,r.rotation[1])),p=s(u,li(c,r.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(u,li(c,r.scale[0]))||Ys,o.scale.y=1+(t.scale[1]-1)*a+s(u,li(c,r.scale[1]))||Ys,o.scale.z=1+(t.scale[2]-1)*a+s(u,li(c,r.scale[2]))||Ys,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+p,o.position.x=t.position[0]*a+s(u,li(c,r.position[0])),o.position.y=t.position[1]*a+s(u,li(c,r.position[1])),o.position.z=t.position[2]*a+s(u,li(c,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??pd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=DA(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new F(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement),d=this.children[t++];d.scale.x=1+s(t,li(h,r.scale[0]))||Ys,d.scale.y=1+s(t,li(h,r.scale[1]))||Ys,d.scale.z=1+s(t,li(h,r.scale[2]))||Ys;let p=s(t,li(h,r.rotation[0])),f=s(t,li(h,r.rotation[1])),g=s(t,li(h,r.rotation[2]));d.rotation.set(p,f,g),d.position.x=i.size[0]*l-o.x+s(t,li(h,r.position[0])),d.position.y=i.size[1]*c-o.y+s(t,li(h,r.position[1])),d.position.z=i.size[2]*u-o.z+s(t,li(h,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),u=this.children[t++];u.scale.x=1+s(t,li(c,r.scale[0]))||Ys,u.scale.y=1+s(t,li(c,r.scale[1]))||Ys,u.scale.z=1+s(t,li(c,r.scale[2]))||Ys;let h=s(t,li(c,r.rotation[0])),d=s(t,li(c,r.rotation[1])),p=s(t,li(c,r.rotation[2]));u.rotation.set(h,d,p),u.position.x=i.size[0]*a+s(t,li(c,r.position[0])),u.position.y=-i.size[1]*o+s(t,li(c,r.position[1])),u.position.z=-i.size[2]*l+s(t,li(c,r.position[2]))}}_updateToObject(e){var u;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new Pn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??pd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=DA(r.strength,this.parameters.randomness);if(!t.object){for(let[,h]of this.children.entries())h.position.set(0,0,0),h.scale.setScalar(1),h.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof _k)if(!((u=this.objectForSample.font)!=null&&u.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let h=Math.round(a.length*t.count/100);this._updateCount(h)}else{let h=this.objectForSample.geometry.getAttribute("position");if(!h||isNaN(h.count)||h.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new hNe(this.objectForSample).build(),l=D4e[t.axis],c=this.children;o.setRandomGenerator((0,ZO.default)(this.object.uuid+t.seed));for(let[h,d]of c.entries()){let p=h*(r.freqScale/10)+r.movement,f=n.noise(p,p,p),g=h+1,m=s(g,li(f,r.rotation[0])),v=s(g,li(f,r.rotation[1])),x=s(g,li(f,r.rotation[2]));t.spreadType==="random"?o.sample(f1,e3):(a.length&&(f1.fromArray(a[h].pos),e3.fromArray(a[h].norm)),this.objectForSample instanceof Sw&&f1.applyMatrix4(V4e.copy(this.objectForSample.matrixWorld).invert())),f1.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(f1),kh.fromArray(l);let y=t.align==="normal"?e3:this.object.getWorldDirection(j4e),_=LA.fromArray(t.position);LA.x+=s(g,li(f,r.position[0])),LA.y+=s(g,li(f,r.position[1])),LA.z+=s(g,li(f,r.position[2]));let A=Math.acos(y.dot(kh)),S=H4e.crossVectors(kh,y).normalize(),C=G4e.makeRotationAxis(S,A),M=y.clone().cross(this.object.up).normalize(),E=M.clone().cross(y).normalize(),P=new ot().makeBasis(M,y,E),R=new F(kh.y,kh.z,kh.x).normalize(),O=R.clone().cross(kh).normalize(),L=new ot().makeBasis(R,kh,O).invert(),I=new ot().multiplyMatrices(P,L);d.rotation.setFromRotationMatrix(I),_.applyMatrix4(C),d.position.add(_),d.rotation.x=d.rotation.x+i.x+m,d.rotation.y=d.rotation.y+i.y+v,d.rotation.z=d.rotation.z+i.z+x,d.scale.setScalar(1),d.scale.x=d.scale.x+t.scale[0]+s(g,li(f,r.scale[0]))||Ys,d.scale.y=d.scale.y+t.scale[1]+s(g,li(f,r.scale[1]))||Ys,d.scale.z=d.scale.z+t.scale[2]+s(g,li(f,r.scale[2]))||Ys,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=t.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...n],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof Sw){let n=this.objectForSample,s=R4e[e],a=Bie[s],o=Lie[s],l=Oie[s],c=a(n.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(n.subdivPointerNew,u),d=l(n.subdivPointerNew,u);N9.fromArray(h).applyMatrix4(n.matrixWorld),U9.fromArray(d),i(N9.toArray(),U9.toArray())}}else(this.objectForSample.geometry.index?B4e(this.objectForSample.geometry):F4e(this.objectForSample.geometry)).forEach((n,s)=>{e==="polygon_center"&&i(n.midpoint,n.norm),e==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),e==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(t.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(e,t){var i;if(this.parameters=RT(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof la?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new ot,this.hiddenMatrix=new ot,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},mb=e=>{var t;return t=class extends e{},t.geometryHelper=new Fl(30,30,30),t},OA=new V0,t3=new Oa,k9=new ot,gb=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),t3.copy(a.boundingSphere),t3.applyMatrix4(o),i.ray.intersectsSphere(t3)===!1||(k9.copy(o).invert(),OA.copy(i.ray).applyMatrix4(k9),a.boundingBox!==null&&OA.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,p=a.attributes.position,f=a.drawRange,g,m;if(n===!1){let x=Math.max(0,f.start),y=Math.min(d.count,f.start+f.count);for(g=x,m=y;g<m;g+=3)if(c=d.getX(g),u=d.getX(g+1),h=d.getX(g+2),l=v(e,i,OA,p,c,u,h),l){l.faceIndex=Math.floor(g/3),r.push(l);return}}else{let x=a.attributes.position,y=new F,_=new F,A=new F,S=new F,C=2,M=1/((s.scale.x+s.scale.y+s.scale.z)/3),E=M*M,P=Math.max(0,f.start),R=Math.min(x.count,f.start+f.count);for(let O=P,L=R-1;O<L;O+=C){if(y.fromBufferAttribute(x,O),_.fromBufferAttribute(x,O+1),OA.distanceSqToSegment(y,_,S,A)>E)continue;S.applyMatrix4(s.matrixWorld);let I=i.ray.origin.distanceTo(S);I<i.near||I>i.far||r.push({distance:I,point:A.clone().applyMatrix4(s.matrixWorld),object:e})}}function v(x,y,_,A,S,C,M){let E=new F,P=new F,R=new F,O=new F,L=new F;if(E.fromBufferAttribute(A,S),P.fromBufferAttribute(A,C),R.fromBufferAttribute(A,M),_.intersectTriangle(E,P,R,!1,O)===null)return null;L.copy(O),L.applyMatrix4(x.matrixWorld);let I=y.ray.origin.distanceTo(L);return I<y.near||I>y.far?null:{faceIndex:1,distance:I,point:L.clone(),object:x}}},BA=new F,wo=new cp,X4e=class extends ab{constructor(e){let t=new Ot,i=new up({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new jt(15711266),o=new jt(15711266),l=new jt(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,p){u(h,p),u(d,p)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new xt(r,3)),t.setAttribute("color",new xt(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;wo.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;ll("n1",t,e,wo,-i,-r,n),ll("n2",t,e,wo,i,-r,n),ll("n3",t,e,wo,-i,r,n),ll("n4",t,e,wo,i,r,n);let s=n;ll("f1",t,e,wo,-i,-r,s),ll("f2",t,e,wo,i,-r,s),ll("f3",t,e,wo,-i,r,s),ll("f4",t,e,wo,i,r,s);let a=s,o=.5;ll("u1",t,e,wo,i*.7*o,r*1.1,a),ll("u2",t,e,wo,-i*.7*o,r*1.1,a),ll("u3",t,e,wo,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ll(e,t,i,r,n,s,a){BA.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],BA.x,BA.y,BA.z)}}var Y4e=class extends mb(X4e){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){gb(this.object,this.geometry,e,t,!0)}},mB;(e=>e.is=t=>"objectHelper"in t)(mB||(mB={}));var iy=(e,t)=>class extends rk(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof kE&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Fl?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof kE&&(r.visible=!1)}}},FA=790,Ig=new F,i3=new F,r3=new $t,n3=new F,m1=new F,s3=new F,Fs=class extends iy(cp,Y4e){constructor(e="",t={...mw.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=y0.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new ot,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new bT(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Ls(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new F(e,t,i)),super.lookAt(e),this.getWorldPosition(Ig),this.targetOffset=Ig.distanceTo(e)}getTarget(e=new F){return this.getWorldDirection(i3),this.getWorldPosition(Ig),i3.multiplyScalar(this.targetOffset),e.copy(Ig).add(i3),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Ig),Ig.distanceTo(e)}updateUp(){this.getWorldQuaternion(r3),n3.set(0,0,1).applyQuaternion(r3),m1.copy(Qi.DEFAULT_UP),this.isUpVectorFlipped&&m1.negate(),m1.applyQuaternion(r3),s3.copy(Qi.DEFAULT_UP).projectOnPlane(n3),this.angleOffsetFromUp=s3.angleTo(m1),this.angleOffsetFromUp*=s3.cross(m1).dot(n3)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new F),i=e.getWorldDirection(new F).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new F).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new F;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-FA*.5*r,this.right=FA*.5*r,this.top=FA*.5*(1/n),this.bottom=-FA*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return oO(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Lg=new ot,q4e=new ot;function z9(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var om=class extends ty{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Ot,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof om&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof la&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){Lg.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=_u.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;_u.transformMeshSet(s.booleanMeshSetAddress,Lg),s.booleanMatrixInvOld.copy(Lg).invert(),s.booleanWasTransformed=!1}else s instanceof om&&s.needsTransformForDownstream===!0?(_u.transformMeshSet(s.booleanMeshSetAddress,Lg),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(_u.transformMeshSet(s.booleanMeshSetAddress,q4e.multiplyMatrices(Lg,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(Lg).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}_u.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new xt([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return _u.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Ot,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=_u.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,wk(this),bk(this)}dispose(){super.dispose(),this.geometry.dispose()}},gB;(e=>{function t(i){return Ei.is(i)&&i instanceof cb}e.is=t})(gB||(gB={}));var Sk=(e,t)=>class extends iy(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},wl=e=>e instanceof la,Hu=e=>e!==null&&e instanceof om,Q4e=e=>e instanceof Fs,J4e=e=>gB.is(e),vB=e=>mB.is(e),K4e=new F(1,1,1),V9=new F,Z4e=new F,G9=new $t,vb=class extends mb(PTe){constructor(e,t=15){super(t),this.object=e,this.dummy=new Vu,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){gb(this.object,vb.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(V9,G9,Z4e),this.matrix.compose(V9,G9,K4e),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},Xv=class extends iy(Vu,vb){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},gx=class extends iy(Vu,vb){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},Fie={RED:0,GREEN:1,BLUE:2,ALPHA:3},yb="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",$4e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,NA=class extends Ri{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new rt(null),kernel16:new rt(null),inputBuffer:new rt(null),cocBuffer:new rt(null),texelSize:new rt(new pe),scale:new rt(1)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:$4e,vertexShader:yb}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(t[r++]=u,t[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new ii(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new ii(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function H9(e,t,i){return e*(t-i)-t}function yB(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var eVe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,tVe=class extends Ri{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new rt(null),focusDistance:new rt(0),focusRange:new rt(0),cameraNear:new rt(.3),cameraFar:new rt(1e3)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:eVe,vertexShader:yb}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ph){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-H9(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=yB(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-H9(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=yB(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ls?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},iVe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,rVe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",j9=class extends Ri{constructor(e=new pe){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new rt(null),texelSize:new rt(new pe),halfTexelSize:new rt(new pe),kernel:new rt(0),scale:new rt(1)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:iVe,vertexShader:rVe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},nVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,sVe=class extends Ri{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new rt(null),opacity:new rt(1)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:nVe,vertexShader:yb}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},aVe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,oVe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,VT={DEPTH:0,LUMA:1,COLOR:2},lVe={DISABLED:0,DEPTH:1,CUSTOM:2},cVe=class extends Ri{constructor(e=new pe,t=VT.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:z0.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new rt(null),depthBuffer:new rt(null),predicationBuffer:new rt(null),texelSize:new rt(e)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:aVe,vertexShader:oVe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ph){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},uVe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,hVe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",cl={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},xB=class extends Ri{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:z0.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new rt(null),depthBuffer:new rt(null),resolution:new rt(new pe),texelSize:new rt(new pe),cameraNear:new rt(.3),cameraFar:new rt(1e3),aspect:new rt(1),time:new rt(0)},blending:xn,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=ph){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=uVe.replace(cl.FRAGMENT_HEAD,e.get(cl.FRAGMENT_HEAD)).replace(cl.FRAGMENT_MAIN_UV,e.get(cl.FRAGMENT_MAIN_UV)).replace(cl.FRAGMENT_MAIN_IMAGE,e.get(cl.FRAGMENT_MAIN_IMAGE)),this.vertexShader=hVe.replace(cl.VERTEX_HEAD,e.get(cl.VERTEX_HEAD)).replace(cl.VERTEX_MAIN_SUPPORT,e.get(cl.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ls?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return cl}},dVe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,pVe=class extends Ri{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:z0.replace(/\D+/g,"")},uniforms:{inputBuffer:new rt(null),threshold:new rt(0),smoothing:new rt(1),range:new rt(null)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:dVe,vertexShader:yb}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},fVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Nie={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},mVe=class extends Ri{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new rt(e),inputBuffer:new rt(null),strength:new rt(1)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:fVe,vertexShader:yb}),this.toneMapped=!1,this.setColorChannel(Fie.RED),this.setMaskFunction(Nie.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Us&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},gVe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,vVe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",yVe=class extends Ri{constructor(e=new pe,t=new pe){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new rt(null),searchTexture:new rt(null),areaTexture:new rt(null),resolution:new rt(t),texelSize:new rt(e)},blending:xn,depthWrite:!1,depthTest:!1,fragmentShader:gVe,vertexShader:vVe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},xVe=new cp,zh=null;function wVe(){if(zh===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);zh=new Ot,zh.setAttribute!==void 0?(zh.setAttribute("position",new Wt(e,3)),zh.setAttribute("uv",new Wt(t,2))):(zh.addAttribute("position",new Wt(e,3)),zh.addAttribute("uv",new Wt(t,2)))}return zh}var ha=class{constructor(e="Pass",t=new Ia,i=xVe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new cr(wVe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ia),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=ph){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Ia||t===this.renderer)continue;this[e].dispose()}}}},wB=class extends ha{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new sVe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Di(1,1,{minFilter:di,magFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Us?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===ci&&(this.renderTarget.texture.encoding=ci))}},bVe=class extends ha{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},a3=new jt,Ak=class extends ha{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=a>=0;l?(a3.copy(e.getClearColor(a3)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(a3,o):c&&e.setClearAlpha(o)}},Vh=-1,Ta=class extends ws{constructor(e,t=Vh,i=Vh,r=1){super(),this.resizable=e,this.base=new pe(1,1),this.preferred=new pe(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Vh?r=t.width:t.height!==Vh?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Vh?r=t.height:t.width!==Vh?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Vh),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Vh}},o3=!1,W9=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Bs:i=this.materialsFlatShadedDoubleSide;break;case Zn:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Bs:i=this.materialsDoubleSide;break;case Zn:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Ol;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Zn,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Bs,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Zn,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Bs,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,o3){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return o3}static set workaroundEnabled(e){o3=e}},_Ve=class extends ha{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new Ak,this.overrideMaterialManager=i===null?null:new W9(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new W9(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},X9=class extends ha{constructor(e,t,{resolutionScale:i=1,width:r=Ta.AUTO_SIZE,height:n=Ta.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new _Ve(e,t,new b$({depthPacking:a$}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new jt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Di(1,1,{minFilter:vi,magFilter:vi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Ta(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Li={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},SVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",AVe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",MVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",EVe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",CVe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",TVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",PVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",DVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",RVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",IVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",LVe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",OVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",BVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",FVe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",NVe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",UVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",kVe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",zVe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",VVe=new Map([[Li.SKIP,null],[Li.ADD,SVe],[Li.ALPHA,AVe],[Li.AVERAGE,MVe],[Li.COLOR_BURN,EVe],[Li.COLOR_DODGE,CVe],[Li.DARKEN,TVe],[Li.DIFFERENCE,PVe],[Li.EXCLUSION,DVe],[Li.LIGHTEN,RVe],[Li.MULTIPLY,IVe],[Li.DIVIDE,LVe],[Li.NEGATION,OVe],[Li.NORMAL,BVe],[Li.OVERLAY,FVe],[Li.REFLECT,NVe],[Li.SCREEN,UVe],[Li.SOFT_LIGHT,kVe],[Li.SUBTRACT,zVe]]),GVe=class extends ws{constructor(e,t=1){super(),this.f=e,this.opacity=new rt(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return VVe.get(this.blendFunction)}},Lc={NONE:0,DEPTH:1,CONVOLUTION:2},Xc=class extends ws{constructor(e,t,{attributes:i=Lc.NONE,blendFunction:r=Li.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new GVe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=ph){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Ia||t===this.renderer)continue;this[e].dispose()}}}};function Y9(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function HVe(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&a&Lc.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,g=xB.Section;if(c){let v=`	${e}MainUv(UV);
`;i.set(g.FRAGMENT_MAIN_UV,i.get(g.FRAGMENT_MAIN_UV)+v),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(g.VERTEX_MAIN_SUPPORT,i.get(g.VERTEX_MAIN_SUPPORT)+v),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(x=>x[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(f)].map(x=>x[1]))}h=h.concat([...o.get("fragment").matchAll(f)].map(v=>v[1])),h=h.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,x)=>s.set(e+x.charAt(0).toUpperCase()+x.slice(1),v)),t.defines.forEach((v,x)=>n.set(e+x.charAt(0).toUpperCase()+x.slice(1),v)),Y9(e,h,n),Y9(e,h,o);let m=t.blendMode;if(r.set(m.blendFunction,m),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,x=`${e}MainImage(color0, UV, `;a&Lc.DEPTH&&v.test(o.get("fragment"))&&(x+="depth, ",p=!0),x+=`color1);
	`;let y=e+"BlendOpacity";s.set(y,m.opacity),x+=`color0 = blend${m.blendFunction}(color0, color1, ${y});

	`,i.set(g.FRAGMENT_MAIN_IMAGE,i.get(g.FRAGMENT_MAIN_IMAGE)+x),x=`uniform float ${y};

`,i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+x)}i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(g.VERTEX_HEAD,i.get(g.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:p}}var _C=class extends ha{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new xB(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=xB.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Li.SKIP)l|=d.getAttributes()&Lc.DEPTH;else if(l&d.getAttributes()&Lc.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,f=HVe(p,d,t,i,r,n,l);if(o+=f.varyings.length,c=c||f.transformedUv,u=u||f.readDepth,d.extensions!==null)for(let g of d.extensions)s.add(g)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}if(l&Lc.DEPTH){if(u){let d=`float depth = readDepth(UV);

	`;t.set(e.FRAGMENT_MAIN_IMAGE,d+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(c){let d=`vec2 transformedUv = vUv;
`;t.set(e.FRAGMENT_MAIN_UV,d+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")}else r.set("UV","vUv");t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=ph){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Us&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},jVe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Mk=class extends ha{constructor({resolutionScale:e=.5,width:t=Ta.AUTO_SIZE,height:i=Ta.AUTO_SIZE,kernelSize:r=GT.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Di(1,1,{minFilter:di,magFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Ta(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new j9,this.ditheredBlurMaterial=new j9,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=jVe[this.kernelSize],u=this.blurMaterial,h=t,d,p;for(this.fullscreenMaterial=u,d=0,p=c.length-1;d<p;++d){let f=d&1?l:o;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(f),e.render(s,a),h=f}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Us?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===ci&&(this.renderTargetA.texture.encoding=ci,this.renderTargetB.texture.encoding=ci))}static get AUTO_SIZE(){return Ta.AUTO_SIZE}},WVe=class extends ha{constructor({width:e=Ta.AUTO_SIZE,height:t=Ta.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new pVe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Di(1,1,{minFilter:di,magFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Ta(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==Us&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},XVe=class extends ha{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new Ak(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},Oo=class extends ha{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Us&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},l3=1/1e3,YVe=1e3,qVe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*l3}getFixedDelta(){return this.fixedDelta*l3}setFixedDelta(e){return this.fixedDelta=e*YVe,this}getElapsed(){return this.elapsed*l3}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},GT={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},QVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,JVe=class extends Xc{constructor({blendFunction:e=Li.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=Ta.AUTO_SIZE,height:a=Ta.AUTO_SIZE,kernelSize:o=GT.LARGE}={}){super("BloomEffect",QVe,{blendFunction:e,uniforms:new Map([["map",new rt(null)],["intensity",new rt(n)]])}),this.renderTarget=new Di(1,1,{minFilter:di,magFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new WVe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new Mk({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===ci&&(this.renderTarget.texture.encoding=ci))}},KVe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",ZVe=class extends Xc{constructor({blendFunction:e=Li.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",KVe,{blendFunction:e,uniforms:new Map([["brightness",new rt(t)],["contrast",new rt(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},$Ve="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",e5e=class extends Xc{constructor(e=Li.NORMAL){super("ColorAverageEffect",$Ve,{blendFunction:e})}},t5e="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",i5e="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",r5e=class extends Xc{constructor({blendFunction:e=Li.NORMAL,offset:t=new pe(.001,5e-4)}={}){super("ChromaticAberrationEffect",t5e,{vertexShader:i5e,blendFunction:e,attributes:Lc.CONVOLUTION,uniforms:new Map([["offset",new rt(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},n5e=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,s5e=class extends Xc{constructor(e,{blendFunction:t=Li.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Ta.AUTO_SIZE,height:c=Ta.AUTO_SIZE}={}){super("DepthOfFieldEffect",n5e,{blendFunction:t,attributes:Lc.DEPTH,uniforms:new Map([["nearColorBuffer",new rt(null)],["farColorBuffer",new rt(null)],["nearCoCBuffer",new rt(null)],["scale",new rt(1)]])}),this.camera=e,this.renderTarget=new Di(1,1,{minFilter:di,magFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Oo(new tVe(e));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new Mk({kernelSize:GT.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new Oo(new mVe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=Nie.MULTIPLY,d.colorChannel=Fie.GREEN,this.bokehNearBasePass=new Oo(new NA(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Oo(new NA(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Oo(new NA(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Oo(new NA(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return yB(-i,t.near,t.far)}setDepthTexture(e,t=ph){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,Us),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===ci&&(this.renderTarget.texture.encoding=ci,this.renderTargetNear.texture.encoding=ci,this.renderTargetFar.texture.encoding=ci,this.renderTargetMasked.texture.encoding=ci))}};new F;new ot;var a5e="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",o5e=class extends Xc{constructor({blendFunction:e=Li.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",a5e,{blendFunction:e,uniforms:new Map([["hue",new rt(new F)],["saturation",new rt(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new jt;var l5e=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,c5e=class extends Xc{constructor({blendFunction:e=Li.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",l5e,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},u5e="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",h5e=class extends Xc{constructor(e=30){super("PixelationEffect",u5e,{uniforms:new Map([["active",new rt(!1)],["d",new rt(new pe)]])}),this.resolution=new pe,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new F;new F;var q9="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",Q9="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",d5e="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",p5e="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",af={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Uie=class extends Xc{constructor({preset:e=af.MEDIUM,edgeDetectionMode:t=VT.COLOR,predicationMode:i=lVe.DISABLED}={}){super("SMAAEffect",d5e,{vertexShader:p5e,blendFunction:Li.NORMAL,attributes:Lc.CONVOLUTION|Lc.DEPTH,uniforms:new Map([["weightMap",new rt(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Di(1,1,{minFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new Ak(!0,!1,!1),this.clearPass.overrideClearColor=new jt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Oo(new cVe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Oo(new yVe);let s=new z$;s.onLoad=()=>{let a=new Br(r);a.name="SMAA.Search",a.magFilter=vi,a.minFilter=vi,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Br(n);o.name="SMAA.Area",o.magFilter=di,o.minFilter=di,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=q9,n.src=Q9),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case af.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case af.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case af.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case af.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=ph){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return q9}static get areaImageDataURL(){return Q9}},f5e=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,UA={DEFAULT:0,ESKIL:1},m5e=class extends Xc{constructor({blendFunction:e=Li.NORMAL,technique:t=UA.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",f5e,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new rt(r)],["darkness",new rt(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===UA.ESKIL}set eskil(e){this.technique=e?UA.ESKIL:UA.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},fh=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Li.NORMAL}},g5e=class extends fh{constructor(){super(JVe),this.blendFunction=Li.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},v5e=class extends fh{constructor(){super(ZVe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},y5e=class extends fh{constructor(){super(r5e),this.effect.offset=new pe(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},x5e=class extends fh{constructor(){super(e5e)}},w5e=class extends fh{constructor(){super(o5e),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},b5e=class extends fh{constructor(){super(c5e),this.blendFunction=Li.OVERLAY}},_5e=class extends fh{constructor(){super(m5e)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},S5e=class extends fh{constructor(e){super(s5e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},A5e=class extends fh{constructor(){super(h5e)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},M5e=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,E5e=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,C5e=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,T5e=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,bB=class extends Ri{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new rt(null)},blending:xn,depthWrite:!1,depthTest:!1,vertexShader:C5e,fragmentShader:T5e})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},P5e=class extends ha{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new bB,this.resolutionVector=new pe,this.resolveMaterial=new Ri({name:"TAAResolveMaterial",uniforms:{inputBuffer:new rt(null),historyBuffer:new rt(null),velocityBuffer:new rt(null),depthBuffer:new rt(null),resolution:new rt(new pe)},blending:xn,depthWrite:!1,depthTest:!1,vertexShader:M5e,fragmentShader:E5e}),this.historyRenderTarget=new Di(1024,1024,{minFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Di(1024,1024,{minFilter:di,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},D5e=class extends ha{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new X9(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new bB,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new bB,this.depthPass=new X9(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},J9=new Ia,R5e=new Ri({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),_B=class extends ha{constructor(e,t,i){super("OpaquePass",t??J9,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??J9}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof la&&(this.originalMaterials.push([r,r.material]),r.material=R5e)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},I5e=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new wB,this.depthTexture=null,this.timer=new qVe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new pe),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===Us&&e.outputEncoding===ci&&(this.inputBuffer.texture[0].encoding=ci,this.outputBuffer.texture[0].encoding=ci,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new p0(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=im,e.type=Ff):e.type=ku,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new pe:a.getDrawingBufferSize(new pe),l={minFilter:di,magFilter:di,wrapS:xr,wrapT:xr,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new Di(o.width,o.height,l),c.samples=r):(n?(c=new p$(o.width,o.height,2,l),c.texture[1].type=nh):c=new Di(o.width,o.height,l),c.depthTexture=new p0(2048,2048),c.depthTexture.type=Ki),i===Us&&a!==null&&a.outputEncoding===ci&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=ci):c.texture.encoding=ci),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new pe),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof XVe?o=!0:d instanceof bVe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new pe);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new pe);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},L5e=new Ri({name:"CombineMaterial",uniforms:{inputBufferA:new rt(null),inputBufferB:new rt(null)},blending:xn,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),O5e=class extends ha{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=L5e,this.helperPass=new _B(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new _B(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new Uie({preset:af.LOW,edgeDetectionMode:VT.COLOR});this.effectPass=new _C(this.camera,t),this.rt=new Di(10,10,{minFilter:di,magFilter:di,wrapS:xr,wrapT:xr,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},B5e=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,F5e=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,N5e=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,U5e=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,k5e=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,z5e=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,g1=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],V5e=new Ri({vertexShader:B5e,fragmentShader:F5e}),Og=new Ri({vertexShader:k5e,fragmentShader:z5e,uniforms:{texture_ao_lrez:new rt(null),texture_depth_lrez:new rt(null),texture_depth_hrez:new rt(null),near:new rt(null),far:new rt(null)}}),G5e=class extends ha{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Di(i,r,{type:db?nh:Ki,depthTexture:new p0(i,r),minFilter:di,magFilter:di}),this.depthBufferHighRes=new Di(i,r,{depthTexture:new p0(i,r)}),this.aoBuffer=new Di(i,r,{minFilter:di,magFilter:di}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(g1.length*2);for(let a=0;a<g1.length;a++){let o=a*2;n[o+0]=g1[a][0],n[o+1]=g1[a][1]}this.blueNoiseInDiskTexture=new ia(n,g1.length,1,EE,Ki),this.blueNoiseInDiskTexture.wrapS=Uu,this.blueNoiseInDiskTexture.wrapT=Uu,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Ri({vertexShader:N5e,fragmentShader:U5e,uniforms:{near:new rt(null),far:new rt(null),fov:new rt(null),proj_info:new rt(new ii),is_ortho:new rt(!1),resolution:new rt(new pe),radius_of_influence:new rt(8),radius_in_screen_space:new rt(1),exponent:new rt(1),ao_color:new rt(new F),bias:new rt(.5),texture_depth:new rt(null),texture_normals:new rt(null),texture_blue_noise:new rt(null),texture_blue_noise_in_disk:new rt(this.blueNoiseInDiskTexture),frame_index:new rt(0),fog_enabled:new rt(!1),fog_near:new rt(1),fog_far:new rt(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Di(i,r,{minFilter:di,magFilter:di,wrapS:xr,wrapT:xr,depthBuffer:!1,type:Ki});let s=new Uie({preset:af.ULTRA,edgeDetectionMode:VT.COLOR});this.effectPass=new _C(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,Og.uniforms.texture_depth_hrez.value=e,Og.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=V5e;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Og,Og.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Og.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Og.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},H5e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,j5e=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,W5e=class extends Oo{constructor(){super(new Ri({vertexShader:H5e,fragmentShader:j5e,uniforms:{tInput:new rt(null),tMap:new rt(null),uResolution:new rt(new pe),uSize:new rt(new pe),uCoords:new rt(new pe),uScale:new rt(1),uSceneColor:new rt(new jt(16711680)),uDPR:new rt(1),uCurrent:new rt(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},X5e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Y5e=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,q5e=[],Q5e=class extends Oo{constructor(){super(new Ri({vertexShader:X5e,fragmentShader:Y5e,uniforms:{toScene:new rt(null),fromScene:new rt(null),uResolution:new rt(new pe),uDPR:new rt(1),mixRatio:new rt(0),threshold:new rt(.1),useTexture:new rt(0),tMixTexture:{value:q5e[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},J5e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,K5e=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,Z5e=class extends Oo{constructor(){super(new Ri({vertexShader:J5e,fragmentShader:K5e,uniforms:{inputBuffer:new rt(null),blurredInputBuffer:new rt(null),overlay:new rt(null),uResolution:new rt(new pe),uDPR:new rt(1),blurIntensity:new rt(0)}})),this._blurEnabled=!1,this.blurTarget=new Di(1,1,{minFilter:di,magFilter:di,wrapS:xr,wrapT:xr}),this.blurPass=new Mk({width:window.innerWidth,height:window.innerHeight,kernelSize:GT.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},$5e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,eGe=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,tGe=class extends Oo{constructor(){super(new Ri({vertexShader:$5e,fragmentShader:eGe,uniforms:{tInput:new rt(null),tOverlayImage:new rt(null),uResolution:new rt(new pe),uImageSize:new rt(new pe),uRightBottom:new rt(new pe(20,20)),uScale:new rt(.25),uDPR:new rt(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function K9(e,t){return t&&t.enabled&&e.push(t.effect),e}var iGe=e=>Object.values(Li).includes(e)?e:Li.NORMAL,rGe=class extends ws{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=sC.defaultData,this._scene=new Ia,this._camera=new Fs,this.effects=new Map,this.blueNoiseTexture=new ia,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new dTe,this.renderer=e,this.debug=!1,this.effects.set("bloom",new g5e),this.effects.set("chromaticAberration",new y5e),this.effects.set("vignette",new _5e),this.effects.set("noise",new b5e),this.effects.set("colorAverage",new x5e),this.effects.set("hueSaturation",new w5e),this.effects.set("brightnessContrast",new v5e),this.effects.set("depthOfField",new S5e),this.effects.set("pixelation",new A5e),this.effectComposer=new I5e(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new _B(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new D5e(this.scene,this.camera,this.renderer),this.aoPass=new G5e(this.scene,this.camera),this.taaPass=new P5e,this.taaPass.renderToScreen=!1,this.helperPass=new O5e(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new W5e,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new Z5e,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new tGe,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new Q5e,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new ia(e,128,128),this.blueNoiseTexture.wrapS=Uu,this.blueNoiseTexture.wrapT=Uu,this.blueNoiseTexture.minFilter=vi,this.blueNoiseTexture.magFilter=vi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(K9,[]);r.length>0&&(this.uvEffectPass=new _C(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(K9,[]);if(n.length>0&&(this.effectPass=new _C(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new pe;this.renderer.getDrawingBufferSize(e),this._rt=new Di(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Uu,wrapT:Uu}),this._rt.samples=0,this._savePass=new wB(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new wB(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=iGe(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof ii?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof ii?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},nGe=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,sGe=ui.lights_fragment_begin,aGe=ui.shadowmask_pars_fragment,Z9=null,oGe=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},lGe=(e="medium")=>{if(Z9===e)return!1;Z9=e;let t=oGe(e);ui.shadowmap_pars_fragment=nGe(t);let i=sGe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),ui.lights_fragment_begin=i;let r=aGe.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),ui.shadowmask_pars_fragment=r,!0},cGe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,uGe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,c3=new Ri({vertexShader:cGe,fragmentShader:uGe,uniforms:{depthContrast:{value:1}}}),$9=new Br,e7=new pe,hGe=class extends _${constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new pe,this.dummyCamera=new Fs,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new rGe(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=uU,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Di(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:di,magFilter:di,wrapS:xr,wrapT:xr,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return qt.transmissionLod.value===1}set hdTransmission(e){qt.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Di(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:h0,magFilter:di,wrapS:xr,wrapT:xr,depthBuffer:!1}),this.transmissionDepthTarget=new Di(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:vi,magFilter:vi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Di(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:vi,magFilter:vi,type:Ki,depthTexture:new p0(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Fs?c3.uniforms.depthContrast.value=(i.far-i.near)/1e4:c3.uniforms.depthContrast.value=1,t.overrideMaterial=c3,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?PB:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=e instanceof Lk?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((p,f)=>{qt.penumbraSize.value[f]=p}),qt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?qt.resolution.value.set(this.resolution.x,this.resolution.y):qt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(qt.normalRenderTarget.value=s,qt.normalRenderTargetDepth.value=$9):l.needsNormal()&&(this.createNormalRenderTarget(),qt.normalRenderTarget.value=this.normalRenderTarget.texture,qt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),qt.aoRenderTarget.value=this.aoRenderTarget.texture),qt.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!db),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let p=this.getSize(e7),f=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==f)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},f),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(p.x,p.y,f),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let p=this.getSize(e7),f=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(p.x,p.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=f}let h=!1;if(n!==void 0)qt.transmissionRenderTarget.value=n,qt.transmissionRenderTargetDepth.value=$9,this.pipeline.setTransmissionPassEnabled(!1);else{let p=l.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),qt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,qt.aspectRatio.value=Wke(this.viewportWidth,this.viewportHeight),qt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(p=>{p.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?PB:null,this.pipeline.render(),qt.frameIndex.value=(qt.frameIndex.value+1)%16,t instanceof Fs&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},kie=class extends mb(TTe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){gb(this.object,kie.geometryHelper,e,t)}},zie=class extends mb(CTe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){gb(this.object,zie.geometryHelper,e,t)}},SB=class extends mb(ETe){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){gb(this.object,SB.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=SB._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},Vie=SB;Vie._vector=new F;var Gie=class extends Vu{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new cr(new zc(1,1),new sh({transparent:!0,opacity:0,side:Bs})),this.add(this.caretMesh),this.selectionMesh=new cr(new zc(1,1),new sh({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Bs})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=SC(i,e),[s,a]=e>0?SC(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=u3(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:p,depth:f}=this.object.geometry.userData.parameters,g=typeof d=="string"?0:d,m=typeof p=="string"?0:p;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-g*.5,l+h+m*.5,f),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=dGe(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[m,v,x]of s)if(v!==x){let[y,_]=u3(this.object,m,v),[A,S]=u3(this.object,m,x);_+=c,S+=c,S+=a;let C=r.length/3;r.push(y,_,0),r.push(A,_,0),r.push(A,S,0),r.push(y,S,0),n.push(C+0,C+1,C+2),n.push(C+2,C+3,C+0)}let u=new Ot;u.setIndex(n),u.setAttribute("position",new xt(r,3));let{width:h,height:d,depth:p}=this.object.geometry.userData.parameters,f=typeof h=="string"?0:h,g=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-f*.5,this.selectionMesh.position.y=g*.5,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-u,a),0)/s),n-1),d=this.object.charCoords[h],p=this.object.charWidths[h],f=0,g=!1;if(i==="previous"){for(let m=0;m<d.length;m++)if(d[m][0]+p[m]*.5-e>0){f=m,g=!0;break}}else if(i==="closest"){let m=1/0;for(let v=0;v<d.length;v++){let x=d[v][0]+p[v]*.5,y=Math.abs(x-e);y<m&&(m=y,f=v,g=!0)}}else for(let m=0;m<d.length;m++){let v=d[m][0],x=d[m][0]+p[m];if(e>=v&&e<x){f=m,g=!0;break}}return g||(f=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,f),lineIndex:h,characterIndex:f}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function u3(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let u=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:p}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=p*.5:h===2&&(u=p)),[u,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,c]}function SC(e,t){var r;let i=0;for(let n=0;n<e.length;n++){let s=e[n],a=t-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,e.length-1),((r=e[e.length-1])==null?void 0:r.length)??0]}function dGe(e,t,i){let[r,n]=SC(e,t),[s,a]=SC(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=e[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function pGe(e,t){let i=hs.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=fGe(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=mGe(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function fGe(e,t){return typeof e=="string"?t.data.colors[e]:e}function mGe(e){return e.colors[0]}function gGe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var Hie=class extends Sk(hTe,kie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new UE(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof UE&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&gGe(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},t7=new F,i7=new F,r7=new $t,jie=class extends Sk(oTe,Vie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=St.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new UE(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof UE&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),i7.setFromMatrixPosition(this.matrixWorld),r7.setFromRotationMatrix(this.matrixWorld),t7.copy(this.up).applyQuaternion(r7).negate().multiplyScalar(this.distance),this.target.position.copy(i7).add(t7),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function vGe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,t),h=(u-c)/2,d=(u+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[o,0],[0,l]],g=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return p[0][0]*=-1,p[0][1]*=-1,g[0][0]*=-1,g[1][0]*=-1,[p,f,g]}function RM(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function n7(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function yGe(e){let[t,i,r]=vGe(e),n=RM(t,n7(r)),s=RM(RM(r,i),n7(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function xGe({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=RM(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Fi;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(S,C=e.identity()){for(let M=0,E=S.length;M<E;M++)C[M]=S[M];return C}e.copy=i;function r(S,C,M,E,P,R){return e.setAbcdef(e.identity(),S,C,M,E,P,R)}e.create=r;function n(S,C,M,E,P,R,O){return S[0]=C,S[1]=E,S[2]=R,S[3]=M,S[4]=P,S[5]=O,S}e.setAbcdef=n;function s(S,C){let[M,E,P,R,O,L]=o(S),[I,z,K,Y,U,j]=o(C),k=I*M+z*P,q=I*E+z*R,W=K*M+Y*P,te=K*E+Y*R,G=U*M+j*P+O,le=U*E+j*R+L;return e.create(k,q,W,te,G,le)}e.append=s;function a(S,C){let[M,E,P,R,O,L]=o(S),[I,z,K,Y,U,j]=o(C),k=M,q=E,W=P,te=R;(I!==1||z!==0||K!==0||Y!==1)&&(k=M*I+E*K,q=M*z+E*Y,W=P*I+R*K,te=P*z+R*Y);let G=O*I+L*K+U,le=O*z+L*Y+j;return e.create(k,q,W,te,G,le)}e.prepend=a;function o(S){return[S[0],S[3],S[1],S[4],S[2],S[5]]}e.getAbcdef=o;function l(S){let[C,M,E,P,R,O]=e.getAbcdef(S),L=C*P-M*E,I=P/L,z=-M/L,K=-E/L,Y=C/L,U=(E*O-P*R)/L,j=-(C*O-M*R)/L;return e.create(I,z,K,Y,U,j)}e.invert=l;function c([S,C],M){let[E,P,R,O,L,I]=e.getAbcdef(M);return[E*S+R*C+L,P*S+O*C+I]}e.apply=c;function u(S,C){let[M,E,P,R,O,L]=e.getAbcdef(C),I=1/(M*R+P*-E),[z,K]=S;return[R*I*z+-P*I*K+(L*P-O*R)*I,M*I*K+-E*I*z+(-L*M+O*E)*I]}e.applyInverse=u;function h(S,C,M=C){let[E,P,R,O,L,I]=e.getAbcdef(S);return e.setAbcdef(S,E*C,P*M,R*C,O*M,L*C,I*M),S}e.scale=h;function d(S,C){let M=Math.cos(C),E=Math.sin(C),[P,R,O,L,I,z]=e.getAbcdef(S);return e.setAbcdef(S,P*M-R*E,P*E+R*M,O*M-L*E,O*E+L*M,I*M-z*E,I*E+z*M),S}e.rotate=d;function p(S,C,M){let[E,P]=M,R=e.translate(S,-E,-P);return R=e.rotate(R,C),R=e.translate(R,E,P),R}e.rotateAround=p;function f(S,C,M){let[E,P,R,O,L,I]=e.getAbcdef(S);return e.setAbcdef(S,E,P,R,O,L+C,I+M),S}e.translate=f;function g(S,C,M){let[E,P,R,O]=e.getAbcdef(S);return e.setAbcdef(S,E,P,R,O,C,M),S}e.setTranslate=g;function m(S,C,M){let[E,P,R,O]=e.getAbcdef(S);return e.setAbcdef(S,E,P,R,O,C,M),S}e.setPosition=m;function v(S){let[C,M,E,P]=e.getAbcdef(S),R=Math.sqrt(C*C+M*M),O=Math.sqrt(E*E+P*P);return[R,O]}e.getScale=v;function x(S){let[,,,,C,M]=e.getAbcdef(S);return[C,M]}e.getPosition=x;function y(S,C){return e.decompose(S,C).rotation}e.getRotation=y;function _(S,C){let[M,E,P,R,O,L]=e.getAbcdef(S),{rotation:I,scale:z,shear:K}=yGe([[M,P],[E,R]]);return{position:[O+(C[0]*M+C[1]*P)-C[0],L+(C[0]*E+C[1]*R)-C[1]],scale:z,rotation:I,shear:K,pivot:C}}e.decompose=_;function A(S,C,M,E,P=[0,0]){let[R,O]=S,[L,I]=E,[z,K,Y,U]=xGe({rotation:M,scale:C,shear:P}),j=R-(L*z+I*Y)+L,k=O-(L*K+I*U)+I;return e.create(z,K,Y,U,j,k)}e.compose=A})(Fi||(Fi={}));var wGe=Math.PI/180;function bGe(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function _Ge(e){return e*wGe}var is=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Fi.identity(),this.worldMatrix=Fi.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new AB,this._recursiveBBox=new AB,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=kT(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Fi.append(t.worldMatrix,i)),Fi.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Fi.compose(this.position,this.scale,_Ge(this.rotation),zf.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Fi.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Fi.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return zf.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=sr(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Dn.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=Dn.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,Af.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)Af.toOps(this.data,r.data).forEach(n=>{let s=QE.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=Af.patch(this.data,r),Af.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new is(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof is&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},bl=class extends is{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof bl&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof bl?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof bl&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof bl&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new bl(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Zd=class extends bl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Zd(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function SGe(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,c]]=t,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var Wie=[[-1,1],[-1,-1],[1,-1],[1,1]],s7=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=Fi.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(Fi.apply(r,s)):Wie.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Fi.apply(o,s))})},AB=class{constructor(){this.matrix=Fi.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Fi.copy(e.worldMatrix,this.matrix);let i=Fi.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof bl?e.traverse(n=>{n.visible&&s7(n,t,r)}):s7(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),Fi.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Fi.apply([0,0],i),Fi.apply([0,t],i),Fi.apply([e,t],i),Fi.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Fi.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Fi.getAbcdef(this.matrix),o=Fi.create(r,n,s,a,i[0],i[1]);this.vertices=Wie.map(([l,c])=>Fi.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Fi.append(t.worldMatrix,i)),Fi.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if(SGe(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Fi.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new AB;return e.copy(this),e}},Xie,AGe=new Promise(e=>{Xie=e}),a7=!1,kA;function MGe(){if(a7)return;if(kA)return kA;async function e(){let t=await ap(()=>import("./ui-dad2f740.js"),[]);Xie(t.default??t),a7=!0}return kA=e(),kA}function o7(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var ai,h3;async function EGe(e){let t=await AGe;ai||(h3||(h3=t({locateFile:()=>e})),ai=await h3)}var l7=Fi.identity(),Yie=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=er.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=er.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=l7,this._currentTransform=new Float32Array(l7)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await EGe(this.wasmURL),this._surface=ai.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new ai.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(ai.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(ai.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=ai.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(zA(e),ai.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(zA(e),ai.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(ai.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new ai.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=ai.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,ai.ClipOp.Intersect,!0);else{let h=ai.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,ai.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Fi.invert(this.currentTransform);this.ctx.concat(e);let t=Fi.translate(Fi.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(zA(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=ai.MaskFilter.MakeBlur(ai.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,ai.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,ai.ClipOp.Intersect,!0);let c=ai.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,ai.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,ai.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=ai.MaskFilter.MakeBlur(ai.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new ai.Paint;c.setAntiAlias(!0),c.setStyle(ai.PaintStyle.Fill),c.setColor(zA(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=ai.MaskFilter.MakeBlur(ai.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,p,f,g]=h,m=f-d,v=g-p;this.ctx.save(),this.ctx.clipPath(this._currentPath,ai.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,ai.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(ai.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+m+Math.abs(this._innerShadowOffsetX*2),2e3+v+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(ai.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?ai.ClipOp.Difference:ai.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(ai.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){var c;if(!c7([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=ai.XYWHRect(e-i,t-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=ai.XYWHRect(e,t,i,r);if(c7(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=ai.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return ai.TextAlign.Right;case 3:return ai.TextAlign.Center;case 4:return ai.TextAlign.Justify;case 1:default:return ai.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,f=>{t.pushPaintStyle(i,f,p),t.addText(e);let g=t.build();g.layout(s);let m=n;o===2?m+=(a-g.getHeight())/2:o===3&&(m+=a-g.getHeight()),h.drawParagraph(g,r,m),u=g.getHeight(),t.reset(),g.delete()},c),d.delete(),p.delete(),u}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new ai.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new ai.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=ai.XYWHRect(t.x,t.y,t.width,t.height),u=ai.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){var n;(n=this._currentPath)==null||n.quadTo(e,t,i,r)}setTransform(e,t=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Fi.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let c=Fi.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=ai.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function c7(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function zA({r:e,g:t,b:i,a:r}){return ai.Color4f(e,t,i,r)}var u7=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=er.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},h7=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},CGe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=er.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},TGe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=er.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},Qn=class extends is{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new CGe(e+"-fill",t.fill,i),this.stroke=new TGe(e+"-stroke",t.stroke,i),this.dropShadow=new u7(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new u7(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new h7(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new h7(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:er.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:er.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=er.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=er.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(sr(e.path,["fill"])?this.fill.update(e.props):sr(e.path,["stroke"])?this.stroke.update(e.props):sr(e.path,["dropShadow"])?this.dropShadow.update(e.props):sr(e.path,["innerShadow"])?this.innerShadow.update(e.props):sr(e.path,["layerBlur"])?this.layerBlur.update(e.props):sr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new Qn(this.uuid,this.data,e);return t.parent=void 0,t}},Ek=class extends Qn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return bGe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new Ek(this.uuid,this.data,e);return t.parent=void 0,t}},xb=class extends Qn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new xb(this.uuid,this.data,e);return t.parent=void 0,t}},Ck=class extends Qn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:er.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:er.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new Ck(this.uuid,this.data,e);return t.parent=void 0,t}},qie=class extends Qn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>AC.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,p={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};AC.derive(p),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new qie(this.uuid,this.data,e);return t.parent=void 0,t}},AC;(e=>{function t(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],p=[3*(u[0]-c[0]),3*(u[1]-c[1])],f={start:h,cp:d,end:p};return a.derivative=f,f.derivative=MB.derive(f),f}e.derive=t;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,p=-(h+d)/u,f=-(-h+d)/u;return[p,f]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,p=l*u*3,f=o*u;return[h*a.start[0]+d*a.cp1[0]+p*a.cp2[0]+f*a.end[0],h*a.start[1]+d*a.cp1[1]+p*a.cp2[1]+f*a.end[1]]}e.compute=s})(AC||(AC={}));var MB;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=EB.derive(u),n.derivative=u,u}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}e.compute=r})(MB||(MB={}));var EB;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(EB||(EB={}));var Oc=class extends bl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new xb(e+"-background",yw.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(sr(e.path,["fill"])?this.fill.update(e.props):sr(e.path,["stroke"])?this.stroke.update(e.props):sr(e.path,["dropShadow"])?this.dropShadow.update(e.props):sr(e.path,["innerShadow"])?this.innerShadow.update(e.props):sr(e.path,["layerBlur"])?this.layerBlur.update(e.props):sr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Oc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},PGe=lp(KZ(),1),HT=class extends Qn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new HT(this.uuid,this.data,e);return t.parent=void 0,t}};function DGe(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,PGe.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return RGe(r)}function RGe(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function IGe(e,t,i){switch(t.type){case"ellipse2d":return new Ek(e,t,i);case"rectangle2d":return new xb(e,t,i);case"text2d":return new Ck(e,t,i);case"vector2d":return new qie(e,t,i);case"path2d":return new HT(e,t,i);case"frame2d":return new Oc(e,t,i);case"group2d":default:return new Zd(e,t,i)}}var Qie=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Zd(Qie.GROUP_ID,{...fC.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=IGe(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof Zd||a instanceof Oc)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof bl&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof bl){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof bl||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>Pee(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},Tk=Qie;Tk.GROUP_ID="scene2d";function Jie({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-r,h=i-n,d=s,p=a,f=o[0],g=o[1];if(l!==0){if(l===1)f+=u;else if(l===3)f+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let m=t/r;d*=m,f*=m}}if(c!==0){if(c===1)g+=h;else if(c===3)g+=h/2;else if(c===2)p=Math.max(1,p+h);else if(c===4){let m=i/n;p*=m,g*=m}}return{width:d,height:p,position:[f,g]}}lp(KZ(),1);var LGe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,OGe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,BGe=new bT(-1,1,1,-1,0,1),FGe=class extends Ot{constructor(){super(),this.setAttribute("position",new xt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new xt([0,2,0,0,2,0],2))}},NGe=new FGe,UGe=class{constructor(e){this._mesh=new cr(NGe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,BGe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},Kie=new Ri({defines:{},uniforms:{tDiffuse:new rt(null)},vertexShader:LGe,fragmentShader:OGe}),kGe=new UGe(Kie),d3=null,p3=null,zGe=()=>(d3===null&&(d3=document.createElement("canvas")),d3),VGe=e=>(p3===null&&(p3=new Yie(e)),p3),GGe=Fi.identity(),Zie=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new Tk(St.generateUUID(),qO.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=zGe(),this.renderer=VGe(this.canvas),this.promise=this.init(),this.renderTarget=new Di(1,1,{type:nh,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new xCe(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof Yie&&(this.renderer.wasmURL=wie.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),Kie.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),kGe.render(e),e.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=GGe,this.isScreenSpace&&(this.frameOverride.fill.color=er.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},$ie({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),r=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,r;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Oc)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function $ie({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof Oc&&t instanceof Oc||e instanceof Zd&&t instanceof Zd)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],c=t.children[a];l&&c&&l.uuid===c.uuid&&jGe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function HGe(e){if(CB(e))return[e.width,e.height];if(e instanceof HT){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof Zd){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function jGe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=HGe(t),{width:l,height:c,position:u}=Jie({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)WGe({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(CB(e)||e instanceof Zd)CB(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),$ie({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(e instanceof HT){let h=t,d=a!==0?l/a:1,p=o!==0?c/o:1;e.path=DGe(h.path,d,p),e.data={...e.data,path:e.path}}}function WGe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:p}=Jie({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:zf.isResizeable(l)?l.width:0,objectInitialHeight:zf.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:p}),zf.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function CB(e){return e instanceof xb||e instanceof Oc||e instanceof Ek||e instanceof Ck}var qn=class extends rk(Ia){constructor(e,t,i){super(),this.data=t,this.bgColor=new ys(1,1,1,1),this.fog=null,this.backupFog=new S$(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new jt,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new Fs(Z0,{...mw.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new sTe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new Tk((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new Zie(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(e),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=ra(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof om&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof ty)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&lGe(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=ra(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=ra(e.aoColor,t))}updateByOp(e,t,i,r){let n=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;sr(e.path,["fog"])?this.updateFog(s.fog,i.shared):sr(e.path,["ao"])?this.updateAo(s.ao,i.shared):sr(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):sr(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(ra(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof Hie&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof jie&&i.visible&&e<5-3&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Ei.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((wl(n)||vB(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),TB(n,e,t,!0)),i(n))}};return i(this),t}updateEntity2DByOp(e,t,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(e,t,i,r)}},XGe=class extends Sk(cTe,zie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new F(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new F(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new nn(n,s),o=new kE(a,new jt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof kE){let i=this.shadow.camera,r=new F(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new F(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},YGe=class extends vn{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?hk(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Pk=class extends vn{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let n in e)typeof e[n]=="string"&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));let t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=uk;break;case"Ellipse":n=ck;break;case"Polygon":n=Fte;break;case"Star":n=Nte;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?hk(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},Dk=class extends _k{constructor(e,t,i){super(e,t,i),this.data=t}},Yv=class extends iy(Vu,vb){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=uC.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of fd.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=Bd.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{...Rn.defaultData,...e,...Ic(Rn.defaultData,fd.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of fd.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&fd.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Ei.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),Rk(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};ere(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(Ei.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof vn&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(p=>e.scene.find(n[p])),h=c.boneInverses.map(p=>new ot().fromArray(p)),d=new yU(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function Rk(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Ei.is(i)&&Rk(i)}}function d7(e,t,i,r){return e.component===t&&jU(e.identity,r)?e.overrideData===i?2:1:0}function ere(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof Yv&&n.isInstanceRoot&&n.expandInstanceChildren(e);let c=0;for(let u of n.children)if(Ei.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=aC.resolve(i,h,1);d!=null&&!(d instanceof wn)&&(Object.setPrototypeOf(d,wn.prototype),console.error("wrong prototype"));let p=null,f;if(!o){let g=r.children[c];if(p=Ei.is(g)?g:null,p!==null){let m=d7(p,u,d,h);f=m>=1?p.stateSelection:void 0,m!==2&&(p=null)}if(p===null&&(p=e.scene.findInstance(h)??null,p!==null)){let m=d7(p,u,d,h);if(f=m>=1?p.stateSelection:void 0,m!==2)p=null;else{let v=p.parent.children.indexOf(p);p.parent.children.splice(v,1),r.children.splice(c,0,p),p.parent===r?v<=c&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(p===null){let g=d?Bd.apply(u.data,d):u.data;nm.is(g.type)&&(g={...g,type:"Empty"}),p=gd.createEntity(h,g,e),p.overrideData=d,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(c,0,p),p.updateState(p.data,e),f&&p.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let g=p.identity[p.identity.length-1];l[g]=p.uuid}c+=1,ere(e,t,i,p,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(Ei.is(h))e.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var qGe=class extends iy(A$,vb){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},Os=class extends vn{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new Zie(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=(e==null?void 0:e.width)??this.dataPatched.geometry.width,r=(e==null?void 0:e.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var i;let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=_w(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):sr(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},QGe=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=Ki,n=new Ia,s=new cp;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new cr(new zc(2,2),o);n.add(l),this.setDataType=function(p){return r=p,this},this.addVariable=function(p,f,g){let m=this.createShaderMaterial(f),v={name:p,initialValueTexture:g,material:m,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:vi,magFilter:vi};return this.variables.push(v),v},this.setVariableDependencies=function(p,f){p.dependencies=f},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let f=this.variables[p];f.renderTargets[0]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),f.renderTargets[1]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),this.renderTexture(f.initialValueTexture,f.renderTargets[0]),this.renderTexture(f.initialValueTexture,f.renderTargets[1]);let g=f.material,m=g.uniforms;if(f.dependencies!==null)for(let v=0;v<f.dependencies.length;v++){let x=f.dependencies[v];if(x.name!==f.name){let y=!1;for(let _=0;_<this.variables.length;_++)if(x.name===this.variables[_].name){y=!0;break}if(!y)return"Variable dependency not found. Variable="+f.name+", dependency="+x.name}m[x.name]={value:null},g.fragmentShader=`
uniform sampler2D `+x.name+`;
`+g.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,f=this.currentTextureIndex===0?1:0;for(let g=0,m=this.variables.length;g<m;g++){let v=this.variables[g];if(v.dependencies!==null){let x=v.material.uniforms;for(let y=0,_=v.dependencies.length;y<_;y++){let A=v.dependencies[y];x[A.name].value=A.renderTargets[p].texture}}this.doRenderTarget(v.material,v.renderTargets[f])}this.currentTextureIndex=f},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let f=0;f<p.length;f++){let g=p[f];g.initialValueTexture&&g.initialValueTexture.dispose();let m=g.renderTargets;for(let v=0;v<m.length;v++)m[v].dispose()}};function c(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(p,f){f=f||{};let g=new Ri({uniforms:f,vertexShader:h(),fragmentShader:p});return c(g),g}this.createShaderMaterial=u,this.createRenderTarget=function(p,f,g,m,v,x){return p=p||e,f=f||t,g=g||xr,m=m||xr,v=v||vi,x=x||vi,new Di(p,f,{wrapS:g,wrapT:m,minFilter:v,magFilter:x,format:Er,type:r,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),f=new ia(p,e,t,Er,Ki);return f.needsUpdate=!0,f},this.renderTexture=function(p,f){a.passThruTexture.value=p,this.doRenderTarget(o,f),a.passThruTexture.value=null},this.doRenderTarget=function(p,f){let g=i.getRenderTarget(),m=i.xr.enabled,v=i.shadowMap.autoUpdate,x=i.outputEncoding,y=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Bl,i.toneMapping=Rc,l.material=p,i.setRenderTarget(f),i.render(n,s),l.material=o,i.xr.enabled=m,i.shadowMap.autoUpdate=v,i.outputEncoding=x,i.toneMapping=y,i.setRenderTarget(g)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},ss=new ps,VA=new F,JGe=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),ss.a.fromBufferAttribute(e,n),ss.b.fromBufferAttribute(e,n+1),ss.c.fromBufferAttribute(e,n+2),s*=ss.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),ss.a.fromBufferAttribute(this.positionAttribute,e*3),ss.b.fromBufferAttribute(this.positionAttribute,e*3+1),ss.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(ss.a,n).addScaledVector(ss.b,s).addScaledVector(ss.c,1-(n+s)),i!==void 0&&ss.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(ss.a.fromBufferAttribute(this.colorAttribute,e*3),ss.b.fromBufferAttribute(this.colorAttribute,e*3+1),ss.c.fromBufferAttribute(this.colorAttribute,e*3+2),VA.set(0,0,0).addScaledVector(ss.a,n).addScaledVector(ss.b,s).addScaledVector(ss.c,1-(n+s)),r.r=VA.x,r.g=VA.y,r.b=VA.z),this}};function KGe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function ZGe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function $Ge(e,t){let i=new cr(e.geometry,e.material),r=[],n=[],s=new F,a=new F;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new JGe(i).build();for(let u=0;u<t;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function p7(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new ia(r,t,t,Er,Ki);return n.needsUpdate=!0,n}function eHe({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new ia(t,e,e,Er,Ki);return i.needsUpdate=!0,i}function tHe(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new ia(t,e,e,Er,Ki);return i.needsUpdate=!0,i}var iHe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,rHe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,nHe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,sHe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,aHe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,oHe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+rHe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${nHe}
      // ATTRACTION
      ${sHe}  
      // VORTEX
      ${aHe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,tre=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,lHe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,cHe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,uHe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${lHe}
  ${tre}
`,hHe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,dHe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+tre+`  
  ${cHe}

`,pHe=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,fHe=class extends Ri{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],Tn.startContext(Tn.globalContext),this.lightLayer=new fc(0,"",{...Xn.defaultData("light","phong"),visible:!1},new mk,{},t.shared),Tn.endContext(Tn.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new Zte;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(Fke),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(Nke),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(uHe),e.addFragmentParsCode(dHe),e.addVertexFinalCode(hHe({easeSize:this.easeSize})),e.addFragmentFinalCode(pHe({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},f3=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=ZGe(t);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=$Ge(t,e*e),n=p7(i,e),s=p7(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new Fv(t*.5,32,32);break}case"TorusEmitterShape":{i=new O$(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new _U(t,t,15);break}case"BoxEmitterShape":{i=new Fl(t,t,t);break}case"PlaneEmitterShape":{i=new zc(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new Fv(t,32,32);break}default:{i=new Fv(t,32,32);break}}return new cr(i,new sh({color:16711680}))}applyToShader(e,t){this.size=new F().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function Qg(e){let t={...e},i=eC.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var mHe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,m3=10,gHe=class extends Qi{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new nTe,this.currentWorldPosition=new F,this.systemQuaternion=new $t,this.worldGravity=new F(0,0,0),this.directionAxis=new F(0,0,0),this.colliderV3=new F(0,0,0),this.colliderQuaternion=new $t(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new fHe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new F(0,0,0)},uEmissionData:{value:new F(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new F(0,0,0)},uWorldQuaternion:{value:new ii(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new Br(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new Br(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){var r;let i=KGe(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new nw(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(Qg({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/m3),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(Qg(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/m3),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let n=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let n=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...Qg(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let n=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*St.DEG2RAD,Number(e[1])*St.DEG2RAD,Number(e[2])*St.DEG2RAD],i=new Pn(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new QGe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+iHe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+oHe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",mHe,tHe(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=eHe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new F(0,0,0)},uWorldQuaternion:{value:new ii(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new F(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new ii(0,0,0,1)},uColliderPos:{value:new F(0,0,0)},uColliderSize:{value:new F(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new ii(0,0,0,1)},uColliderQuaternionInvert:{value:new ii(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/m3}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...Qg(this.system.data).shape,size:p};this.emitterShape.applyToShader(n.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new F(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new f3(i,t,e.type,r):new f3(i,t,"SphereEmitterShape")}else return new f3(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new vCe(new zc(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(Qg(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},vx=class extends la{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Ot,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...Qg(t)},this.geometry.setAttribute("position",new xt([],3)),this.material=new sh({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new gHe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),sr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Jn.drop(e,1).props}}),sr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Jn.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function vHe(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var g3=vHe();function yHe(e,t,i){var n;g3!==void 0&&(((n=t==null?void 0:t.geometry)==null?void 0:n.subdivisions)??0)>g3&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=g3);let r;return t.geometry.type==="TextGeometry"?new _k(e,t,i):t.geometry.type==="InputGeometry"?new Dk(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Sw(e,t,i):t.geometry.type==="PathGeometry"?r=new Pk(e,t,i):t.geometry.type==="VectorGeometry"?r=new YGe(e,t,i):t.geometry.type==="BooleanGeometry"?r=new om(e,t,i):t.geometry.type==="ShapeBlendGeometry"?r=new lm(e,t,i):t.geometry.type==="UIGeometry"?r=new Os(e,t,i):r=new vn(e,t,i),r)}function Ik(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?yHe(e,t,i):t.type==="Empty"?new Xv(e,t):t.type==="Particle"?new vx(e,t,i):t.type==="ParticleCollider"?new gx(e,t,i):t.type==="Splat"?new Xv(e,t):t.type==="Bone"?new qGe(e,t):t.type==="Page"?new qn(e,t,i):t.type==="PointLight"?new XGe(e,t,i):t.type==="SpotLight"?new jie(e,t,i):t.type==="DirectionalLight"?new Hie(e,t,i):t.type==="Component"||t.type==="Instance"?new Yv(e,t,i):nm.is(t.type)?new Fs(e,t):(console.error(t),new Xv(e,t))}gd.createEntity=Ik;function xHe(e,t,i){let r=Ik(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}gd.changeEntityProptotype=xHe;gd.Cloner=No;function wHe(e,t,i,r){e.updateByOp(t,i,r,!1)}var of=5,yx=new Ot;yx.setAttribute("position",new Wt(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var IM=class extends qCe{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:jL,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function bHe(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/of};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/of};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/of};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/of};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/of}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var LM=new cp,_He=class{constructor(){this.pyramidPassScene=new Ia,this.pyramidPassMaterial=new IM({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new cr(yx,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,r,n){new CU().min.setScalar(0);let s=t.length-1,a=new ii;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?n[0]:n[1],h=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=t[c],p=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,d/p,d/p),c===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,3/p,3/p),i.render(this.pyramidPassScene,LM);let f=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=f,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},ul=24,os=96,ac=bHe(),du=2,ire=class extends vn{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new Ia,this.potentialPassScene=new Ia,this.voxelPassScene=new Ia,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Ot,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new cr(yx,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new ia(ac.triTable,16,256,bM,Ki);r.needsUpdate=!0;let n=new ia(ac.numTrisTable,256,1,bM,Ki);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new cr(yx,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new cr(yx,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(CHe.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Ri({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Ri({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new F},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new F,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new pe(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new pe(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,LM),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,LM),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,LM),ire.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Ot,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Wt(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*ul)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*du,this.bboxOffset=8*du*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*du,this.bboxOffset=4*du*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*du,this.bboxOffset=2*du*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*du,this.bboxOffset=du*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new Di(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Er,type:Ki,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:vi,magFilter:vi}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new Di(this.basePyramidSize,this.basePyramidSize,{format:Er,type:Ki,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:vi,magFilter:vi}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new p$(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:vi,magFilter:vi}),e.texture[0].format=Er,e.texture[0].type=Ki,e.texture[1].format=bM,e.texture[1].type=Ki,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new Di(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Er,type:Ki,stencilBuffer:!1,depthBuffer:!1,magFilter:vi,minFilter:vi}),i=new Di(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Er,type:Ki,stencilBuffer:!1,depthBuffer:!1,magFilter:vi,minFilter:vi});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Wt(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${ac.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${ul-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${os}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${ac.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*ul}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${ul}.);
				pc_FragColor.z = spatialKey(lowi+${2*ul}.);
				pc_FragColor.w = spatialKey(lowi+${3*ul}.);
			}
		`;return new IM({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${ac.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${ac.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${ul}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/os};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*ul}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${ul}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*ul}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*ul}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${ac.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new IM({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${ac.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${ac.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new IM({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${du}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${ac.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(r[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new zc(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new pe(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},lm=ire;lm.streamCompaction=new _He;var SHe=new ot,AHe=new ot,Bg=new $t,Gh=new F,GA=new F,MHe=new $t;function EHe(e,t=0){let i=this.children.length;for(;i--;){let r=this.children[i];sm.is(r)&&rre.call(r,e,t+1)}}function rre(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];sm.is(r)&&rre.call(r,e,t+1)}}}function CHe(){if(this.shapesDataTexture.value===void 0){let a=new ia(new Float32Array(4*os*of),os,of,Er,Ki);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=SHe.copy(this.matrixWorld).invert(),s=0;EHe.call(this,a=>{var v;if(a.visible===!1)return!0;let o;if(a instanceof No||a instanceof gx||a instanceof vx)return;a instanceof gs?o=a.object:o=a;let l=(v=a.data)==null?void 0:v.cloner;if(Ei.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof vn))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(AHe.multiplyMatrices(n,a.matrixWorld).decompose(GA,Bg,Gh),c.type==="TorusGeometry"&&c.arc!==360){let x=c.arc*Math.PI/180;x=x/4,Bg.multiply(MHe.set(0,0,Math.sin(x),Math.cos(x)))}let h=u.overrideGlobalBlend?u.blendRange:r;h=h/this.bboxSize*2,t[s*4]=(GA.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(GA.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(GA.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,t[os*4+s*4]=-Bg.x,t[os*4+s*4+1]=-Bg.y,t[os*4+s*4+2]=-Bg.z,t[os*4+s*4+3]=Bg.w;let d=new Float32Array(4),p=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*Gh.x+h,d[2]*Gh.x+h,d[3]*Gh.x+h);else if(c.type==="CubeGeometry"){p=c.cornerRadius;let x=c.width,y=c.height,_=c.depth;d[0]=2,d[1]=(x-2*p)/this.bboxSize,d[2]=(y-2*p)/this.bboxSize,d[3]=(_-2*p)/this.bboxSize,i=Math.max(i,Math.sqrt(x**2+y**2+_**2)/this.bboxSize*Gh.x+h)}else if(c.type==="CylinderGeometry"){p=c.cornerRadius;let x=c.height,y=c.radiusBottom,_=c.radiusTop;if(_>=y){let A=Math.atan2(_-y,x),S=(Math.PI/2-A)/2;_-=p/Math.tan(S),y-=p*Math.tan(S)}else if(y>_){let A=Math.atan2(y-_,x),S=(Math.PI/2-A)/2;_-=p*Math.tan(S),y-=p/Math.tan(S)}d[1]=(c.height-2*p)/this.bboxSize,y===_?(d[0]=3,d[2]=y/this.bboxSize*2):(d[0]=4,d[2]=y/this.bboxSize*2,d[3]=_/this.bboxSize*2),i=Math.max(i,d[1]*4*Gh.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],t[os*12+s*4+3]=d[2];let x=2*Math.atan2(d[2]/2,d[1]),y=c.arc*Math.PI/180/2-x;d[1]=Math.sin(y),d[2]=Math.cos(y)}i=Math.max(i,c.width*Gh.x/this.bboxSize+h)}t.set(d,os*8+s*4),t[os*12+s*4]=h,t[os*12+s*4+1]=p/this.bboxSize*2,t[os*12+s*4+2]=Gh.x;let f=o.material,g=f.uniforms.nodeU0.node.value,m=f.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(m=-1),t[os*16+s*4]=g.r,t[os*16+s*4+1]=g.g,t[os*16+s*4+2]=g.b,t[os*16+s*4+3]=m,m<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var nre=512;function f7(e,t){let i=!1,r=e.layers.mask&nre,n=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,bk(e),wk(e)),n.length===0&&s.length===0&&e.layers.set(0),r&&e.layers.set(9),e instanceof ty&&e.needsAO&&e.layers.enable(5),i}function m7(e,t){if(!t.layers)return!1;let i=e.layers.mask&nre,r=!1,n=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),r=!0),n.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),r}function THe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof ty)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)f7(i,i.material[r])&&(t=!0);else f7(i,i.material)&&(t=!0)}),t}function PHe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof ty)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)m7(i,i.material[r])&&(t=!0);else m7(i,i.material)&&(t=!0)}),t}var DHe=new H$,RHe=new ot,IHe=new V0;function TB(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=RHe.copy(s.matrixWorld).invert(),o=IHe.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let c=DHe;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?s:e})}}var LHe=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},OHe="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",yd=class{};xf(yd,"DepthMapRange",65536),xf(yd,"MemoryPageSize",65536),xf(yd,"BytesPerFloat",4),xf(yd,"BytesPerInt",4);function BHe(e){let t,i,r,n,s,a,o,l,c,u,h,d,p,f,g,m;function v(R){let O=new Float64Array(u,a,16);for(let I=0;I<16;I++)O[I]=R[I];let L;if(r>1){t.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let I=new Uint32Array(r);L=I.buffer,I.set(new Uint32Array(u,l,r))}else if(r===1){let I=new Uint32Array(r);I[0]=new Uint32Array(u,n,i)[0],L=I.buffer}else L=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:L},[L])}function x(R,O,L){let I=new Float32Array(u,s,i*3);r=0;let z=new Uint32Array(u,n,i);for(let K=0;K<L.length-1;K++){let Y=O[K],U=R[K].elements,j=Y.filter(q=>q.enabled&&q.mode==="Include").map(q=>q.type==="Box"?S(q):E(q)),k=Y.filter(q=>q.enabled&&q.mode==="Exclude").map(q=>q.type==="Box"?S(q):E(q));for(let q=L[K];q<L[K+1];q++){let W=p[q*3],te=p[q*3+1],G=p[q*3+2];if((j.length===0||_(W,te,G,j))&&(k.length===0||!_(W,te,G,k))){let le=1/(U[3]*W+U[7]*te+U[11]*G+U[15]);I[r*3]=(U[0]*W+U[4]*te+U[8]*G+U[12])*le,I[r*3+1]=(U[1]*W+U[5]*te+U[9]*G+U[13])*le,I[r*3+2]=(U[2]*W+U[6]*te+U[10]*G+U[14])*le,z[r]=q,r++}}}}function y(R,O){let L=[],I=O.filter(Y=>Y.enabled&&Y.mode==="Include").map(Y=>Y.type==="Box"?S(Y):E(Y)),z=O.filter(Y=>Y.enabled&&Y.mode==="Exclude").map(Y=>Y.type==="Box"?S(Y):E(Y)),K=R.length;for(let Y=0;Y<K;Y+=3){let U=R[Y],j=R[Y+1],k=R[Y+2];(I.length===0||_(U,j,k,I))&&(z.length===0||!_(U,j,k,z))||L.push(Y/3)}return L}function _(R,O,L,I,z){return I[z==="Intersect"?"every":"some"](K=>{let Y=A(R,O,L,K.invRotationMatrix,K.cropCenter);return Array.isArray(K)?M(Y.x,Y.y,Y.z,K):P(Y.x,Y.y,Y.z,K)})}function A(R,O,L,I,z){let K=R-z[0],Y=O-z[1],U=L-z[2],j=1/(I[3]*K+I[7]*Y+I[11]*U+I[15]);return{x:(I[0]*K+I[4]*Y+I[8]*U+I[12])*j+z[0],y:(I[1]*K+I[5]*Y+I[9]*U+I[13])*j+z[1],z:(I[2]*K+I[6]*Y+I[10]*U+I[14])*j+z[2]}}function S(R){let O=R.cropSize[0]/2,L=R.cropSize[1]/2,I=R.cropSize[2]/2,z=[R.cropCenter[0]-O,R.cropCenter[1]-L,R.cropCenter[2]-I,R.cropCenter[0]+O,R.cropCenter[1]+L,R.cropCenter[2]+I],K=C(R.cropRotation);return Object.assign(z,{invRotationMatrix:K,cropCenter:R.cropCenter})}function C(R){let O=[],L=R[0]*Math.PI/180,I=R[1]*Math.PI/180,z=R[2]*Math.PI/180,K=Math.cos(L),Y=Math.sin(L),U=Math.cos(I),j=Math.sin(I),k=Math.cos(z),q=Math.sin(z),W=K*k,te=K*q,G=Y*k,le=Y*q;return O[0]=U*k,O[1]=-U*q,O[2]=j,O[4]=te+G*j,O[5]=W-le*j,O[6]=-Y*U,O[8]=le-W*j,O[9]=G+te*j,O[10]=K*U,O[12]=0,O[13]=0,O[14]=0,O[3]=0,O[7]=0,O[11]=0,O[15]=1,O}function M(R,O,L,I){return R>=I[0]&&R<=I[3]&&O>=I[1]&&O<=I[4]&&L>=I[2]&&L<=I[5]}function E(R){let O=2/R.cropSize[0],L=2/R.cropSize[1],I=2/R.cropSize[2],z=C(R.cropRotation);return{invRadiusX:O,invRadiusY:L,invRadiusZ:I,cropCenter:R.cropCenter,invRotationMatrix:z}}function P(R,O,L,I){let z=(R-I.cropCenter[0])*I.invRadiusX,K=(O-I.cropCenter[1])*I.invRadiusY,Y=(L-I.cropCenter[2])*I.invRadiusZ;return z*z+K*K+Y*Y<=1}e.onmessage=R=>{if(R.data.getCroppedIndexes){let O=new Uint32Array(y(new Float32Array(R.data.positions),R.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:O},[O])}else if(R.data.positions)h=R.data.positions,p=new Float32Array(h),g=R.data.meshMatrixWorlds,m=R.data.cropsArray,f=R.data.meshIndexIntervals,x(g,m,f),e.postMessage({sortSetupComplete:!0});else if(R.data.sort||R.data.newMatrixWorlds||R.data.newCropsArray)(R.data.newMatrixWorlds||R.data.newCropsArray)&&(m=R.data.newCropsArray||m,g=R.data.newMatrixWorlds||g,x(g,m,f)),v(R.data.sort.view,R.data.sort.cameraPosition);else if(R.data.init){d=R.data.init.Constants,i=R.data.init.splatCount;let O=d.BytesPerInt,L=d.BytesPerFloat*3,I=new Uint8Array(R.data.init.sorterWasmBytes),z=O+L,K=i*z,Y=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,U=d.MemoryPageSize*32,j=K+Y+U,k=Math.floor(j/d.MemoryPageSize)+1,q={module:{},env:{memory:new WebAssembly.Memory({initial:k*2,maximum:k*3,shared:!0})}};WebAssembly.compile(I).then(W=>WebAssembly.instantiate(W,q)).then(W=>{t=W,n=0,s=i*O,a=s+i*L,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=q.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function FHe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",BHe.toString(),")(self)"],{type:"application/javascript"}))),i=atob(OHe),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:yd.BytesPerFloat,BytesPerInt:yd.BytesPerInt,DepthMapRange:yd.DepthMapRange,MemoryPageSize:yd.MemoryPageSize}}}),t}var v3=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),NHe=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},HA=new pe;function g7(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var OM=class extends cr{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=OM.buildGeomtery(t),o=OM.buildMaterial(n);return new OM(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new pe},viewport:{type:"v2",value:new pe},basisViewport:{type:"v2",value:new pe},debugColor:{type:"v3",value:new jt},covariancesTextureSize:{type:"v2",value:new pe(1024,1024)},centersColorsTextureSize:{type:"v2",value:new pe(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Ri({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:Bf,depthTest:!0,depthWrite:!1,side:Bs})}static buildGeomtery(e){let t=new Ot;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new Wt(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new V$().copy(t),s=new Uint32Array(e),a=new nw(s,1,!1);return a.setUsage(i_e),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new pe(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new pe(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=LTe.toHalfFloat(this.covariances[u]);r=new ia(n,t.x,t.y,EE,nh)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new ia(n,t.x,t.y,EE,Ki);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,p=u*4;s[p]=NHe(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=v3(this.centers[d]),s[p+2]=v3(this.centers[d+1]),s[p+3]=v3(this.centers[d+2])}let a=new ia(s,i.x,i.y,r$,ku);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new ia(l,o,1,Er,Ki);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(HA.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(HA),this.material.uniforms.basisViewport.value.set(2/HA.x,2/HA.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},sre,UHe=new Promise(e=>{sre=e}),v7=!1,jA;function kHe(){if(v7)return;if(jA)return jA;async function e(){let t=await ap(()=>import("./gaussian-splat-compression-f68e3207.js"),[]);sre(t),v7=!0}return jA=e(),jA}var are;UHe.then(e=>are=e);var zHe=class{constructor(e={}){xf(this,"updateView",function(){let t=new ot,i=[],r=new F(0,0,-1),n=new F(0,0,-1),s=new F,a=new F;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(p=!0),!d&&!p&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new ot().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new pe;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new F().fromArray(e.position)),e.orientation&&(e.orientation=new $t().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new are.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new F,r=new $t,n=!1,s=1,a,o){this.splatMesh=OM.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(e){this.sortWorker=FHe(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},PB=new sh;PB.wireframe=!0;var y7=new F,Lk=class extends Ia{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new LHe,this.invisibleObjects=new Xv("jflkdsafjasdifjaslk",{...BO.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new qn("fdasfa",{..._0.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=PHe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=THe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof qn&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>Pee(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===Z0)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof qn&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof qn&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof Os&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof qn&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),wl(n)&&Hu(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof lm&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Hu(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),wl(r)&&(r.freeBooleanPointer(),n instanceof om&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof Pk&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),wl(r)&&(r.invalidateUpstreamBooleanData(),Hu(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof om&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof qn&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{wHe(n,t,i,{scene:this,shared:r}),n instanceof vn&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof Os||a instanceof qn)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof Fs&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Ei.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Ei.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=fw(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...Tee(h.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let f=p.uuid,g=Dn.zoom(u,t);g[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Yv&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=fw(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of lC.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof Yv&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),Rk(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof Yv&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Ei.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Ei.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(wl(s)||vB(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),TB(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Ei.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((wl(n)||vB(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),TB(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Ei.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Ei.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Ei.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof vn&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();Hu(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)sm.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Ei.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let a={scene:this,shared:s},o=Ik(e,t,a);return o instanceof lm&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof vn&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof vn&&u.bones&&u.boneInverses){let h=u.bones.map(f=>this.find(f)),d=u.boneInverses.map(f=>new ot().fromArray(f)),p=new yU(h,d);c.bind(p,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new nn;return i.setFromPoints(t),i.getCenter(y7),y7}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof la)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Kd&&e(t.material[i]);else t.material instanceof Kd&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof Fs&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new zHe({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},BM=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},VHe=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return HHe(Math.atan2(r,i))},GHe=(e,t,i)=>{let r={x:0,y:0};return i=DB(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},DB=e=>e*(Math.PI/180),HHe=e=>e*(180/Math.PI),jHe=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,y3=new Map,x7=e=>{y3.has(e)&&clearTimeout(y3.get(e)),y3.set(e,setTimeout(e,100))},MC=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},w7=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},ore=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),b7=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},RB=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},Ok=(e,t,i)=>{let r=lre(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},WHe=(e,t)=>{let i=lre(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},lre=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},x3=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},XHe=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},IB=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},YHe=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(cre="ontouchstart"in window,ure=!!window.PointerEvent,hre=!!window.MSPointerEvent);var cre,ure,hre,v1={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Sv,Aw={};ure?Sv=v1.pointer:hre?Sv=v1.MSPointer:cre?(Sv=v1.touch,Aw=v1.mouse):Sv=v1.mouse;function Am(){}Am.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};Am.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Am.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};Am.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=XHe(t.options,e))};Am.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},MC(e,Sv[t],i._domHandlers_[t]),Aw[t]&&MC(e,Aw[t],i._domHandlers_[t]),i};Am.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},w7(e,Sv[t],i._domHandlers_[t]),Aw[t]&&w7(e,Aw[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var Bk=Am;function Un(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Un.id,Un.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Un.prototype=new Bk;Un.constructor=Un;Un.id=0;Un.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Un.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=WHe("borderRadius","50%"),i=Ok("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},x3(r.el,i),this.options.shape==="circle"&&x3(r.back,t),x3(r.front,t),this.applyStyles(r),this};Un.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Un.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Un.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Un.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Un.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Un.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Un.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=Ok("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Un.prototype.restCallback=function(){var e=this,t={};t.front=Ok("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Un.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Un.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var qHe=Un;function sn(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=sn.id,sn.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}sn.prototype=new Bk;sn.constructor=sn;sn.id=0;sn.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};sn.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};sn.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};sn.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new qHe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(RB(c.ui.el,n),RB(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};sn.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};sn.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};sn.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};sn.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=ore(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return IB(e,n),t.manager.bindDocument(),!1};sn.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=BM(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};sn.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};sn.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!jHe(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=BM(l,n.position),u=VHe(l,n.position),h=DB(u),d=c/o,p={distance:c,position:l},f,g;if(n.options.shape==="circle"?(f=Math.min(c,o),g=GHe(n.position,f,u)):(g=YHe(l,n.position,o),f=BM(g,n.position)),i.follow){if(c>o){let y=l.x-g.x,_=l.y-g.y;n.position.x+=y,n.position.y+=_,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",c=BM(l,n.position)}}else l=g,c=f;var m=l.x-n.position.x,v=l.y-n.position.y;n.frontPosition={x:m,y:v},i.dataOnly||RB(n.ui.front,n.frontPosition);var x={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:m/o,y:-v/o},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};x=n.computeDirection(x),x.angle={radian:DB(180-u),degree:180-u},n.trigger("move",x),t.trigger("move "+n.id+":move",x)};sn.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};sn.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};sn.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var QHe=sn;function rs(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=b7(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;MC(window,"resize",function(){x7(i)});var r=function(){t.scroll=b7()};return MC(window,"scroll",function(){x7(r)}),t.collections}rs.prototype=new Bk;rs.constructor=rs;rs.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};rs.prototype.create=function(e){return this.createCollection(e)};rs.prototype.createCollection=function(e){var t=this,i=new QHe(t,e);return t.bindCollection(i),t.collections.push(i),i};rs.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};rs.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};rs.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};rs.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};rs.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};rs.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};rs.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};rs.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};rs.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=ore(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),IB(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return IB(t,a),!1};rs.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};rs.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var JHe=rs,_7=new JHe,KHe={create:function(e){return _7.create(e)},factory:_7},dre=new Map,xx=new Map,Ef=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new G1({src:l,volume:s,delay:a,loop:o}),xx.has(i.uuid)?xx.get(i.uuid).push(this):xx.set(i.uuid,[this]),dre.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},LB=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=dre.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=xx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...xx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},pre=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new Ef(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new LB(t);else throw new Error("Missing property")}dispatchBasic(){if(gr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ef?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(gr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ef?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(gr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ef&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},fre=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(gr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(gr(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(gr(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},ZHe="text/plain",$He="us-ascii",S7=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),eje=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===$He)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==ZHe)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function tje(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return eje(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];S7(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])S7(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var ije=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:tje(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if(gr(this.shared,this.condition)===!1)return!1;db?window.location.assign(this.url):(this.context==="tab"||Cee&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(Qt[0]),cBe())}},mre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(gr(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(gr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},gre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(gr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),Xk(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},vre={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},Fk={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},rje=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],EC={CSS:{},springs:{}};function Al(e,t,i){return Math.min(Math.max(e,t),i)}function wx(e,t){return e.indexOf(t)>-1}function w3(e,t){return e.apply(null,t)}var ei={arr:function(e){return Array.isArray(e)},obj:function(e){return wx(Object.prototype.toString.call(e),"Object")},pth:function(e){return ei.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||ei.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return ei.hex(e)||ei.rgb(e)||ei.hsl(e)},key:function(e){return!vre.hasOwnProperty(e)&&!Fk.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function yre(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function xre(e,t){var i=yre(e),r=Al(ei.und(i[0])?1:i[0],.1,100),n=Al(ei.und(i[1])?100:i[1],.1,100),s=Al(ei.und(i[2])?10:i[2],.1,100),a=Al(ei.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(f){var g=t?t*f/1e3:f;return l<1?g=Math.exp(-g*l*o)*(u*Math.cos(c*g)+h*Math.sin(c*g)):g=(u+h*g)*Math.exp(-g*o),f===0||f===1?f:1-g}function p(){var f=EC.springs[e];if(f)return f;for(var g=1/6,m=0,v=0;;)if(m+=g,d(m)===1){if(v++,v>=16)break}else v=0;var x=m*g*1e3;return EC.springs[e]=x,x}return t?d:p}function nje(e){return e===void 0&&(e=10),function(t){return Math.ceil(Al(t,1e-6,1)*e)*(1/e)}}var sje=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,p,f){var g,m,v=0;do m=h+(d-h)/2,g=s(m,p,f)-u,g>0?d=m:h=m;while(Math.abs(g)>1e-7&&++v<10);return m}function l(u,h,d,p){for(var f=0;f<4;++f){var g=a(h,d,p);if(g===0)return h;var m=s(h,d,p)-u;h-=m/g}return h}function c(u,h,d,p){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var f=new Float32Array(e);if(u!==h||d!==p)for(var g=0;g<e;++g)f[g]=s(g*t,u,d);function m(v){for(var x=0,y=1,_=e-1;y!==_&&f[y]<=v;++y)x+=t;--y;var A=(v-f[y])/(f[y+1]-f[y]),S=x+A*t,C=a(S,u,d);return C>=.001?l(v,S,u,d):C===0?S:o(v,x,x+t,u,d)}return function(v){return u===h&&d===p||v===0||v===1?v:s(m(v),h,p)}}return c}(),wre=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Al(r,1,10),a=Al(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function Nk(e,t){if(ei.fnc(e))return e;var i=e.split("(")[0],r=wre[i],n=yre(e);switch(i){case"spring":return xre(e,t);case"cubicBezier":return w3(sje,n);case"steps":return w3(nje,n);default:return w3(r,n)}}function bre(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function jT(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function WT(e){return e.reduce(function(t,i){return t.concat(ei.arr(i)?WT(i):i)},[])}function A7(e){return ei.arr(e)?e:(ei.str(e)&&(e=bre(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function Uk(e,t){return e.some(function(i){return i===t})}function kk(e){var t={};for(var i in e)t[i]=e[i];return t}function OB(e,t){var i=kk(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function XT(e,t){var i=kk(e);for(var r in t)i[r]=ei.und(e[r])?t[r]:e[r];return i}function aje(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function oje(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function lje(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(p-d)*6*f:f<1/2?p:f<2/3?d+(p-d)*(2/3-f)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function cje(e){if(ei.rgb(e))return aje(e);if(ei.hex(e))return oje(e);if(ei.hsl(e))return lje(e)}function Ju(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function uje(e){if(wx(e,"translate")||e==="perspective")return"px";if(wx(e,"rotate")||wx(e,"skew"))return"deg"}function BB(e,t){return ei.fnc(e)?e(t.target,t.id,t.total):e}function Mc(e,t){return e.getAttribute(t)}function zk(e,t,i){var r=Ju(t);if(Uk([i,"deg","rad","turn"],r))return t;var n=EC.CSS[t+i];if(!ei.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(t);return EC.CSS[t+i]=c,c}function _re(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?zk(e,n,i):n}}function Vk(e,t){if(ei.dom(e)&&!ei.inp(e)&&(Mc(e,t)||ei.svg(e)&&e[t]))return"attribute";if(ei.dom(e)&&Uk(rje,t))return"transform";if(ei.dom(e)&&t!=="transform"&&_re(e,t))return"css";if(e[t]!=null)return"object"}function Sre(e){if(ei.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function hje(e,t,i,r){var n=wx(t,"scale")?1:0+uje(t),s=Sre(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?zk(e,s,r):s}function Gk(e,t,i,r){switch(Vk(e,t)){case"transform":return hje(e,t,r,i);case"css":return _re(e,t,i);case"attribute":return Mc(e,t);default:return e[t]||0}}function Hk(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Ju(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function Are(e,t){if(ei.col(e))return cje(e);if(/\s/g.test(e))return e;var i=Ju(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function jk(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function dje(e){return Math.PI*2*Mc(e,"r")}function pje(e){return Mc(e,"width")*2+Mc(e,"height")*2}function fje(e){return jk({x:Mc(e,"x1"),y:Mc(e,"y1")},{x:Mc(e,"x2"),y:Mc(e,"y2")})}function Mre(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=jk(r,s)),r=s}return i}function mje(e){var t=e.points;return Mre(e)+jk(t.getItem(t.numberOfItems-1),t.getItem(0))}function Ere(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return dje(e);case"rect":return pje(e);case"line":return fje(e);case"polyline":return Mre(e);case"polygon":return mje(e)}}function gje(e){var t=Ere(e);return e.setAttribute("stroke-dasharray",t),t}function vje(e){for(var t=e.parentNode;ei.svg(t)&&ei.svg(t.parentNode);)t=t.parentNode;return t}function Cre(e,t){var i=t||{},r=i.el||vje(e),n=r.getBoundingClientRect(),s=Mc(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function yje(e,t){var i=ei.str(e)?bre(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:Cre(i),totalLength:Ere(i)*(r/100)}}}function xje(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=Cre(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function M7(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Are(ei.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:ei.str(e)||t?r.split(i):[]}}function Tre(e){var t=e?WT(ei.arr(e)?e.map(A7):A7(e)):[];return jT(t,function(i,r,n){return n.indexOf(i)===r})}function Pre(e){var t=Tre(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:Sre(i)}}})}function wje(e,t){var i=kk(t);if(/^spring/.test(i.easing)&&(i.duration=xre(i.easing)),ei.arr(e)){var r=e.length,n=r===2&&!ei.obj(e[0]);n?e={value:e}:ei.fnc(t.duration)||(i.duration=t.duration/r)}var s=ei.arr(e)?e:[e];return s.map(function(a,o){var l=ei.obj(a)&&!ei.pth(a)?a:{value:a};return ei.und(l.delay)&&(l.delay=o?0:t.delay),ei.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return XT(a,i)})}function bje(e){for(var t=jT(WT(e.map(function(s){return Object.keys(s)})),function(s){return ei.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var c in o)ei.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<t.length;n++)r(n);return i}function _je(e,t){var i=[],r=t.keyframes;r&&(t=XT(bje(r),t));for(var n in t)ei.key(n)&&i.push({name:n,tweens:wje(t[n],e)});return i}function Sje(e,t){var i={};for(var r in e){var n=BB(e[r],t);ei.arr(n)&&(n=n.map(function(s){return BB(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function Aje(e,t){var i;return e.tweens.map(function(r){var n=Sje(r,t),s=n.value,a=ei.arr(s)?s[1]:s,o=Ju(a),l=Gk(t.target,e.name,o,t),c=i?i.to.original:l,u=ei.arr(s)?s[0]:c,h=Ju(u)||Ju(l),d=o||h;return ei.und(a)&&(a=c),n.from=M7(u,d),n.to=M7(Hk(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=Nk(n.easing,n.duration),n.isPath=ei.pth(s),n.isColor=ei.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var Dre={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function Rre(e,t){var i=Pre(e);i.forEach(function(r){for(var n in t){var s=BB(t[n],r),a=r.target,o=Ju(s),l=Gk(a,n,o,r),c=o||Ju(l),u=Hk(Are(s,c),l),h=Vk(a,n);Dre[h](a,n,u,r.transforms,!0)}})}function Mje(e,t){var i=Vk(e.target,t.name);if(i){var r=Aje(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function Eje(e,t){return jT(WT(e.map(function(i){return t.map(function(r){return Mje(i,r)})})),function(i){return!ei.und(i)})}function Ire(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var E7=0;function Cje(e){var t=OB(vre,e),i=OB(Fk,e),r=_je(i,e),n=Pre(e.targets),s=Eje(n,r),a=Ire(s,i),o=E7;return E7++,XT(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var Vo=[],C7=[],FM,Tje=function(){function e(){FM=requestAnimationFrame(t)}function t(i){var r=Vo.length;if(r){for(var n=0;n<r;){var s=Vo[n];s.paused?(Vo.splice(n,1),r-=1):(s.tick(i),n++)}e()}else FM=cancelAnimationFrame(FM)}return e}();function Pje(e){document.hidden?(Vo.forEach(function(t){return t.pause(e.timeStamp)}),C7=Vo.slice(0),rn.running=Vo=[]):C7.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",Pje);function rn(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(S){var C=window.Promise&&new Promise(function(M){return o=M});return S.finished=C,C}var c=Cje(e);l(c);function u(){var S=c.direction;S!=="alternate"&&(c.direction=S!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(C){(C.loop===1||C.loop%2===0)&&(C.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(S){return S.reversed=!1})}function d(S){return c.reversed?c.duration-S:S}function p(){t=0,i=d(c.currentTime)*(1/rn.speed)}function f(S,C,M=!1){C&&(c.reversed?C.seek(C.duration*C.loop-(S-C.timelineOffset-C.pingPongDelayCorrection),M):C.seek(S-C.timelineOffset-C.startOnceDelay-C.pingPongDelayCorrection,M))}function g(S,C=!1){if(c.reversed)for(var M=a;M--;)f(S,s[M],C);else for(var E=0;E<a;E++)f(S,s[E],C)}function m(S){var he,ye,de,xe,me,ee,we,Ae,Te,Re;var C=0,M=c.animations,E=M.length;for(c.direction!=="alternate"&&((he=c.parent)==null?void 0:he.direction)==="alternate"?((ye=c.parent)==null?void 0:ye.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((de=c.parent)!=null&&de.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S):_(!1,(xe=c.parent)==null?void 0:xe.rewind,c.rewind,(me=c.parent)==null?void 0:me.reversePlayback,c.reversePlayback)&&((ee=c.parent)!=null&&ee.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S);C<E;){var P=M[C],R=P.animatable,O=P.tweens,L=O.length-1,I=O[L];L&&(I=jT(O,function(Oe){return S<Oe.end})[0]||I);let Xe;(we=c.parent)!=null&&we.reversed&&c.direction==="alternate"?Xe=Al(S-I.start-I.endDelay,0,I.duration)/I.duration:Xe=Al(S-I.start-I.delay,0,I.duration)/I.duration;for(var z=isNaN(Xe)?1:I.easing(Xe),K=I.to.strings,Y=I.round,U=[],j=I.to.numbers.length,k=void 0,q=0;q<j;q++){var W=void 0;let Oe,Be;c.direction!=="alternate"?((Ae=c.parent)==null?void 0:Ae.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(Oe=I.to.numbers[q],Be=I.from.numbers[q]||0):(Be=I.to.numbers[q],Oe=I.from.numbers[q]||0):_(!0,(Te=c.parent)==null?void 0:Te.rewind,c.rewind,(Re=c.parent)==null?void 0:Re.reversePlayback,c.reversePlayback)?(Oe=I.to.numbers[q],Be=I.from.numbers[q]||0):(Be=I.to.numbers[q],Oe=I.from.numbers[q]||0),I.isPath?W=xje(I.value,z*Be):W=Oe+z*(Be-Oe),Y&&(I.isColor&&q>2||(W=Math.round(W*Y)/Y)),U.push(W)}var te=K.length;if(!te)k=U[0];else{k=K[0];for(var G=0;G<te;G++){K[G];var le=K[G+1],Z=U[G];isNaN(Z)||(le?k+=Z+le:k+=Z+" ")}}Dre[P.type](R.target,P.property,k,R.transforms),P.currentValue=k,C++}}function v(S){c[S]&&!c.passThrough&&c[S](c)}function x(){c.remaining&&c.remaining!==!0&&c.remaining--}let y={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function _(S,C,M,E,P){return y[S<<4|C<<3|M<<2|E<<1|P]}function A(S,C=!1){var O;var M=c.duration;let E=c.delay,P=M-c.endDelay;(O=c.parent)!=null&&O.reversed&&c.direction==="alternate"&&(E=c.endDelay,P=M-c.delay);var R=d(S);if(c.progress=Al(R/M*100,0,100),C||(c.reversePlayback=R<c.currentTime),a&&g(R,C),!c.began&&c.currentTime>=0&&(c.began=!0,v("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,v("loopBegin")),(c.reversed||R>=0)&&R<=E&&c.currentTime!==0&&(m(0),v("change")),(R>=P&&c.currentTime!==M+c.pingPongDelayCorrection||!M)&&(m(M),v("change")),R>E&&R<P?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,v("changeBegin")),m(R),v("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,v("change"),a&&v("timelineChangeComplete")):c.began&&R>P&&v("changeComplete"),c.currentTime=Al(R,0,M+c.pingPongDelayCorrection),c.began&&v("update"),S>=M)if(x(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,v("loopComplete"),v("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?t+=c.duration/rn.speed:t+=c.duration;for(let L of s)L.setStartTime(0),L.remaining=L.loop;v("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var S=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=S==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var C=a;C--;)c.children[C].reset();m(c.reversed?c.duration:0)},c.setStartTime=function(S){t=S},c.set=function(S,C){return Rre(S,C),c},c.tick=function(S){r=S,t||(t=r),A((r+(i-t))*rn.speed)},c.seek=function(S,C=!1){A(S-t,C)},c.pause=function(S){c.paused=!0,a&&(n=S??performance.now())},c.play=function(S){!c.paused||(c.completed&&c.reset(),c.paused=!1,Vo.push(c),a&&n!==void 0&&(t+=(S??performance.now())-n),FM||Tje())},c.reverse=function(){u(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function T7(e,t){for(var i=t.length;i--;)Uk(e,t[i].animatable.target)&&t.splice(i,1)}function Dje(e){for(var t=Tre(e),i=Vo.length;i--;){var r=Vo[i],n=r.animations,s=r.children;T7(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;T7(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function Rje(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?Nk(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",c=a==="last",u=ei.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,p=Ju(u?e[1]:e)||0,f=t.start||0+(u?h:0),g=[],m=0;return function(v,x,y){if(o&&(a=0),l&&(a=(y-1)/2),c&&(a=y-1),!g.length){for(var _=0;_<y;_++){if(!n)g.push(Math.abs(a-_));else{var A=l?(n[0]-1)/2:a%n[0],S=l?(n[1]-1)/2:Math.floor(a/n[0]),C=_%n[0],M=Math.floor(_/n[0]),E=A-C,P=S-M,R=Math.sqrt(E*E+P*P);s==="x"&&(R=-E),s==="y"&&(R=-P),g.push(R)}m=Math.max.apply(Math,g)}r&&(g=g.map(function(L){return r(L/m)*m})),i==="reverse"&&(g=g.map(function(L){return s?L<0?L*-1:-L:Math.abs(m-L)}))}var O=u?(d-h)/m:h;return f+O*(Math.round(g[x]*100)/100)+p}}function Ije(e){e===void 0&&(e={});var t=rn(e);return t.duration=0,t.add=function(i,r){var n=Vo.indexOf(t),s=t.children;n>-1&&Vo.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=XT(i,OB(Fk,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=ei.und(r)?c:Hk(r,c),a(t);var u=rn(l);a(u),s.push(u),u.parent=t;var h=Ire(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}rn.version="3.2.0";rn.speed=1;rn.running=Vo;rn.remove=Dje;rn.get=Gk;rn.set=Rre;rn.convertPx=zk;rn.path=yje;rn.setDashoffset=gje;rn.stagger=Rje;rn.timeline=Ije;rn.easing=Nk;rn.penner=wre;rn.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var Lre=rn,P7=new F,D7=new F,R7=new $t;function Lje(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*e.w+r*t.w,i.x=u*e.x+r*t.x,i.y=u*e.y+r*t.y,i.z=u*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function us(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=St.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function Wk(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||jU(c,u)))return{update:h=>{c.forEach((d,p)=>{let f=St.lerp(d,u[p],h);t[e][p]=s?Math.trunc(f):f})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function CC(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function I7(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?CC(new F,s,n):o.clone(),c=CC(new F,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function L7(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function TC(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof pe),c=o instanceof pe?o:new pe().fromArray(o),u=s?L7(new pe,s,n):c.clone(),h=L7(new pe,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function Oje(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new ot().fromArray(n):a.clone(),l=new F,c=new $t,u=new F;o.decompose(l,c,u);let h=new ot().fromArray(s),d=new F,p=new $t,f=new F;if(h.decompose(d,p,f),!o.equals(h))return{update:g=>{R7.slerpQuaternions(c,p,g),P7.lerpVectors(l,d,g),D7.lerpVectors(u,f,g),a.compose(P7,R7,D7)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,p,f)}}}function Bje(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new jt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new jt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{var d,p;u.lerpColors(l,c,h),(p=(d=t[e])==null?void 0:d.copy)==null||p.call(d,u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function WA(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new ys(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new ys(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new ys(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=St.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function hp(e,t,i,r,n){if(typeof t[e]=="number")return us(e,t,i??{},r,n);if(Array.isArray(t[e]))return Wk(e,t,i??{},r,n)}function Fje(e,t,i,r){var o,l,c,u;let n=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??e.zoom,d=a;h!==d&&n.push({update:p=>{e.zoom=St.lerp(h,d,p),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=us("targetOffset",e,t,i,r);h&&n.push(h)}return n}function Nje(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(kf.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[St.lerp(n[0],s[0],o),St.lerp(n[1],s[1],o),St.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function Uje(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return ute.forEach(l=>{let c=hp(l,n,s,a,r);c&&o.push(c)}),o}function kje(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof Sw){let l=Nje(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Ic(s,ER),Ic(a,ER)),ER.forEach(c=>{let u=hp(c,l,a,o,r);u&&n.push(u)}),e instanceof Pk){Object.assign(l,{extrusion:{...s.extrusion}});let c=Uje(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function zje(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=us("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=Bje("color",e,t,i,r);s&&n.push(s)}return n}function Vje(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...O7(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...O7(e.material,s,a,r))}return n}function O7(e,t,i,r){var a;let n=[],s=_v(i,r)||!!t.layers&&_v(t,r);n.push(Jje(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!ote.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),p;if(h==="colors")p=qje(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(p=Yje(o,l,c,h));else if(typeof d=="number")p=Gje(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof pe?p=Hje(o,l,c,h):d instanceof F?p=jje(o,l,c,h,r):d instanceof ys?p=Xje(o,l,c,h,r):d instanceof jt?p=Wje(o,l,c,h,r):"isTexture"in d&&(p=Qje(o,l,c,h))}p&&(Array.isArray(p)?n.push(...p):n.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return n}function Gje(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{e.setValue(r,St.lerp(o,l,c))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function Hje(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new pe().fromArray(t[r]):n.clone(),a=new pe().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function jje(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?CC(new F,a,n):s.clone(),c=CC(new F,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function Wje(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new jt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new jt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function Xje(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new jt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new ys(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function Yje(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return jU(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=St.lerp(h,d,l)}e.setValue(r,c)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function qje(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];$E.isEqual(c,u)||n.push({update:h=>{s[l].fromArray($E.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function Qje(e,t,i,r="texture"){var m,v;if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=((m=t==null?void 0:t[r])==null?void 0:m.rotation)??0,a=((v=i[r])==null?void 0:v.rotation)??0;if(n&&s!==a)return{update:x=>{n.value=St.lerp(s,a,x)*St.DEG2RAD},start:()=>{n.value=s*St.DEG2RAD},end:()=>{n.value=a*St.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],p=[...c.offset],f=l.rotation??0,g=c.rotation??0;if(!Gu.isEqual(u,d)||!Gu.isEqual(h,p)||f!==g)return{update:x=>{o.repeat=Gu.lerp(u,d,x),o.offset=Gu.lerp(h,p,x),o.rotation=St.lerp(f,g,x),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=f,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=g,o.updateMatrix()}}}function Jje(e,t){return{update:()=>{e.transparent=t}}}var b3=new F,B7=new Pn;function Kje(e,t,i,r,n){var f,g,m,v,x,y;let s=[],a,o,l,c,u,h,d,p;if(e instanceof is?(a=TC("position",e,t,i,n),a&&s.push(a),l=us("rotation",e,t,i,n),l&&s.push(l),c=TC("shear",e,t,i,n),c&&s.push(c)):(p={slide:((f=t.pathSnapping)==null?void 0:f.slide)??((g=e.updatedPathSnapping)==null?void 0:g.slide)??((m=e.dataPatched.pathSnapping)==null?void 0:m.slide)??0,offset:((v=t.pathSnapping)==null?void 0:v.offset)??((x=e.updatedPathSnapping)==null?void 0:x.offset)??((y=e.dataPatched.pathSnapping)==null?void 0:y.offset)??0},h=us("slide",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),h&&s.push(h),d=us("offset",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=I7("position",e,t,i,n),a&&s.push(a),o=I7("scale",e,t,i,n),o&&s.push(o),l=Zje(e,t,i,r,n),l&&s.push(l),u=Oje("hiddenMatrix",e,t,i),u&&s.push(u))),a||o||l||u||h||d){let _=e instanceof is?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var A;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(A=e.parent)!=null&&A.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),wl(e)&&Hu(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,p))};s.push({update:_,start:_,end:_})}return s}function Zje(e,t,i,r,n){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*St.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*St.DEG2RAD);if(!a)return;let o=s?new F().fromArray(s):new F().setFromEuler(e.rotation),l=new F().fromArray(a);if(o.equals(l))return;let c=b3.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new $t().setFromEuler(B7.setFromVector3(o)),d=new $t().setFromEuler(B7.setFromVector3(l));return{update:p=>{Lje(h,d,e.quaternion,p)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{b3.lerpVectors(o,l,h),e.rotation.setFromVector3(b3)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function $je(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;tte.forEach(p=>{let f;p==="count"?f=us("count",s.parameters,a,o,r,!0):f=hp(p,s.parameters,a??{},o,r),f&&n.push(f)});let l=e6e(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=t6e(s,a,o,r);c!=null&&c.length&&n.push(...c);let u=i6e(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=r6e(s,a,o,r);h!=null&&h.length&&n.push(...h);let d=n6e(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function e6e(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return ite.forEach(l=>{let c=hp(l,a,n??{},s,r);c&&o.push(c)}),o}function t6e(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return rte.forEach(l=>{let c=hp(l,o,n??{},s,r);c&&a.push(c)}),a}function i6e(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return nte.forEach(l=>{let c;l==="count"?c=Wk(l,o,n??{},s,r,!0):c=hp(l,o,n??{},s,r),c&&a.push(c)}),a}function r6e(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return ste.forEach(l=>{let c;l==="count"?c=us(l,o,n??{},s,r,!0):c=hp(l,o,n??{},s,r),c&&a.push(c)}),a}function n6e(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return ate.forEach(l=>{let c=hp(l,o,n??{},s,r);c&&a.push(c)}),a}function s6e(e,t){return{update:()=>{e instanceof Qn&&(e.fill.enabled=t)}}}function a6e(e,t){return{update:()=>{e instanceof Qn&&(e.stroke.enabled=t)}}}function o6e(e,t){return{update:()=>{e instanceof Qn&&(e.dropShadow.enabled=t)}}}function l6e(e,t){return{update:()=>{e instanceof Qn&&(e.innerShadow.enabled=t)}}}function c6e(e,t){return{update:()=>{e instanceof Qn&&(e.backgroundBlur.enabled=t)}}}function u6e(e,t){return{update:()=>{e instanceof Qn&&(e.layerBlur.enabled=t)}}}function h6e(e,t,i,r,n){let s=[],a,o,l,c,u,h,d,p,f,g,m,v,x,y,_;if("width"in e&&(a=us("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=us("height",e,t,i,n),o&&s.push(o)),e instanceof Qn||e instanceof Oc){let A={...t.fill},S={...i.fill};A.enabled!==void 0&&A.enabled!==S.enabled&&(s.push(s6e(e,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),l=WA("color",e.fill,A,S,n),l&&s.push(l)}if(e instanceof Qn){let A={...t.stroke},S={...i.stroke};(A.enabled||S.enabled)&&(s.push(a6e(e,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),c=WA("color",e.stroke,A,S,n),c&&s.push(c),u=us("thickness",e.stroke,A,S,n),u&&s.push(u)}if(e instanceof Qn){let A={...t.dropShadow},S={...i.dropShadow};(A.enabled||S.enabled)&&(s.push(o6e(e,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),h=WA("color",e.dropShadow,A,S,n),h&&s.push(h),d=us("blurRadius",e.dropShadow,A,S,n),d&&s.push(d),f=us("spread",e.dropShadow,A,S,n),f&&s.push(f),p=TC("offset",e.dropShadow,A,S,n),p&&s.push(p)}if(e instanceof Qn){let A={...t.innerShadow},S={...i.innerShadow};(A.enabled||S.enabled)&&(s.push(l6e(e,!0)),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),g=WA("color",e.innerShadow,A,S,n),g&&s.push(g),m=us("blurRadius",e.innerShadow,A,S,n),m&&s.push(m),x=us("spread",e.innerShadow,A,S,n),x&&s.push(x),v=TC("offset",e.innerShadow,A,S,n),v&&s.push(v)}if(e instanceof Qn||e instanceof Oc){let A={...t.backgroundBlur},S={...i.backgroundBlur};(A.enabled||S.enabled)&&(s.push(c6e(e,!0)),A.enabled||Object.assign(A,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),y=us("radius",e.backgroundBlur,A,S,n),y&&s.push(y)}if(e instanceof Qn){let A={...t.layerBlur},S={...i.layerBlur};(A.enabled||S.enabled)&&(s.push(u6e(e,!0)),A.enabled||Object.assign(A,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),_=us("radius",e.layerBlur,A,S,n),_&&s.push(_)}if(e instanceof Oc||e instanceof xb){let A=Wk("cornerRadius",e,t,i,n);A&&s.push(A)}return s}function F7(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...Kje(e,t,i,n,r)),e instanceof is?s.push(...h6e(e,t,i,n,r)):(e.data.visible&&s.push(...$je(e,t,i,r)),wl(e)?(e instanceof vn&&e.data.visible&&s.push(...kje(e,t,i,r)),e.data.visible&&s.push(...Vje(e,t,i,r))):J4e(e)?e.data.visible&&s.push(...zje(e,t,i,r)):Q4e(e)&&s.push(...Fje(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var N7=new F;function Xk(e,t,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=Af.patch(o,c)}k7(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),U7(e)};e.scene.traverse2D(n),e.traverseChildren(a=>{var u,h,d,p,f,g;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(N7,!0),(p=a.rigidBody)==null||p.setAngvel(N7,!0)),!Ei.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===Z0)return;let c=!1;r.some(m=>{var v;return(v=e.scene.find(o))==null?void 0:v.isDescendantOf(m)})?c=!0:((f=l.physics)==null?void 0:f.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let m of l.states){let v={...m.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(m.data.position!==void 0&&delete v.position,m.data.rotation!==void 0&&delete v.rotation,m.data.hiddenMatrix!==void 0&&delete v.hiddenMatrix),a.states||(a.states={}),a.states[m.id]=bf.patch(l,v)}k7(e.scene,a,null,t,l.events.find(m=>m.data.type==="Follow"||m.data.type==="LookAt")!==void 0),a instanceof Os&&a.frame&&(a.frame.traverse(m=>n(m)),(g=a.uiCanvas)==null||g.applySize())}),U7(e),e.frame&&(e.frame.traverse(a=>n(a)),(s=e.uiCanvas)==null||s.applySize())}function U7(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function k7(e,t,i,r,n=!1){if(t instanceof vn&&!(t instanceof lm)&&t.removeInteractionGeometry(r),t instanceof is?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof vn&&t.updateGeometryGroupsIfNeeded(),t instanceof Fs&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof is)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function Ore(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=$h.linear;break;case 1:i=$h.ease;break;case 2:i=$h.easeIn;break;case 3:i=$h.easeOut;break;case 4:i=$h.easeInOut;break;default:i=$h.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function FB(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var d6e={type:"beginState"},p6e={type:"completeState",isfromEntity:!1},z7=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof is||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Fs&&o.dispatchEvent(d6e)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof is||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Fs&&o.dispatchEvent(p6e)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=F7(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=NM(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=NM(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=NM(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...FB(r),...Ore(r),change:this.onChange},this.callback=F7(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},Bre=class extends ws{constructor(e,t,i,r,n){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=NM(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&OW(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=FB(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=Lre.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],p;u===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(p=void 0,this.object instanceof Fs&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new z7(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],p;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(p=void 0,this.object instanceof Fs&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new z7(this.object,p,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u-1]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(gr(this.shared,this.condition)===!1||OW(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=FB(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof is?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(gr(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(gr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function NM(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var f6e={type:"beginState"},V7={type:"completeState",isfromEntity:!1},G7={type:"requestRender"},Fre=class extends ws{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new F,this.posEnd=new F,this.qStart=new $t,this.qEnd=new $t,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=Lre({targets:i,t:1,...Ore(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(f6e));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(G7),i.t===1&&r.dispatchEvent(V7)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(gr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(gr(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(V7),this.page.activeCamera.dispatchEvent(G7))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function Nre(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=LOe(t);return i&&i>2?i:2}return 2}var Ure=class extends ws{constructor(e,t,i,r,n){var l,c,u;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=Nre(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(gr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=St.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(gr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},kre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(gr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),Xk(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},zre=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=gr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=zte(this.data.expression,this.shared,ms.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},Vre=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(gr(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},m6e=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(gr(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(fB(e))})}dispose(){}},g6e=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){var e;if(gr(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function gr(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=zte(t.expression,e,"boolean");return t.negate?!i:!!i}function bn(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?Ds[e.type].includes("Audio")&&a.Audio.push(new pre(c,u,s,r,l)):u.type==="Video"&&!(s instanceof is)?Ds[e.type].includes("Video")&&a.Video.push(new Hre(c,u,s,r,l)):u.type==="Particles"?Ds[e.type].includes("Particles")&&a.Particles.push(new fre(u,i,r,l)):u.type==="Link"?Ds[e.type].includes("Link")&&a.Link.push(new ije(u,n.controlsManager,r,l)):u.type==="Create"?Ds[e.type].includes("Create")&&a.Create.push(new jre(u,i,n.controlsManager,r,l)):u.type==="Destroy"?Ds[e.type].includes("Destroy")&&a.Destroy.push(new mre(u,i,n.controlsManager,r,l)):u.type==="Reset"?Ds[e.type].includes("Reset")&&a.Reset.push(new gre(u,i,r,n,l)):u.type==="Transition"?Ds[e.type].includes("Transition")&&a.Transition.push(new Bre(e.type,u,i,r,l)):u.type==="SwitchCamera"?Ds[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new Fre(u,i,r,l)):u.type==="SceneTransition"?Ds[e.type].includes("SceneTransition")&&a.SceneTransition.push(new kre(u,i,n,r,l)):u.type==="Animation"?Ds[e.type].includes("Animation")&&a.Animation.push(new Ure(u,i,n.animationControls,r,l)):u.type==="SetVariable"?Ds[e.type].includes("SetVariable")&&a.SetVariable.push(new zre(u,i,r,l)):u.type==="DynamicVariablePlay"?Ds[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new Vre(u,i,r,l)):u.type==="Conditional"?Ds[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?Ds[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new m6e(u,i,r,l)):u.type==="UserAPI"&&Ds[e.type].includes("UserAPI")&&a.UserAPI.push(new g6e(u,i,r,l))}catch{}};return t.forEach(o()),a}function $n(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof pre||i instanceof Hre||i instanceof fre||i instanceof Ure||i instanceof Bre||i instanceof jre||i instanceof mre||i instanceof Fre||i instanceof kre||i instanceof gre||i instanceof zre||i instanceof Vre)&&i.dispose()})})}function v6e(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Gre=new Map,bx=new Map,qv=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=v6e(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,db&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),bx.has(i.uuid)?bx.get(i.uuid).push(this):bx.set(i.uuid,[this]),Gre.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},NB=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=Gre.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=bx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...bx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Hre=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new qv(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new NB(t);else throw new Error("Missing property")}dispatchBasic(){if(gr(this.shared,this.condition)===!1)return!1;this.interaction instanceof qv?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(gr(this.shared,this.condition)===!1)return!1;this.interaction instanceof qv?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},H7=(()=>{let e,t,i,r;function n(o){!e&&!j7()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&u[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(u[p.userData.actionId]>p.userData.quantity&&u[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){j7()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function j7(){return!!document&&document.hidden}var W7=new $t,y6e=new F,x6e=new F,jre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=St.generateUUID(),this.dispatch=()=>{if(gr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(gr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=KOe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new gs(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),H7(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,p;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof No)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof gs)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof No)return;a instanceof gs?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new F().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(y6e,W7,x6e),l.applyQuaternion(W7),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");H7(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},Wre=200,_3=.02,S3=.3,w6e=65;new F;var X7=new F,Y7=new F,b6e=new F,qs=new F,ga=new F,Hh=new F,A3=new ot,q7=new ot,_6e=new ot;new ot;var hl=new $t,pu=new $t,oc=new Pn(0,0,0,"YXZ"),S6e=new F(1,0,0),dl=new F(0,1,0),A6e=new F(0,0,1),Q7=new F(1,1,1);new Oa;var M6e=1,E6e=.025,C6e=16e-6,J7=12,T6e=20,jn=new zo,bo=new nn,P6e={type:"requestRender"},D6e={type:"updateMatrix"},K7=Math.PI/6,UB=class extends ws{constructor(e,t,i,r,n,s,a,o,l){var f;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new ot,this.target0=new F,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=Wre,this.euler0=new Pn(0,0,0,"YXZ"),this.position0Cam=new F,this.quat0Cam=new $t,this.scale0Cam=new F,this.hiddenMatrix0Cam=new ot,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new zo(new F(0,-40,0),new F(0,40,0)),matrix:new ot,position:new F,rotation:new $t},this.euler=new Pn(0,0,0,"YXZ"),this.eulerDelta=new F,this.lastPosition=new F,this.lastCameraQuaternion=new $t,this.lastCameraPosition=new F,this.PI_2=Math.PI/2,this.prevMouse=new pe,this.velocityTarget=new F,this.velocity=new F,this.directionXZ=new F,this.rotVelocityStick=new F,this.rotVelocityTarget=new F,this.rotVelocity=new F,this.rotDirection=new F,this.nonColliderRotOffset=new ot,this.nonColliderPosOffset=new ot,this.firstPointerId=-1,this.rot=new F,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new ot,this.objectToTarget=new F,this.objectToTarget0=new F,this.objectToCamXZ=new F,this.objectToCamXZ0=new F,this.targetToCamera=new F,this.targetToCamera0=new F,this.cameraPolarAxis0=new F,this.targetPos=new F,this.targetQuat=new $t,this.lerpFactorPos=new F().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new $t,this.objXZQuatInv=new $t,this.objXZRotMat=new ot,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new F,this.pushedVelocity=new F,this.groundYRotation=0,this.objectRealQuat=new $t,this.colliderWorldQuat=new $t,this.groundNormal=new F,this.groundTilt=new $t,this.groundTiltInv=new $t,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new F,this.quaternion=new $t,this.scale=new F,this.initialAction=!0,this.onPointerDown=g=>{var m;!(g.target===this.domElement||g.target instanceof HTMLElement&&g.target.tagName==="SPLINE-VIEWER"&&((m=g.target.shadowRoot)!=null&&m.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=g.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!Ka&&!xW&&this.domElement.requestPointerLock(),this.prevMouse.set(g.clientX,g.clientY))},this.onPointerUp=g=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),g.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=g=>{if(g.pointerId!==this.firstPointerId)return;let m=g.clientX-this.prevMouse.x,v=g.clientY-this.prevMouse.y;this.prevMouse.set(g.clientX,g.clientY),g.pointerType==="mouse"&&this.rotBy!=="keys"&&(xW&&oBe<15.5&&!Ka?(this.eulerDelta.y=-m*this.mouseOrbitSensitivity,this.eulerDelta.x=-v*this.mouseOrbitSensitivity):(this.eulerDelta.y=-g.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-g.movementY*this.mouseOrbitSensitivity)),g.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-m*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-v*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=g=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?UB.isLocked=!0:UB.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let g in this.movementState)this.movementState[g]=0},this.onKeyDown=g=>{!(g.target instanceof HTMLInputElement)&&(g.code==="ArrowLeft"||g.code==="ArrowUp"||g.code==="ArrowRight"||g.code==="ArrowDown"||g.code==="Space")&&g.preventDefault();for(let m of this.keyAssignments)if(g.key.toUpperCase()===m[1]||g.key===m[1]){this.movementState[m[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=g=>{for(let m of this.keyAssignments)if(g.key.toUpperCase()===m[1]||g.key===m[1]||g.code.slice(3,g.code.length).toUpperCase()===m[1]){this.movementState[m[0]]=0;break}},this.copyVRGamePadValues=(g,m)=>{for(let v=2;v<4;v++){let x=g.axes[v];m===0?v===2?this.movementState.movePosX=x:this.movementState.movePosZ=x:(g.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,v===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(x)>=.3&&(this.vrEulerYOffset+=x<0?1:-1),this.movementState.rotPosY=x):this.moveMode==="fly"&&(this.movementState.moveNegY=x))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((f=this.camera)==null?void 0:f.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let g=new F(0,0,-1).applyQuaternion(this.camera.quaternion),m=new F().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(m),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let v,x;Math.abs(g.y)<1e-6?(m.y=0,g.y=0,x=m.projectOnVector(g)):m.y/g.y>0?x=g.multiplyScalar(m.y/g.y):x=g.multiplyScalar(m.length()),this.targetToCamera0.copy(x).negate(),v=this.camera.position.clone().add(x),this.objectToTarget0.subVectors(v,this.position);let y=new Pn().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-y.x,y.x=0,y.z=0,y.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(y)}if(this.object instanceof Fs&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*M6e,this.speedOrbit=(i.speedRotate??100)*E6e,this.mouseOrbitSensitivity=(i.speedRotate??100)*C6e,this.keyAssignments=i.keyAssignments.map(g=>{let m=[g[0],g[1]];return m[1]===""?m[1]="ArrowUp":m[1]===""?m[1]="ArrowLeft":m[1]===""?m[1]="ArrowDown":m[1]===""?m[1]="ArrowRight":m[1]===""?m[1]="Shift":m[1]===""?m[1]="Enter":m[1]==="Space"?m[1]=" ":m[1]===""?m[1]="Meta":m[1]==="Ctrl"?m[1]="Control":m[1]==="Esc"&&(m[1]="Escape"),m}),i.rotBy==="mouse"){let g;g=this.keyAssignments.findIndex(m=>m[0]==="rotNegX"),g!==-1&&(this.keyAssignments[g][1]=""),g=this.keyAssignments.findIndex(m=>m[0]==="rotPosX"),g!==-1&&(this.keyAssignments[g][1]=""),g=this.keyAssignments.findIndex(m=>m[0]==="rotPosY"),g!==-1&&(this.keyAssignments[g][1]=""),g=this.keyAssignments.findIndex(m=>m[0]==="rotNegY"),g!==-1&&(this.keyAssignments[g][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??w0.defaultData.gravity)*J7,this.usePhysics=this.gloabalPhysics.usePhysics??w0.defaultData.usePhysics,this.jumpPower=i.jumpPower*T6e,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??cC.defaultDataThirdPerson.orientWith,this.slopeThresh=w6e*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*_3/this.pixelsPerMeter,this.stepThresh=i.collider.height*S3/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*_3/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*S3/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*_3/this.pixelsPerMeter,this.stepThresh=i.collider.height*S3/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new F().fromArray(i.collider.position),d=new $t().setFromEuler(new Pn().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,Q7),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let g=new Bt;g.push({fi:0,data:{...Xn.defaultData("light","phong"),alpha:0},id:"layer1"}),g.push({fi:0,data:{...Xn.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let m=new gk({layers:g},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new cr(xte.create({parameters:{width:p,height:p/10,hollow:.7}}),m),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new Pn().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Fs?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},lC.list.forEach(i=>{this.actions[i]=bn({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),$n(this.actions.idle),$n(this.actions.move),$n(this.actions.run),$n(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return qs.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,p,f,g;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let m=ga.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*J7),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,m,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(v){this.onObject=!0,this.groundNormal.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=v.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let x=v.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let y of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(y.rigidBody===x&&y.userData.isFollowingObj!==this.object.uuid){(y.hasNonUniformScale?y.matrixWorldRigid:y.matrixWorld).decompose(qs,pu,ga),this.groundVelocity.subVectors(qs,y.prevT),this.object.getWorldPosition(ga).add(this.collider.position).sub(qs),this.groundYRotation=oc.setFromQuaternion(pu).y-y.prevR.y,Hh.copy(ga).applyAxisAngle(dl,this.groundYRotation),this.groundVelocity.add(Hh.sub(ga)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let m=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let v=qs.subVectors(this.path[1],this.position),x=ga.subVectors(this.path[1],this.path[0]);v.dot(x)<0?this.path.shift():(this.directionXZ.x=x.x,this.directionXZ.z=x.z),m.opacity=m.userData.opacity0}else m.opacity-=.05*m.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=b6e.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let m=ga.copy(a);m.y=0,a.set(0,a.y,m.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let m=qs;this.camera.getWorldDirection(m);let v=Hh.copy(dl).multiplyScalar(m.dot(dl));m.sub(v);let x=ga.copy(this.directionXZ);x.x*=-1,this.rot.y=m.angleTo(x)*(m.cross(x).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(oc.setFromVector3(this.rot),this.moveMode==="walk"&&(oc.x=0),a.applyEuler(oc),s&&(pu.setFromUnitVectors(dl,this.groundNormal),a.applyQuaternion(pu)),i){let m=oc.set(0,this.vrEulerYOffset*K7,0);i.applyEuler(m),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let m=ga;this.pushedVelocity.set(0,0,0);for(let v of this.sharedGameControlGlobals.entitiesWithTransformAnim){let x=Hh.setFromMatrixPosition(v.matrixWorld).sub(v.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),y=v.rigidBody.collider(0).castCollider(x,this.object.rigidBody.collider(0),qs.copy(a).divideScalar(this.pixelsPerMeter),r,!1);x.multiplyScalar(this.pixelsPerMeter);let _=Ei.is(v)?v:v.object;if(y!==null&&this.lastHitObj!==_){let A;v instanceof gs&&(A=v);let S=this.sharedGameControlGlobals.entityToCollisionEvents[_.uuid];if(S)for(let C of S)C.data.target==="character"&&(C.dispatch(A),_.dispatchEvent(zB));this.lastHitObj=_}if(y!==null){this.pushedVelocity.copy(x),m.copy(y.normal1).applyQuaternion(v.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let v=m.dot(a);v<0&&a.addScaledVector(m,-v),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(dl,this.euler.y-this.euler0.y);let m=ga.copy(this.objectToCamXZ).normalize(),v=Hh.copy(a).multiplyScalar(r);v.y=0;let x=v.sub(qs.copy(m).multiplyScalar(v.dot(m))).cross(m).y;this.euler.y-=Math.atan2(x,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=St.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=St.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=St.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(oc.copy(t),oc.y=0):(oc.copy(this.euler),oc.y=0),this.nonColliderRotOffset.makeRotationFromEuler(oc)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*K7),hl.setFromAxisAngle(S6e,this.rot.x),pu.setFromAxisAngle(dl,this.rot.y),pu.multiply(hl),hl.setFromAxisAngle(A6e,this.rot.z),pu.multiply(hl),this.quaternion.copy(pu),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let m=ga.copy(a).multiplyScalar(r/this.pixelsPerMeter),v=null;this.didHit=!1;let x=new F;for(let y=0;y<5;y++){let _=m.length(),A=Hh.copy(m).normalize();if(v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(x),this.colliderWorldQuat,A,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,_,!1,24,void 0,void 0,this.object.rigidBody),v!==null){this.didHit=!0;let S=this.sharedGameControlGlobals.colliderToEntity.get(v.collider.handle);if(S!==this.lastHitObj&&y===0){this.lastHitObj=S;let P=this.sharedGameControlGlobals.entityToCollisionEvents[S==null?void 0:S.uuid];if(P){for(let R of P)if(R.data.target==="character"){let O=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(v.collider.handle))._parent,L;if(S.cloner){for(let I of S.cloner.children)if(I.rigidBody===O){L=I;break}}R.dispatch(L),S.dispatchEvent(zB)}}}let C=X7.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat),M=Y7.copy(A).multiplyScalar(v.toi).dot(C),E=v.toi;if(E===0&&(this.position.y+=this.offset*this.pixelsPerMeter),M>this.offset&&(E=v.toi*(M-this.offset)/M,x.addScaledVector(A,E)),m.copy(A).multiplyScalar(_-E),Math.acos(-C.y)>this.slopeThresh){let P=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(x),R=Hh.copy(v.witness2).applyQuaternion(this.colliderWorldQuat);R.y=0;let O=P.add(R);O.y+=this.stepThresh;let L=this.sharedGameControlGlobals.rapierWorld.castShape(O,this.colliderWorldQuat,m,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);L!==null&&L.toi===0&&(C.y=0,C.normalize())}m.addScaledVector(C,-m.dot(C))}else{y===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),x.add(m);break}}this.position.addScaledVector(x,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(qs.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(hl.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let m=this.onObject?1:5,v=a.multiplyScalar(r/m);for(let x=0;x<m;x++)this.position.add(v),this.collisionAdjustment(r/m)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let m=this.objectToTarget.add(this.position),v=this.targetToCamera.add(m);A3.lookAt(v,m,dl).setPosition(v),A3.decompose(this.targetPos,this.targetQuat,qs),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=St.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=St.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(D6e),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((g=(f=this.navMeshPathDest)==null?void 0:f.material)==null?void 0:g.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(P6e),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=hl.setFromAxisAngle(dl,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?St.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=St.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=St.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=qs.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=pu.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){dl.angleTo(e)*180/Math.PI<15||dl.angleTo(e)*180/Math.PI>85?hl.identity():hl.setFromUnitVectors(dl,e),this.groundTilt.slerp(hl,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=Y7.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=A3.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(qs,hl,ga).compose(qs,hl,Q7);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;bo.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=q7.copy(a).invert(),l=_6e.copy(q7).multiply(i);jn.copy(this.collider.segment),jn.start.applyMatrix4(l),jn.end.applyMatrix4(l);let c=X7.copy(this.position).applyMatrix4(o);bo.expandByPoint(jn.start),bo.expandByPoint(jn.end),bo.min.addScalar(-this.collider.radius),bo.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(jn.end)},intersectsBounds:u=>u.intersectsBox(bo),intersectsTriangle:u=>{let h=qs,d=ga,p=u.closestPointToSegment(jn,h,d);if(p<this.collider.radius){let f=this.collider.radius-p,g=d.sub(h).normalize(),m=Hh.copy(c);m.addScaledVector(g,f);let v=m.applyMatrix4(a).sub(this.position);t.add(v),jn.start.addScaledVector(g,f),jn.end.addScaledVector(g,f)}}})}),bo.makeEmpty(),jn.copy(this.collider.segment),jn.start.applyMatrix4(i),jn.end.applyMatrix4(i),bo.expandByPoint(jn.start),bo.expandByPoint(jn.end),bo.min.addScalar(-this.collider.radius),bo.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(jn.end)},intersectsBounds:s=>s.intersectsBox(bo),intersectsTriangle:s=>{let a=qs,o=ga,l=s.closestPointToSegment(jn,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),jn.start.addScaledVector(u,c),jn.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},Xre=UB;Xre.isLocked=!1;var R6e=lp(JZ());function Yre(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,r=t[4]**2+t[5]**2+t[6]**2,n=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function Tu(e,t){let i=new Ot;if(t&&Yre(t))return i.setAttribute("position",new xt([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new xt([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=zT(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new xt(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var I6e=new ot,L6e=new ot,lc=[[0,0,0],[0,0,0],[0,0,0]];function qre(e){let t=e.elements;lc[0][0]=t[0],lc[0][1]=t[4],lc[0][2]=t[8],lc[1][0]=t[1],lc[1][1]=t[5],lc[1][2]=t[9],lc[2][0]=t[2],lc[2][1]=t[6],lc[2][2]=t[10];let{u:i,v:r}=(0,R6e.SVD)(lc),n=I6e.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=L6e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var O6e=class extends H${constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new up({color:65280,linewidth:10}),t=new F(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new F(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new F().addVectors(t,i.multiplyScalar(r)),s=new Ot;return s.setFromPoints([t,n]),new IE(s,e)}},Qre=e=>e instanceof Xv||e instanceof Yv;function B6e(e,t){return e.distance-t.distance}function Jre(e,t,i){if(!(!Cu(t)||!t.visible)){wl(t)&&t.raycast(e,i);for(let r of t.children)Jre(e,r,i)}}function UM(e,t,i,r=!1){if(!r&&!i.some(s=>PC(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>Jre(e,s,n)),n.sort(B6e),n}function kB(e){let t=[];if(e.length){let i=e[0].object;Cu(i)&&t.push(i);let r=i.parent;for(;r;)Qre(r)&&t.push(r),r=r.parent}return t}function Pu(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function PC(e,t){if(wl(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(Qre(t))return Kre(e,t)}function Kre(e,t){if(!(!Cu(t)||!t.visible)){if(wl(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=Kre(e,i);if(r)return r}}}function F6e(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function N6e(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var U6e=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new O6e,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=F6e(t,i,this._domRect),this.pointerScreen=N6e(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Vs=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},Yk=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Zre=e=>{var t;return(t=Yk.find(([i,r])=>r===e))==null?void 0:t[0]},wb=e=>{var t;return(t=Yk.find(([i])=>i===e))==null?void 0:t[1]},k6e=(e,t)=>{let i=Zre(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},z6e=class extends Vs{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var r;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(r=this.splineEvents[Zre(e.eventName)])==null?void 0:r[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,r;if((i=t.data)!=null&&i.events.length){for(let[n,s]of Yk)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(t):this.objectsPerEvents.set(n,[t]);let a={id:t.uuid,name:t.name},o=k6e(s,a),l=this.splineEvents[n];l?l[t.uuid]=o:this.splineEvents[n]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},V6e=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=bn(t,t.actions,r,n,s,i)}disconnect(){$n(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},G6e=class extends Vs{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=UM(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{Qt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{Qt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{Qt.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{Qt.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,u;if(!r||!n)return;let a=wb(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(u,h)=>{var p,f;if(!((p=u.data)!=null&&p.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let g of d){let m=this.eventsPerObjects[g];if(u.data.events.filter(({data:v})=>v.type===g&&v.disabled!==!0).forEach(({id:v,data:x})=>{try{let y=new V6e(v,x,u,e,t,this.eventManager);y.actions.Video.length&&(this.hasVideoAction=!0),(x.type==="MouseDown"||x.type==="MouseUp"||x.type==="MousePress")&&(x.mode==="Canvas"||x.mode==="Window")?this.canvasMouseEvents.push(y):(m[u.uuid]?m[u.uuid].some(_=>_.id===y.id)||m[u.uuid].push(y):m[u.uuid]=[y],u instanceof lm&&u.traverseChildren(_=>{var A;if(!_.visible)return!0;_ instanceof vn&&((A=_.data.geometry.shapeBlendNode)==null?void 0:A.operation)!==2&&(m[_.uuid]?m[_.uuid].push(y):m[_.uuid]=[y])}))}catch{}}),((f=m[u.uuid])==null?void 0:f.length)&&(this.objectsPerTypes[g].push(u instanceof is&&(g==="MouseDown"||g==="MouseUp"||g==="MousePress")?h:u),u instanceof lm)){let v=this.objectsPerTypes[g];u.traverseChildren(x=>{if(!x.visible)return!0;x instanceof vn&&v.indexOf(x)===-1&&v.push(x)})}}};e.traverseEntity(u=>{var h;(u instanceof Os||u instanceof qn)&&((h=u.frame)==null||h.traverse(d=>{r(d,u)})),r(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(h=>!(h instanceof is));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&Pu(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=UM(i,r,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];kB(h).forEach(p=>{p instanceof Os&&Pu(p,d,Object.keys(this.eventsPerObjects[e]),f=>{this.handleObjectMouseEventDispatch(f,e)}),this.eventsPerObjects[e][p.uuid]&&this.handleObjectMouseEventDispatch(p,e)})}}t||a.forEach(h=>{var p,f;let d=PC(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof Os&&Pu(h,[((p=d==null?void 0:d.uv)==null?void 0:p.x)??0,((f=d==null?void 0:d.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[e]),g=>{this.handleObjectMouseEventDispatch(g,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof is)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=Pu(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{n.push(u)})),s&&!c){let u=UM(a,o,r);n=kB(u),u.forEach(h=>{var d,p;h.object instanceof Os&&Pu(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{n.push(f)})})}else r.forEach(u=>{var d,p;let h=PC(a,u);h&&(n.push(u),u instanceof Os&&Pu(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{n.push(f)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},H6e=new F,j6e=new F,$re=class{constructor(e,t,i,r,n){this.actionsIn=bn(e,e.inActions,i,r,n,t),this.actionsOut=bn(e,e.outActions,i,r,n,t)}disconnect(){$n(this.actionsIn),$n(this.actionsOut)}},W6e=class extends $re{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=H6e.setFromMatrixPosition(this.objects[0].matrixWorld),u=j6e.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch()),d.ClearLocalStorage.forEach(p=>p.dispatch()),d.UserAPI.forEach(p=>p.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},X6e=class extends $re{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){wf(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),wf(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),wf(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),wf(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},Y6e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new W6e(n,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new X6e(n,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},y1=new F,jh=new F,Up=new F,Z7=new ba,q6e=.01,Xi=new F,En=new F,$7=new F,Cf=new $t,M3=new Pn,Q6e=new ot,E3=new gn,Fg=new F,cc=new F,Ng=.2;function C3(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var J6e=function(){let e=new ot;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&C3(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?C3(n.position,t.limits):t.reference==="local"&&(Cf.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Cf),C3(n.position,t.limits),Cf.invert(),n.position.applyQuaternion(Cf),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(Xi,n.quaternion,En),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof la&&Hu(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),K6e=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=bn(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=bn(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new F().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new F().setFromMatrixPosition(l.matrixWorld),pointStart:new F,pointEnd:new F,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new F().copy(l.position),quat0:new $t().copy(l.quaternion),snapped:!1,orientationMatrix:new ot,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){$n(this.actionsDrag),$n(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},Z6e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if(Qt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||Ei.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(Xi,Cf,En),M3.setFromQuaternion(Cf),d.prevR===void 0?(d.prevR=M3.clone(),d.prevT=Xi.clone()):(d.prevR.copy(M3),d.prevT.copy(Xi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if(Qt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(Qt.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||Ei.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof Xv)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(p=>p===d.object.uuid||n.scene.find(p).isAncestorOf(d.object.uuid))))[0]),h){let d=$7.copy(h.face.normal).applyMatrix3(E3.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Xi.copy(d).applyMatrix3(E3.setFromMatrix4(u.obj.matrixWorld).transpose());let p=u.obj;Xi.x>Ng?En.x=-p.recursiveBBox.min.x:Xi.x<-Ng&&(En.x=-p.recursiveBBox.max.x),Xi.y>Ng?En.y=-p.recursiveBBox.min.y:Xi.y<-Ng&&(En.y=-p.recursiveBBox.max.y),Xi.z>Ng?En.z=-p.recursiveBBox.min.z:Xi.z<-Ng&&(En.z=-p.recursiveBBox.max.z),En.applyMatrix3(E3.invert())}else En.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(En)}this.activeEvent.data.autoOrient&&(Xi.set(0,1,0).cross(d),Xi.length()<1e-4&&Xi.set(-1,0,0).cross(d),En.crossVectors($7,Xi),u.orientationMatrix.makeBasis(Xi,En,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(p=>{p.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new K6e(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(jh),jh.negate();let a=Cf.identity();switch(r==="parent"?Q6e.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Xi,a,En):r==="local"&&e.matrixWorld.decompose(Xi,a,En),i){case"x":Xi.set(1,0,0).applyQuaternion(a),Fg.copy(jh).cross(Xi),cc.copy(Xi).cross(Fg);break;case"y":Xi.set(0,1,0).applyQuaternion(a),Fg.copy(jh).cross(Xi),cc.copy(Xi).cross(Fg);break;case"z":Xi.set(0,0,1).applyQuaternion(a),Fg.copy(jh).cross(Xi),cc.copy(Xi).cross(Fg);break;case"xy":cc.set(0,0,1).applyQuaternion(a);break;case"yz":cc.set(1,0,0).applyQuaternion(a);break;case"xz":cc.set(0,1,0).applyQuaternion(a);break;case"adaptive":jh.angleTo(En.set(0,1,0))>Math.PI/6?(Xi.crossVectors(En.set(0,1,0),jh),cc.crossVectors(Xi,En)):cc.set(0,1,0);break;default:cc.copy(jh);break}Up.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Up;if(Z7.setFromNormalAndCoplanarPoint(cc,o),!!s.ray.intersectPlane(Z7,t)&&(i==="x"||i==="y"||i==="z")){let l=En.subVectors(t,o).dot(Xi);t.copy(o).addScaledVector(Xi,l)}}updateDragItem(e,t=!1){var i,r;Up.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?y1.subVectors(e.fromPosition,Up).divideScalar(e.currentDampingFactor):e.reset==="original"?(y1.subVectors(e.obj.userData.worldPosition0,Up).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):y1.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Up).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?y1.length()<q6e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&J6e(e,y1.add(Up),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Ug=new F,T3=new F,fu=new F,mu=new F,eX=new ba,$6e=.01,eWe={type:"requestRender"},tWe=function(){let e=new F,t=new F;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),tX=function(){let e=new ot;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof la&&Hu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),iWe=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new F,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...mO.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=bn(e,e.actions,r,n,s,i)}},rWe=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Qt.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new iWe(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Ka&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,$n(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(fu),e.isReset)mu.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(mu);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(T3),T3.negate(),Ug.copy(T3)):i==="xy"?Ug.set(0,0,1):i==="xz"?Ug.set(0,1,0):i==="yz"&&Ug.set(1,0,0),eX.setFromNormalAndCoplanarPoint(Ug,fu),!l.ray.intersectPlane(eX,mu))return}if(!e.isReset){if(mu.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)mu.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(mu.x=fu.x),e.data.enabledTranslation[1]===!1&&(mu.y=fu.y),e.data.enabledTranslation[2]===!1&&(mu.z=fu.z);let s=tWe(fu,mu,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=Ug.subVectors(s,fu).divideScalar(e.currentDampingFactor);fu.add(o),t&&tX(e.object,fu),e.paused=o.length()<$6e}else tX(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(eWe)}},x1=new F,XA=new F,w1=new ot,kg=new $t,Wh=new $t,b1=new F,_1=new F,kp=new F,gu=new F,P3=new ba,nWe=1e-6,sWe={type:"requestRender"},aWe={type:"changeRotation"},iX=function(){let e=new ot;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(qre(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof la&&Hu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),oWe=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new $t,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...gO.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},lWe=class extends Vs{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Qt.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=wb(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new oWe(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Ka&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(b1),!e.isReset)if(e.target)e.target.getWorldPosition(_1);else{if(n==="custom"?(l().getWorldDirection(XA),XA.negate(),P3.setFromNormalAndCoplanarPoint(XA,b1)):(n==="xy"?x1.set(0,0,1):n==="xz"?x1.set(0,1,0):n==="yz"&&x1.set(1,0,0),P3.setFromNormalAndCoplanarPoint(x1,b1)),!c.ray.intersectPlane(P3,_1))return;r>0&&(n==="custom"||n===void 0)&&_1.addScaledVector(XA,r)}if(e.isReset||(h?t==="target"?kp.copy(h.up).applyMatrix4(w1.extractRotation(h.matrixWorld)).normalize():a.some(p=>p===!1)?(i==="x"?(gu.set(0,0,1),a[2]===!1&&gu.set(0,1,0)):i==="y"?(gu.set(1,0,0),a[0]===!1&&gu.set(0,0,1)):(gu.set(0,1,0),a[1]===!1&&gu.set(1,0,0)),kp.copy(gu).applyQuaternion(e.worldQuaternion0).normalize()):kp.set(0,1,0):n==="custom"?kp.set(0,1,0):kp.copy(x1)),e.isReset)Wh.copy(e.worldQuaternion0);else if(b1.distanceTo(_1)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Wh.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;cWe(w1,_1,b1,kp,i,gu),Wh.setFromRotationMatrix(w1),kg.setFromUnitVectors(gu.applyQuaternion(Wh),kp),a.some(p=>p===!1)&&t!=="target"&&Wh.premultiply(kg).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),kg.setFromRotationMatrix(qre(u.matrixWorld)),kg.slerp(Wh,1/e.currentDampingFactor),iX(u,w1.makeRotationFromQuaternion(kg)),e.paused=8*(1-kg.dot(Wh))<nWe):(iX(u,w1.makeRotationFromQuaternion(Wh)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(sWe),u.dispatchEvent(aWe)}},_o=new F,Mn=new F,$r=new F;function cWe(e,t,i,r,n,s){let a=e.elements;$r.subVectors(t,i),$r.lengthSq()===0&&($r.z=1),$r.normalize(),Mn.crossVectors(r,$r),Mn.lengthSq()===0&&(Math.abs(r.z)===1?$r.x+=1e-4:$r.z+=1e-4,$r.normalize(),Mn.crossVectors(r,$r)),Mn.normalize(),_o.crossVectors($r,Mn),n==="x"?s.z===1?[Mn,_o,$r]=[$r,Mn,_o]:(Mn.negate(),[Mn,$r]=[$r,Mn]):n==="y"?s.x===1?[Mn,_o,$r]=[_o,$r,Mn]:(Mn.negate(),[_o,$r]=[$r,_o]):s.x===1&&(Mn.negate(),[Mn,_o]=[_o,Mn]),a[0]=Mn.x,a[4]=_o.x,a[8]=$r.x,a[1]=Mn.y,a[5]=_o.y,a[9]=$r.y,a[2]=Mn.z,a[6]=_o.z,a[10]=$r.z}var uWe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=bn(t,t.actions,r,n,s,i)}disconnect(){$n(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},hWe=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Qt.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Qt.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Qt.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=wb(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new uWe(l,c,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof is?s:n)}};if(e.traverseEntity(n=>{var s;(n instanceof Os||n instanceof qn)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=Pu(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=UM(r,n,this.objects);t=kB(o),o.forEach(l=>{var c,u;l.object instanceof Os&&Pu(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=PC(r,o);l&&(t.push(o),o instanceof Os&&Pu(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},dWe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=bn(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){$n(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},pWe=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=bn(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let c=t.getBoundingClientRect(),u=window.getComputedStyle(e),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),p=parseFloat(u.bottom),f=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=f-i.height,r.bottom-=f-i.height);else if(!isNaN(p)){let g=document.body.clientHeight??window.innerHeight,m=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===g-p?(r.top+=c.top-i.height+p+m,r.bottom+=c.top-i.height+p+m):i.bottom<g-p&&(r.top-=f-i.height,r.bottom-=f-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){$n(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},fWe=class extends Vs{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=wb(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!r){let h=new dWe(c,u,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(h):this.wheelEventsPerObject.set(s,[h])}else{let h=new pWe(c,u,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(h):this.scrollEventsPerObject.set(s,[h])}}};e.traverseEntity(s=>{var a;(s instanceof Os||s instanceof qn)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},mWe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=bn(t,t.actions,r,n,s,i)}disconnect(){$n(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Ef?t.interaction.audioPlayer.play():t.interaction instanceof LB&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof qv?t.interaction.play(i==="autoplay"):t.interaction instanceof NB&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Ef?t.interaction.audioPlayer.play():t.interaction instanceof LB&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof qv?t.interaction.play():t.interaction instanceof NB&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},gWe=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof Ef&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof qv&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=wb(i);s&&s==="Start"&&(r instanceof is||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new mWe(c,u,r,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(t.traverseEntity(r=>{var n;(r instanceof Os||r instanceof qn)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},vWe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=bn(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){$n(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},yWe=class extends Vs{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:p,property:f,prevValue:g}=this.propertiesToWatch[d],m=this.eventContext.scene.find(p),v=yO.propertyPaths[f];if(v[0]==="width"||v[0]==="height"||v[0]==="depth")m=m.geometry.userData.parameters[v[0]];else for(let x=0;x<v.length;x++)m=m[v[x]];g===null?this.propertiesToWatch[d].prevValue=m instanceof F?m.clone():m:(m instanceof F?!m.equals(g):g!==m)&&(c.push({objId:p,property:f}),m instanceof F?this.propertiesToWatch[d].prevValue.copy(m):this.propertiesToWatch[d].prevValue=m)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:p,prevValue:f}=this.variablesToWatch[d],g=a.getVariable(p);g!==f&&(l.push(p),this.variablesToWatch[d].prevValue=g)}for(let d=0;d<this.dynamicVars.length;d++){let{id:p,expectedTime:f,last:g,data:m,timerSeconds:v,startValue:x}=this.dynamicVars[d],y=1e3;if((m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&m.format==="number3decimal"?y=1:m.dynamicVariableType==="counter"?y=m.updateInterval:m.dynamicVariableType==="random"&&(y=m.isStatic?1/0:m.updateInterval),f===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+y;continue}if(!((a.getDynamicVariablePlayState(p)==="Stopped"||a.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+y,m.dynamicVariableType==="counter"&&a.getVariable(p)!==x&&(a.updateVariable(p,x),this.eventManager.requestRender()),(m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==x&&(this.dynamicVars[d].timerSeconds=x,a.updateVariable(p,Do.getFormattedTimerTime(x,m)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(p)==="Restarted"&&a.setDynamicVariablePlayState(p,"Playing"),a.getDynamicVariablePlayState(p)==="Stopped"))){if(a.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(y-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=f)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=y,m.dynamicVariableType==="random"){let _=m.min+Math.random()*(m.max-m.min),A=m.decimals;_=Math.round(_*Math.pow(10,A))/Math.pow(10,A),a.updateVariable(p,_),l.push(p),this.eventManager.requestRender()}else if(m.dynamicVariableType==="counter"){let _=a.getVariable(p),A=a.getDynamicVariableToggleIsForward(p)??!0,S=a.getVariable(p)+m.increment*(A?1:-1);m.hasEnd&&(S=m.increment>0?St.clamp(S,x,m.endValue):St.clamp(S,m.endValue,x),S===x&&a.setDynamicVariableToggleIsForward(p,void 0),m.repeat?S===m.endValue&&(S=x):(S===x||S===m.endValue)&&a.setDynamicVariablePlayState(p,"Paused")),S!==_&&(l.push(p),a.updateVariable(p,S),this.eventManager.requestRender())}else if(m.dynamicVariableType==="time"){let _=a.getVariable(p),A=f9(o,m);if(typeof _=="object"&&"textValue"in _&&typeof A=="object"&&"textValue"in A){if(Array.isArray(_.textValue)&&Array.isArray(A.textValue)){if(_.textValue.every((S,C)=>S===A.textValue[C]))continue}else if(_.textValue===A.textValue)continue}else if(_===A)continue;a.updateVariable(p,A),l.push(p),this.eventManager.requestRender()}else{let _=ms.isTextValue(m.endValue)?rX(m.endValue.textValue):m.endValue,A=a.getDynamicVariableToggleIsForward(p)??!0,S=v+(s-g)/1e3*(m.dynamicVariableType==="timer"?-1:1)*(A?1:-1);S=Math.max(S,0),m.hasEnd&&(S=m.dynamicVariableType==="stopwatch"?St.clamp(S,x,_):St.clamp(S,_,x),S===x&&a.setDynamicVariableToggleIsForward(p,void 0),m.repeat?Math.abs(S-_)<(m.format==="number3decimal"?1e-4:.1)&&(S=x):(Math.abs(S-x)<(m.format==="number3decimal"?1e-4:.1)||Math.abs(S-_)<(m.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(p,"Paused")),S!==v&&(l.push(p),this.dynamicVars[d].timerSeconds=S,a.updateVariable(p,Do.getFormattedTimerTime(S,m)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(p=>p.objId===d.data.objectId&&p.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new xWe(r.id,r.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(ms.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,f9(new Date,i)),i.dynamicVariableType==="counter"&&(r=ms.isTextValue(i.value)?rX(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},xWe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=bn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){$n(this.actions)}};function rX(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var wWe="https://unpkg.com/@splinetool/runtime@1.9.59/build/",bWe="https://unpkg.com/@splinetool/navmesh-wasm@1.9.59/build/",_We=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${wWe}' + 'navmesh.js'),
		fetch('${bWe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,SWe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,AWe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,MWe=.001,EWe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},ene,Si,as;dBe.then(e=>{ene=e,Si=new e.Vec3,as=new e.Vec3});var CWe=new F,TWe=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(Qt.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=CWe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,p,f,g,m,v,x;let s;if(n instanceof No)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof gs)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((f=s.dataPatched.physics)==null?void 0:f.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((g=a.physics)==null?void 0:g.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=DC(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let y of a.events)y.data.disabled!==!0&&(y.data.type==="GameControl"?u=!0:y.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((m=a.physics)==null?void 0:m.rigidBody)==="dynamic"){if(this.usePhysics&&((v=a.physics)!=null&&v.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(Tu(n.geometry,n.matrixWorld)),this.usePhysics&&((x=a.physics)==null?void 0:x.fusedBody))return n.traverseObject((y,_)=>{var C,M;if(_===0)return;let A;if(y instanceof No)if(y.objectForSample){if(y.objectForSample.dataPatched.physics.fusedBody)return;A=y.object}else return y.object.dataPatched.physics.fusedBody===!0&&y.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(y instanceof gs)A=y.object;else if(A=y,(C=y.dataPatched.cloner)==null?void 0:C.hideBase)return!0;let S=A.dataPatched;if(!S.visible&&((M=S.physics)==null?void 0:M.enabled)!==!0)return!0;"geometry"in y&&y.geometry&&i.push(Tu(y.geometry,y.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof No)return;n instanceof gs?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(DC(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(Tu(o,n.matrixWorld))},this.navmeshWasm=ene,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?_We:SWe)+AWe])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new F().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=Mf(r),{positions:a,triIndices:o}=zT(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...EWe,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new Ot;return a.setIndex(new Wt(n,1)),a.setAttribute("position",new Wt(s,3)),a}getClosestPoint(e){return Si.x=e.x,Si.y=e.y,Si.z=e.z,this.navMesh.getClosestPoint(Si)}getClosestPointToRef(e,t){Si.x=e.x,Si.y=e.y,Si.z=e.z;let i=this.navMesh.getClosestPoint(Si);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Si.x=e.x,Si.y=e.y,Si.z=e.z,this.navMesh.getRandomPointAround(Si,t)}getRandomPointAroundToRef(e,t,i){Si.x=e.x,Si.y=e.y,Si.z=e.z;let r=this.navMesh.getRandomPointAround(Si,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Si.x=e.x,Si.y=e.y,Si.z=e.z,as.x=t.x,as.y=t.y,as.z=t.z,this.navMesh.moveAlong(Si,as)}moveAlongToRef(e,t,i){return Si.x=e.x,Si.y=e.y,Si.z=e.z,as.x=t.x,as.y=t.y,as.z=t.z,this.navMesh.moveAlong(Si,as)}computePath(e,t){let i=this.getClosestPoint(t);if(as.x=i.x,as.y=i.y,as.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(Si,as),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new F(o.x,o.y,o.z))}return s}createCrowd(e,t){return new PWe(this,e,t)}setDefaultQueryExtent(e){Si.x=e.x,Si.y=e.y,Si.z=e.z,this.navMesh.setDefaultQueryExtent(Si)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Si.x=e.x,Si.y=e.y,Si.z=e.z,this.navMesh.addCylinderObstacle(Si,t,i)}addBoxObstacle(e,t,i){return Si.x=e.x,Si.y=e.y,Si.z=e.z,as.x=t.x,as.y=t.y,as.z=t.z,this.navMesh.addBoxObstacle(Si,as,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},PWe=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new F(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=MWe)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new F(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function DWe(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&gw.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var RWe={type:"change"},nX={type:"changeZoom"},IWe={type:"changePan"},zp={type:"start"},Vp={type:"end",changed:!0},LWe={type:"end",changed:!1},D3=new $t,sX=new pe,OWe=2*Math.PI,BWe=1e-8,FWe=.01,R3=new F,YA=new pe,I3=new F,qA=new $t,aX=new ot,NWe={type:"requestRender"},tne=class extends ws{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,vo.DOLLY_ROTATE,vo.PAN],this.offset=new F,this.eye=new F,this.lastPosition=new F,this.lastQuaternion=new $t,this.current=new pe,this.overShoot=new pe,this.overRatio=new pe,this.spherical=new R6,this.sphericalDelta=new R6,this.panOffset=new F,this.panLeftV=new F,this.panUpV=new F,this.panV=new F,this.rotateStart=new pe,this.rotateEnd=new pe,this.rotateDelta=new pe,this.panStart=new pe,this.panEnd=new pe,this.panDelta=new pe,this.dollyStart=new pe,this.dollyEnd=new pe,this.dollyDelta=new pe,this.rotationRangeFactor=new pe,this.panRangeFactor=new pe,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(I3,qA,R3),this.offset.copy(I3).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(D3.copy(qA).invert()),this.panOffset.applyQuaternion(D3),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(qA),this.panOffset.applyQuaternion(qA)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),I3.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(aX.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(aX));let r=this.spherical.phi%OWe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Qi.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>FWe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>BWe?(this.dispatchEvent(RWe),this.object.dispatchEvent(NWe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&Ka?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(zp),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Ka||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,R3.subVectors(this.position0,this.target0),this.spherical.setFromVector3(R3),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?YA.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):YA.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(YA).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(sX,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(YA).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&Ka?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Qt.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Qt.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Vp):this.dispatchEvent(LWe),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Ka||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!nA(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(nA(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(nA(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Qt.length>1&&r.preventDefault(),this.touches[Qt.length-1]){case vo.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case vo.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case vo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case vo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Qt.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=hw(()=>this.dispatchEvent(Vp),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(zp),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!db)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(zp),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Vp)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(zp))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Qt[0]),r.key===" "&&this.dispatchEvent(Vp))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(D3.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=uc(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=uc(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=uc(uc(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=uc(uc(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=vo.ROTATE),e.panTouches===1&&(this.touches[0]=vo.PAN),e.orbitTouches===2&&(this.touches[1]=vo.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=vo.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=vo.ROTATE),e.panTouches===3&&(this.touches[2]=vo.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;e instanceof F?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set(uc(this.spherical.theta),uc(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=uc(this.overShoot.x),this.overShoot.y=uc(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=oX(Math.abs(this.overRatio.x)),this.overRatio.y=oX(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof F?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(IWe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(nX)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(nX)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(zp),this.dollyOut(e),this.dispatchEvent(Vp)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(zp),this.dollyIn(e),this.dispatchEvent(Vp)}setZoom(e){if(this.dispatchEvent(zp),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Vp)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(sX,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(aBe===!1&&nA(e)===!1&&lBe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Qt.length===2){let e=.5*(Qt[0].pageX+Qt[1].pageX),t=.5*(Qt[0].pageY+Qt[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Qt[0].pageX,Qt[0].pageY)}handleTouchStartPan(){if(Qt.length===2){let e=.5*(Qt[0].pageX+Qt[1].pageX),t=.5*(Qt[0].pageY+Qt[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Qt[0].pageX,Qt[0].pageY)}handleTouchStartDolly(){let e=Qt[0].pageX-Qt[1].pageX,t=Qt[0].pageY-Qt[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(Qt.length===2){let i=bR(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==Qt[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(Qt.length===2){let t=bR(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==Qt[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=bR(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function uc(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function oX(e){return 1-Math.pow(1-e,4)}var lX=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=bn(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){$n(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},Ii;fBe.then(e=>Ii=e);var hn=new F,pl=new $t,Xh=new F,L3=new Pn(0,0,0,"YXZ"),cX=new Pn(0,0,0,"XYZ"),fl=new F,O3=new F,B3=new F(1,1,1),zg=new $t,QA=new ot,uX=new ot,UWe={type:"updateMatrix"},hX=new $t,F3=new Oa,zB={type:"beginEvent",eventName:"Collision"},kWe={type:"beginEvent",eventName:"Trigger"};function zWe(e){if(gw.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var DC=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),VWe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Ii.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if(hn.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),pl.copy(t.rotation()),i.matrixWorld.compose(hn,pl,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(UWe),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let f of h)f.data.target==="scene"&&this.dispatchCollisionEvent(f,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(p!==void 0)for(let f of p)f.data.target==="scene"&&this.dispatchCollisionEvent(f,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=Wre,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,r=t instanceof gx,n=t instanceof vx;if(t instanceof No||r||n)return;t instanceof gs?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(DC(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&(h.data.type==="GameControl"||h.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(Tu(a,t.matrixWorld))}),e.length>0){let t=Mf(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new fx(t)}}addRigidBody(e,t,i){if(Yre(e.matrixWorld))return;let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(Tu(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=Ii.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=Ii.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=Ii.RigidBodyDesc.fixed();let l=Mf(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(hn,pl,Xh),e.position0=hn.clone().divideScalar(this.pixelsPerMeter),e.rotation0=pl.clone(),hn.divideScalar(this.pixelsPerMeter),a.setTranslation(hn.x,hn.y,hn.z).setRotation(pl),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(Xh.x/this.pixelsPerMeter,Xh.y/this.pixelsPerMeter,Xh.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[e,Xh.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(Tu(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(n=>n.updateMatrixWorld(!0)),t.length>0){let n=Mf(t,!1);e.bvhGeometry=n,n.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new fx(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=Ii.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Ii.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Ii.CoefficientCombineRule.Average).setRestitutionCombineRule(Ii.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof No)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof gs)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(Tu(a,i.matrixWorld))}}activate(e){var d,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let f of l.data.events){if(f.data.disabled||f.data.type!=="GameControl")continue;let g=l;for(;this.usePhysics&&((d=g=g.parent)==null?void 0:d.parent)!==null;)(p=g.data.physics)==null||p.fusedBody;f.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=f.data)}if(this.page.traverseEntity(f=>{for(let g of f.dataPatched.events)if(g.data.disabled===!1&&g.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let f=new Xre(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=f,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,Ka&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let f=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new TWe(this.usePhysics,this.isExport);let g;f.collider.type==="sphere"?g=f.collider.radius*2:g=f.collider.height,g=Math.floor(g/f.navmesh.ch-1),this.navigationMeshWrapper.init({...f.navmesh,walkableHeight:g},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:f,enablePan:g,enableZoom:m,autoRotate:v,hoverRotatePanMode:x}=this.eventManager.publish.orbitControls;(f||g||m||v||x!==0)&&(this.orbitControls=new tne(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((f,g)=>{let m=document.body.appendChild(document.createElement("div")),[v,x,y]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[g],_=(u-5*v)/4+v,A={},S=f==="jmp",C=S?0:v;g<10?(g<5?A.top=C/2:A.bottom=C/2,A.left=C/2+g%5*_):g===10?(A.left=C/2,A.top=h/2):(A.right=C/2,A.top=h/2),A.top?A.top-=x[1]:A.bottom+=x[1],A.left?A.left+=x[0]:A.right-=x[0];for(let P in A)A[P]+="px";if(S){let P=m.appendChild(document.createElement("div"));Object.assign(P.style,A,{position:"absolute",width:v+"px",height:v+"px",backgroundColor:`rgba(255,255,255,${y==="show"?.4:0})`,zIndex:"9999",borderRadius:v+"px",border:y==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let R=v/16*16*.4;y==="show"&&(P.innerHTML=`
						<svg width="${R}" height="${v*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),P.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),P.addEventListener("touchend",O=>O.preventDefault()),this.joysticks[g]=[void 0,m];return}let M={zone:m,mode:"static",position:A,size:v};y==="hide"&&(M.restOpacity=0);let E=KHe.create(M);E.on("move",(P,R)=>{let O=this.gameControl;f==="pos"?R.force<.2?O.moveForce=0:(O.movementState.movePosZ=Math.sin(-R.angle.radian),O.movementState.movePosX=Math.cos(-R.angle.radian),R.force>1.2?O.movementState.run=1:O.movementState.run=0,R.force<.3?O.moveForce=(R.force-.2)/.1:O.moveForce=1):f==="rot"&&(R.force<.2?O.rotForce=0:(O.movementState.rotPosX=R.vector.y,O.movementState.rotPosY=-R.vector.x,R.force<.3?O.rotForce=(R.force-.2)/.1:O.rotForce=1)),this.requestRender()}),E.on("end",(P,R)=>{let O=this.gameControl;f==="pos"?(O.movementState.movePosZ=0,O.movementState.movePosX=0,O.moveForce=1):f==="rot"&&(O.movementState.rotPosX=0,O.movementState.rotPosY=0,O.rotForce=1)}),this.joysticks[g]=[E,m]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(f=>f.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new Ii.World(new Ii.Vector3(0,this.gravity,0)),this.events=new Ii.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var v,x,y,_;let l;if(o instanceof No)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof gs)l=o.object;else{if(o instanceof vx||o instanceof gx)return;if(l=o,((v=l.dataPatched.cloner)==null?void 0:v.disabled)===!1&&((x=l.dataPatched.cloner)==null?void 0:x.hideBase)&&((y=l.dataPatched.physics)==null?void 0:y.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let A of c.events)A.data.disabled!==!0&&A.data.type==="GameControl"&&(u=A.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=DC(c),d=!1,p=l.userData.hasDestroy,f=l.userData.hasDrag,g=!1;for(let A of c.events)if(A.data.disabled!==!0){if(A.data.type==="Collision"){d=!0;let S=new vWe(A.id,A.data,l,this.page,this.sharedAssets,this.eventManager);S.initialDisabled=!0,this.collisionEvents.push(S),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(C=>C.id!==A.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(S):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[S]}else if(A.data.type==="Follow"){g=!0;let S=A.data.target;o.traverseVisible(C=>{C.userData.isFollowingObj=S})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let m=o.geometry;if(u!==void 0){let A=Ii.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(hn,pl,Xh),o.position0=hn.clone().divideScalar(this.pixelsPerMeter),o.rotation0=pl.clone(),hn.divideScalar(this.pixelsPerMeter),A.setTranslation(hn.x,hn.y,hn.z).setRotation(pl);let S=this.sharedGameControlGlobals.rapierWorld.createRigidBody(A);o.rigidBody=S;let C;u.collider.type==="sphere"?C=Ii.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?C=Ii.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):C=Ii.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),C.setFrictionCombineRule(Ii.CoefficientCombineRule.Average).setRestitutionCombineRule(Ii.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let M=this.sharedGameControlGlobals.rapierWorld.createCollider(C,S);this.sharedGameControlGlobals.colliderToEntity.set(M.handle,l),hn.fromArray(u.collider.position).multiply(Xh.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),M.setTranslationWrtParent(hn);let E=new $t().setFromEuler(new Pn().setFromVector3(new F().fromArray(u.collider.rotation)));M.setRotationWrtParent(E),M.setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||g||p||f||d?(this.addRigidBody(o,l,{hasFollow:g,hasTransformAnim:h,hasDrag:f}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(m&&e.push(Tu(m,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((A,S)=>{var P;if(S===0)return;let C;if(A instanceof No)if(A.objectForSample){if(A.objectForSample.dataPatched.physics.fusedBody)return;C=A.object}else return A.object.dataPatched.physics.fusedBody===!0&&A.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(A instanceof vx||A instanceof gx)return;if(A instanceof gs)C=A.object;else if(C=A,(P=C.dataPatched.cloner)==null?void 0:P.hideBase)return!0}let M=C.dataPatched;if(M.physics.enabled==="visibility"?!M.visible:!M.physics.enabled)return!0;let E=A.geometry;(E==null?void 0:E.getAttribute("position"))!==void 0&&e.push(Tu(E,A.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((_=c.physics)==null?void 0:_.fusedBody)===!0||u)return!0}),e.length===0)return;let i=Mf(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Ii.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Ii.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Ii.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Ii.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new lX(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new ot().compose(fl.fromArray(t.data.position),zg.setFromEuler(cX.fromArray(t.data.rotation)),B3);if(t.data.triggerZone==="box"){let n=new nn;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(hn,pl,Xh),L3.setFromQuaternion(pl);let i=t;i.prevR===void 0?(i.prevR=L3.clone(),i.prevT=hn.clone()):(i.prevR.copy(L3),i.prevT.copy(hn)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(hn.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(pl))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===r){n=a;break}}e.dispatch(n),t.dispatchEvent(zB)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=uX.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new lX(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=Ii.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=Ii.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Ii.ActiveEvents.COLLISION_EVENTS),fl.fromArray(a.data.position),zg.setFromEuler(cX.fromArray(a.data.rotation)),QA.compose(fl,zg,B3).premultiply(n.matrixWorld),i?(QA.decompose(fl,zg,O3),l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_FIXED|Ii.ActiveCollisionTypes.DYNAMIC_FIXED)):(QA.premultiply(r).decompose(fl,zg,O3),e.rigidBody.bodyType()===Ii.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Ii.RigidBodyType.Fixed?l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_FIXED|Ii.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Ii.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Ii.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),fl.divideScalar(this.pixelsPerMeter),l.setTranslation(fl.x,fl.y,fl.z),l.setRotation(zg),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Ei.is(o)?o:o.object)===!1)continue;let l=uX.copy(n.matrixWorld).decompose(fl,hX,O3).compose(fl,hX,B3).multiply(r),c=QA.copy(o.matrixWorld).invert().multiply(l);i instanceof nn?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(F3.radius=i,F3.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(F3)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(kWe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function GWe(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===hU;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===n$){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var dX=!1,HWe=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=KL.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);dX===!1&&(Object.getPrototypeOf(c)._updateTime=GWe,dX=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new MTe(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=s$}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=hU)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return Nre(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},N3=new WeakMap,jWe=class extends lb{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new ZL(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(N3.has(e)){let o=N3.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),N3.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new Ot;e.index&&t.setIndex(new Wt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new Wt(s,a))}return t}_loadLibrary(e,t){let i=new ZL(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=WWe.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function WWe(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(h,d,p,c),g=f.attributes.map(m=>m.array.buffer);f.index&&g.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},g)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,p,f=o.GetEncodedGeometryType(l);if(f===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(f===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let g={index:null,attributes:[]};for(let m in u){let v=self[h[m]],x,y;if(c.useUniqueIDs)y=u[m],x=o.GetAttributeByUniqueId(d,y);else{if(y=o.GetAttributeId(d,a[u[m]]),y===-1)continue;x=o.GetAttribute(d,y)}g.attributes.push(n(a,o,d,m,v,x))}return f===a.TRIANGULAR_MESH&&(g.index=r(a,o,d)),a.destroy(d),g}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),p=l.num_points()*d,f=p*u.BYTES_PER_ELEMENT,g=s(a,u),m=a._malloc(f);o.GetAttributeDataArrayForAllPoints(l,h,g,f,m);let v=new u(a.HEAPF32.buffer,m,p).slice();return a._free(m),{name:c,array:v,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var xd;function XWe(){return xd||(xd=new jWe,xd.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),xd.decoderPending}async function YWe(e){if(xd){let t={attributeIDs:xd.defaultAttributeIDs,attributeTypes:xd.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await xd.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function qWe(e,t){let[i,r]=Gee(pO.deserialize(new Uint8Array(e)));return pte(i),t&&t(i),r.result().data}function QWe(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function JWe(e){for(let t of e){let i=await YWe(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var KWe=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},ZWe=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=bn(r,i.actions,s,a,o,n)}disconnect(){$n(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},$We=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=vO.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new ZWe(o,c,l,a,n,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(n=>{var s;(n instanceof Os||n instanceof qn)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},e8e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new t8e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},t8e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=bn(t,t.successActions,r,n,s,i),this.errorActions=bn(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},i8e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new r8e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},r8e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=bn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function n8e(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var s8e=new F(0,0,1),pX=new F,fX=new F,mX=new gn,a8e=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new Gie,this.doubleClickHandler=new KWe,this.isDragging=!1,this.plane=new ba,this.caretInterval=0,this.planeIntersection=new F,this.projected=new pe,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=pGe(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=n8e(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof Dk)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new F);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof e.geometry.width=="number"?e.geometry.width:1,n=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(mX.getNormalMatrix(this.virtualInput.matrixWorld),pX.copy(s8e).applyMatrix3(mX).normalize(),this.virtualInput.localToWorld(fX.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(pX,fX))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=o8e(e.geometry.horizontalAlign))}};function o8e(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var ine=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return ine(i.value,t)}return ms.getDisplayedValue(e)};function gX(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=ine(n.value,t.variables))}else r=i.textValue.toString();return r}var l8e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Ia,this.helper=new Gie,this._onMouseDownFocusIn=i=>{if(Qt.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new a8e(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof Dk&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=gX(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=gX(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},c8e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new u8e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("voice",this.onVoice)}},u8e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=bn(t,t.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},h8e=class extends Vs{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new d8e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("trigger_event",this.onTriggerEvent)}},d8e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=bn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},p8e=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(e=!1){var r,n;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new z6e(this.eventContext),VariableChange:new yWe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new e8e(this.eventContext,this),WEBHOOK:new i8e(this.eventContext,this),AIAssistantListener:new c8e(this.eventContext,this),AIAssistantTrigger:new h8e(this.eventContext,this),Conditional:new Y6e(this.eventContext,this),Start:new gWe(this.eventContext,this),Basic:new G6e(this.eventContext,this,this.needsRaycast),MouseHover:new hWe(this.eventContext,this),Scroll:new fWe(this.eventContext,this),Follow:new rWe(this.eventContext,this),DragDrop:new Z6e(this.eventContext,this),LookAt:new lWe(this.eventContext),Resize:new $We(this.eventContext,this),Textfields:new l8e(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(s=>{s.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(s=>s.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect(),(n=this.eventContext.sharedAssets.openAIRealtime)==null||n.start())}deactivate(e=!1){var r;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;if(i.style.cursor="",Object.values(this.handlers).forEach(n=>n.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(n=>{n.removeEventListener("requestRender",this.requestRender),n.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),!e){let n=this.eventContext.sharedAssets.openAIRealtime;n==null||n.disconnect(),n==null||n.stop().then(()=>{n==null||n.disconnect()})}}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(t);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(t);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(t);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(t);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(t)})}},f8e=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new pe().copy(i),this._editorSize=new pe().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=m8e(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function m8e(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var g8e=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new xk(e.shared,t,!0,i),this.scene=new Lk(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof qn&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof vn&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},v8e=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function y8e(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function _x(e){return e instanceof Sw?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function x8e(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof la)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof la&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!Kn.isMergable(a))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!Kn.isMergable(c.material))return;s=Kn.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][_x(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][_x(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][_x(r)].push(c)}),i}function w8e(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function b8e(e,t){let i=x8e(t,e),r=w8e(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(o=0,c=0,f.forEach(m=>{m instanceof la&&(a[o++]=m.geometry.clone(),l[c++]=m)}),c<2)continue;for(let m=0;m<c;m++)l[m].updateWorldMatrix(!0,!1),a[m].applyMatrix4(l[m].matrixWorld),l[m].matrixWorld.determinant()<0&&y8e(a[m]);let g=Mf(a.slice(0,o),!1);if(g){let m;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),m=new cr(g,l[0].material);break}default:{m=new cr(g,l[0].material);break}}m.castShadow=l[0].castShadow,m.receiveShadow=l[0].receiveShadow,t.add(m);let v=x=>{h=0;for(let y of x)y.children&&v(y.children),y instanceof la&&(Array.isArray(y.material)||i[y.material.uuid]&&i[y.material.uuid][_x(y)]&&i[y.material.uuid][_x(y)].length>1||(u[h++]=y));for(let y=0;y<h;y++)t.attach(u[y])};for(let x=0;x<c;x++){let y=l[x];v(y.children),n[s++]=y}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var _8e=lp(cbe(),1),S8e=new pe;function A8e(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var M8e=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,u,h,d,p,f,g,m;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(v=>{v.type==="ParticleSystem"&&(v.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.LookAt).onAnimationFrameDamping(),((g=this._eventManager.handlers)==null?void 0:g.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let v=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=v,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(m=this._perfs)==null||m.end()},this._resize=r=>{var n,s,a,o,l,c,u,h,d,p;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=S8e.set(this._viewportWidth,this._viewportHeight)),r){let f=this._viewportWidth,g=this._viewportHeight;this._renderer.setSize(f-1,g-1,!1),this._renderer.setSize(f,g,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let f=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(p=this._frameView)==null||p.updateCamera(f!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=hw(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new v8e({x:10,y:10})),uBe(e)}async load(e,t,i){A8e(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let r=await qWe(e);this._data=r;let n=QWe(r);r.version&&(0,_8e.default)(r.version,"1.9.59")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&XWe(),z9(r)&&fke(),T4e(r)&&uke(),gw.physicsEnabled(r.scene.objects)&&mBe(),F9(r)&&Qze(),g7(r)&&kHe(),Yze(r)&&Xze(),o7(r)&&MGe(),DWe(r)&&pBe()].filter(Boolean)),n.length&&await JWe(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new g8e(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();b8e(r,s.scene);let p=performance.now();console.log("Merged geometries in ",p-d," ms")}z9(r)&&this._scene.traverse(d=>{Hu(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(p=>{p instanceof No&&p.pendingMediaLoad&&p.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),F9(r)&&zWe(r)&&await Promise.all(a),o7(r)){let d=[];this._scene.traverseEntity(p=>{(p instanceof Os||p instanceof qn)&&p.uiCanvas&&d.push(p.uiCanvas)}),await Promise.all(d.map(p=>p.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),Xk(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new hGe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let p=d.getTexture(1001);this._renderer.pipeline.setWatermark(p)}g7(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new f8e(this._renderer,this._camera,new pe(this._viewportWidth,this._viewportHeight),new pe(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let d=new U6e(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new VWe(d),this._animationControls=new HWe(this._scene,this._requestRenderAutoMode),this._eventManager=new p8e(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;typeof i.data.value=="number"?n=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?n=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=t.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&ms.isTextValue(e)?ms.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==Z0&&!this._scene.isInvisibleObjects(i)&&!(i instanceof qn)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof tne&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new ys(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{V6.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,hBe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof qn&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof qn||e instanceof Lk||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=V6(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){wie.skiaWasmUrl=e}},E8e="Expected a function",vX=0/0,C8e="[object Symbol]",T8e=/^\s+|\s+$/g,P8e=/^[-+]0x[0-9a-f]+$/i,D8e=/^0b[01]+$/i,R8e=/^0o[0-7]+$/i,I8e=parseInt,L8e=typeof M1=="object"&&M1&&M1.Object===Object&&M1,O8e=typeof self=="object"&&self&&self.Object===Object&&self,B8e=L8e||O8e||Function("return this")(),F8e=Object.prototype,N8e=F8e.toString,U8e=Math.max,k8e=Math.min,U3=function(){return B8e.Date.now()};function z8e(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(E8e);t=yX(t)||0,VB(i)&&(u=!!i.leading,h="maxWait"in i,s=h?U8e(yX(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var C=r,M=n;return r=n=void 0,c=S,a=e.apply(M,C),a}function f(S){return c=S,o=setTimeout(v,t),u?p(S):a}function g(S){var C=S-l,M=S-c,E=t-C;return h?k8e(E,s-M):E}function m(S){var C=S-l,M=S-c;return l===void 0||C>=t||C<0||h&&M>=s}function v(){var S=U3();if(m(S))return x(S);o=setTimeout(v,g(S))}function x(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function y(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:x(U3())}function A(){var S=U3(),C=m(S);if(r=arguments,n=this,l=S,C){if(o===void 0)return f(l);if(h)return o=setTimeout(v,t),p(l)}return o===void 0&&(o=setTimeout(v,t)),a}return A.cancel=y,A.flush=_,A}function VB(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function V8e(e){return!!e&&typeof e=="object"}function G8e(e){return typeof e=="symbol"||V8e(e)&&N8e.call(e)==C8e}function yX(e){if(typeof e=="number")return e;if(G8e(e))return vX;if(VB(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=VB(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(T8e,"");var i=D8e.test(e);return i||R8e.test(e)?I8e(e.slice(2),i?2:8):P8e.test(e)?vX:+e}var H8e=z8e;const j8e=E0(H8e);function W8e(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const X8e=[],Y8e={width:"100%",height:"100%"},q8e=fe.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=X8e,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=fe.useRef(null),u=fe.useRef(0),[h,d]=fe.useState({width:0,height:0,top:0,left:0}),p=fe.useMemo(()=>{const f=Array.isArray(r)?r:[r];return j8e(g=>{d(m=>Object.keys(m).filter(v=>m[v]!==g[v]).every(v=>f.includes(v))?m:g)},i,{leading:s})},[i,s,r]);return fe.useEffect(()=>{const f=a||window.ResizeObserver,g=new f(m=>{m.forEach(v=>{const{left:x,top:y,width:_,height:A}=(v==null?void 0:v.contentRect)??{};u.current=window.requestAnimationFrame(()=>{p({width:_,height:A,top:y,left:x})})})});return c.current&&g.observe(c.current),()=>{window.cancelAnimationFrame(u.current),g.disconnect(),p.cancel()}},[p,a]),He.jsx("div",{style:{...Y8e,...n},ref:W8e([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:p})})}),Q8e=fe.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,children:p,...f},g)=>{const m=fe.useRef(null),[v,x]=fe.useState(!0),[y,_]=fe.useState();if(y)throw y;return fe.useEffect(()=>{x(!0);let A;const S=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(m.current){A=new M8e(m.current,{renderOnDemand:d});async function C(){await A.load(e);for(let M of S)M.cb&&A.addEventListener(M.name,M.cb);x(!1),h==null||h(A)}C().catch(M=>{_(M)})}return()=>{for(let C of S)C.cb&&A.removeEventListener(C.name,C.cb);A.dispose()}},[e]),He.jsx(q8e,{ref:g,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...f,children:()=>He.jsxs(He.Fragment,{children:[v&&p,He.jsx("canvas",{ref:m,style:{display:v?"none":"block"}})]})})}),rne=()=>/Mobi|Android/i.test(navigator.userAgent);function J8e(){return rne()?He.jsx(He.Fragment,{}):He.jsx("div",{className:"absolute xs:bottom-10 bottom-32 w-full flex justify-center items-center",children:He.jsx("a",{href:"#about",children:He.jsx("div",{className:"w-[35px] h-[64px] rounded-3xl border-4 border-secondary flex justify-center items-start p-2",children:He.jsx(kc.div,{animate:{y:[0,24,0]},transition:{duration:1.5,repeat:1/0,repeatType:"loop"},className:"w-3 h-3 rounded-full bg-secondary mb-1"})})})})}function K8e(){const e=rne()?"https://prod.spline.design/XXi-LdKqImqN5qeM/scene.splinecode":"https://prod.spline.design/rBdn0bzcfwYEE6d2/scene.splinecode";return He.jsx("div",{children:He.jsx(Q8e,{scene:e})})}const Z8e=()=>He.jsx(He.Fragment,{children:He.jsxs("section",{className:"relative w-full h-screen mx-auto",children:[He.jsxs("div",{className:`absolute inset-0 top-[120px] max-w-7xl mx-auto ${Dl.paddingX} flex flex-row items-start gap-5`,style:{zIndex:1,pointerEvents:"none"},children:[He.jsxs("div",{className:"flex flex-col justify-center items-center mt-5",children:[He.jsx("div",{className:"w-5 h-5 rounded-full bg-[#915EFF]"}),He.jsx("div",{className:"w-1 sm:h-80 h-40 violet-gradient"})]}),He.jsxs("div",{children:[He.jsxs("h1",{className:`${Dl.heroHeadText} text-white`,children:["Hi, I'm ",He.jsx("span",{className:"text-[#915EFF]",children:"Qaisar"})]}),He.jsxs("p",{className:`${Dl.heroSubText} mt-2 text-white-100`,children:["I do",He.jsx(Jwe,{options:{strings:["AI & ML","NLP","Data Science","Data Scrapping"],autoStart:!0,loop:!0,loopCount:1/0,deleteSpeed:"natural",pauseFor:1500}})]})]})]}),He.jsx(K8e,{}),J8e()]})}),$8e="/Portfolio/assets/python-2dc084df.png",e9e="/Portfolio/assets/c-2a05db7f.png",t9e="/Portfolio/assets/cpp-e5f8d8e1.png",i9e="/Portfolio/assets/java-8540cc9a.png",r9e="/Portfolio/assets/WeatherPedia-2b620c2e.png",n9e="/Portfolio/assets/termpw-334f3924.png",s9e="/Portfolio/assets/payloadmaster-39f66459.png",a9e="/Portfolio/assets/mhft-4943b10b.png",o9e="/Portfolio/assets/sketcher-eb4a129e.png",l9e="/Portfolio/assets/CompileVortex-20c14677.png",c9e="/Portfolio/assets/github-37a26f13.png",u9e="/Portfolio/assets/menu-242d80a8.svg",h9e="/Portfolio/assets/close-ad0e0ca6.svg",d9e=[{id:"about",title:"About"},{id:"contact",title:"Contact"}],p9e=[{title:"C",icon:e9e},{title:"C++",icon:t9e},{title:"Python",icon:$8e},{title:"Java",icon:i9e}],f9e=[{name:"WeatherPedia",description:"Web-based platform that allows users to access weather information for their location by entering it in the search field",tags:[{name:"Javascript",color:"blue-text-gradient"},{name:"HTML",color:"green-text-gradient"},{name:"bootstrap 5.3.0",color:"pink-text-gradient"},{name:"Weather API by API Ninjas",color:"yellow-text-gradient"}],image:r9e,source_code_link:"https://github.com/lohitkolluri/WeatherPedia"},{name:"Terminal Like Portfolio Website",description:"A terminal themed portfolio website that allows users to type into the terminal and use commands like a real terminal.",tags:[{name:"HTML",color:"blue-text-gradient"},{name:"css",color:"green-text-gradient"},{name:"Javascript",color:"pink-text-gradient"}],image:n9e,source_code_link:"https://github.com/lohitkolluri/lohitkolluri.github.io"},{name:"Mental Health Fitness Tracker",description:"ML model that utilizes regression techniques to provide insights into mental health and make predictions based on the available data.",tags:[{name:"Machine Learning",color:"blue-text-gradient"},{name:"Jupyter Notebook",color:"green-text-gradient"},{name:"Regression Algorithms",color:"pink-text-gradient"}],image:a9e,source_code_link:"https://github.com/lohitkolluri/mental_health_fitness_tracker"},{name:"PayloadMaster",description:"Tool to automate payload creation using the Metasploit framework",tags:[{name:"shell",color:"blue-text-gradient"}],image:s9e,source_code_link:"https://github.com/lohitkolluri/PayloadMaster"},{name:"CompileVortex",description:"Tool to automate payload creation using the Metasploit framework",tags:[{name:"Javascript",color:"blue-text-gradient"},{name:"CSS",color:"green-text-gradient"},{name:"HTML",color:"pink-text-gradient"}],image:l9e,source_code_link:"https://github.com/lohitkolluri/CompileVortex"},{name:"Sketcher",description:"Convert an input image to a pencil sketch using OpenCV and Matplotlib libraries.",tags:[{name:"OpenCV",color:"blue-text-gradient"},{name:"Matplotlib",color:"green-text-gradient"},{name:"Python",color:"pink-text-gradient"}],image:o9e,source_code_link:"https://github.com/lohitkolluri/Image_to_Pencil_Sketch_App"}],m9e=()=>{const[e,t]=fe.useState(""),[i,r]=fe.useState(!1),n=()=>{const a="/Portfolio/Resume.pdf";window.open(a)};fe.useEffect(()=>{i&&t("")},[i]);const s=a=>He.jsxs("ul",{className:`list-none ${a?"flex sm:hidden":"hidden sm:flex"} flex-row gap-6`,children:[d9e.map(o=>He.jsx("li",{className:`${e===o.title?"text-white":a?"text-secondary":"text-white"} hover:text-white text-[20px] font-medium cursor-pointer`,onClick:()=>{t(o.title),a&&r(!1)},children:He.jsx("a",{href:`#${o.id}`,children:o.title})},o.id)),He.jsx("li",{className:`text-${a?"secondary":"white"} hover:text-white text-[20px] font-medium cursor-pointer`,children:He.jsx("button",{onClick:n,children:"Resume"})})]});return He.jsx(He.Fragment,{children:He.jsx("nav",{className:`${Dl.paddingX} w-full flex items-center py-3 fixed top-0 z-20 bg-primary`,children:He.jsxs("div",{className:"w-full flex justify-between items-center max-w-7xl mx-auto",children:[He.jsx(sle,{to:"/",className:"flex items-center gap-2",onClick:()=>{t(""),window.scrollTo(0,0)},children:He.jsxs("p",{className:"text-white text-[20px] font-bold cursor-pointer flex",children:["Qaisar",He.jsx("span",{className:"sm:block hidden",children:"Mateen"})]})}),s(!1),He.jsxs("div",{className:"sm:hidden flex flex-1 justify-end items-center",children:[He.jsx("img",{src:i?h9e:u9e,alt:"menu",className:"w-[28px] h-[18px] object-contain cursor-pointer",onClick:()=>r(!i)}),He.jsx("div",{className:`p-4 black-gradient absolute top-14 right-0 mx-2 my-2 min-w-[120px] z-10 rounded-xl foggy-glass ${i?"flex":"hidden"}`,children:s(!0)})]})]})})})};var g9e=Object.defineProperty,v9e=Object.defineProperties,y9e=Object.getOwnPropertyDescriptors,xX=Object.getOwnPropertySymbols,x9e=Object.prototype.hasOwnProperty,w9e=Object.prototype.propertyIsEnumerable,wX=(e,t,i)=>t in e?g9e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,S1=(e,t)=>{for(var i in t||(t={}))x9e.call(t,i)&&wX(e,i,t[i]);if(xX)for(var i of xX(t))w9e.call(t,i)&&wX(e,i,t[i]);return e},A1=(e,t)=>v9e(e,y9e(t)),nne=class extends fe.Component{constructor(e){super(e),this.ref=Ku.createRef(),this.state={style:{}};const t={reverse:!1,max:35,perspective:1e3,easing:"cubic-bezier(.03,.98,.52,.99)",scale:"1.1",speed:"1000",transition:!0,axis:null,reset:!0};this.width=null,this.height=null,this.left=null,this.top=null,this.transitionTimeout=null,this.updateCall=null,this.element=null,this.settings=Object.assign({},t,this.props.options),this.reverse=this.settings.reverse?-1:1,this.onMouseEnter=this.onMouseEnter.bind(this,this.props.onMouseEnter),this.onMouseMove=this.onMouseMove.bind(this,this.props.onMouseMove),this.onMouseLeave=this.onMouseLeave.bind(this,this.props.onMouseLeave)}componentDidMount(){this.element=this.ref.current,setTimeout(()=>{this.element.parentElement.querySelector(":hover")===this.element&&this.onMouseEnter()},0)}componentWillUnmount(){clearTimeout(this.transitionTimeout),cancelAnimationFrame(this.updateCall)}onMouseEnter(e=()=>{},t){return this.updateElementPosition(),this.setState(Object.assign({},this.state,{style:A1(S1({},this.state.style),{willChange:"transform"})})),this.setTransition(),e(t)}reset(){window.requestAnimationFrame(()=>{this.setState(Object.assign({},this.state,{style:A1(S1({},this.state.style),{transform:`perspective(${this.settings.perspective}px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`})}))})}onMouseMove(e=()=>{},t){return t.persist(),this.updateCall!==null&&window.cancelAnimationFrame(this.updateCall),this.event=t,this.updateCall=requestAnimationFrame(this.update.bind(this,t)),e(t)}setTransition(){clearTimeout(this.transitionTimeout),this.setState(Object.assign({},this.state,{style:A1(S1({},this.state.style),{transition:`${this.settings.speed}ms ${this.settings.easing}`})})),this.transitionTimeout=setTimeout(()=>{this.setState(Object.assign({},this.state,{style:A1(S1({},this.state.style),{transition:""})}))},this.settings.speed)}onMouseLeave(e=()=>{},t){return this.setTransition(),this.settings.reset&&this.reset(),e(t)}getValues(e){const t=(e.nativeEvent.clientX-this.left)/this.width,i=(e.nativeEvent.clientY-this.top)/this.height,r=Math.min(Math.max(t,0),1),n=Math.min(Math.max(i,0),1),s=(this.reverse*(this.settings.max/2-r*this.settings.max)).toFixed(2),a=(this.reverse*(n*this.settings.max-this.settings.max/2)).toFixed(2),o=r*100,l=n*100;return{tiltX:s,tiltY:a,percentageX:o,percentageY:l}}updateElementPosition(){const e=this.element.getBoundingClientRect();this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,this.left=e.left,this.top=e.top}update(e){const t=this.getValues(e);this.setState(Object.assign({},this.state,{style:A1(S1({},this.state.style),{transform:`perspective(${this.settings.perspective}px) rotateX(${this.settings.axis==="x"?0:t.tiltY}deg) rotateY(${this.settings.axis==="y"?0:t.tiltX}deg) scale3d(${this.settings.scale}, ${this.settings.scale}, ${this.settings.scale})`})})),this.updateCall=null}render(){const e=Object.assign({},this.props.style,this.state.style);return He.jsx("div",{style:e,ref:this.ref,className:this.props.className,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,children:this.props.children})}};const sne=e=>({hidden:{y:-50,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",duration:1.25,delay:e}}}),YT=(e,t,i,r)=>({hidden:{x:e==="left"?100:e==="right"?-100:0,y:e==="up"?100:e==="down"?-100:0,opacity:0},show:{x:0,y:0,opacity:1,transition:{type:t,delay:i,duration:r,ease:"easeOut"}}}),bX=(e,t,i,r)=>({hidden:{x:e==="left"?"-100%":e==="right"?"100%":0,y:e==="up"||e==="down"?"100%":0},show:{x:0,y:0,transition:{type:t,delay:i,duration:r,ease:"easeOut"}}}),b9e=(e,t)=>({hidden:{},show:{transition:{staggerChildren:e,delayChildren:t||0}}}),qk=(e,t)=>()=>He.jsxs(kc.section,{variants:b9e(),initial:"hidden",whileInView:"show",viewport:{once:!0,amount:.25},className:`${Dl.padding} max-w-7xl mx-auto relative z-0`,children:[He.jsx("span",{className:"hash-span",id:t,children:""}),He.jsx(e,{})]}),_9e=({index:e,title:t,icon:i})=>He.jsx(nne,{className:"xs:w-[250px] w-full",children:He.jsx(kc.div,{variants:YT("right","spring",e*.5,.75),className:"w-full green-pink-gradient p-[1px] rounded-[20px] shadow-card",children:He.jsxs("div",{options:{max:45,scale:1,speed:450},className:"bg-tertiary rounded-[20px] py-5 px-12 min-h-[280px] flex justify-evenly items-center flex-col",children:[He.jsx("img",{src:i,alt:"web-development",className:"w-16 h-16 object-contain",loading:"lazy"}),He.jsx("h3",{className:"text-white text-[20px] font-bold text-center",children:t})]})})}),S9e=()=>He.jsxs(He.Fragment,{children:[He.jsxs(kc.div,{variants:sne(),children:[He.jsx("p",{className:Dl.sectionSubText,children:"Introduction"}),He.jsx("h2",{className:Dl.sectionHeadText,children:"Overview"})]}),He.jsxs(kc.p,{variants:YT("","",.1,1),className:"mt-4 text-secondary text-[17px] max-w-3xl leading-[30px]",children:["Hi, I'm Qaisar Mateen, an AI and Data Science enthusiast specializing in Artificial Inteligence, NLP, Computer Vision, Automation, and Data Science. I build intelligent solutions, from AI-driven recommendations to image analysis and automation.",He.jsx("br",{})," ",He.jsx("br",{}),"With expertise in model development, deployment, and data-driven insights, I help businesses harness AI for real-world impact. Explore my portfolio and reach out for collaborations-lets innovate together!"]}),He.jsx("div",{className:"mt-20 flex flex-wrap gap-10",children:p9e.map((e,t)=>He.jsx(_9e,{index:t,...e},e.title))})]}),A9e=qk(S9e,"about");var ane={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function i(){for(var s="",a=0;a<arguments.length;a++){var o=arguments[a];o&&(s=n(s,r(o)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return i.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var o in s)t.call(s,o)&&s[o]&&(a=n(a,o));return a}function n(s,a){return a?s?s+" "+a:s+a:s}e.exports?(i.default=i,e.exports=i):window.classNames=i})()})(ane);var one=ane.exports,M9e=Qk(fe),Yh=Qk(MK),E9e=Qk(one);function Qk(e){return e&&e.__esModule?e:{default:e}}const C9e=({animate:e=!0,className:t="",layout:i="2-columns",lineColor:r="#FFF",children:n})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",r),M9e.default.createElement("div",{className:(0,E9e.default)(t,"vertical-timeline",{"vertical-timeline--animate":e,"vertical-timeline--two-columns":i==="2-columns","vertical-timeline--one-column-left":i==="1-column"||i==="1-column-left","vertical-timeline--one-column-right":i==="1-column-right"})},n));C9e.propTypes={children:Yh.default.oneOfType([Yh.default.arrayOf(Yh.default.node),Yh.default.node]).isRequired,className:Yh.default.string,animate:Yh.default.bool,layout:Yh.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:Yh.default.string};function GB(){return GB=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},GB.apply(this,arguments)}function T9e(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,HB(e,t)}function HB(e,t){return HB=Object.setPrototypeOf||function(r,n){return r.__proto__=n,r},HB(e,t)}function P9e(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}var jB=new Map,JA=new WeakMap,_X=0,lne=void 0;function D9e(e){lne=e}function R9e(e){return e?(JA.has(e)||(_X+=1,JA.set(e,_X.toString())),JA.get(e)):"0"}function I9e(e){return Object.keys(e).sort().filter(function(t){return e[t]!==void 0}).map(function(t){return t+"_"+(t==="root"?R9e(e.root):e[t])}).toString()}function L9e(e){var t=I9e(e),i=jB.get(t);if(!i){var r=new Map,n,s=new IntersectionObserver(function(a){a.forEach(function(o){var l,c=o.isIntersecting&&n.some(function(u){return o.intersectionRatio>=u});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=c),(l=r.get(o.target))==null||l.forEach(function(u){u(c,o)})})},e);n=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:r},jB.set(t,i)}return i}function Jk(e,t,i,r){if(i===void 0&&(i={}),r===void 0&&(r=lne),typeof window.IntersectionObserver>"u"&&r!==void 0){var n=e.getBoundingClientRect();return t(r,{isIntersecting:r,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:n,intersectionRect:n,rootBounds:n}),function(){}}var s=L9e(i),a=s.id,o=s.observer,l=s.elements,c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(t),o.observe(e),function(){c.splice(c.indexOf(t),1),c.length===0&&(l.delete(e),o.unobserve(e)),l.size===0&&(o.disconnect(),jB.delete(a))}}var O9e=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function SX(e){return typeof e.children!="function"}var RC=function(e){T9e(t,e);function t(r){var n;return n=e.call(this,r)||this,n.node=null,n._unobserveCb=null,n.handleNode=function(s){n.node&&(n.unobserve(),!s&&!n.props.triggerOnce&&!n.props.skip&&n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=s||null,n.observeNode()},n.handleChange=function(s,a){s&&n.props.triggerOnce&&n.unobserve(),SX(n.props)||n.setState({inView:s,entry:a}),n.props.onChange&&n.props.onChange(s,a)},n.state={inView:!!r.initialInView,entry:void 0},n}var i=t.prototype;return i.componentDidUpdate=function(n){(n.rootMargin!==this.props.rootMargin||n.root!==this.props.root||n.threshold!==this.props.threshold||n.skip!==this.props.skip||n.trackVisibility!==this.props.trackVisibility||n.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(!(!this.node||this.props.skip)){var n=this.props,s=n.threshold,a=n.root,o=n.rootMargin,l=n.trackVisibility,c=n.delay,u=n.fallbackInView;this._unobserveCb=Jk(this.node,this.handleChange,{threshold:s,root:a,rootMargin:o,trackVisibility:l,delay:c},u)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!SX(this.props)){var n=this.state,s=n.inView,a=n.entry;return this.props.children({inView:s,entry:a,ref:this.handleNode})}var o=this.props,l=o.children,c=o.as,u=P9e(o,O9e);return fe.createElement(c||"div",GB({ref:this.handleNode},u),l)},t}(fe.Component);RC.displayName="InView";RC.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function B9e(e){var t=e===void 0?{}:e,i=t.threshold,r=t.delay,n=t.trackVisibility,s=t.rootMargin,a=t.root,o=t.triggerOnce,l=t.skip,c=t.initialInView,u=t.fallbackInView,h=fe.useRef(),d=fe.useState({inView:!!c}),p=d[0],f=d[1],g=fe.useCallback(function(v){h.current!==void 0&&(h.current(),h.current=void 0),!l&&v&&(h.current=Jk(v,function(x,y){f({inView:x,entry:y}),y.isIntersecting&&o&&h.current&&(h.current(),h.current=void 0)},{root:a,rootMargin:s,threshold:i,trackVisibility:n,delay:r},u))},[Array.isArray(i)?i.toString():i,a,s,o,l,n,u,r]);fe.useEffect(function(){!h.current&&p.entry&&!o&&!l&&f({inView:!!c})});var m=[g,p.inView,p.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}const F9e=Object.freeze(Object.defineProperty({__proto__:null,InView:RC,default:RC,defaultFallbackInView:D9e,observe:Jk,useInView:B9e},Symbol.toStringTag,{value:"Module"})),N9e=rse(F9e);var qh=Kk(fe),Sr=Kk(MK),KA=Kk(one),U9e=N9e;function Kk(e){return e&&e.__esModule?e:{default:e}}const k9e=({children:e="",className:t="",contentArrowStyle:i=null,contentStyle:r=null,date:n="",dateClassName:s="",icon:a=null,iconClassName:o="",iconOnClick:l=null,onTimelineElementClick:c=null,iconStyle:u=null,id:h="",position:d="",style:p=null,textClassName:f="",intersectionObserverProps:g={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:m=!1})=>qh.default.createElement(U9e.InView,g,({inView:v,ref:x})=>qh.default.createElement("div",{ref:x,id:h,className:(0,KA.default)(t,"vertical-timeline-element",{"vertical-timeline-element--left":d==="left","vertical-timeline-element--right":d==="right","vertical-timeline-element--no-children":e===""}),style:p},qh.default.createElement(qh.default.Fragment,null,qh.default.createElement("span",{style:u,onClick:l,className:(0,KA.default)(o,"vertical-timeline-element-icon",{"bounce-in":v||m,"is-hidden":!(v||m)})},a),qh.default.createElement("div",{style:r,onClick:c,className:(0,KA.default)(f,"vertical-timeline-element-content",{"bounce-in":v||m,"is-hidden":!(v||m)})},qh.default.createElement("div",{style:i,className:"vertical-timeline-element-content-arrow"}),e,qh.default.createElement("span",{className:(0,KA.default)(s,"vertical-timeline-element-date")},n)))));k9e.propTypes={children:Sr.default.oneOfType([Sr.default.arrayOf(Sr.default.node),Sr.default.node]),className:Sr.default.string,contentArrowStyle:Sr.default.shape({}),contentStyle:Sr.default.shape({}),date:Sr.default.node,dateClassName:Sr.default.string,icon:Sr.default.element,iconClassName:Sr.default.string,iconStyle:Sr.default.shape({}),iconOnClick:Sr.default.func,onTimelineElementClick:Sr.default.func,id:Sr.default.string,position:Sr.default.string,style:Sr.default.shape({}),textClassName:Sr.default.string,visible:Sr.default.bool,intersectionObserverProps:Sr.default.shape({root:Sr.default.object,rootMargin:Sr.default.string,threshold:Sr.default.number,triggerOnce:Sr.default.bool})};const z9e=({name:e,description:t,tags:i,image:r,source_code_link:n})=>He.jsx(kc.div,{variants:YT("up","spring"),children:He.jsxs(nne,{options:{max:45,scale:1,speed:450},className:"bg-tertiary p-5 rounded-2xl sm:w-[360px] w-full",children:[He.jsxs("div",{className:"relative w-full h-[230px]",children:[He.jsx("img",{src:r,alt:"project_image",className:"w-full h-full object-cover rounded-2xl"}),He.jsx("div",{className:"absolute inset-0 flex justify-end m-3 card-img_hover",children:He.jsx("div",{onClick:()=>window.open(n,"_blank"),className:"black-gradient w-10 h-10 rounded-full flex justify-center items-center cursor-pointer",children:He.jsx("img",{src:c9e,alt:"source code",className:"w-1/2 h-1/2 object-contain"})})})]}),He.jsxs("div",{className:"mt-5",children:[He.jsx("h3",{className:"text-white font-bold text-[24px]",children:e}),He.jsx("p",{className:"mt-2 text-secondary text-[14px]",children:t})]}),He.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:i.map(s=>He.jsxs("p",{className:`text-[14px] ${s.color}`,children:["#",s.name]},s.name))})]})}),V9e=()=>He.jsxs(He.Fragment,{children:[He.jsxs(kc.div,{variants:sne(),children:[He.jsx("p",{className:`${Dl.sectionSubText} `,children:"My work"}),He.jsx("h2",{className:`${Dl.sectionHeadText}`,children:"Projects"})]}),He.jsx("div",{className:"w-full flex",children:He.jsx(kc.p,{variants:YT("","",.1),className:"mt-3 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"Following projects showcase my skills and experience through examples of my work. Each project is briefly described with links to code repositories in it."})}),He.jsx("div",{className:"mt-20 flex flex-wrap gap-7",children:f9e.map((e,t)=>He.jsx(z9e,{...e},`project-${t}`))})]}),G9e=qk(V9e,""),Mw={_origin:"https://api.emailjs.com"},H9e=(e,t="https://api.emailjs.com")=>{Mw._userID=e,Mw._origin=t},cne=(e,t,i)=>{if(!e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!i)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class AX{constructor(t){this.status=t?t.status:0,this.text=t?t.responseText:"Network Error"}}const une=(e,t,i={})=>new Promise((r,n)=>{const s=new XMLHttpRequest;s.addEventListener("load",({target:a})=>{const o=new AX(a);o.status===200||o.text==="OK"?r(o):n(o)}),s.addEventListener("error",({target:a})=>{n(new AX(a))}),s.open("POST",Mw._origin+e,!0),Object.keys(i).forEach(a=>{s.setRequestHeader(a,i[a])}),s.send(t)}),j9e=(e,t,i,r)=>{const n=r||Mw._userID;return cne(n,e,t),une("/api/v1.0/email/send",JSON.stringify({lib_version:"3.12.1",user_id:n,service_id:e,template_id:t,template_params:i}),{"Content-type":"application/json"})},W9e=e=>{let t;if(typeof e=="string"?t=document.querySelector(e):t=e,!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return t},X9e=(e,t,i,r)=>{const n=r||Mw._userID,s=W9e(i);cne(n,e,t);const a=new FormData(s);return a.append("lib_version","3.12.1"),a.append("service_id",e),a.append("template_id",t),a.append("user_id",n),une("/api/v1.0/email/send-form",a)},Y9e={init:H9e,send:j9e,sendForm:X9e},k3=({label:e,value:t,onChange:i,placeholder:r,name:n,type:s})=>He.jsxs("label",{className:"flex flex-col",children:[He.jsx("span",{className:"text-white font-medium mb-4",children:e}),He.jsx("input",{type:s,name:n,value:t,onChange:i,placeholder:r,className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),q9e=()=>{const e=fe.useRef(),[t,i]=fe.useState({name:"",email:"",message:""}),[r,n]=fe.useState(!1),[s,a]=fe.useState(""),[o,l]=fe.useState(""),[c,u]=fe.useState(""),h=f=>{const{name:g,value:m}=f.target;i({...t,[g]:m})},d=f=>/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(f),p=f=>{if(f.preventDefault(),a(""),l(""),u(""),!d(t.email)){a("Please enter a valid email address.");return}if(!t.name.trim()){l("Name is required.");return}n(!0),Y9e.send("service_r2i0by4","template_mf5x3bh",{from_name:t.name,to_name:"Qaisar Mateen",from_email:t.email,to_email:"qaisarmateen313@gmail.com",message:t.message},"p-gXzzyvEhPaJ0XA-").then(()=>{n(!1),u("Thank you! I will get back to you as soon as possible."),i({name:"",email:"",message:""})}).catch(g=>{n(!1),console.error(g),u("Something went wrong. Please try again. :/")})};return He.jsxs("div",{className:"xl:mt-12 flex xl:flex-row flex-col-reverse gap-10 overflow-hidden",children:[He.jsxs(kc.div,{variants:bX("left","tween",.2,1),className:"flex-[0.75] bg-black-100 p-8 rounded-2xl",children:[He.jsx("p",{className:Dl.sectionSubText,children:"Get in touch"}),He.jsx("h3",{className:Dl.sectionHeadText,children:"Contact Me"}),He.jsxs("form",{ref:e,onSubmit:p,className:"mt-12 flex flex-col gap-8",children:[He.jsx(k3,{label:"Your Name",name:"name",value:t.name,onChange:h,placeholder:"Insert Your name here...",type:"text"}),o&&He.jsx("span",{className:"text-red-500",children:o}),He.jsx(k3,{label:"Email Address",name:"email",value:t.email,onChange:h,placeholder:"What's your email address?",type:"email"}),s&&He.jsx("span",{className:"text-red-500",children:s}),He.jsx(k3,{label:"Your Message",name:"message",value:t.message,onChange:h,placeholder:"What you want to say...?",type:"text"}),He.jsx("button",{type:"submit",className:"bg-tertiary py-3 px-8 rounded-xl outline-none w-fit text-white font-bold shadow-md shadow-primary",children:r?"Sending...":"Send"}),c&&He.jsx("p",{className:"text-green-500",children:c})]})]}),He.jsx(kc.div,{variants:bX("right","tween",.2,1),className:"xl:flex-1 xl:h-auto md:h-[550px] h-[350px]",children:He.jsx(L0e,{})})]})},Q9e=qk(q9e,"contact"),J9e=()=>He.jsx(ile,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:He.jsxs("div",{className:"relative z-0 bg-primary",children:[He.jsxs("div",{className:"bg-hero-pattern bg-cover bg-no-repeat bg-center",children:[He.jsx(m9e,{}),He.jsx(Z8e,{})]}),He.jsx(A9e,{}),He.jsx(G9e,{}),He.jsxs("div",{className:"relative z-0",children:[He.jsx(Q9e,{}),He.jsx(N0e,{})]})]})}),K9e=document.getElementById("root"),Z9e=Doe.createRoot(K9e);Z9e.render(He.jsx(Ku.StrictMode,{children:He.jsx(J9e,{})}));export{M1 as c,E0 as g};
